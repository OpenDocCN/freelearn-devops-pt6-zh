<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer355">
    <h1 class="chapterNumber">17</h1>
    <h1 class="chapterTitle" id="_idParaDest-553">Kubernetes Clusters on Microsoft Azure with Azure Kubernetes Service</h1>
    <p class="normal">The final public cloud Kubernetes service we’ll examine is <strong class="keyWord">Azure Kubernetes Service</strong> (<strong class="keyWord">AKS</strong>), hosted in Microsoft Azure, one of the “big three” public cloud providers – the other two of the big three we have already covered in <em class="chapterRef">Chapter 15</em>, <em class="italic">Kubernetes Clusters on Google Kubernetes Engine</em>, and <em class="chapterRef">Chapter 16</em>, <em class="italic">Launching a Kubernetes Cluster on Amazon Web Services with Amazon Elastic Kubernetes Service</em>.</p>
    <p class="normal">By the end of the chapter, you will have configured your local environment with the tools needed to interact with your Microsoft Azure account and launch your AKS cluster. </p>
    <p class="normal">After deploying the cluster, we’ll launch the same workload as in the previous chapters and explore the integration level between your AKS cluster and the Microsoft Azure portal.</p>
    <p class="normal">Finally, at the end of the chapter, we will discuss the three services we covered in this and the previous two chapters, as well as which one I would recommend.</p>
    <p class="normal">To do this, we will be covering the following topics:</p>
    <ul>
      <li class="bulletList">What are Microsoft Azure and Azure Kubernetes Service?</li>
      <li class="bulletList">Preparing your local environment</li>
      <li class="bulletList">Launching your Azure Kubernetes Service cluster</li>
      <li class="bulletList">Deploying a workload and interacting with your cluster</li>
      <li class="bulletList">Deleting your Azure Kubernetes Service cluster</li>
    </ul>
    <h1 class="heading-1" id="_idParaDest-554">Technical requirements</h1>
    <p class="normal">If you plan on following along with the examples covered in this chapter, you need a Microsoft Azure account with a valid payment method attached.</p>
    <div class="note">
      <p class="normal">Following the examples in this chapter will incur a cost, and it is essential to terminate any resources you launch once you have finished with them to prevent unwanted expenses. All prices quoted in this chapter are correct at the time of print, and we recommend that you review the current costs before you launch any resources.</p>
    </div>
    <h1 class="heading-1" id="_idParaDest-555">What are Microsoft Azure and Azure Kubernetes Service?</h1>
    <p class="normal">Before we start to look at installing the supporting tools, let’s quickly discuss the origins of the services we’ll be looking at, starting with Microsoft Azure.</p>
    <h2 class="heading-2" id="_idParaDest-556">Microsoft Azure</h2>
    <p class="normal">In 2008, Microsoft formally <a id="_idIndexMarker1437"/>announced that it had a new service called Windows<a id="_idIndexMarker1438"/> Azure. </p>
    <p class="normal">This service was part of a <a id="_idIndexMarker1439"/>project known internally as Project Red Dog, which had been in development since 2004. This project aimed to deliver data center services using core Windows components.</p>
    <p class="normal">The five core components that Microsoft announced at their 2008 developer conference were as follows:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Microsoft SQL Data Services</strong>: This was a cloud version of the Microsoft SQL Database service running as a <strong class="keyWord">Platform </strong><strong class="keyWord"><a id="_idIndexMarker1440"/></strong><strong class="keyWord">as a Service</strong> (<strong class="keyWord">PaaS</strong>), which aimed to remove the complexity of hosting your own SQL services.</li>
      <li class="bulletList"><strong class="keyWord">Microsoft .NET Services</strong>: Another PaaS service that allowed developers to deploy their .NET-based<a id="_idIndexMarker1441"/> applications into a Microsoft-managed .NET runtime.</li>
      <li class="bulletList"><strong class="keyWord">Microsoft SharePoint</strong>: A <strong class="keyWord">Software </strong><strong class="keyWord"><a id="_idIndexMarker1442"/></strong><strong class="keyWord">as a Service</strong> (<strong class="keyWord">SaaS</strong>) version of the popular intranet product.</li>
      <li class="bulletList"><strong class="keyWord">Microsoft Dynamics</strong>: A SaaS version<a id="_idIndexMarker1443"/> of Microsoft’s CRM product.</li>
      <li class="bulletList"><strong class="keyWord">Windows Azure</strong>: An <strong class="keyWord">Infrastructure as</strong><strong class="keyWord"><a id="_idIndexMarker1444"/></strong><strong class="keyWord"> a Service</strong> (<strong class="keyWord">IaaS</strong>) offering, like other cloud providers, enabling users to spin up virtual machines, storage, and the networking services needed to support their compute workloads.</li>
    </ul>
    <p class="normal">All these services were built on top of the Red Dog operating system, from which the project took its name; this was a specialized version of the Windows operating system with a built-in cloud layer.</p>
    <p class="normal">In 2014, Windows Azure was<a id="_idIndexMarker1445"/> renamed Microsoft Azure, reflecting the name of the underlying operating system powering the cloud services and that Azure was running many Linux-based workloads. As part of this announcement, newly appointed Microsoft CEO Satya Nadella showed the now famous (or infamous, depending on your point of view) “Microsoft loves Linux” slide, with “loves” represented by a heart emoji.</p>
    <p class="normal">I say “famous” and “infamous” because one-time Microsoft CEO Steve Ballmer was once quoted as saying the following:</p>
    <blockquote class="packt_quote">
      <p class="quote">“Linux is a cancer that attaches itself in an intellectual property sense to everything it touches.”</p>
    </blockquote>
    <p class="normal">So, this was seen as quite a U-turn, which took many by surprise.</p>
    <p class="normal">In 2020, it was revealed that more than 50% of virtual machine cores are running Linux workloads, and 60% of Azure Marketplace images are now Linux-based. This is primarily attributed to Microsoft’s embrace of Linux and open-source projects like Kubernetes, which has led us to their native Kubernetes service.</p>
    <h2 class="heading-2" id="_idParaDest-557">Azure Kubernetes Service</h2>
    <p class="normal">Originally, Microsoft launched <a id="_idIndexMarker1446"/>a container-based service called <strong class="keyWord">Azure Container Service </strong>(<strong class="keyWord">ACS</strong>). This allowed users to deploy their container workloads and choose to<a id="_idIndexMarker1447"/> have them powered by one of three different orchestrators: Docker Swarm, DC/OS, or Kubernetes. All of these provided a container-based cluster solution.</p>
    <p class="normal">It soon became apparent that Kubernetes was the most popular of the three orchestrators, so ACS was gradually<a id="_idIndexMarker1448"/> replaced by AKS. AKS is a CNCF-compliant, purely Kubernetes-based service. The transition took about two years, with AKS becoming generally available in 2018 and ACS being retired in early 2020.</p>
    <p class="normal">The AKS service is closely integrated with Azure Active Directory, Policies, and other key Microsoft Azure services. Alongside AKS, Microsoft also offers other container services; the newest is called Azure Container Apps.</p>
    <p class="normal">Azure Container <a id="_idIndexMarker1449"/>Apps is a serverless platform that runs containerized applications without the end user managing infrastructure, with features such as dynamic scaling based on traffic, event, CPU, or memory load, HTTPS or TCP ingress, Dapr integration, and autoscaling. It allows the use of various Azure native tools for management, secure secret handling, internal service discovery, and traffic splitting for deployment strategies. Applications can run containers from any registry and integrate with other Azure services. Confusingly, you can also choose to launch your container-based workloads in Azure App Services.</p>
    <p class="normal">However, rather than discussing all the services in Microsoft Azure that you can use to run your container-based workloads, I have always found it easier to roll up your sleeves and get hands-on with a service, so without further delay, let’s look at installing the tools we will need to launch and manage our AKS cluster.</p>
    <h1 class="heading-1" id="_idParaDest-558">Preparing your local environment</h1>
    <p class="normal">Before you launch your cluster, there are a few tasks you need to complete. First, you will need somewhere to launch the <a id="_idIndexMarker1450"/>cluster, so if you don’t already have one, you will need to sign up for an Azure account.</p>
    <h2 class="heading-2" id="_idParaDest-559">Creating a free Microsoft Azure account</h2>
    <p class="normal">If you don’t already<a id="_idIndexMarker1451"/> have an account, head to <a href="https://azure.microsoft.com/free/"><span class="url">https://azure.microsoft.com/free/</span></a>, where you can sign up for a free account:</p>
    <figure class="mediaobject"><img alt="A computer on a white background&#10;&#10;Description automatically generated" src="image/B22019_17_01.png"/></figure>
    <p class="packt_figref">Figure 17.1: Reviewing what Microsoft Azure services you can get for free</p>
    <p class="normal">At the time of writing, your free account includes 12 months of popular services, $200 of credit that can be used to explore and test the different Azure services, and access to over 55 services that will always be free.</p>
    <p class="normal">Click on the <strong class="screenText">Start free</strong> button and follow the onscreen instructions. The sign-up process will take about 15 minutes, and <a id="_idIndexMarker1452"/>you will need to provide valid credit or debit card information to complete it and gain access to your free account.</p>
    <p class="normal">Once you can access your account, the next step is installing the Azure CLI.</p>
    <h2 class="heading-2" id="_idParaDest-560">The Azure CLI</h2>
    <p class="normal">Microsoft provides a <a id="_idIndexMarker1453"/>powerful cross-platform command-line tool for managing your Microsoft Azure resources. Installing it on macOS, Linux, and, of course, Windows couldn’t be more straightforward.</p>
    <h3 class="heading-3" id="_idParaDest-561">Installing on macOS</h3>
    <p class="normal">If you have been following <a id="_idIndexMarker1454"/>along with the previous two chapters, you<a id="_idIndexMarker1455"/> may have already guessed that we will use Homebrew to install the Azure CLI on macOS.</p>
    <p class="normal">To do this, run the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>brew install azure-cli
</code></pre>
    <p class="normal">Once the Azure CLI has been installed, run the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az --version
</code></pre>
    <p class="normal">This should return something like the following screenshot:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer program&#10;&#10;Description automatically generated" src="image/B22019_17_02.png"/> </figure>
    <p class="packt_figref">Figure 17.2: Checking the Azure CLI version on macOS</p>
    <p class="normal">Once the Azure CLI has been installed, you can move on to the <em class="italic">Configuring the Azure CLI</em> section.</p>
    <h3 class="heading-3" id="_idParaDest-562">Installing on Linux</h3>
    <p class="normal">Microsoft provides<a id="_idIndexMarker1456"/> an installation script that covers the most common Linux distributions. To<a id="_idIndexMarker1457"/> run the script, use the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>curl -L https://aka.ms/InstallAzureCli | bash
</code></pre>
    <p class="normal">This will download, install, and configure everything required to run the Azure CLI on your Linux distribution of choice. Once it has been installed, you will need to restart your session.</p>
    <p class="normal">You can do this by<a id="_idIndexMarker1458"/> logging out and then back in, or, on some distributions, by running the <a id="_idIndexMarker1459"/>following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">source</span> ~/.profile
</code></pre>
    <p class="normal">Once you have restarted your session, run the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az --version
</code></pre>
    <p class="normal">This will return output almost exactly the same as the macOS output we covered when installing the CLI on that operating system, with the only difference being information on the operating system. Once the Azure CLI has been installed, move on to the <em class="italic">Configuring the Azure CLI</em> section.</p>
    <h3 class="heading-3" id="_idParaDest-563">Installing on Windows</h3>
    <p class="normal">You can install the<a id="_idIndexMarker1460"/> Azure CLI on Windows machines in a few ways. Your first option is to<a id="_idIndexMarker1461"/> download a copy of the installer from <a href="https://aka.ms/installazurecliwindows"><span class="url">https://aka.ms/installazurecliwindows</span></a> and then run the installer by double-clicking it.</p>
    <p class="normal">Your next option is to use the following PowerShell command, which will download the installer from the preceding URL and install it:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span>ProgressPreference = <span class="hljs-con-string">'SilentlyContinue'</span>; Invoke-WebRequest -Uri https://aka.ms/installazurecliwindows -OutFile .\AzureCLI.msi; Start-Process msiexec.exe -Wait -ArgumentList <span class="hljs-con-string">'/I AzureCLI.msi /quiet'</span>; Remove-Item .\AzureCLI.msi
</code></pre>
    <p class="normal">The third option is to use the <strong class="keyWord">Chocolatey</strong> package manager<a id="_idIndexMarker1462"/> by running the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>choco install azure-cli
</code></pre>
    <p class="normal">Whichever way you choose to install the package, run the following command once it has been installed to find out the version number:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az --version
</code></pre>
    <p class="normal">As you may have guessed, this will also show you something similar to the output we saw when running the command<a id="_idIndexMarker1463"/> on macOS. Now that we have the Azure CLI installed, we can configure<a id="_idIndexMarker1464"/> it.</p>
    <h3 class="heading-3" id="_idParaDest-564">Configuring the Azure CLI</h3>
    <p class="normal">Configuring the Azure<a id="_idIndexMarker1465"/> CLI is a straightforward process; you need to run the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az login
</code></pre>
    <p class="normal">This will open your default browser, asking you to log in. Once you are logged in, the Azure CLI will be configured to work the account associated with the user you logged in as.</p>
    <p class="normal">If you are having problems or running a command-line-only installation of the Azure CLI (on a remote Linux server, for example), then running the following command will give you a URL and unique sign-in code to use:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az login --use-device-code
</code></pre>
    <p class="normal">Once you are logged in, your command-line session should return some information on your Azure account. You can view this again by using the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az account show
</code></pre>
    <p class="normal">If you cannot install the Azure CLI locally for any reason, you will not lose anything, as there is a web-based terminal with the Azure CLI you can use in the Azure portal. We will look at this next.</p>
    <h3 class="heading-3" id="_idParaDest-565">Accessing Azure Cloud Shell</h3>
    <p class="normal">To access Azure Cloud Shell, open <a href="https://portal.azure.com/"><span class="url">https://portal.azure.com/</span></a> and log in with your credentials. Once <a id="_idIndexMarker1466"/>you’re logged in, click on the Cloud Shell icon in the<a id="_idIndexMarker1467"/> menu bar, which is found at the top of the page; it is the first icon next to the central search box.</p>
    <p class="normal">When launching a cloud shell, you have the option of attaching storage. Given that we will be using <code class="inlineCode">kubectl</code>, we want our configuration to persist, so select the <strong class="screenText">Mount storage account</strong> option and choose your<a id="_idIndexMarker1468"/> subscription, as shown in the following screenshot:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_03.png"/></figure>
    <p class="packt_figref">Figure 17.3: Choosing a storage option for your cloud shell session</p>
    <p class="normal">Clicking on the <strong class="screenText">Apply</strong> button will then present you with three options, as you can see in the following <a id="_idIndexMarker1469"/>screenshot. Choose the <strong class="screenText">We will create a storage account for you</strong> option:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_04.png"/></figure>
    <p class="packt_figref">Figure 17.4: How do you want to create a storage account?</p>
    <p class="normal">After about a minute, <strong class="screenText">Cloud Shell</strong> should<a id="_idIndexMarker1470"/> open, and you will be presented with a command prompt:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_05.png"/></figure>
    <p class="packt_figref">Figure 17.5: Logged in and ready to use</p>
    <p class="normal">Now that you have a<a id="_idIndexMarker1471"/> command prompt, running the following command, as we did on the local Azure CLI installation, will give you information on the version of the Azure CLI installed:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az --version
</code></pre>
    <p class="normal">You will not need to run the <code class="inlineCode">az login</code> command as the Azure portal took care of that for you in the background when your <strong class="screenText">Cloud Shell</strong> instance was launched.</p>
    <p class="normal">Now that you have access to a configured Azure CLI, in one form or another, we can look at launching our AKS cluster.</p>
    <h1 class="heading-1" id="_idParaDest-566">Launching your Azure Kubernetes Service cluster</h1>
    <p class="normal">With all of the prerequisites in <a id="_idIndexMarker1472"/>place, we can now launch our AKS cluster. To do this, we will need to run just two commands.</p>
    <p class="normal">The first of the commands creates an Azure resource group:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az group create --name rg-myfirstakscluster-eus --location eastus -o table
</code></pre>
    <p class="normal">In the preceding command, we are creating a resource group called <code class="inlineCode">rg-myfirstakscluster-eus</code> in the <code class="inlineCode">eastus</code> region and setting the output to be formatted as a table rather than the JSON, which is the default output type for the Azure CLI.</p>
    <div class="note">
      <p class="normal">A <strong class="keyWord">resource group</strong> is a logical container used to <a id="_idIndexMarker1473"/>group related Azure resources. Services launched within the resource group can inherit settings such as role-based access control, locks, and regions in which the resources are launched.</p>
    </div>
    <p class="normal">Once the resource group has been <a id="_idIndexMarker1474"/>created, you should see confirmation formatted in a table like the output below:</p>
    <figure class="mediaobject"><img alt="A screen shot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_06.png"/></figure>
    <p class="packt_figref">Figure 17.6: Creating the resource group</p>
    <p class="normal">Now that we have a container for our resources with the resource group, we can launch our AKS cluster by running the command below. As you can see, it references the resource group we just created:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az aks create --resource-group rg-myfirstakscluster-eus --name aks-myfirstakscluster-eus --node-count 2 --enable-addons monitoring --generate-ssh-keys -o yaml
</code></pre>
    <p class="normal">Launching and configuring the cluster will take about five minutes, so while that deploys, I will work through the options we passed to the preceding <code class="inlineCode">az aks create</code> command:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">--resource-group</code>: As you may have guessed, this is the resource group where you would like to launch your AKS cluster. The cluster will inherit the resource group’s location. In our example, we are using the <code class="inlineCode">rg-myfirstakscluster-eus</code> resource group we created in the command before last, and the cluster will be created in <code class="inlineCode">eastus</code>.</li>
      <li class="bulletList"><code class="inlineCode">--name</code>: This passes the name of the cluster you are launching. We are calling ours <code class="inlineCode">aks-myfirstakscluster-eus</code>.</li>
      <li class="bulletList"><code class="inlineCode">--node-count</code>: Here, you set the number of nodes you want to launch. We are launching two. At the time of writing, the default instance type for nodes is Standard_DS2_v2, meaning that each node will have 2 x vCPUs and 7 GB of RAM.</li>
      <li class="bulletList"><code class="inlineCode">--enable-addons</code>: This flag is used to supply a list of add-ons to enable while the cluster is being launched – we are just enabling the monitoring add-on.</li>
      <li class="bulletList"><code class="inlineCode">--generate-ssh-keys</code>: This will generate SSH public and private key files for the cluster.</li>
      <li class="bulletList"><code class="inlineCode">-o</code>: As we mentioned when discussing the previous command, this determines the command output format. This time, we output the results returned as YAML when we run the command because the output is more readable than the JSON and table options.</li>
    </ul>
    <p class="normal">Once your cluster has been<a id="_idIndexMarker1475"/> launched, you should see something like the following output:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_07.png"/></figure>
    <p class="packt_figref">Figure 17.7: Viewing the output of the cluster launch</p>
    <p class="normal">As you can see, there is a lot of information. We will not worry about this, though, as we will use the Azure CLI and portal to interact with the cluster rather than handcrafting API requests to the Azure Resource Manager API.</p>
    <p class="normal">Now that our cluster is up and running, the last task we need to do before deploying our example workload is to configure our local <code class="inlineCode">kubectl</code> client to interact with the cluster. </p>
    <p class="normal">To do this, run the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az aks get-credentials --resource-group rg-myfirstakscluster-eus --name aks-myfirstakscluster-eus
</code></pre>
    <p class="normal">Once this command has been run, you should see something like the following:</p>
    <figure class="mediaobject"><img alt="" src="image/B22019_17_08.png"/></figure>
    <p class="packt_figref">Figure 17.8: Downloading the cluster credentials and configuring kubectl</p>
    <p class="normal">With our cluster launched and the local <code class="inlineCode">kubectl</code> configured, we can now start issuing commands against the cluster, and if you have been through the previous two chapters, you will already know that the command is:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>kubectl get nodes
</code></pre>
    <p class="normal">This will return the nodes<a id="_idIndexMarker1476"/> within the cluster, as shown in the following screenshot:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_09.png"/></figure>
    <p class="packt_figref">Figure 17.9: Checking the nodes are up and running</p>
    <p class="normal">We are now able to launch the example guestbook workload that we have been using in the previous two chapters to test our cluster.</p>
    <h1 class="heading-1" id="_idParaDest-567">Deploying a workload and interacting with your cluster</h1>
    <p class="normal">We are <a id="_idIndexMarker1477"/>going to be using the <a id="_idIndexMarker1478"/>same workload we launched in <em class="chapterRef">Chapter 15</em>, <em class="italic">Kubernetes Clusters on Google Kubernetes Engine</em>, and <em class="chapterRef">Chapter 16</em>, <em class="italic">Launching a Kubernetes Cluster on Amazon Web Services with Amazon Elastic Kubernetes Service</em>, so I am not going to go into detail here other than to cover the commands.</p>
    <h2 class="heading-2" id="_idParaDest-568">Launching the workload</h2>
    <p class="normal">We start with the <a id="_idIndexMarker1479"/>Redis leader deployment and service:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>kubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/kubernetes-engine-samples/main/quickstarts/guestbook/redis-leader-deployment.yaml
<span class="hljs-con-meta">$ </span>kubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/kubernetes-engine-samples/main/quickstarts/guestbook/redis-leader-service.yaml
</code></pre>
    <p class="normal">Followed by the Redis follower:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>kubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/kubernetes-engine-samples/main/quickstarts/guestbook/redis-follower-deployment.yaml
<span class="hljs-con-meta">$ </span>kubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/kubernetes-engine-samples/main/quickstarts/guestbook/redis-follower-service.yaml
</code></pre>
    <p class="normal">Finally, we can launch the frontend deployment and service using the following commands:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>kubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/kubernetes-engine-samples/main/quickstarts/guestbook/frontend-deployment.yaml
<span class="hljs-con-meta">$ </span>kubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/kubernetes-engine-samples/main/quickstarts/guestbook/frontend-service.yaml
</code></pre>
    <p class="normal">Then, after a few minutes, we will be able to run the following command to get information on the frontend service:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>kubectl get service frontend
</code></pre>
    <p class="normal">Like the previous times, we have deployed the example workload. This will give us the public IP address we can use to access the guestbook application:</p>
    <figure class="mediaobject"><img alt="" src="image/B22019_17_10.png"/></figure>
    <p class="packt_figref">Figure 17.10: Getting information on the frontend service</p>
    <p class="normal">Entering the IP address into a browser, making sure to use <code class="inlineCode">http://&lt;ipaddress&gt;</code> as we have not configured an SSL <a id="_idIndexMarker1480"/>certificate, will show the Guestbook application:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_11.png"/></figure>
    <p class="packt_figref">Figure 17.11: Viewing the Guestbook application</p>
    <p class="normal">We can move to the Azure portal now that the workload is running.</p>
    <h2 class="heading-2" id="_idParaDest-569">Exploring the Azure portal</h2>
    <p class="normal">If you haven’t already, log in to the Azure portal at <a href="https://portal.azure.com/"><span class="url">https://portal.azure.com/</span></a>. Once you are logged in, start <a id="_idIndexMarker1481"/>typing <strong class="keyWord">Kubernetes</strong> into the Search resources, services, and docs search box at the top of the page. </p>
    <p class="normal">In the list of services, you will see <strong class="screenText">Kubernetes services</strong>. Click on this service, and you will be presented with a list of Kubernetes services running within the subscriptions your user has access to.</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_12.png"/></figure>
    <p class="packt_figref">Figure 17.12: Listing the Kubernetes services</p>
    <p class="normal">Clicking on <code class="inlineCode">aks-myfirstakscluster-eus</code> will take you to an overview page. This will be our jumping-off point for viewing our workload and cluster information.</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_13.png"/></figure>
    <p class="packt_figref">Figure 17.13: The cluster overview page</p>
    <p class="normal">You will see several options under the Kubernetes resources menu on the left. Let’s work through them one by one.</p>
    <h3 class="heading-3" id="_idParaDest-570">Namespaces (Kubernetes resources)</h3>
    <p class="normal">Here, you will find all the namespaces active within the cluster. As we didn’t define a custom namespace when we launched our <a id="_idIndexMarker1482"/>workload, our deployments and services will be listed under the <code class="inlineCode">default</code> namespace.</p>
    <p class="normal">In addition to the <code class="inlineCode">default</code> namespace, there are also the ones deployed as part of the cluster: <code class="inlineCode">kube-node-lease</code>, <code class="inlineCode">kube-public</code>, and <code class="inlineCode">kube-system</code>. I recommend leaving these alone.</p>
    <p class="normal">You will be presented with the <strong class="screenText">Overview</strong> page if you click on the default namespace. Here, you can edit the YAML that defines the namespaces, view an events log, and configure any service meshes that may have been deployed; in our test, there aren’t any.</p>
    <h3 class="heading-3" id="_idParaDest-571">Workloads (Kubernetes resources)</h3>
    <p class="normal">As you may have already guessed, you can <a id="_idIndexMarker1483"/>view information on your workload here. In the following screenshot, I have filtered the list only to show the workloads in the default namespace:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_14.png"/></figure>
    <p class="packt_figref">Figure 17.14: Viewing the workloads</p>
    <p class="normal">Clicking on one of the<a id="_idIndexMarker1484"/> deployments will give you a more detailed view of the deployment. For example, selecting the <strong class="screenText">frontend</strong> deployment shows the following:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_15.png"/></figure>
    <p class="packt_figref">Figure 17.15: Drilling down into a deployment</p>
    <p class="normal">As you can see from the menu <a id="_idIndexMarker1485"/>on the left, there are a few additions to the options: in addition to <strong class="screenText">YAML</strong> and <strong class="screenText">Events</strong>, we now have the option to view <strong class="screenText">Insights</strong>. We will cover insights in more detail at the end of this section.</p>
    <p class="normal">The next option is <strong class="screenText">Live logs</strong>. Here, you can select a pod and stream the logs in real time:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_16.png"/></figure>
    <p class="packt_figref">Figure 17.16: Viewing the pod logs in real time</p>
    <p class="normal">Returning to the <strong class="screenText">Workloads</strong> screen and selecting the <strong class="screenText">Pods</strong> tab will give you a list of the pods that make up your<a id="_idIndexMarker1486"/> workload. The IP address and the node the pod is active on are listed. This is good for getting a quick overview of your running pods.</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_17.png"/></figure>
    <p class="packt_figref">Figure 17.17: Listing all the running pods</p>
    <p class="normal">Clicking on one of the pods will give you an overview and show you the YAML and any events for the pod.</p>
    <p class="normal">The next tab on the workload screen is <strong class="screenText">Replica sets</strong>, which provides useful way to see the replica sets deployed as part of your workload at a glance. Again, clicking on one of the listed replica sets gives you the now-familiar options of <strong class="screenText">Overview</strong>, <strong class="screenText">YAML</strong>, and <strong class="screenText">Events</strong>.</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_18.png"/></figure>
    <p class="packt_figref">Figure 17.18: Listing all the replica sets</p>
    <p class="normal">The next tab in <strong class="screenText">Workloads</strong> is <strong class="screenText">Stateful sets</strong>; we don’t have any stateful sets in our namespace, nor does Microsoft in the other namespaces, so there isn’t much for us to see here. However, if there were, and if you were to select it, you would see the same information as we have seen <a id="_idIndexMarker1487"/>on the other tabs in the <strong class="screenText">Workloads</strong> section.</p>
    <p class="normal">Next up, we have the <strong class="screenText">Daemon sets</strong> tab. Again, there are no daemon sets in our workspace, but there are ones launched as part of the cluster by Microsoft that you can explore.</p>
    <p class="normal">Finally, we have the last two tabs, <strong class="screenText">Jobs</strong> and <strong class="screenText">Cron jobs</strong>; here, you will find details of any jobs and cron jobs you have deployed within the cluster.</p>
    <h3 class="heading-3" id="_idParaDest-572">Services and ingresses (Kubernetes resources)</h3>
    <p class="normal">Here, you can find a list of all the services <a id="_idIndexMarker1488"/>you have deployed in your cluster. As you can see from the following screenshot, you can get an overview of the cluster IPs used for the service along with any external IPs you have configured:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_19.png"/></figure>
    <p class="packt_figref">Figure 17.19: Viewing the services</p>
    <p class="normal">Clicking on one of the <a id="_idIndexMarker1489"/>services listed will provide the now-familiar view and allow you to drill deeper into the configuration of the services.</p>
    <h3 class="heading-3" id="_idParaDest-573">Storage (Kubernetes resources)</h3>
    <p class="normal">If we have any persistent storage <a id="_idIndexMarker1490"/>configured within the cluster, you can view the details and manage them here; in our example workload, we don’t, so there will be little to see.</p>
    <h3 class="heading-3" id="_idParaDest-574">Configuration (Kubernetes resources)</h3>
    <p class="normal">Here, you can view and edit any <a id="_idIndexMarker1491"/>ConfigMaps or Secrets you have configured within the cluster. As we don’t have any of these configured in our workload, the ones listed are for the cluster itself, so I wouldn’t recommend making any changes to the items present.</p>
    <h3 class="heading-3" id="_idParaDest-575">Custom resources (Kubernetes resources)</h3>
    <p class="normal">Here, you can manage any custom<a id="_idIndexMarker1492"/> resources attached to your cluster.</p>
    <h3 class="heading-3" id="_idParaDest-576">Events (Kubernetes resources)</h3>
    <p class="normal">Here are all the real-time events for the <a id="_idIndexMarker1493"/>cluster; these events can help you monitor and troubleshoot any health issues within the cluster and application workloads.</p>
    <h3 class="heading-3" id="_idParaDest-577">Run command (Kubernetes resources)</h3>
    <p class="normal">This is a helpful addition; here, you can run any <code class="inlineCode">kubectl</code> commands directly from the Azure portal without having to<a id="_idIndexMarker1494"/> launch a cloud shell or have your local copy of <code class="inlineCode">kubectl</code> configured:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_20.png"/></figure>
    <p class="packt_figref">Figure 17.20: Running commands against the cluster from the portal</p>
    <p class="normal">Moving onto the <strong class="screenText">Settings</strong> section of the menu, we have the following.</p>
    <h3 class="heading-3" id="_idParaDest-578">Node pools (Settings)</h3>
    <p class="normal">Here, you will find details of your node pool and the option to upgrade the Kubernetes version running within the pool. This<a id="_idIndexMarker1495"/> option is only available if you upgrade the version of Kubernetes running on the control plane.</p>
    <p class="normal">You can also scale the pool and have the option to add a node pool. In the following screenshot, we can see what the scale option looks like:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_21.png"/></figure>
    <p class="packt_figref">Figure 17.21: Reviewing the scaling options</p>
    <p class="normal">You can also view information on each of the nodes, as seen on the screen below:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_22.png"/></figure>
    <p class="packt_figref">Figure 17.22: Reviewing the nodes</p>
    <h3 class="heading-3" id="_idParaDest-579">Cluster configuration (Settings)</h3>
    <p class="normal">In the last point, I mentioned that you can only upgrade the Kubernetes version running within your node pools if you upgrade the <a id="_idIndexMarker1496"/>control plane, and this option is where you do that. Microsoft manages the control plane and separates it from your node pools. </p>
    <p class="normal">The Kubernetes control plane provides backward compatibility for up to three releases, so you can usually only upgrade within three releases of the version you are currently running.</p>
    <h3 class="heading-3" id="_idParaDest-580">Application scaling (Settings)</h3>
    <p class="normal">Here, you can enable <strong class="keyWord">Kubernetes Event-Driven Autoscaler</strong> (<strong class="keyWord">KEDA</strong>), which dynamically adjusts workloads in response to <a id="_idIndexMarker1497"/>events from external sources. At the time <a id="_idIndexMarker1498"/>of writing, there are some limitations in the scaling events that can be supported when configuring the service through the Azure portal. It supports scaling with the following sources: Azure Service Bus, Cron, Memory, and CPU.</p>
    <h3 class="heading-3" id="_idParaDest-581">Networking (Settings)</h3>
    <p class="normal">In this section, you can view and manage<a id="_idIndexMarker1499"/> your cluster’s network settings.</p>
    <h3 class="heading-3" id="_idParaDest-582">Extensions + applications (Settings)</h3>
    <p class="normal">As part of Azure<a id="_idIndexMarker1500"/> Marketplace, Microsoft provides first- and third-party applications you can deploy into your AKS cluster. In this section, you can manage these deployments.</p>
    <h3 class="heading-3" id="_idParaDest-583">Backup (Settings)</h3>
    <p class="normal">The Azure native backup services <a id="_idIndexMarker1501"/>now support backing up your Kubernetes workloads and application data; this can all be managed from here.</p>
    <h3 class="heading-3" id="_idParaDest-584">Other options (Settings)</h3>
    <p class="normal">Several other options in the <strong class="screenText">Settings</strong> menu allow you to configure various parts of your cluster and connect your cluster to<a id="_idIndexMarker1502"/> other Azure native services. If you require any further information, links to the AKS documentation can be found in the <strong class="screenText">Further reading</strong> section of this chapter at the end.</p>
    <h3 class="heading-3" id="_idParaDest-585">Insights (Monitoring)</h3>
    <p class="normal">The last part of the Azure portal we are going to look at is the <strong class="screenText">Insights</strong> option found in the <strong class="screenText">Monitoring</strong> menu in the cluster view. As<a id="_idIndexMarker1503"/> you may recall, when we deployed our cluster, we enabled the monitoring add-on using the <code class="inlineCode">--enable-addons</code> monitoring flag.</p>
    <p class="normal">This enabled Microsoft’s native monitoring to ship data from a resource to the Azure Log Analytics service. Once the data has been shipped to this service, Microsoft presents this information back to you, most commonly as insights. Most Azure services have an <strong class="screenText">Insights</strong> option, and the data here can be used by Azure Monitor to create and generate alerts.</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer&#10;&#10;Description automatically generated" src="image/B22019_17_23.png"/></figure>
    <p class="packt_figref">Figure 17.23: The Insights page</p>
    <p class="normal">There are a few tabs on the <strong class="screenText">Insights</strong> <a id="_idIndexMarker1504"/>page; let’s look:</p>
    <ul>
      <li class="bulletList"><strong class="screenText">Cluster</strong>: This is shown in the preceding screenshot and gives you a quick view of the CPU and memory utilization across the whole cluster. It also shows both node and pod counts.</li>
      <li class="bulletList"><strong class="screenText">Reports</strong>: Here, you can find pre-written reports on node monitoring (performance), resource monitoring (availability), billing, and networking. As the service matures, more reports will be added.</li>
      <li class="bulletList"><strong class="screenText">Nodes</strong>: Here, you can get an overview of your nodes.</li>
      <li class="bulletList"><strong class="screenText">Controllers</strong>: This is where you will find details on the controllers launched within your cluster – for example, replica sets and daemon sets.</li>
      <li class="bulletList"><strong class="screenText">Containers</strong>: Here, you can find details of all the containers running on your deployed pods.</li>
    </ul>
    <p class="normal">Now, you may think there is a lot of repetition in the preceding sections – and there is a little bit of that; however, if you need to see what is going on within your cluster quickly, you now have a way of getting that information without having to drill through a lot of pages to find it.</p>
    <p class="normal">I recommend looking around and clicking on as many options as possible to explore the level of integration of your cluster and the Azure portal. Once you have finished, it is time for us to remove the cluster.</p>
    <h1 class="heading-1" id="_idParaDest-586">Deleting your Azure Kubernetes Service cluster</h1>
    <p class="normal">The final thing we will look at is how to delete the cluster. Moving back to the Azure CLI, all we need to run to <a id="_idIndexMarker1505"/>delete the cluster is the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az aks delete --resource-group rg-myfirstakscluster-eus --name aks-myfirstakscluster-eus
</code></pre>
    <p class="normal">You will be asked if you are sure, and answering yes will proceed to delete the cluster.</p>
    <p class="normal">The process takes about five minutes. The preceding command only deletes the cluster and not the resource group. To delete the latter, run the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az group delete --name rg-myfirstakscluster-eus
</code></pre>
    <p class="normal">Again, you will be asked if you want to delete the group – just answer yes.</p>
    <p class="normal">So, how much will our cluster cost to run?</p>
    <p class="normal">Unlike the other two cloud services we examined in the previous two chapters, cluster management is free for non-production workloads, and you only pay for the compute resource.</p>
    <p class="normal">In our case, two Standard_DS2_v2 instances in the US East region would cost around $213 per month, or if we choose the standard cluster management, it will cost $286 per month.</p>
    <p class="normal">Other options, such as <a id="_idIndexMarker1506"/>new generations of instances, could give us a similar-sized cluster for less money. For example, we could launch a different cluster using the following commands:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>az group create --name rg-myfirstakscluster-eus --location eastus -o table
<span class="hljs-con-meta">$ </span>az aks create --resource-group rg-myfirstakscluster-eus --name aks-myfirstakscluster-eus --node-count 2 --enable-addons monitoring --generate-ssh-keys --node-vm-size standard_ds3_v2 -o yaml
</code></pre>
    <p class="normal">This will give us a two-node cluster with four vCPUs and 16 GB of RAM for around $140 per month if we go for<a id="_idIndexMarker1507"/> the non-production option.</p>
    <h1 class="heading-1" id="_idParaDest-587">Comparing the three public cloud offerings</h1>
    <p class="normal">Before we finish the chapter, let’s quickly compare the three public cloud offerings:</p>
    <table class="table-container" id="table001-5">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Feature</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Google Kubernetes Engine (GKE)</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Amazon Elastic Kubernetes Service (EKS)</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Microsoft AKS</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Kubernetes version support</p>
          </td>
          <td class="table-cell">
            <p class="normal">Latest versions, frequent <a id="_idIndexMarker1508"/>updates</p>
          </td>
          <td class="table-cell">
            <p class="normal">Slightly <a id="_idIndexMarker1509"/>behind in version support</p>
          </td>
          <td class="table-cell">
            <p class="normal">Latest<a id="_idIndexMarker1510"/> versions, frequent updates</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Automatic updates</p>
          </td>
          <td class="table-cell">
            <p class="normal">Automatic<a id="_idIndexMarker1511"/> for control plane and nodes</p>
          </td>
          <td class="table-cell">
            <p class="normal">On-demand <a id="_idIndexMarker1512"/>for control plane, manual for nodes</p>
          </td>
          <td class="table-cell">
            <p class="normal">On-demand for control plane and nodes</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Ease of use</p>
          </td>
          <td class="table-cell">
            <p class="normal">High – intuitive interface</p>
          </td>
          <td class="table-cell">
            <p class="normal">Medium – complex setup</p>
          </td>
          <td class="table-cell">
            <p class="normal">High – intuitive interface</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Integration with cloud services</p>
          </td>
          <td class="table-cell">
            <p class="normal">Strong<a id="_idIndexMarker1513"/> integration with GCP services</p>
          </td>
          <td class="table-cell">
            <p class="normal">Strong<a id="_idIndexMarker1514"/> integration with AWS services</p>
          </td>
          <td class="table-cell">
            <p class="normal">Strong integration with Azure services</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Scalability</p>
          </td>
          <td class="table-cell">
            <p class="normal">Good, supports auto-scaling</p>
          </td>
          <td class="table-cell">
            <p class="normal">Good, supports auto-scaling</p>
          </td>
          <td class="table-cell">
            <p class="normal">Good, supports auto-scaling</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Security features</p>
          </td>
          <td class="table-cell">
            <p class="normal">Strong, integrates with GCP<a id="_idIndexMarker1515"/> security tools</p>
          </td>
          <td class="table-cell">
            <p class="normal">Strong, integrates with AWS security tools</p>
          </td>
          <td class="table-cell">
            <p class="normal">Strong, integrates with Azure security tools</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Pricing</p>
          </td>
          <td class="table-cell">
            <p class="normal">Free control plane, pay for<a id="_idIndexMarker1516"/> nodes</p>
          </td>
          <td class="table-cell">
            <p class="normal">$0.10/hour for control plane and node <a id="_idIndexMarker1517"/>costs</p>
          </td>
          <td class="table-cell">
            <p class="normal">Free control plane, pay for nodes</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Multi-zone cluster support</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Private cluster support</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Serverless compute option</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes, using Cloud Run for <a id="_idIndexMarker1518"/>Anthos</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes, using<a id="_idIndexMarker1519"/> Fargate for EKS</p>
          </td>
          <td class="table-cell">
            <p class="normal">Yes, using AKS virtual nodes</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Pricing</p>
          </td>
          <td class="table-cell">
            <p class="normal">Free control plane, pay for nodes</p>
          </td>
          <td class="table-cell">
            <p class="normal">Per hour cost for control plane and node costs</p>
          </td>
          <td class="table-cell">
            <p class="normal">Free control plane, pay for nodes</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 17.1: Comparison between the three public cloud offerings</p>
    <p class="normal">There are some key points to note:</p>
    <ul>
      <li class="bulletList">GKE tends to lead in Kubernetes version support and automatic updates.</li>
      <li class="bulletList">AKS is considered by most to be the most user-friendly, especially for those already using Azure services.</li>
      <li class="bulletList">EKS charges for the control plane, while GKE and AKS only charge for the worker nodes.</li>
      <li class="bulletList">All three services offer strong integration with their respective cloud ecosystems.</li>
      <li class="bulletList">GKE is often praised for its advanced features and performance, leveraging Google’s expertise as the original creator of Kubernetes.</li>
      <li class="bulletList">Each service has unique strengths: GKE in performance and features, EKS in AWS ecosystem integration, and AKS in ease of use and Azure integration.</li>
      <li class="bulletList">The best choice often depends on your existing cloud infrastructure, requirements, and familiarity with the cloud provider’s ecosystem.</li>
    </ul>
    <p class="normal">As you can see, your choice of which of the three services to use is very much connected with which cloud services you are already running workloads in; as we have learned in the last three chapters, once your clusters have been launched, the experience is pretty much the same.</p>
    <h1 class="heading-1" id="_idParaDest-588">Summary</h1>
    <p class="normal">In this chapter, we looked at how Microsoft Azure came to be, the history behind some of Microsoft’s container services, and how they eventually settled on AKS.</p>
    <p class="normal">We then signed up for an Azure account and installed and configured the Azure CLI before launching our own AKS cluster. Once it was launched, we deployed the same workload we deployed to our GKE and Amazon EKS clusters.</p>
    <p class="normal">Once the workload was deployed, we moved onto the Azure portal and looked at the options for gaining insights into our workload and cluster and some of the cluster management options.</p>
    <p class="normal">We finally deleted the resources we launched and discussed how much the cluster would cost to run.</p>
    <p class="normal">Out of the three public cloud services we have examined over the last three chapters, I personally would put Microsoft Azure AKS first; it has the most rounded and feature-rich offerings, alongside its ease of use. I would put Google’s offering, which we discussed in <em class="chapterRef">Chapter 15</em>, <em class="italic">Kubernetes Clusters on Google Kubernetes Engine</em>, at a close second; it is good, but their pricing needs to be revised to rival Microsoft’s offering.</p>
    <p class="normal">This leaves Amazon’s service, covered in <em class="chapterRef">Chapter 16</em>, <em class="italic">Launching a Kubernetes Cluster on Amazon Web Services with Amazon Elastic Kubernetes Service</em>. AWS comes in as my least recommended service. It simply doesn’t feel as polished as the offerings by Microsoft and Google, and it should feel like you are launching a service to complement other services offered by the cloud provider. Yet, it feels like you are running a Kubernetes cluster in AWS.</p>
    <p class="normal">My personal opinion aside, the critical takeaway from having launched a Kubernetes cluster in three very different public cloud services is that once you have your cluster up and running and your <code class="inlineCode">kubectl</code> client configured to interact with it, the experience is pretty much the same and your workload doesn’t care where it is launched. You also don’t have to consider the differences between the three providers – just a few years ago, this seemed like an unthinkable situation, and genuinely cloud-agnostic workloads were just a pipe dream.</p>
    <p class="normal">In the next chapter, we are going to explore the security aspects of Kubernetes, including authentication and authorization, admission controllers, network policies, and other important topics.</p>
    <h1 class="heading-1" id="_idParaDest-589">Further reading</h1>
    <p class="normal">Here are links to more information on some of the topics and tools covered in this chapter:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Microsoft Azure</strong>: <a href="https://azure.microsoft.com/&#13;"><span class="url">https://azure.microsoft.com/</span></a></li>
      <li class="bulletList"><strong class="keyWord">AKS</strong>: <a href="https://azure.microsoft.com/services/kubernetes-service/&#13;"><span class="url">https://azure.microsoft.com/services/kubernetes-service/</span></a></li>
      <li class="bulletList"><strong class="keyWord">AKS official documentation</strong>: <a href="https://docs.microsoft.com/en-us/azure/aks/&#13;"><span class="url">https://docs.microsoft.com/en-us/azure/aks/</span></a></li>
      <li class="bulletList"><strong class="keyWord">Microsoft Loves Linux</strong>: <a href="https://www.microsoft.com/en-us/windows-server/blog/2015/05/06/microsoft-loves-linux/&#13;"><span class="url">https://www.microsoft.com/en-us/windows-server/blog/2015/05/06/microsoft-loves-linux/</span></a></li>
      <li class="bulletList"><strong class="keyWord">Ballmer</strong>: <em class="italic">“Linux is a cancer”</em>: <a href="https://www.theregister.com/2001/06/02/ballmer_linux_is_a_cancer/"><span class="url">https://www.theregister.com/2001/06/02/ballmer_linux_is_a_cancer/</span></a></li>
      <li class="bulletList"><strong class="keyWord">Ballmer</strong>:<em class="italic"> I may have called Linux a cancer but now I love it</em>: <a href="https://www.zdnet.com/article/ballmer-i-may-have-called-linux-a-cancer-but-now-i-love-it/"><span class="url">https://www.zdnet.com/article/ballmer-i-may-have-called-linux-a-cancer-but-now-i-love-it/</span></a></li>
      <li class="bulletList"><em class="italic">Linux is Most Used OS in Microsoft Azure – over 50 percent of VM cores</em>: <a href="https://build5nines.com/linux-is-most-used-os-in-microsoft-azure-over-50-percent-fo-vm-cores/"><span class="url">https://build5nines.com/linux-is-most-used-os-in-microsoft-azure-over-50-percent-fo-vm-cores/</span></a></li>
    </ul>
    <h1 class="heading-1" id="_idParaDest-590">Join our community on Discord</h1>
    <p class="normal">Join our community’s Discord space for discussions with the authors and other readers:</p>
    <p class="normal"><a href="https://packt.link/cloudanddevops"><span class="url">https://packt.link/cloudanddevops</span></a></p>
    <p class="normal"><img alt="" src="image/QR_Code119001106479081656.png"/></p>
  </div>
</body></html>