["```\n$ kubectl apply -f Chapter6/01-envoy-dummy.yaml\n$ istioctl proxy-config all po/envoydummy-2-7488b58cd7-m5vpv -n utilities -o json | jq -r '.. |.\"secret\"?' | jq -r 'select(.name == \"default\")' | jq -r '.tls_certificate.certificate_chain.inline_bytes' | base64 -d - | step certificate inspect  --short\nX.509v3 TLS Certificate (RSA 2048) [Serial: 3062...1679]\n  Subject:     spiffe://cluster.local/ns/utilities/sa/default\n  Issuer:\n  Valid from:  2022-09-11T22:18:13Z\n          to:  2022-09-12T22:20:13Z\n```", "```\nkubectl get po/envoydummy-2-7488b58cd7-m5vpv -n utilities -o json | jq .spec.serviceAccountName\n\"default\"\n```", "```\n% kubectl get sa -n utilities\nNAME      SECRETS   AGE\ndefault   1         13d\n% kubectl get sa -n sock-shop\nNAME      SECRETS   AGE\ndefault   1         27d\n```", "```\n    $ kubectl apply -f Chapter6/01-httpbin-deployment.yaml\n    ```", "```\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: httpbin\n  namespace: chapter6\n```", "```\n  Spec:\n      serviceAccountName: httpbin\n      containers:\n      - image: docker.io/kennethreitz/httpbin\n        imagePullPolicy: IfNotPresent\n        name: httpbin\n        ports:\n        - containerPort: 80\n```", "```\n    $ kubectl apply -f Chapter6/01-curl-deployment.yaml\n    ```", "```\n$ kubectl label ns utilities istio-injection-\n```", "```\n    $ kubectl exec -it curl -n utilities – curl -v http://httpbin.chapter6.svc.cluster.local:8000/get\n    {\n      \"args\": {},\n      \"headers\": {\n        \"Accept\": \"*/*\",\n        \"Host\": \"httpbin.chapter6.svc.cluster.local:8000\",\n        \"User-Agent\": \"curl/7.87.0-DEV\",\n        \"X-B3-Sampled\": \"1\",\n        \"X-B3-Spanid\": \"a00a50536c3ec2f5\",\n        \"X-B3-Traceid\": \"49b6942c85c7c1f2a00a50536c3ec2f5\"\n      },\n      \"origin\": \"127.0.0.6\",\n      \"url\": \"http://httpbin.chapter6.svc.cluster.local:8000/get\"\n    ```", "```\n    apiVersion: security.istio.io/v1beta1\n    kind: PeerAuthentication\n    metadata:\n      name: \"httpbin-strict-tls\"\n      namespace: chapter6\n    spec:\n      mtls:\n        mode: STRICT\n      selector:\n        matchLabels:\n          app: httpbin\n    ```", "```\n    $ kubectl apply -f Chapter6/02-httpbin-strictTLS.yaml\n    peerauthentication.security.istio.io/httpbin-strict-tls created\n    ```", "```\n    $ kubectl exec -it curl -n utilities – curl -v http://httpbin.chapter6.svc.cluster.local:8000/get\n    * Connected to httpbin.chapter6.svc.cluster.local (172.20.147.104) port 8000 (#0)\n    > GET /get HTTP/1.1\n    > Host: httpbin.chapter6.svc.cluster.local:8000\n    > User-Agent: curl/7.87.0-DEV\n    > Accept: */*\n    >\n    * Recv failure: Connection reset by peer\n    * Closing connection 0\n    curl: (56) Recv failure: Connection reset by peer\n    command terminated with exit code 56\n    ```", "```\n$ kubectl exec -it curl -n utilities -- curl -s http://httpbin.chapter6.svc.cluster.local:8000/get\n{\n  \"args\": {},\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Host\": \"httpbin.chapter6.svc.cluster.local:8000\",\n    \"User-Agent\": \"curl/7.85.0-DEV\",\n    \"X-B3-Parentspanid\": \"a35412ed46b7ec46\",\n    \"X-B3-Sampled\": \"1\",\n    \"X-B3-Spanid\": \"0728b578e88b72fb\",\n    \"X-B3-Traceid\": \"830ed3d5d867a460a35412ed46b7ec46\",\n    \"X-Envoy-Attempt-Count\": \"1\",\n    \"X-Forwarded-Client-Cert\": \"By=spiffe://cluster.local/ns/chapter6/sa/\nhttpbin;Hash=b1b88fe241c557bd1281324b458503274eec3f04b1d439758508842d6d5b7018;Subject=\\\"\\\";URI=spiffe://cluster.local/ns/utilities/sa/curl\"\n  },\n  \"origin\": \"127.0.0.6\",\n  \"url\": \"http://httpbin.chapter6.svc.cluster.local:8000/get\"\n}\n```", "```\napiVersion: security.istio.io/v1beta1\nkind: PeerAuthentication\nmetadata:\n  name: \"httpbin-strict-tls\"\n  namespace: chapter6\nspec:\n  portLevelMtls:\n    8080:\n      mode: PERMISSIVE\n    8000:\n      mode: STRICT\n  selector:\n    matchLabels:\n      app: httpbin\n```", "```\n    $ openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -subj '/O=sock Inc./CN=sock.inc' -keyout sock.inc.key -out sock.inc.crt\n    ```", "```\n    $ openssl req -out httpbin.org.csr -newkey rsa:2048 -nodes -keyout httpbin.org.key -subj \"/CN=httpbin.org/O=sockshop.inc\"\n    Generating a 2048 bit RSA private key\n    .........+++\n    ..+++\n    writing new private key to 'httpbin.org.key'\n    ```", "```\n    $ openssl x509 -req -sha256 -days 365 -CA sock.inc.crt -CAkey sock.inc.key -set_serial 0 -in httpbin.org.csr -out httpbin.org.crt\n    Signature ok\n    subject=/CN=httpbin.org/O=sockshop.inc\n    Getting CA Private Key\n    ```", "```\n    $ kubectl create -n istio-system secret generic httpbin-credential --from-file=tls.key=httpbin.org.key --from-file=tls.crt=httpbin.org.crt --from-file=ca.crt=sock.inc.crt\n    secret/httpbin-credential created\n    ```", "```\n      tls:\n          mode: MUTUAL\n          credentialName: httpbin-credential\n    ```", "```\n    $ kubectl apply -f Chapter6/02-httpbin-deployment-MTLS.yaml\n    ```", "```\n    $ openssl req -out bootstrapistio.packt.com.csr -newkey rsa:2048 -nodes -keyout bootstrapistio.packt.com.key -subj \"/CN= bootstrapistio.packt.com/O=packt.com\"\n    $ openssl x509 -req -sha256 -days 365 -CA sock.inc.crt -CAkey sock.inc.key -set_serial 0 -in bootstrapistio.packt.com.csr -out bootstrapistio.packt.com.crt\n    ```", "```\n    % curl -v -HHost:httpbin.org --connect-to \"httpbin.org:443:a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com\" --cacert sock.inc.crt --cert bootstrapistio.packt.com.crt --key bootstrapistio.packt.com.key https://httpbin.org:443/get\n    ```", "```\n$ curl --request POST --url https://dev-0ej7x7k2.us.auth0.com/oauth/token --header 'content-type:application/json' --data '{\"client_id\":\"XXXXXX-id\",\"client_secret\":\"XXXXX-secret\",\" \"audience\":\"http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/\",\"grant_type\":\"client_credentials\"}'\n{\"access_token\":\"xxxxxx-accesstoken\" \"scope\":\"read:dummyData\",\"expires_in\":86400,\"token_type\":\"Bearer\"}%\n```", "```\napiVersion: security.istio.io/v1beta1\nkind: RequestAuthentication\nmetadata:\n  name: \"auth0\"\n  namespace: chapter6\nspec:\n  selector:\n    matchLabels:\n      name: envoydummy\n  jwtRules:\n  - issuer: \"https://dev-0ej7x7k2.us.auth0.com/\"\n    jwksUri: \"https://dev-0ej7x7k2.us.auth0.com/.well-known/jwks.json\"\n```", "```\napiVersion: security.istio.io/v1beta1\nkind: AuthorizationPolicy\nmetadata:\n  name: auth0-authz\n  namespace: chapter6\nspec:\n  action: DENY\n  selector:\n    matchLabels:\n      name: envoydummy\n  rules:\n  - from:\n    - source:\n        notPrincipals: [\"*\"]\n```", "```\napiVersion: \"security.istio.io/v1beta1\"\nkind: \"AuthorizationPolicy\"\nmetadata:\n  name: \"envoydummy-authz-policy\"\n  namespace: utilities\nspec:\n  action: ALLOW\n  selector:\n    matchLabels:\n      name: envoydummy\n  rules:\n  - when:\n    - key: request.auth.claims[permissions]\n      values: [\"read:profile\"]\n```", "```\n$ curl -Hhost:mockshop.com http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/\nV1----------Bootstrap Service Mesh Implementation with Istio----------V1%\n```", "```\n% kubectl apply -f Chapter6/01-requestAuthentication.yaml\nrequestauthentication.security.istio.io/auth0 created\n% kubectl apply -f Chapter6/02-requestAuthorization.yaml\nauthorizationpolicy.security.istio.io/envoydummy-authz-policy created\n```", "```\n% curl -Hhost:mockshop.com http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/\nRBAC: access denied\n```", "```\n$ curl -Hhost:mockshop.com -H \"authorization: Bearer xxxxxx-accesstoken \" http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/\nRBAC: access denied%\n```", "```\n% kubectl apply -f Chapter6/03-requestAuthorization.yaml\nauthorizationpolicy.security.istio.io/envoydummy-authz-policy configured\n$ curl -Hhost:mockshop.com -H \"authorization: Bearer xxxxxx-accesstoken \" http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/\nV2----------Bootstrap Service Mesh Implementation with Istio----------V2%\n```", "```\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: chapter6sa\n  namespace: utilities\n```", "```\nKubectl delete -f Chapter6/01-curl-deployment.yaml\nkubectl apply -f Chapter6/02-curl-deployment.yaml\n```", "```\napiVersion: \"security.istio.io/v1beta1\"\nkind: \"AuthorizationPolicy\"\nmetadata:\n  name: \"httpbin-authz-policy\"\n  namespace: chapter6\nspec:\n  action: ALLOW\n  selector:\n    matchLabels:\n      app: httpbin\n  rules:\n  - from:\n    - source:\n        principals: [\"cluster.local/ns/utilities/sa/curl\"]\n    to:\n    - operation:\n        methods: ['*']\n```", "```\n$ kubectl apply -f Chapter6/04-httpbinAuthorizationForSpecificSA.yaml\nauthorizationpolicy.security.istio.io/httpbin-authz-policy configured\n$ kubectl exec -it curl -n utilities -- curl -v http://httpbin.chapter6.svc.cluster.local:8000/headers\n*   Trying 172.20.152.62:8000...\n* Connected to httpbin.chapter6.svc.cluster.local (172.20.152.62) port 8000 (#0)\n> GET /headers HTTP/1.1\n> Host: httpbin.chapter6.svc.cluster.local:8000\n> User-Agent: curl/7.85.0-DEV\n> Accept: */*\n>\n* Mark bundle as not supporting multiuse\n< HTTP/1.1 403 Forbidden\n< content-length: 19\n< content-type: text/plain\n< date: Tue, 20 Sep 2022 02:20:39 GMT\n< server: envoy\n< x-envoy-upstream-service-time: 15\n<\n* Connection #0 to host httpbin.chapter6.svc.cluster.local left intact\nRBAC: access denied%\n```", "```\n$ kubectl delete -f Chapter6/02-curl-deployment.yaml\n$ kubectl apply -f Chapter6/03-curl-deployment.yaml\n```", "```\napiVersion: \"security.istio.io/v1beta1\"\nkind: \"AuthorizationPolicy\"\nmetadata:\n  name: \"httpbin-authz-policy\"\n  namespace: chapter6\nspec:\n  action: ALLOW\n  selector:\n    matchLabels:\n      app: httpbin\n  rules:\n  - from:\n    - source:\n        requestPrincipals: [\"cluster.local/ns/utilities/sa/curl\"]\n  - to:\n    - operation:\n        methods: [\"GET\"]\n        paths: [\"/get\"]\n```", "```\nkubectl apply -f Chapter6/05-httpbinAuthorizationForSpecificPath.yaml\n```", "```\nkubectl exec -it curl -n utilities -- curl -X GET -v http://httpbin.chapter6.svc.cluster.local:8000/headers\n……\nRBAC: access denied%\n```", "```\nkubectl exec -it curl -n utilities -- curl -X GET -v http://httpbin.chapter6.svc.cluster.local:8000/get\n```"]