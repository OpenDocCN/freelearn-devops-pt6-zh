["```\nterraform {\n...\n      backend \"azurerm\" {\n        resource_group_name  = \"resource-group\"\n        storage_account_name = \"storage-account\"\n        container_name       = \"tfstate\"\n        key                  = \"aks.tfstate\"\n    }\n}\n```", "```\nresource \"azurerm_resource_group\" \"ksm_resource_group\" {\n  name     = \"ksm-resource-group\"\n}\n```", "```\nresource \"azurerm_storage_account\" \"ksm_storage_account\" {\n  name = \"ksmlogs\"\n  resource_group_name = azurerm_resource_group.ksm_resource_group.name\n  …\n}\n```", "```\nresource \"azurerm_virtual_network\" \"ksm_virtual_network\" {\n  name                = \"ksm-virtual-network\"\n  ...\n  address_space       = [\"10.1.0.0/16\"]\n}\nresource \"azurerm_subnet\" \"ksm_subnet\" {\n  name                 = \"ksm-private-subnt\"\n  ...\n  address_prefixes     = [\"10.1.0.0/24\"]\n  enforce_private_link_endpoint_network_policies = true\n}\n```", "```\nresource \"azurerm_kubernetes_cluster\" \"ksm_aks\" {\n  name = \"ksm-aks\"\n  ...\n  dns_prefix = \"private-aks-cluster\"\n  private_cluster_enabled = false\n  oidc_issuer_enabled = true\n  workload_identity_enabled = true\n  role_based_access_control_enabled = true\n...\n  default_node_pool {\n    name           = \"default\"\n    node_count     = 1\n    vm_size        = \"Standard_A2_v2\"\n    vnet_subnet_id = azurerm_subnet.ksm_subnet.id\n  }\n}\n```", "```\n$ terraform init\n...\n$ terraform apply\n```", "```\n$ az aks create -n ksm-aks -g ksm-resource-group --enable-addons azure-keyvault-secrets-provider --enable-oidc-issuer --enable-workload-identity\n```", "```\n$ az aks get-credentials --name ksm-aks \\\n    --resource-group ksm-resource-group \\\n    --subscription $subscription \\\n    --admin\n```", "```\nresource \"azurerm_key_vault\" \"ksm_key_vault\" {\n  name                       = \"ksm-key-vault\"\n  ...\n  sku_name                   = \"standard\"\n  enable_rbac_authorization = true\n  soft_delete_retention_days = 7\n}\n```", "```\nresource \"azurerm_user_assigned_identity\" \"keyvault_reader\" {\n  name                = \"keyvault-reader\"\n  ...\n}\nresource \"azurerm_role_assignment\" \"ksm_key_vault_reader\" {\n  scope = azurerm_key_vault.ksm_key_vault.id\n  role_definition_name = \"Key Vault Reader\"\n  principal_id         = azurerm_user_assigned_identity.keyvault_reader.principal_id\n}\n...\n```", "```\nresource \"azurerm_federated_identity_credential\" \"cred\" {\n name   = \"ksm-reader-identity\"\n ...\n Issuer =azurerm_kubernetes_cluster.ksm_aks.oidc_issuer_url\n audience  = [\"api://AzureADTokenExchange\"]\n parent_id = azurerm_user_assigned_identity.keyvault_reader.id\n  subject = \"system:serviceaccount:default:service-token-reader\"\n}\n```", "```\n$ az keyvault create -n ksm-key-vault -g ksm-resource-group  -l eastus --enable-rbac-authorization\naz identity create --name keyvault-reader --resource-group ksm-resource-group\n...\naz identity federated-credential create \\\n  --name \"ksm-reader-identity\" ...\n```", "```\nkubectl get pods -n kube-system -l 'app in (secrets-store-csi-driver,secrets-store-provider-azure)'\nNAME                                  READY   STATUS    RESTARTS  AGE\naks-secrets-store-csi-driver-t6n7h    3/3     Running   0         80m\naks-secrets-store-provider-azure-htmqk 1/1     Running   0        80m\n```", "```\napiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: keyvault-secrets\nspec:\n  provider: azure\n  parameters:\n    usePodIdentity: \"false\"\n    clientID: #the identity provisioned\n    keyvaultName: #keyvault name\n    ...\n    objects:  |\n      array:\n        - |\n          objectName: secret1\n          objectType: secret\n        - |\n          objectName: key1\n          objectType: key\n    tenantId: #kubernetes tenant id\n```", "```\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  annotations:\n    azure.workload.identity/client-id: #identity with Key Vault access\n  labels:\n    azure.workload.identity/use: \"true\"\n  name: service-token-reader\n  namespace: default\n```", "```\nkind: Pod\napiVersion: v1\nmetadata:\n  name: nginx\nspec:\n  serviceAccountName: service-token-reader\n  containers:\n    - name: nginx\n      image: nginx\n      volumeMounts:\n      - name: keyvault-secrets\n        mountPath: \"/mnt/secrets-store\"\n        readOnly: true\n  volumes:\n    - name: keyvault-secrets\n      csi:\n        driver: secrets-store.csi.k8s.io\n        readOnly: true\n        volumeAttributes:\n          secretProviderClass: \"keyvault-secrets\"\n```", "```\nresource \"azurerm_monitor_diagnostic_setting\" \"ksm_key_vault_logs\" {\n  name               = \"ksm-key-vault-logs\"\n  target_resource_id = azurerm_key_vault.ksm_key_vault.id\n  storage_account_id = azurerm_storage_account.ksm_storage_account.id\n  log {\n    category = \"AuditEvent\"\n    enabled  = true\n    retention_policy {\n      enabled = false\n    }\n  }\n...\n}\n```", "```\n{\n  \"time\": \"2023-08-30T09:07:19.8593007Z\",\n  \"category\": \"AuditEvent\",\n  \"operationName\": \"KeyGet\",\n  \"resultType\": \"Success\",\n  \"correlationId\": \"fa11ea42-67c0-47cd-8a6b-f7bcb349414f\",\n  \"identity\": {\n    \"claim\": {\n      \"oid\": \"80dd018c-ede7-42f4-99a8-00e278868a7c\",\n      \"appid\": \"b1967275-af7b-4d75-9804-c935ecb22226\",\n      \"xms_mirid\": \"/subscriptions/.../userAssignedIdentities/keyvault-reader\",\n      \"xms_az_nwperimid\": []\n    }\n  },\n  \"properties\": {\n    \"id\": \"https://ksm-key-vault.vault.azure.net/keys/key1\",\n    \"requestUri\": \"https://ksm-key-vault.vault.azure.net/keys/key1/?api-version=2016-10-01\",\n    \"isRbacAuthorized\": true,\n    ...\n  },\n  ...\n}\n```", "```\nresource \"azurerm_key_vault_key\" \"ksm_encryption_key\" {\n  name         = \"ksm-encryption-key\"\n  key_vault_id = azurerm_key_vault.ksm_key_vault.id\n  key_type     = \"RSA\"\n  key_size     = 2048\n    key_opts = [\n    \"decrypt\",\n    \"encrypt\",\n    \"sign\",\n    \"unwrapKey\",\n    \"verify\",\n    \"wrapKey\",\n  ]\n }\n```", "```\nrotation_policy {    automatic {      time_before_expiry = \"P30D\"    }    expire_after         = \"P90D\"    notify_before_expiry = \"P29D\"  }\n```", "```\nresource \"azurerm_kubernetes_cluster\" \"ksm_aks\" {\n  name = \"ksm-aks\"\n  ...\n  key_management_service {\n    key_vault_key_id = azurerm_key_vault_key.ksm_encryption_key.id\n    key_vault_network_access = \"Public\"\n  }\n  ...\n}\n```", "```\n{\n  \"time\": \"2023-09-03T11:46:27.5820050Z\",\n  \"category\": \"AuditEvent\",\n  \"operationName\": \"KeyDecrypt\",\n  \"resultType\": \"Success\",\n  \"identity\": {\n    \"claim\": {\n      \"xms_az_rid\": \"/subscriptions/.../managedClusters/ksm-aks\",\n      \"xms_az_nwperimid\": []\n    }\n  },\n  \"properties\": {\n    \"id\": \"https://ksm-key-vault.vault.azure.net/keys/ksm-encryption-key/0c24b95c67534a3eb85c71854dc8a7bd\",\n    \"algorithm\": \"RSA-OAEP-256\",\n    \"clientInfo\": \"... k8s-kms-keyvault/v0.5.0 (linux/amd64) 84fa3b7/2023-05-17-21:13\",\n    \"httpStatusCode\": 200,\n    ..\n    \"tlsVersion\": \"TLS1_2\"\n  },\n}\n```"]