<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer007">
<h1 class="mainHeading" id="_idParaDest-6">Preface</h1>
<p class="normal">Kubernetes has taken the world by storm, becoming the standard infrastructure for DevOps teams to develop, test, and run applications. Most enterprises are either running it already or are planning to run it in the next year. A look at job postings on any of the major job sites shows that just about every big-name company has Kubernetes positions open. The fast rate of adoption has led to Kubernetes-related positions growing by over 2,000% in the last 4 years.</p>
<p class="normal">One common problem that companies are struggling to address is the lack of enterprise Kubernetes knowledge. While Kubernetes isn’t new anymore (it just turned 10!), companies have had issues with trying to build teams to run clusters reliably. They’ve also struggled to understand how to integrate Kubernetes workloads across the multiple silos and technology stacks that are common in the enterprise world. Finding people with basic Kubernetes skills is becoming easier, but finding people with knowledge on topics that are required for enterprise clusters is still a challenge.</p>
<h1 class="heading-1" id="_idParaDest-7">Who this book is for</h1>
<p class="normal">We created this book to help DevOps teams to expand their skills beyond the basics of Kubernetes. It was created from the years of experience we have working with clusters in multiple enterprise environments.</p>
<p class="normal">There are many books available that introduce Kubernetes and the basics of installing clusters, creating Deployments, and using Kubernetes objects. Our plan was to create a book that would go beyond a basic cluster, and to keep the book at a reasonable length, we have not re-hashed the basics of Kubernetes. Readers should have some experience with Kubernetes and DevOps before reading this book.</p>
<p class="normal">While the primary focus of the book is on extending clusters with enterprise features, the first section of the book will provide a refresher on key Docker topics and Kubernetes objects. It is important that you have a solid understanding of Kubernetes objects in order to get the most out of the more advanced chapters.</p>
<h1 class="heading-1" id="_idParaDest-8">What this book covers</h1>
<p class="normal"><em class="chapterRef">Chapter 1</em>, <em class="italic">Docker and Container Essentials</em>, covers the problems Docker and Kubernetes address for developers. You will be introduced to Docker, including the Docker daemon, data, installation, and using the Docker CLI.</p>
<p class="normal"><em class="chapterRef">Chapter 2</em>, <em class="italic">Deploying Kubernetes Using KinD</em>, helps with creating development clusters using KinD, a powerful tool that allows you to create clusters ranging from a single-node cluster to a full multi-node cluster. The chapter goes beyond a basic <strong class="keyWord">KinD</strong> cluster, explaining how to use a load balancer running <strong class="keyWord">HAProxy</strong> to load-balance worker nodes. By the end of the chapter, you will understand how KinD works and how to create a custom multi-node cluster, which will be used for the exercises in the chapters.</p>
<p class="normal"><em class="chapterRef">Chapter 3</em>, <em class="italic">Kubernetes Bootcamp</em>, provides a refresher on Kubernetes. This chapter will cover most of the objects that a cluster includes , which will be helpful if you are new to Kubernetes. It will explain each object with a description of what each object does and its function in a cluster. It is meant to be a refresher, or a “pocket guide” to objects. It does not contain exhaustive details for each object (that would require a second book).</p>
<p class="normal"><em class="chapterRef">Chapter 4</em>, <em class="italic">Services, Load Balancing, and Network Policies</em>, explains how to expose a Kubernetes Deployment using services. Each service type will be explained with examples, and you will learn how to expose them using both a layer 7 and layer 4 load balancer. In this chapter, you will go beyond the basics of a simple Ingress controller, installing <strong class="keyWord">MetalLB</strong>, to provide layer 4 access to services. Finally, you will learn how to provide fine-grained control over the communication between pods, enhancing security and compliance within your cluster by using Kubernetes network policies.</p>
<p class="normal"><em class="chapterRef">Chapter 5</em>, <em class="italic">External DNS and Global Load Balancing</em>, will make you learn about two add-ons that benefit enterprise clusters by installing an incubator project called <code class="inlineCode">external-dns</code> to provide dynamic name resolution for the services exposed by MetalLB. You will also learn how to add a <strong class="keyWord">Global Load Balancer</strong> to your cluster, using a project called <strong class="keyWord">K8GB</strong>, which provides native Kubernetes Global Load Balancing.</p>
<p class="normal"><em class="chapterRef">Chapter 6</em>, <em class="italic">Integrating Authentication into Your Cluster</em>, answers the question, “Once your cluster is built, how will users access it?” In this chapter we’ll detail how OpenID Connect works and why you should use it to access your cluster. You’ll also learn how to authenticate your pipelines, and finally, we’ll also cover several anti-patterns that should be avoided and explain why they should be avoided.</p>
<p class="normal"><em class="chapterRef">Chapter 7</em>, <em class="italic">RBAC Policies and Auditing</em>, explains that once users have access to a cluster, you need to know how to limit their access. Whether you are providing an entire cluster to your users or just a namespace, you’ll need to know how Kubernetes authorizes access via its <strong class="keyWord">role-based access control </strong>(<strong class="keyWord">RBAC</strong>) system. In this chapter, we’ll detail how to design RBAC policies, how to debug them, and different strategies for multi-tenancy.</p>
<p class="normal"><em class="chapterRef">Chapter 8</em>, <em class="italic">Managing Secrets</em>, puts the focus on one of the hardest to implement issues in the Kubernetes world: how to manage secret data. First, we’ll look at the challenges of managing Secrets in Kubernetes. Then we’ll learn about HashiCorp’s <strong class="keyWord">Vault</strong> for secret management. Finally, we’ll integrate our clusters with Vault using both the <strong class="keyWord">Vault sidecar</strong> and the popular <strong class="keyWord">External Secrets Operator</strong>.</p>
<p class="normal"><em class="chapterRef">Chapter 9</em>, <em class="italic">Building Multitenant Clusters with vClusters</em>, moves out of a single cluster toward breaking up clusters into tenants using the <strong class="keyWord">vCluster</strong> project from Loft. You’ll learn how vClusters work, how they interact with host clusters, how to securely access them, and how to automate their rollout for your tenants. We’ll also build off what we learned in <em class="chapterRef">Chapter 8</em> to integrate managed Secrets into our vClusters too!</p>
<p class="normal"><em class="chapterRef">Chapter 10</em>, <em class="italic">Deploying a Secured Kubernetes Dashboard</em>, covers Kubernetes Dashboard, which is often the first thing users try to launch once a cluster is up and running. There’s quite a bit of mythology around security (or lack thereof). Your cluster will be made of other web applications too, such as network dashboards, logging systems, and monitoring dashboards. This chapter looks at how the dashboard is architected, how to properly secure it, and examples of how not to deploy it with details as to why.</p>
<p class="normal"><em class="chapterRef">Chapter 11</em>, <em class="italic">Extending Security Using Open Policy Agent</em>, provides you with the guidance you need to deploy <strong class="keyWord">Open Policy Agent</strong> and <strong class="keyWord">GateKeeper</strong> to enable policies that can’t be implemented using RBAC. We’ll cover how to deploy Gatekeeper, how to write policies in Rego, and how to test your policies using OPA’s built-in testing framework.</p>
<p class="normal"><em class="chapterRef">Chapter 12</em>, <em class="italic">Node Security with Gatekeeper</em>, deals with the security of the nodes that run your pods. We will discuss how to securely design your containers so they are harder to abuse and how to build policies using GateKeeper that prevent your containers from accessing resources they don’t need.</p>
<p class="normal"><em class="chapterRef">Chapter 13</em>, <em class="italic">KubeArmor Securing Your Runtime</em>, presents security, which is the job of everyone, and providing tools to address attack vectors is key to running a secure and resilient cluster. In this chapter, you will learn how to secure your containers runtime by using a CNCF project called <strong class="keyWord">KubeArmor</strong>. KubeArmor provides an easy way to lock down containers using easy to understand policies.</p>
<p class="normal"><em class="chapterRef">Chapter 14</em>, <em class="italic">Backing Up Workloads</em>, explains how to create a backup of your cluster workloads for disaster recovery or cluster migrations, using <strong class="keyWord">Velero</strong>. You will work hands-on to create an S3-compatible storage location using MinIO to create a backup of example workloads and persistent storage. You will then restore the backup to a brand-new cluster to simulate a cluster migration.</p>
<p class="normal"><em class="chapterRef">Chapter 15</em>, <em class="italic">Monitoring Clusters and Workloads</em>, explores how to know how healthy your cluster is using <strong class="keyWord">Prometheus</strong> and <strong class="keyWord">OpenSearch</strong>. You’ll start with understanding how Kubernetes and Prometheus handle metrics, then we’ll deploy the Prometheus stack with <strong class="keyWord">Alertmanager</strong> and <strong class="keyWord">Grafana</strong>. You’ll learn how to secure the stack and how to extend it to monitor additional workloads. After we’re done with monitoring, we will move on to log aggregation with OpenSearch. We will start with exploring how logging in Kubernetes works, move on to integrating OpenSearch, and wrap up with securing access to OpenSearch with <strong class="keyWord">OpenUnison</strong>.</p>
<p class="normal"><em class="chapterRef">Chapter 16</em>, <em class="italic">An Introduction to Istio</em>, explains that many enterprises use a service mesh to provide advanced features such as security, traffic routing, authentication, tracing, and observability to a cluster. This chapter will introduce you to Istio, a popular open-source mesh, and its architecture, along with the most commonly used resources it provides. You will deploy Istio to your KinD cluster with an example application and learn how to observe the behavior of an application using an observability tool called Kiali.</p>
<p class="normal"><em class="chapterRef">Chapter 17</em>, <em class="italic">Building and Deploying Applications on Istio</em>, acknowledges that once you’ve deployed Istio, you’ll want to develop and deploy applications that use it! This chapter starts with a walk-through of the differences between monoliths and microservices and how they’re deployed. Next, we’ll step through building a micro-service to run in Istio and get into advanced topics like authentication, authorization, and service-to-service authentication for your services. You will also learn how to secure Kiali access by leveraging existing roles in Kubernetes using an OIDC provider and JSON Web Tokens. You’ll also learn how to secure Istio services using JWTs, along with how to use token exchanges to gain access to different services, securely moving from one service to another. Finally, we use OPA to create a custom authorization rule we configure with Istio.</p>
<p class="normal"><em class="chapterRef">Chapter 18</em>, <em class="italic">Provisioning a Multitenant Platform</em>, explores how to build pipelines, how to automate their creation, and how they relate to GitOps. We’ll explore how the objects that are used to drive pipelines are related to each other, how to build relationships between systems, and finally, design a self-service workflow for automating the Deployment of pipelines.</p>
<p class="normal"><em class="chapterRef">Chapter 19</em>, <em class="italic">Building a Developer Portal</em>, builds off of our designs in <em class="chapterRef">Chapter 18</em> to build out a multitenant platform with many of the tools we used throughout this book. We’ll start with talking about building a lab to run our multitenant cluster in. Next we’ll roll out Kubernetes to three clusters and integrate them with GitLab, Vault, Argo CD, Harbor, and OpenUnison. Finally we’ll walk through onboarding a new vCluster based tenant using OpenUnison’s self-service portal.</p>
<h1 class="heading-1" id="_idParaDest-9">To get the most out of this book</h1>
<ul>
<li class="bulletList">You should have a basic understanding of Linux, basic commands, tools like Git, and a text editor like Vi.</li>
<li class="bulletList">The book chapters contain both theory and hands-on exercises. We feel that the exercises help to reinforce the theory, but they are not required to understand each topic. If you want to do the exercises in the book, you will need to meet the requirement in the table below:</li>
</ul>
<table class="table-container" id="table001">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Requirement for the chapter exercises</strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Version</strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal">Ubuntu Server</p>
</td>
<td class="table-cell">
<p class="normal">22.04 or higher</p>
</td>
</tr>
</tbody>
</table>
<p class="normal-one">All exercises use Ubuntu, but most of them will work on other Linux installations.</p>
<h2 class="heading-2" id="_idParaDest-10">Download the example code files</h2>
<p class="normal">The code bundle for the book is hosted on GitHub at <a href="https://github.com/PacktPublishing/Kubernetes-An-Enterprise-Guide-Third-Edition"><span class="url">https://github.com/PacktPublishing/Kubernetes-An-Enterprise-Guide-Third-Edition</span></a>. We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/"><span class="url">https://github.com/PacktPublishing/</span></a>. Check them out!</p>
<h2 class="heading-2" id="_idParaDest-11">Download the color images</h2>
<p class="normal">We also provide a PDF file that has color images of the screenshots/diagrams used in this book. You can download it here: <a href="https://packt.link/gbp/9781835086957"><span class="url">https://packt.link/gbp/9781835086957</span></a>.</p>
<h2 class="heading-2" id="_idParaDest-12">Supplementary content</h2>
<p class="normal">Here’s a link to the YouTube channel (created and managed by the authors Marc Boorshtein and Scott Surovich) that contains videos of the labs from this book, so you can see them in action before you start on your own: <a href="https://packt.link/N5qjd"><span class="url">https://packt.link/N5qjd</span></a>.</p>
<h2 class="heading-2" id="_idParaDest-13">Conventions used</h2>
<p class="normal">There are a number of text conventions used throughout this book.</p>
<p class="normal"><code class="inlineCode">CodeInText</code>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. For example: “The <code class="inlineCode">--name</code> option will set the name of the cluster to <code class="inlineCode">cluster01</code>, and <code class="inlineCode">--config</code> tells the installer to use the <code class="inlineCode">cluster01-kind.yaml</code> config file.”</p>
<p class="normal">A block of code is set as follows:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">grafana</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">grafana</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">monitoring</span>
</code></pre>
<p class="normal">When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">labels:</span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-attr-slc">app:</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">grafana</strong></span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">grafana</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">monitoring</span>
</code></pre>
<p class="normal">Any command-line input or output is written as follows:</p>
<pre class="programlisting con"><code class="hljs-con">PS C:\Users\mlb&gt; kubectl create ns not-going-to-work
namespace/not-going-to-work created
</code></pre>
<p class="normal"><strong class="keyWord">Bold</strong>: Indicates a new term, an important word, or words that you see on the screen, for example, in menus or dialog boxes, also appear in the text like this. For example: “Hit the <strong class="screenText">Finish Login</strong> button at the bottom of the screen.”</p>
<div class="note">
<p class="normal">Warnings or important notes appear like this.</p>
</div>
<div class="packt_tip">
<p class="normal">Tips and tricks appear like this.</p>
</div>
<h1 class="heading-1" id="_idParaDest-14">Get in touch</h1>
<p class="normal">Feedback from our readers is always welcome.</p>
<p class="normal"><strong class="keyWord">General feedback</strong>: Email <a href="mailto:feedback%40packtpub.com"><span class="url">feedback@packtpub.com</span></a>, and mention the book’s title in the subject of your message. If you have questions about any aspect of this book, please email us at <a href="mailto:questions%40packtpub.com"><span class="url">questions@packtpub.com</span></a>.</p>
<p class="normal"><strong class="keyWord">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/submit-errata"><span class="url">http://www.packtpub.com/submit-errata</span></a>, select your book, click on the Errata Submission Form link, and enter the details.</p>
<p class="normal"><strong class="keyWord">Piracy</strong>: If you come across any illegal copies of our works in any form on the Internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <a href="mailto:copyright%40packtpub.com"><span class="url">copyright@packtpub.com</span></a> with a link to the material.</p>
<p class="normal"><strong class="keyWord">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit <a href="http://authors.packtpub.com"><span class="url">http://authors.packtpub.com</span></a>.</p>
</div>
<div class="Basic-Text-Frame" id="_idContainer008">
<p class="eop"/>
<h1 class="heading-1" id="_idParaDest-15">Share your thoughts</h1>
<p class="normal">Once you’ve read <em class="italic">Kubernetes - An Enterprise Guide, Third Edition</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/1835086950"><span class="url">click here to go straight to the Amazon review page</span></a> for this book and share your feedback.</p>
<p class="normal">Your review is important to us and the tech community and will help us make sure we’re delivering excellent quality content.</p>
</div>
<div class="Basic-Text-Frame" id="_idContainer010">
<p class="eop"/>
<h1 class="heading-1" id="_idParaDest-16">Download a free PDF copy of this book</h1>
<p class="normal">Thanks for purchasing this book!</p>
<p class="normal">Do you like to read on the go but are unable to carry your print books everywhere?</p>
<p class="normal">Is your eBook purchase not compatible with the device of your choice?</p>
<p class="normal">Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p>
<p class="normal">Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application.</p>
<p class="normal">The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your inbox daily.</p>
<p class="normal">Follow these simple steps to get the benefits:</p>
<ol>
<li class="numberedList" value="1">Scan the QR code or visit the link below:</li>
</ol>
<figure class="mediaobject"><img alt="" height="225" src="../Images/B21165_Free_PDF_QR.png" width="225"/></figure>
<p class="packt_figref"><a href="https://packt.link/free-ebook/9781835086957"><span class="url">https://packt.link/free-ebook/9781835086957</span></a></p>
<ol>
<li class="numberedList" value="2">Submit your proof of purchase.</li>
<li class="numberedList">That’s it! We’ll send your free PDF and other benefits to your email directly.</li>
</ol>
</div>
</div></body></html>