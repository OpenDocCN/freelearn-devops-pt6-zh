<html><head></head><body>
		<div id="_idContainer050">
			<h1 id="_idParaDest-61" class="chapter-number"><a id="_idTextAnchor063"/>3</h1>
			<h1 id="_idParaDest-62"><a id="_idTextAnchor064"/>Setting Up a Learning Environment with Demo Applications</h1>
			<p>This chapter guides you through setting up a <strong class="bold">learning environment</strong> for the practical examples throughout this book and for independent experimentation. As Grafana Labs offers a free tier of their cloud service, we will use this for the storage and searching of data. To produce rich, useful data, we will use the <strong class="bold">OpenTelemetry</strong> demo application. This demo application deploys the services needed to run the OpenTelemetry Astronomy Shop locally. These applications are written in many different languages and are instrumented to produce metrics, logs, and distributed traces. This application will help you interact directly (and via load generators) with real applications and see observability telemetry in real time in the Grafana <span class="No-Break">Labs instance.</span></p>
			<p>In this chapter, we’re going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Introducing <span class="No-Break">Grafana Cloud</span></li>
				<li>Installing the <span class="No-Break">prerequisite tools</span></li>
				<li>Installing the OpenTelemetry <span class="No-Break">Demo application</span></li>
				<li>Exploring telemetry from the <span class="No-Break">demo application</span></li>
				<li>Troubleshooting your OpenTelemetry <span class="No-Break">demo application</span></li>
			</ul>
			<h1 id="_idParaDest-63"><a id="_idTextAnchor065"/>Technical requirements</h1>
			<p>We assume you are working on at least Windows 10 version 2004, macOS version 11, or a relatively recent installation of Linux (e.g., Ubuntu 20.10 or later); earlier versions are not supported. We will be using the OpenTelemetry Collector version 0.73.1 and the OpenTelemetry Demo version 0.26.0. Full installation instructions for these components are provided in <span class="No-Break">this chapter.</span></p>
			<p>All commands and configuration files to complete these steps are included in the GitHub repository at <a href="https://github.com/PacktPublishing/Observability-with-Grafana/tree/main/chapter3">https://github.com/PacktPublishing/Observability-with-Grafana/tree/main/chapter3</a>. You'll find the <em class="italic">Code in Action</em> videos for this chapter <span class="No-Break">at </span><a href="https://packt.link/GNFyp"><span class="No-Break">https://packt.link/GNFyp</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-64"><a id="_idTextAnchor066"/>Introducing Grafana Cloud</h1>
			<p>Grafana Cloud <a id="_idIndexMarker226"/>is a hosted platform-as-a-service observability tool. It offers the ability to quickly create infrastructure to receive and store log, metric, and trace data as well as tools to visualize the data. We are using Grafana Cloud to reduce the technical skill needed to engage with this book, although all the open source components from Grafana that we will introduce can be deployed locally <span class="No-Break">as well.</span></p>
			<p>Grafana Cloud offers free access. In this chapter, we will first set up a cloud account and familiarize ourselves with the administration and use of <span class="No-Break">the tools.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Grafana Labs introduces changes on a regular basis. The information and screenshots in this chapter are based on Grafana version 10.2, which was released in <span class="No-Break">October 2023.</span></p>
			<h2 id="_idParaDest-65"><a id="_idTextAnchor067"/>Setting up an account</h2>
			<p>Creating a free Grafana Cloud account<a id="_idIndexMarker227"/> is simple. To do this, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Go to <a href="https://www.grafana.com">https://www.grafana.com</a> and click on <strong class="bold">Create </strong><span class="No-Break"><strong class="bold">Free Account</strong></span><span class="No-Break">.</span></li>
				<li>Sign up using any of <span class="No-Break">the following:</span><ol><li class="Alphabets">A <span class="No-Break">Google account</span></li><li class="Alphabets">A <span class="No-Break">GitHub account</span></li><li class="Alphabets">A <span class="No-Break">Microsoft account</span></li><li class="Alphabets">An <span class="No-Break">Amazon account</span></li><li class="Alphabets">An <span class="No-Break">email address</span></li></ol></li>
				<li>Choose a team URL. This is the URL used to access your Grafana instance. In our sample setup, we <span class="No-Break">chose </span><span class="No-Break"><strong class="source-inline">observabilitywithgrafana</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer028" class="IMG---Figure">
					<img src="image/B18277_figure_3.1.jpg" alt="Figure 3.1 – Creating a Grafana stack"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.1 – Creating a Grafana stack</p>
			<ol>
				<li value="4">Choose a<a id="_idIndexMarker228"/> deployment region from the available list and then wait for a few minutes for your Grafana account to <span class="No-Break">be created.</span></li>
				<li>When the account creation is completed, you will see a screen titled <strong class="bold">GET STARTED</strong>, as shown in the following screenshot. We encourage you to explore the screens in Grafana, but for this introduction, you can just click on <strong class="bold">I’m already familiar </strong><span class="No-Break"><strong class="bold">with Grafana</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer029" class="IMG---Figure">
					<img src="image/B18277_figure_3.2.jpg" alt="Figure 3.2 – Get started with Grafana"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.2 – Get started with Grafana</p>
			<p class="list-inset">Then click <a id="_idIndexMarker229"/>on the Grafana icon in the top-left corner to return to the home screen, and finally, click on <strong class="bold">Stacks</strong>, which you will find just under the <span class="No-Break">welcome message:</span></p>
			<div>
				<div id="_idContainer030" class="IMG---Figure">
					<img src="image/B18277_figure_3.3.jpg" alt="Figure 3.3 – Welcome to Grafana Cloud"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.3 – Welcome to Grafana Cloud</p>
			<ol>
				<li value="6">This will take you to the Grafana Cloud Portal, which will look <span class="No-Break">like this.</span></li>
			</ol>
			<div>
				<div id="_idContainer031" class="IMG---Figure">
					<img src="image/B18277_figure_3.4.jpg" alt="Figure 3.4 – The Grafana Cloud Portal"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.4 – The Grafana Cloud Portal</p>
			<p>Before we <a id="_idIndexMarker230"/>set up the local data-producing environment, let’s take a few moments to explore the basics of the Grafana Cloud Portal and your new <span class="No-Break">Grafana Stack.</span></p>
			<h2 id="_idParaDest-66"><a id="_idTextAnchor068"/>Exploring the Grafana Cloud Portal</h2>
			<p>The home page of the portal <a id="_idIndexMarker231"/>shows your subscription and billing information, as well as details about your single Grafana Stack. When you first sign up for <a id="_idIndexMarker232"/>a <strong class="bold">Cloud Free</strong> subscription, you will be granted access to a 14-day trial for Cloud Pro. To access your instance of Grafana, you need to click on the <strong class="bold">Launch</strong> button in the <strong class="bold">Grafana</strong> section. This gives you access to view data you send to <span class="No-Break">Grafana </span><span class="No-Break"><a id="_idIndexMarker233"/></span><span class="No-Break">Cloud.</span></p>
			<p>A full Grafana <strong class="bold">Stack</strong> consists of the<a id="_idIndexMarker234"/> <span class="No-Break">following installations:</span></p>
			<ul>
				<li><span class="No-Break"><strong class="bold">Visualization</strong></span><span class="No-Break">:</span><ul><li>A <a id="_idIndexMarker235"/><span class="No-Break">Grafana</span><span class="No-Break"><a id="_idIndexMarker236"/></span><span class="No-Break"> instance</span></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Metrics</strong></span><span class="No-Break">:</span><ul><li>A <a id="_idIndexMarker237"/>Prometheus<a id="_idIndexMarker238"/> remote <span class="No-Break">write endpoint</span></li><li>A <span class="No-Break">Graphite endpoint</span></li><li>A Mimir backend <span class="No-Break">storage instance</span></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Logs</strong></span><span class="No-Break">:</span><ul><li>A <a id="_idIndexMarker239"/><span class="No-Break">Loki </span><span class="No-Break"><a id="_idIndexMarker240"/></span><span class="No-Break">endpoint</span></li><li>A Loki backend <span class="No-Break">storage instance</span></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Traces</strong></span><span class="No-Break">:</span><ul><li>A <a id="_idIndexMarker241"/><span class="No-Break">Tempo</span><span class="No-Break"><a id="_idIndexMarker242"/></span><span class="No-Break"> endpoint</span></li><li>A Tempo backend <span class="No-Break">storage instance</span></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Alerting</strong></span><span class="No-Break">:</span><ul><li>An<a id="_idIndexMarker243"/> Alerting instance<a id="_idIndexMarker244"/> for managing <span class="No-Break">Prometheus-based alerts</span></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Load testing</strong></span><span class="No-Break">:</span><ul><li>A <a id="_idIndexMarker245"/>k6<a id="_idIndexMarker246"/> <span class="No-Break">cloud runner</span></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Profiling</strong></span><span class="No-Break">:</span><ul><li>A <a id="_idIndexMarker247"/><span class="No-Break">Pyroscope</span><span class="No-Break"><a id="_idIndexMarker248"/></span><span class="No-Break"> endpoint</span></li><li>A Pyroscope backend <span class="No-Break">storage instance</span></li></ul></li>
			</ul>
			<p>Let’s take a look at some of the sections you can access in <span class="No-Break">your portal:</span></p>
			<ul>
				<li><strong class="bold">Security</strong>: In<a id="_idIndexMarker249"/> this<a id="_idIndexMarker250"/> section, you <a id="_idIndexMarker251"/>can <a id="_idIndexMarker252"/>manage <strong class="bold">access policies</strong> and <strong class="bold">access tokens</strong>, <strong class="bold">Open Authorization</strong> (<strong class="bold">OAuth</strong>), <strong class="bold">Security Assertion Markup Language</strong> (<strong class="bold">SAML</strong>), and <strong class="bold">Lightweight Directory Access </strong><span class="No-Break"><strong class="bold">Protocol</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">LDAP</strong></span><span class="No-Break">).</span><p class="list-inset">Access<a id="_idIndexMarker253"/> policies <a id="_idIndexMarker254"/>are scoped to a <strong class="bold">realm</strong>; a realm<a id="_idIndexMarker255"/> can cover a specific stack, or it can cover the <span class="No-Break">entire organization.</span></p></li>
				<li><strong class="bold">Support</strong>: This section<a id="_idIndexMarker256"/> gives <a id="_idIndexMarker257"/>access to <a id="_idIndexMarker258"/>support from the community<a id="_idIndexMarker259"/> via <strong class="bold">Community Forums</strong>, and from Grafana Labs via <strong class="bold">Support Ticket</strong> and <strong class="bold">Chat </strong><span class="No-Break"><strong class="bold">with Support</strong></span><span class="No-Break">.</span></li>
				<li><strong class="bold">Billing</strong>: The <strong class="bold">Billing</strong> section is <a id="_idIndexMarker260"/>where invoices and subscriptions are managed. A Cloud Free subscription provides a monthly limit of 10,000 metrics, 50 GB logs and 50 GB traces, 50 GB profiles, as well as three <strong class="bold">Incident Response &amp; Management</strong> (<strong class="bold">IRM</strong>) users<a id="_idIndexMarker261"/> and 500 k6 <strong class="bold">virtual user hours</strong> (<strong class="bold">VUh</strong>). This subscription is plenty for the demo <a id="_idIndexMarker262"/>applications we will be using during the book and similar small demo, personal-use installations. For larger installations, Grafana Cloud also offers two additional tiers, Cloud Pro and Cloud Advanced. These tiers give access to different key features, with Cloud Advanced being geared toward enterprise-level installations. Grafana then bills based on ingest and active users in different areas. Grafana provides a very easy-to-use monthly cost <span class="No-Break">estimation tool:</span></li>
			</ul>
			<div>
				<div id="_idContainer032" class="IMG---Figure">
					<img src="image/B18277_figure_3.5.jpg" alt="Figure 3.5 – Grafana cost estimator"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.5 – Grafana cost estimator</p>
			<p class="list-inset">With a Cloud Free <a id="_idIndexMarker263"/>subscription, you will only have access to a single stack. With a subscription to <strong class="bold">Cloud Pro</strong> or <strong class="bold">Cloud Advanced</strong>, you will be able to create multiple<a id="_idIndexMarker264"/> stacks in your account. These<a id="_idIndexMarker265"/> stacks can be in <span class="No-Break">different regions.</span></p>
			<ul>
				<li><strong class="bold">Org Settings</strong>: Here, you can<a id="_idIndexMarker266"/> manage the users who can access Grafana Cloud. You can also update your avatar, organization name, and any plugins or dashboards you have shared with <span class="No-Break">the community.</span></li>
			</ul>
			<p>Now that you have explored the Grafana Cloud Portal and have an overview of managing a Grafana Cloud account, let’s explore the Grafana instance in your <span class="No-Break">cloud stack.</span></p>
			<h2 id="_idParaDest-67"><a id="_idTextAnchor069"/>Exploring the Grafana instance</h2>
			<p>The main way to interact with <a id="_idIndexMarker267"/>the tools provided by the Grafana Stack is to access the <strong class="bold">Grafana instance</strong>. This instance provides visualization tools to view the data that is collected by the rest of the Grafana stack or other linked tools. To access your Grafana instance, you can click on the <strong class="bold">Launch</strong> button in your <span class="No-Break">Cloud Portal:</span></p>
			<div>
				<div id="_idContainer033" class="IMG---Figure">
					<img src="image/B18277_figure_3.6.jpg" alt="Figure 3.6 – Launching Grafana"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.6 – Launching Grafana</p>
			<p>To access it more directly, you can use the direct URL based on the team name selected during account creation. For instance, our sample account has the <span class="No-Break">URL </span><span class="No-Break"><strong class="source-inline">https://observabilitywithgraf</strong></span><strong class="source-inline">
</strong><span class="No-Break"><strong class="source-inline">ana.grafana.net</strong></span><span class="No-Break">.</span></p>
			<p>Once you have accessed Grafana, you will be greeted with a home page that shows your current usage. Navigation is done using the menu available at the top left of <span class="No-Break">the page:</span></p>
			<div>
				<div id="_idContainer034" class="IMG---Figure">
					<img src="image/B18277_figure_3.7.jpg" alt="Figure 3.7 – The main navigation panel in Grafana"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.7 – The main navigation panel in Grafana</p>
			<p>Let’s talk through the different sections available in the menu shown in the <span class="No-Break">preceding figure.</span></p>
			<h3>Dashboards and Starred dashboards</h3>
			<p>The <strong class="bold">Dashboards</strong> section <a id="_idIndexMarker268"/>allows you to create, import, organize, and tag dashboards in your Grafana installation. Under <strong class="bold">Dashboards</strong>, you can also access <strong class="bold">Playlists</strong>, <strong class="bold">Snapshot</strong>, <strong class="bold">Library panels</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="bold">Reporting</strong></span><span class="No-Break">:</span></p>
			<ul>
				<li>The <strong class="bold">Playlists</strong> subsection lets you manage groups of dashboards that are displayed in a sequence, for instance, on TVs in <span class="No-Break">an office.</span></li>
				<li>The <strong class="bold">Snapshot</strong> tab gives you the ability to take a snapshot of a dashboard with the data to share. This will give the recipients the ability to explore the data much better than by sharing a <span class="No-Break">simple screenshot.</span></li>
				<li><strong class="bold">Library panels</strong> provides reusable panels that can be used in multiple dashboards to aid in offering a <span class="No-Break">standardized UI.</span></li>
				<li>Finally, <strong class="bold">Reporting</strong> allows you to automatically generate PDFs from any dashboard and <a id="_idIndexMarker269"/>send them to interested parties on <span class="No-Break">a schedule.</span></li>
			</ul>
			<p>The <strong class="bold">Starred</strong> dashboards section<a id="_idIndexMarker270"/> lets you customize the UI by saving dashboards you frequently use at the top of the menu. We will explore using dashboards more fully in <a href="B18277_08.xhtml#_idTextAnchor172"><span class="No-Break"><em class="italic">Chapter 8</em></span></a><span class="No-Break">.</span></p>
			<h3>Explore</h3>
			<p><strong class="bold">Explore</strong> is the way to <a id="_idIndexMarker271"/>get direct access to the data that is connected to the Grafana instance. This is the foundation of building custom dashboards and exploring data to understand the current state of the system. We will look at this briefly later in this chapter in the section titled <em class="italic">Exploring telemetry from the demo application</em>, and in a lot more detail in <em class="italic">Chapters 4</em>, <em class="italic">5</em>, <span class="No-Break">and </span><span class="No-Break"><em class="italic">6</em></span><span class="No-Break">.</span></p>
			<h3>Alerts &amp; IRM</h3>
			<p>The <strong class="bold">Alerts &amp; IRM</strong> section <a id="_idIndexMarker272"/>contains Grafana’s <strong class="bold">Alerting</strong>, <strong class="bold">OnCall</strong>, and <strong class="bold">Incident</strong> systems for IRM, as well as machine learning capabilities and the SLO service. These can help with identifying anomalies in the system (for more details on this, you can refer to <a href="B18277_09.xhtml#_idTextAnchor183"><span class="No-Break"><em class="italic">Chapter 9</em></span></a><span class="No-Break">):</span></p>
			<div>
				<div id="_idContainer035" class="IMG---Figure">
					<img src="image/B18277_figure_3.8.jpg" alt="Figure 3.8 – Alerts &amp; IRM"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.8 – Alerts &amp; IRM</p>
			<p><strong class="bold">Alerting</strong>, or Alertmanager, allows<a id="_idIndexMarker273"/> teams to manage rules for when an alert should be triggered. It also gives teams control over the method of notification used for the alert and whether there are any schedules for when to alert. Grafana <strong class="bold">Alerting</strong> is geared toward notifying an individual team of alerts in their system, and it has been battle-tested by <span class="No-Break">many organizations.</span></p>
			<p><strong class="bold">OnCall</strong> and <strong class="bold">Incident</strong> form Grafana’s IRM toolkit. This gives organizations the ability to receive notifications from many monitoring systems and manage schedules and escalation chains, as well as giving high-level visibility of sent, acknowledged, resolved, and silenced alerts. The <strong class="bold">Incident</strong> section gives organizations the ability to start incidents. These follow predefined processes for involving the right people and communicating with stakeholders. Once the incident is initiated, Grafana can record key moments during the incident process ready for any post-incident processes. Both <strong class="bold">OnCall</strong> and <strong class="bold">Incident</strong> are aimed at organizations that need a central hub to manage the technical aspects of problem and incident management. <a href="B18277_09.xhtml#_idTextAnchor183"><span class="No-Break"><em class="italic">Chapter 9</em></span></a> will explore these tools in greater detail and show you how to <span class="No-Break">configure them.</span></p>
			<h3>Performance testing</h3>
			<p>The <strong class="bold">Performance testing</strong> area is <a id="_idIndexMarker274"/>where the k6 performance testing tool is integrated with the Grafana UI, allowing teams to manage tests and projects. k6 allows your teams to use the same performance testing tools in the CI/CD pipeline as they use to test against production. k6 will be covered in <a href="B18277_13.xhtml#_idTextAnchor239"><span class="No-Break"><em class="italic">Chapter 13</em></span></a><span class="No-Break">.</span></p>
			<h3>Observability</h3>
			<p>The <strong class="bold">Observability</strong> section <a id="_idIndexMarker275"/>brings together Kubernetes infrastructure and application monitoring, with synthetic tests used to simulate critical user journeys in your application alongside frontend <strong class="bold">real user monitoring</strong> (<strong class="bold">RUM</strong>) and <strong class="bold">profiles</strong> from<a id="_idIndexMarker276"/> Pyroscope. By combining these data sources, you <a id="_idIndexMarker277"/>gain an end-to-end view of the current performance of <span class="No-Break">your products.</span></p>
			<h3>Connections</h3>
			<p>The <strong class="bold">Connections</strong> section<a id="_idIndexMarker278"/> is an administrative area to set up and manage connections from Grafana to the 160+ data sources and infrastructure components that it can connect and show data from. Some examples of available connections are Elastisearch, Datadog, Splunk, AWS, Azure, cert-manager, GitHub, Ethereum, and Snowflake. The page to configure these connections is shown in the <span class="No-Break">following figure:</span></p>
			<div>
				<div id="_idContainer036" class="IMG---Figure">
					<img src="image/B18277_figure_3.9.jpg" alt="Figure 3.9 – Connections screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.9 – Connections screen</p>
			<h3>Administration</h3>
			<p>The <strong class="bold">Administration</strong> panel <a id="_idIndexMarker279"/>allows for the management of many aspects of Grafana, from plugins and recorded queries to users, authentication, teams, and <span class="No-Break">service accounts:</span></p>
			<div>
				<div id="_idContainer037" class="IMG---Figure">
					<img src="image/B18277_figure_3.10.jpg" alt="Figure 3.10 – Administration panel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.10 – Administration panel</p>
			<p>Now that we’ve explored the Grafana Cloud Portal, let’s prepare your local environment to <span class="No-Break">send data.</span></p>
			<h1 id="_idParaDest-68"><a id="_idTextAnchor070"/>Installing the prerequisite tools</h1>
			<p>Grafana is much more exciting with data! To build a realistic view of how Grafana works and can help your organization, we have chosen to install the OpenTelemetry demo application. This is a demonstration web store that sells telescopes and other observational equipment. We’ll take you through the installation process to get this running locally on <span class="No-Break">your machine.</span></p>
			<p>But first, there are a few prerequisites that your local environment has, and they depend on the operating system <span class="No-Break">you use.</span></p>
			<p>In this section, we will explain how to install <span class="No-Break">the following:</span></p>
			<ul>
				<li>Tools based on your <span class="No-Break">operating system:</span><ul><li><strong class="bold">Windows Subsystem for Linux version </strong><span class="No-Break"><strong class="bold">2</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">WSL2</strong></span><span class="No-Break">)</span></li><li><span class="No-Break">macOS Homebrew</span></li></ul></li>
				<li>Docker <span class="No-Break">or Podman</span></li>
				<li>A single-node <span class="No-Break">Kubernetes cluster</span></li>
				<li><span class="No-Break">Helm</span></li>
			</ul>
			<h2 id="_idParaDest-69"><a id="_idTextAnchor071"/>Installing WSL2</h2>
			<p>WSL is a<a id="_idIndexMarker280"/> way of running a Linux filesystem and tools directly on Windows. This is used to give a standard set of commands and tools across operating systems. It is possible to run these systems outside of WSL, but the processes are much easier using WSL. Follow these steps to set <span class="No-Break">up </span><span class="No-Break"><a id="_idIndexMarker281"/></span><span class="No-Break">WSL2:</span></p>
			<ol>
				<li>Open a PowerShell terminal or Windows Command Prompt as <span class="No-Break">an administrator.</span></li>
				<li>Run the following command to <span class="No-Break">install WSL2:</span><pre class="source-code">
<strong class="bold">C:\Users\OwG&gt; wsl --install</strong></pre><p class="list-inset">This will install the Ubuntu distribution <span class="No-Break">of Linux.</span></p><p class="list-inset">You should see a message that Ubuntu is installing and then you will be prompted for a new UNIX username. If you see any other message, you may have a version of WSL installed already; please refer to the Microsoft website to <span class="No-Break">address this.</span></p></li>				<li>Create a new user for your Ubuntu installation by entering a username and password. These do not need to match your Windows username <span class="No-Break">and password.</span></li>
				<li>Upgrade packages by running the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">sudo apt update &amp;&amp; sudo apt upgrade</strong></pre><p class="list-inset">It is recommended <a id="_idIndexMarker282"/>to install the Windows Terminal to use WSL. This can be downloaded from the Microsoft <span class="No-Break">Store: </span><span class="No-Break">https://learn</span><a href="http://.microsoft.com/en-us/windows/terminal/install"><span class="No-Break">.microsoft.com/en-us/windows/terminal/install</span></a><span class="No-Break">.</span></p></li>			</ol>
			<p>More detailed instructions on how to complete this installation process and troubleshoot any issues that may arise can be found <span class="No-Break">at </span><a href="https://learn.microsoft.com/en-us/windows/wsl/install"><span class="No-Break">https://learn.microsoft.com/en-us/windows/wsl/install</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-70"><a id="_idTextAnchor072"/>Installing Homebrew</h2>
			<p><strong class="bold">Homebrew</strong> is a<a id="_idIndexMarker283"/> package management tool for macOS. To install it on your system, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Open a<a id="_idIndexMarker284"/> <span class="No-Break">terminal window.</span></li>
				<li>Run the following command to <span class="No-Break">install Homebrew:</span><pre class="source-code">
<strong class="bold">$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</strong></pre><p class="list-inset">The script that runs will explain what it is doing and pause <span class="No-Break">before continuing.</span></p></li>				<li>Run the following <a id="_idIndexMarker285"/>command to install <strong class="source-inline">wget</strong> (used later in the <span class="No-Break">setup process):</span><pre class="source-code">
<strong class="bold">$ brew install wget</strong></pre></li>			</ol>
			<p>Detailed instructions <a id="_idIndexMarker286"/>on this installation can be found <span class="No-Break">at </span><a href="https://brew.sh/"><span class="No-Break">https://brew.sh/</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-71"><a id="_idTextAnchor073"/>Installing container orchestration tools</h2>
			<p><strong class="bold">Docker</strong> and <strong class="bold">Podman</strong> are both <strong class="bold">container orchestration tools</strong>. Docker has been the de facto <a id="_idIndexMarker287"/>standard for about a decade. Podman is a newer tool. It was first released in 2018. The major <a id="_idIndexMarker288"/>functions of<a id="_idIndexMarker289"/> Docker are also <a id="_idIndexMarker290"/>offered in Podman, but support and information may be more difficult <span class="No-Break">to find.</span></p>
			<p>In 2021, Docker made licensing changes that became fully effective in January 2023. These licensing changes may impact readers using devices belonging to businesses. We will only provide instructions for Docker, but we will highlight the potential issues, so you are aware of them. The aim of providing a container orchestration tool is to run a single-node Kubernetes cluster on <span class="No-Break">that tool.</span></p>
			<h3>Installing Docker Desktop</h3>
			<p>The following sections <a id="_idIndexMarker291"/>briefly describe how <strong class="bold">Docker Desktop</strong> can be installed on Windows, macOS, and Linux. Let’s look at the Windows installation <span class="No-Break">process first.</span></p>
			<h4>Windows installation</h4>
			<p>To<a id="_idIndexMarker292"/> install Docker <a id="_idIndexMarker293"/>Desktop on Windows, do <span class="No-Break">the following:</span></p>
			<ol>
				<li>Go to <a href="https://docs.docker.com/desktop/install/windows-install/">https://docs.docker.com/desktop/install/windows-install/</a> and download the latest Docker installer <strong class="source-inline">.</strong><span class="No-Break"><strong class="source-inline">exe</strong></span><span class="No-Break"> file.</span></li>
				<li>Run the installation package. You will be prompted to enable WSL2. <span class="No-Break">Select </span><span class="No-Break"><strong class="bold">Yes</strong></span><span class="No-Break">.</span></li>
				<li>After installation, start <span class="No-Break">Docker Desktop.</span></li>
				<li>Navigate to <strong class="bold">Settings</strong> | <strong class="bold">General</strong>. Select the <strong class="bold">Use WSL2 based </strong><span class="No-Break"><strong class="bold">engine</strong></span><span class="No-Break"> checkbox.</span></li>
				<li>Select <strong class="bold">Apply &amp; </strong><span class="No-Break"><strong class="bold">Restart</strong></span><span class="No-Break">.</span></li>
				<li>In your <a id="_idIndexMarker294"/>WSL <a id="_idIndexMarker295"/>terminal, validate the Docker installation by running the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">$ docker --version</strong>
<strong class="bold">Docker version 20.10.24, build 297e128</strong></pre></li>			</ol>
			<h4>macOS installation</h4>
			<p>For the <a id="_idIndexMarker296"/>macOS installation of Docker Desktop, do<a id="_idIndexMarker297"/> <span class="No-Break">the following:</span></p>
			<ol>
				<li>Go to <a href="https://docs.docker.com/desktop/install/mac-install/">https://docs.docker.com/desktop/install/mac-install/</a> and download the latest Docker installer for <span class="No-Break">your Mac.</span></li>
				<li>Run the <span class="No-Break">installation package.</span></li>
				<li>In your terminal, validate the Docker installation by running <span class="No-Break">the following:</span><pre class="source-code">
<strong class="bold">$ docker --version</strong>
<strong class="bold">Docker version 20.10.24, build 297e128</strong></pre></li>			</ol>
			<h4>Linux installation</h4>
			<p>Linux <a id="_idIndexMarker298"/>users may consider using Podman Desktop as <a id="_idIndexMarker299"/>it has better native support for Linux environments. Installation instructions are available <span class="No-Break">at </span><a href="https://podman-desktop.io/docs/Installation/linux-install"><span class="No-Break">https://podman-desktop.io/docs/Installation/linux-install</span></a><span class="No-Break">.</span></p>
			<p>However, if you do wish to use Docker, please follow the installation guide provided as the process will vary by <span class="No-Break">distribution: </span><span class="No-Break">https://docs.docker.com/desktop/install/linux-install/</span><span class="No-Break">.</span></p>
			<p>The full documentation can be found <span class="No-Break">at </span><span class="No-Break">https://docs.docker.com/desktop/</span><span class="No-Break">.</span></p>
			<p>With a base system that now supports containerization, let’s set up a single-node Kubernetes cluster. This will be used to easily and repeatably install the OpenTelemetry <span class="No-Break">demo application.</span></p>
			<h2 id="_idParaDest-72"><a id="_idTextAnchor074"/>Installing a single-node Kubernetes cluster</h2>
			<p>There are a few different<a id="_idIndexMarker300"/> tools to run<a id="_idIndexMarker301"/> local Kubernetes clusters, including <strong class="bold">Kubernetes in Docker</strong> (<strong class="bold">KinD</strong>), <strong class="bold">Minikube</strong>, and <strong class="bold">MicroK8s</strong>. However, we have chosen to use <strong class="bold">k3d</strong> due to the ease of <a id="_idIndexMarker302"/>installation<a id="_idIndexMarker303"/> across operating systems. Follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Install k3d using the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">$ wget -q -O - https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh | bash</strong></pre><p class="list-inset">Full details can be found <span class="No-Break">at </span><a href="https://k3d.io/stable/"><span class="No-Break">https://k3d.io/stable/</span></a><span class="No-Break">.</span></p></li>				<li>Create a <span class="No-Break">k3d cluster:</span><pre class="source-code">
<strong class="bold">$ k3d cluster create owg-otel-demo</strong></pre></li>				<li>Validate the <span class="No-Break">cluster status:</span><pre class="source-code">
<strong class="bold">$ kubectl get nodes</strong>
<strong class="bold">NAME             STATUS   ROLES                  AGE   VERSION</strong>
<strong class="bold">k3d-owg-otel-demo-server-0   Ready    control-plane,master   13d   v1.25.7+k3s1</strong></pre></li>			</ol>
			<p>With a Kubernetes cluster installed, we now need a way to install applications easily. OpenTelemetry provides Helm charts, which allow us to deploy applications to Kubernetes; we will install Helm to <span class="No-Break">use these.</span></p>
			<h2 id="_idParaDest-73"><a id="_idTextAnchor075"/>Installing Helm</h2>
			<p><strong class="bold">Helm</strong> is a <a id="_idIndexMarker304"/>package manager for Kubernetes clusters. A lot of infrastructure-level components are provided as Helm charts for installation, and OpenTelemetry is no exception. To install<a id="_idIndexMarker305"/> Helm, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Install Helm using the following command (details can be found <span class="No-Break">at </span><a href="https://helm.sh/docs/intro/install/"><span class="No-Break">https://helm.sh/docs/intro/install/</span></a><span class="No-Break">):</span><pre class="source-code">
<strong class="bold">$ wget –q –O - https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash</strong></pre></li>				<li>Validate the <span class="No-Break">Helm installation:</span><pre class="source-code">
<strong class="bold">$ helm version</strong>
<strong class="bold">version.BuildInfo{Version:"v3.11.3", GitCommit:"323249351482b3bbfc9f5004f65d400aa70f9ae7", GitTreeState:"clean", GoVersion:"go1.20.3"}</strong></pre></li>			</ol>
			<p>With our local system ready to start running applications, we can now install the demo application provided <span class="No-Break">by OpenTelemetry.</span></p>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor076"/>Installing the OpenTelemetry Demo application</h1>
			<p>As we need to send data from our<a id="_idIndexMarker306"/> local machine to our Grafana Cloud instance, we need to provide some credentials and tell our local machine where to send data. Before we install the demo application, we need to set up access tokens so we can send data to our Grafana <span class="No-Break">Cloud stack.</span></p>
			<h2 id="_idParaDest-75"><a id="_idTextAnchor077"/>Setting up access credentials</h2>
			<p>Access tokens<a id="_idIndexMarker307"/> allow the Open Telemetry application to send data securely to your Grafana Cloud stack. To set up an access token, we need to do <span class="No-Break">the following:</span></p>
			<ol>
				<li>In the Grafana Cloud Portal, select <strong class="bold">Access Policies</strong> in the <span class="No-Break"><strong class="bold">Security</strong></span><span class="No-Break"> section.</span></li>
				<li>Click <strong class="bold">Create </strong><span class="No-Break"><strong class="bold">access policy</strong></span><span class="No-Break">.</span></li>
				<li>Choose a name and display name, and set <strong class="bold">Realm</strong> to <span class="No-Break"><strong class="bold">All Stacks</strong></span><span class="No-Break">.</span></li>
				<li>Set the <strong class="bold">Write</strong> scope for metrics, logs, and traces and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break">.</span></li>
				<li>On the new access policy, click <span class="No-Break"><strong class="bold">Add token</strong></span><span class="No-Break">.</span></li>
				<li>Give the token a name and set the expiration date. <span class="No-Break">Click </span><span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break">.</span></li>
				<li>Finally, copy<a id="_idIndexMarker308"/> the token and save <span class="No-Break">it securely.</span></li>
			</ol>
			<p>Now that we’ve created our token, let’s download the GitHub repository for this book and set <span class="No-Break">it up.</span></p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor078"/>Downloading the repository and adding credentials and endpoints</h2>
			<p>The Git <a id="_idIndexMarker309"/>repository contains configuration files for each of the chapters that will use live data. Downloading the repository is simple. Go to the Git repository: <a href="https://github.com/PacktPublishing/Observability-with-Grafana">https://github.com/PacktPublishing/Observability-with-Grafana</a>. Click on the green <strong class="bold">Code</strong> button and follow the instructions to clone the repository. Once downloaded, the repository should look <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer038" class="IMG---Figure">
					<img src="image/B18277_figure_3.11.jpg" alt="Figure 3.11 – Observability with Grafana repo"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.11 – Observability with Grafana repo</p>
			<p>To set up the demo application, we need to add the token we saved in the previous section and the correct endpoints in the <strong class="source-inline">OTEL-Creds.yaml</strong> file. The information you will need is <span class="No-Break">the </span><span class="No-Break"><a id="_idIndexMarker310"/></span><span class="No-Break">following:</span></p>
			<ul>
				<li><strong class="bold">Password</strong>: This is the token you saved earlier and is shared by each <span class="No-Break">telemetry type</span></li>
				<li><strong class="bold">Username</strong>: This is specific to each <span class="No-Break">telemetry type</span></li>
				<li><strong class="bold">Endpoint</strong>: This is also specific to each <span class="No-Break">telemetry type</span></li>
			</ul>
			<p>Let’s take Loki <a id="_idIndexMarker311"/>as an example of how to get this information. In the Grafana Cloud Portal, do the following to get the <span class="No-Break">correct information:</span></p>
			<ol>
				<li>Click on the <strong class="bold">Send Logs</strong> button in the Loki box. At the top of the page is an information box that looks <span class="No-Break">like this:</span></li>
			</ol>
			<div>
				<div id="_idContainer039" class="IMG---Figure">
					<img src="image/B18277_figure_3.12.jpg" alt="Figure 3.12 – Grafana Data Source settings"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.12 – Grafana Data Source settings</p>
			<ol>
				<li value="2">The <strong class="bold">User</strong> field is used as <span class="No-Break">the username.</span></li>
				<li>The <strong class="bold">URL</strong> field is used as the endpoint. This <span class="No-Break">needs modifying:</span><ul><li>For logs, add <strong class="source-inline">/loki/api/v1/push</strong> to the end of <span class="No-Break">the URL</span></li><li>For metrics, add <strong class="source-inline">/api/prom/push</strong> to the end of <span class="No-Break">the URL</span></li><li>For traces, remove <strong class="source-inline">https://</strong> and add <strong class="source-inline">:443</strong> to the end of <span class="No-Break">the URL</span></li></ul></li>
				<li>Add this information into the relevant fields in the <span class="No-Break"><strong class="source-inline">OTEL-Creds.yaml</strong></span><span class="No-Break"> file.</span></li>
			</ol>
			<p>With Loki <a id="_idIndexMarker312"/>completed, we can follow the same process for Prometheus (click <strong class="bold">Send Metrics</strong>) and Tempo (click <span class="No-Break"><strong class="bold">Send Traces</strong></span><span class="No-Break">).</span></p>
			<p>These instructions are repeated and expanded on in the <strong class="source-inline">README.md</strong> file in the repository. With the credentials saved, we are now ready to <span class="No-Break">deploy OpenTelemetry.</span></p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor079"/>Installing the OpenTelemetry Collector</h2>
			<p>With the <a id="_idIndexMarker313"/>credentials file updated, we can now install the Helm chart for the OpenTelemetry Collector. This is the component that will collect and transmit the data produced by the demo application. To proceed with the installation, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Add the <span class="No-Break">OpenTelemetry repository:</span><pre class="source-code">
<strong class="bold">$ helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts</strong></pre></li>				<li>Install the collector <span class="No-Break">with Helm:</span><pre class="source-code">
<strong class="bold">$ helm install --version '0.73.1' --values chapter3/OTEL-Collector.yaml --values OTEL-Creds.yaml owg open-telemetry/opentelemetry-collector</strong>
<strong class="bold">NAME: owg-otel-collector</strong>
<strong class="bold">LAST DEPLOYED: Sun May 14 13:53:16 2023</strong>
<strong class="bold">NAMESPACE: default</strong>
<strong class="bold">STATUS: deployed</strong>
<strong class="bold">REVISION: 1</strong>
<strong class="bold">…</strong></pre></li>				<li>Validate <a id="_idIndexMarker314"/>that the installation <span class="No-Break">was successful:</span><pre class="source-code">
<strong class="bold">$ kubectl get pods</strong>
<strong class="bold">NAME                         READY   STATUS    RESTARTS   AGE</strong>
<strong class="bold">owg-otel-collector-opentelemetry-collector-6b8fdddc9d-4tsj5   1/1     Running   0          2s</strong></pre></li>			</ol>
			<p>We are now ready to install the OpenTelemetry <span class="No-Break">demo application.</span></p>
			<h2 id="_idParaDest-78"><a id="_idTextAnchor080"/>Installing the OpenTelemetry demo application</h2>
			<p>The OpenTelemetry demo application <a id="_idIndexMarker315"/>is an example web store that sells telescopes and other tools to observe the universe. To install this demo application, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Install the demo application <span class="No-Break">with Helm:</span><pre class="source-code">
<strong class="bold">$ helm install --version '0.26.0' --values owg-demo open-telemetry/opentelemetry-demo</strong>
<strong class="bold">NAME: owg-otel-demo</strong>
<strong class="bold">LAST DEPLOYED: Mon May 15 21:58:37 2023</strong>
<strong class="bold">NAMESPACE: default</strong>
<strong class="bold">STATUS: deployed</strong>
<strong class="bold">REVISION: 1</strong>
<strong class="bold">…</strong></pre></li>				<li>Validate<a id="_idIndexMarker316"/> that the installation was successful. This process may take a few minutes on the <span class="No-Break">first install:</span><pre class="source-code">
<strong class="bold">$ kubectl get pods</strong></pre><p class="list-inset">You should see about 19 <span class="No-Break">Pods running.</span></p></li>				<li>Open a port for <span class="No-Break"><strong class="source-inline">frontendproxy</strong></span><span class="No-Break"> access:</span><pre class="source-code">
<strong class="bold">$ kubectl port-forward svc/owg-demo-frontendproxy 8080:8080 &amp;</strong></pre></li>				<li>Open a port for <span class="No-Break">browser spans:</span><pre class="source-code">
<strong class="bold">$ kubectl port-forward svc/owg-opentelemetry-collector 4318:4318 &amp;</strong></pre></li>				<li>Check you can access the OpenTelemetry demo application <span class="No-Break">on </span><span class="No-Break">http://localhost:8080</span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer040" class="IMG---Figure">
					<img src="image/B18277_figure_3.13.jpg" alt="Figure 3.13 – OpenTelemetry demo application"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.13 – OpenTelemetry demo application</p>
			<ol>
				<li value="6">Explore the <a id="_idIndexMarker317"/>OpenTelemetry demo application to generate some data. Take some time to add items to your cart and purchase them. While a load generator is part of the installation, it is worth getting familiar with the application as it will help put the telemetry generated <span class="No-Break">in context.</span></li>
			</ol>
			<p>Now that you have an application that produces data, let’s start exploring <span class="No-Break">that data.</span></p>
			<h1 id="_idParaDest-79"><a id="_idTextAnchor081"/>Exploring telemetry from the demo application</h1>
			<p>Assuming the installation <a id="_idIndexMarker318"/>was successful, you will have data flowing into your Grafana instance. To view these, head to your Grafana instance, either from your team URL or by clicking <strong class="bold">Launch</strong> in the <span class="No-Break">Cloud Portal.</span></p>
			<p>On the front page, you should see information detailing your current or billable usage of logs, metrics, and traces. If everything is correct, these should all be greater than 0. It may take a few minutes for this to show up completely, sometimes up to <span class="No-Break">an hour:</span></p>
			<div>
				<div id="_idContainer041" class="IMG---Figure">
					<img src="image/B18277_figure_3.14.jpg" alt="Figure 3.14 – Grafana Cloud usage"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.14 – Grafana Cloud usage</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If you don’t see usage for metrics, logs, and traces, you might need to troubleshoot. We have included some tips at the end of <span class="No-Break">this chapter.</span></p>
			<p>Click on the <a id="_idIndexMarker319"/>menu and select <strong class="bold">Explore</strong>. This will take you to the page to run queries on the telemetry from the demo application. The highest-level concept in Grafana is a <strong class="bold">data source</strong>. These are <a id="_idIndexMarker320"/>selectable just below the main menu. Each data source is a connection from the Grafana instance to either a component in the Grafana Stack or a connection to another tool. Each data source is self-contained. The data source menu can be seen in the <span class="No-Break">following figure:</span></p>
			<div>
				<div id="_idContainer042" class="IMG---Figure">
					<img src="image/B18277_figure_3.15.jpg" alt="Figure 3.15 – Data source menu"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.15 – Data source menu</p>
			<p>You will see<a id="_idIndexMarker321"/> that there are data sources for <strong class="bold">logs</strong>, <strong class="bold">prom</strong> (Prometheus metrics), and <strong class="bold">traces</strong>. There are other data sources, but for this chapter, we will only concentrate on these three, as they are the data sources related to the Grafana Stack we <span class="No-Break">have provisioned.</span></p>
			<p>These data sources relate to our Loki, Mimir, and Tempo components, used to collect logs, metrics, and traces, respectively. We’ll discuss <span class="No-Break">these next.</span></p>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor082"/>Logs in Loki</h2>
			<p>Loki stores the log data produced<a id="_idIndexMarker322"/> by the demo application. Let’s have a quick look at the interface for a Loki data source and see some of the log data the demo application <span class="No-Break">is producing.</span></p>
			<p>Select the <strong class="source-inline">grafanacloud-&lt;team name&gt;-logs</strong> data source. In <strong class="bold">Label filters</strong>, add <strong class="bold">exporter = OTLP</strong> and click <strong class="bold">Run query</strong>. You should now see a screen <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer043" class="IMG---Figure">
					<img src="image/B18277_figure_3.16.jpg" alt="" role="presentation"/>
				</div>
			</div>
			<p class="IMG---Figure">Fig 3.16 – Reviewing logs</p>
			<p>The upper area of the <a id="_idIndexMarker323"/>screen is where you enter and modify your query. In the middle of the screen, you will see the volume of logs returned by your search over time. This can provide a lot of contextual information at a glance. The lower part of the screen displays the results of <span class="No-Break">your query:</span></p>
			<div>
				<div id="_idContainer044" class="IMG---Figure">
					<img src="image/B18277_figure_3.17.jpg" alt="Figure 3.17 Query panel details"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.17 Query panel details</p>
			<p>Let’s break the preceding<a id="_idIndexMarker324"/> screenshot down into <span class="No-Break">its components:</span></p>
			<ol>
				<li>You can select the time range and add the query to various tools by clicking <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Add</strong></span><span class="No-Break">.</span></li>
				<li>Using the buttons at the bottom of this section, you can use <strong class="bold">Add query</strong> to produce a more complex analysis of the data. <strong class="bold">Query history</strong> lets you review your query history. <strong class="bold">Query inspector</strong> helps to understand how your query <span class="No-Break">is performing.</span></li>
				<li>The <strong class="bold">Builder</strong> or <strong class="bold">Code</strong> selector allows you to switch between the UI-focused query builder you see by default and a query language entry box, which is useful for directly <span class="No-Break">entering queries.</span></li>
				<li>The <strong class="bold">Kick start your query</strong> button will give you some starter queries and the <strong class="bold">Label browser</strong> button will let you explore the labels currently available in your collected <span class="No-Break">log data.</span></li>
				<li>Finally, the <strong class="bold">Explain query</strong> slider will give you a detailed explanation of each step of the query you <span class="No-Break">currently have.</span></li>
			</ol>
			<p>Let’s take a look at the components in the query <span class="No-Break">result panel:</span></p>
			<div>
				<div id="_idContainer045" class="IMG---Figure">
					<img src="image/B18277_figure_3.18.jpg" alt="Figure 3.18 – Query result panel details"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.18 – Query result panel details</p>
			<p>These components can be used <span class="No-Break">as follows:</span></p>
			<ol>
				<li>You can customize the display of this data to show the timestamp, highlight any unique labels, wrap lines, or <span class="No-Break">prettify JSON.</span></li>
				<li>You can also <span class="No-Break">apply deduplication.</span></li>
				<li>You can choose to view the oldest or newest log <span class="No-Break">events first.</span></li>
				<li>Finally, you can download the data as <strong class="source-inline">.txt</strong> <span class="No-Break">or </span><span class="No-Break"><strong class="source-inline">.json</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p>We will look at <a id="_idIndexMarker325"/>these features in more depth in <a href="B18277_04.xhtml#_idTextAnchor092"><span class="No-Break"><em class="italic">Chapter 4</em></span></a> and introduce the LogQL <span class="No-Break">query language.</span></p>
			<p>Now that you have familiarized yourself with the query panels for logs in a Loki data source, let’s see how querying metrics from a Mimir data source is <span class="No-Break">very similar.</span></p>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor083"/>Metrics in Prometheus/Mimir</h2>
			<p>Grafana uses similar repeating <a id="_idIndexMarker326"/>blocks for querying data. In this section, we will explore how to <span class="No-Break">query metrics.</span></p>
			<p>Select the <strong class="bold">grafanacloud-&lt;team name&gt;-prom</strong> data source. In the <strong class="bold">Metric</strong> dropdown, select <strong class="bold">kafka_consumer_commit_rate</strong> and leave <strong class="bold">Label filters</strong> blank. Click on <strong class="bold">Run query</strong> and you should see a screen <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer046" class="IMG---Figure">
					<img src="image/B18277_figure_3.19.jpg" alt="Figure 3.19 – Kafka consumer commit rate"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.19 – Kafka consumer commit rate</p>
			<p>Similar to Loki, we <a id="_idIndexMarker327"/>have a query section at the top, although the structure is slightly different. The major difference is the <strong class="bold">Options</strong> section, which controls how the data is presented. <strong class="bold">Legend</strong> manages the graph’s legend display. The <strong class="bold">Format</strong> option allows you to select between a <strong class="bold">Time series</strong> representation (the graph shown in the preceding screenshot); a <strong class="bold">Table</strong> representation, showing each value of each time series; and a <strong class="bold">Heatmap</strong> representation. The <strong class="bold">Type</strong> selector allows you to select either a range of time, the latest instant of each time series, or both. The <strong class="bold">Exemplars</strong> slider will show trace data that is linked to <span class="No-Break">each metric.</span></p>
			<p>The bottom section shows the data, with options to display it in <span class="No-Break">different ways.</span></p>
			<p>To see how Grafana represents multiple plots, from the <strong class="bold">Metric</strong> dropdown, select <strong class="bold">process_runtime_jvm_cpu_utilization_ratio</strong> and click <strong class="bold">Run query</strong>. You should see a chart <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer047" class="IMG---Figure">
					<img src="image/B18277_figure_3.20.jpg" alt="Figure 3.20 – JVM CPU utilization"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.20 – JVM CPU utilization</p>
			<p>Each of the<a id="_idIndexMarker328"/> plotted lines in the chart in the preceding screenshot represents the CPU utilization of a different service running in the demo application. We will look at these features in more depth in <a href="B18277_05.xhtml#_idTextAnchor106"><span class="No-Break"><em class="italic">Chapter 5</em></span></a> and introduce the PromQL <span class="No-Break">query language.</span></p>
			<p>A Tempo trace data source is very similar to a Loki log data source and a Mimir metric data source. Let’s look at <span class="No-Break">this now.</span></p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor084"/>Traces in Tempo</h2>
			<p>Traces use a little bit more<a id="_idIndexMarker329"/> querying, as we have to find and select an individual trace, and then show the spans in the trace <span class="No-Break">in detail.</span></p>
			<p>Select the <strong class="bold">grafanacloud-&lt;team name&gt;-traces</strong> data source. For <strong class="bold">Query type</strong>, choose <strong class="bold">Search</strong>, for <strong class="bold">Service Name</strong>, select <strong class="bold">checkoutservice</strong>, and click <strong class="bold">Run query</strong>. You should see a screen <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer048" class="IMG---Figure">
					<img src="image/B18277_figure_3.21.jpg" alt="Figure 3.21 – Selecting a trace"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.21 – Selecting a trace</p>
			<p>Click on <a id="_idIndexMarker330"/>one of the <strong class="bold">Trace ID</strong> links and you will see a screen <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer049" class="IMG---Figure">
					<img src="image/B18277_figure_3.22.jpg" alt="Figure 3.22 – Trace view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.22 – Trace view</p>
			<p>This view<a id="_idIndexMarker331"/> shows the split view that Grafana offers. This can be accessed from any data source and can provide the ability to use linked data points to move between logs, metrics, and traces to see the same point in time or event in each of the telemetry types. If you select the bar between the panels, indicated by the number <strong class="bold">1</strong> in the preceding screenshot, you can make the trace view bigger by clicking <span class="No-Break">and dragging.</span></p>
			<p>Looking through the trace, each line represents a span with information on which service was involved alongside specific information from that service. For example, <strong class="bold">checkoutservice</strong> will show you the count of items in the cart and the shipping amount. The bars with each span show the total time that span took and are stacked to represent the relative start and end times of the span. You might see that <strong class="bold">productcatalogueservice</strong> takes up a significant portion of the time in the transaction in <span class="No-Break"><em class="italic">Figure 3</em></span><span class="No-Break"><em class="italic">.21</em></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-83"><a id="_idTextAnchor085"/>Adding your own applications</h2>
			<p>It is possible to add your own application to this demo installation. The OpenTelemetry Collector has been deployed with receivers available for OTLP-formatted data on port <strong class="source-inline">4317</strong> for gRPC data and <strong class="source-inline">4318</strong> for HTTP(s) data. To deploy your application, it will need to be packaged as a container and then just follow a standard deployment mechanism for a Kubernetes deployment. Please do note that k3d is opinionated and by default uses Flannel and Traefik for networking and <span class="No-Break">ingress, respectively.</span></p>
			<p>Now that we’ve understood this demo application, let’s look at some troubleshooting tips that will help you if you’re facing any issues while setting it up or <span class="No-Break">using it.</span></p>
			<h1 id="_idParaDest-84"><a id="_idTextAnchor086"/>Troubleshooting your OpenTelemetry Demo installation</h1>
			<p>There are various<a id="_idIndexMarker332"/> things that could go wrong while <a id="_idIndexMarker333"/>using this application, so this section is not necessarily exhaustive. We will assume that all the prerequisite tools were <span class="No-Break">installed correctly.</span></p>
			<p>Let’s first take a look at the correct formatting of <span class="No-Break">Grafana credentials.</span></p>
			<h2 id="_idParaDest-85"><a id="_idTextAnchor087"/>Checking Grafana credentials</h2>
			<p>If the OpenTelemetry <a id="_idIndexMarker334"/>Collector is giving authentication errors, or you are not receiving data from it, it is likely that the credentials are not formatted correctly. These details are entered into the <strong class="source-inline">OTEL-Creds.yaml</strong> file from this book’s <span class="No-Break">Git repository.</span></p>
			<p>The Grafana credentials should be formed <span class="No-Break">like this:</span></p>
			<ul>
				<li><strong class="bold">Username</strong>: Number, typically <span class="No-Break">six digits.</span></li>
				<li><strong class="bold">Password</strong>: API token, which is a long string of letters and numbers. When troubleshooting the token there are some <span class="No-Break">important considerations:</span><ul><li>The same token can be shared by all <span class="No-Break">the exporters.</span></li><li>The <strong class="bold">Access policy</strong> associated with the API token needs to be able to write logs, metrics and traces. This can be checked in the Grafana <span class="No-Break">Cloud portal.</span></li></ul></li>
				<li><strong class="bold">Endpoint</strong>: The URL that the OpenTelemetry Collector will push data to. These are the endpoints that are provided by the Grafana Cloud installation you set up in an earlier section, <em class="italic">Introducing </em><span class="No-Break"><em class="italic">Grafana Cloud</em></span><span class="No-Break">.</span><p class="list-inset">The<a id="_idIndexMarker335"/> following are sample endpoints. Yours will be different, but they will be <span class="No-Break">similarly formed:</span></p><ul><li><span class="No-Break"><strong class="source-inline">loki</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="source-inline">https://logs-prod-006.grafana.net/loki/api/v1/push</strong></span></li><li><span class="No-Break"><strong class="source-inline">prometheusremotewrite</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="source-inline">https://prometheus-prod-13-prod-us-east-0.grafana.net/api/prom/push</strong></span></li><li><strong class="source-inline">otlp</strong> (<span class="No-Break"><strong class="source-inline">tempo</strong></span><span class="No-Break">): </span><span class="No-Break"><strong class="source-inline">tempo-prod-04-prod-us-east-0.grafana.net:443</strong></span></li></ul></li>
			</ul>
			<p class="callout-heading">Important note</p>
			<p class="callout">The OTLP endpoint for Tempo is different from <span class="No-Break">the others.</span></p>
			<p>If you notice that you have made a mistake, you will need to use <strong class="source-inline">helm upgrade</strong> to deploy the changes you make to the <span class="No-Break"><strong class="source-inline">OTEL-Creds.yaml</strong></span><span class="No-Break"> file:</span></p>
			<pre class="source-code">
<strong class="bold">$ helm upgrade --version '0.73.1' --values chapter3/OTEL-Collector.yaml --values OTEL-Creds.yaml owg open-telemetry/opentelemetry-collector</strong></pre>			<p>You can also use <strong class="source-inline">helm uninstall</strong> and then use the original instructions <span class="No-Break">to reinstall.</span></p>
			<p>The most <a id="_idIndexMarker336"/>common problem is with the access credentials, but sometimes you will need to look at the collector logs to understand what is happening. Let’s see how to do <span class="No-Break">this now.</span></p>
			<h2 id="_idParaDest-86"><a id="_idTextAnchor088"/>Reading logs from the OpenTelemetry Collector</h2>
			<p>The next place to<a id="_idIndexMarker337"/> investigate<a id="_idIndexMarker338"/> is the logs from the <span class="No-Break">OpenTelemetry </span><span class="No-Break"><a id="_idIndexMarker339"/></span><span class="No-Break">Collector.</span></p>
			<p>Kubernetes allows you to directly read the logs from a Pod. To do this, you need the full Pod name, which you can get using the <span class="No-Break">following command:</span></p>
			<pre class="console">
$ kubectl get pods --selector=app.kubernetes.io/instance=owg
NAME                              READY   STATUS    RESTARTS   AGE
owg-opentelemetry-collector-567579558c-std2x   1/1     Running   0          6h26m</pre>			<p>In this case, the full Pod name <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">owg-opentelemetry-collector-567579558c-std2x</strong></span><span class="No-Break">.</span></p>
			<p>To read the logs, run the <span class="No-Break">following command:</span></p>
			<pre class="console">
$ kubectl logs owg-opentelemetry-collector-567579558c-std2x</pre>			<p>Look for any warning or error-level events, which should give an indication of the issue that <span class="No-Break">is occurring.</span></p>
			<p>Sometimes, the default logging does not give enough information. Let’s see how we can increase the <span class="No-Break">logging level.</span></p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor089"/>Debugging logs from the OpenTelemetry Collector</h2>
			<p>If the <a id="_idIndexMarker340"/>standard<a id="_idIndexMarker341"/> logs are not enough to<a id="_idIndexMarker342"/> resolve the problem, the OpenTelemetry Collector allows you to switch on <strong class="bold">debug logging</strong>. This is typically verbose, but it is very helpful in understanding <span class="No-Break">the problem.</span></p>
			<p>At the end of <strong class="source-inline">OTEL-Creds.yaml</strong>, we have included a section to manage the debug exporter. The verbosity can be set to <strong class="source-inline">detailed</strong>, <strong class="source-inline">normal</strong>, <span class="No-Break">or </span><span class="No-Break"><strong class="source-inline">basic</strong></span><span class="No-Break">.</span></p>
			<p>For most use cases, switching to <strong class="source-inline">normal</strong> will offer enough information, but if this does not help you to address the problem, switch to <strong class="source-inline">detailed</strong>. Once this option is changed, you <a id="_idIndexMarker343"/>will need <a id="_idIndexMarker344"/>to redeploy the <span class="No-Break">Helm </span><span class="No-Break"><a id="_idIndexMarker345"/></span><span class="No-Break">chart:</span></p>
			<pre class="console">
$ helm upgrade owg open-telemetry/opentelemetry-collector -f OTEL-Collector.yaml</pre>			<p>This will restart the Pod, so you will need to get the new Pod ID. With that new ID, you can look at the logs; as we saw in the previous section, you should have a lot <span class="No-Break">more detail.</span></p>
			<h1 id="_idParaDest-88"><a id="_idTextAnchor090"/>Summary</h1>
			<p>In this chapter, we have seen how to set up a Grafana Cloud account and the main screens available in the portal. We set up our local machine to run the OpenTelemetry demo application and installed the components for this. Finally, we looked a the data produced by the demo application in our Grafana Cloud account. This chapter has helped you set up an application that will produce data that is visible in your Grafana Cloud instance, so you can explore the more detailed concepts introduced later with <span class="No-Break">real examples.</span></p>
			<p>In the next chapter, we will begin to look in depth at logs and Loki, explaining how best to categorize data to give you <span class="No-Break">great insights.</span></p>
		</div>
	

		<div id="_idContainer051" class="Content">
			<h1 id="_idParaDest-89" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor091"/>Part 2: Implement Telemetry in Grafana</h1>
			<p>This part of the book will take you through the different telemetry sources, explaining what they are, when to use them, and problems to watch out for. You will look at integrations with major cloud vendors: AWS, Azure, and Google. This part will also investigate real user monitoring with Faro, profiling with Pyroscope, and performance <span class="No-Break">with k6.</span></p>
			<p>This part has the <span class="No-Break">following chapters:</span></p>
			<ul>
				<li><a href="B18277_04.xhtml#_idTextAnchor092"><em class="italic">Chapter 4</em></a>, <em class="italic">Looking at Logs with Grafana Loki</em></li>
				<li><a href="B18277_05.xhtml#_idTextAnchor106"><em class="italic">Chapter 5</em></a>, <em class="italic">Monitoring with Metrics Using Grafana Mimir and Prometheus</em></li>
				<li><a href="B18277_06.xhtml#_idTextAnchor134"><em class="italic">Chapter 6</em></a>, <em class="italic">Tracing Technicalities with Grafana Tempo</em></li>
				<li><a href="B18277_07.xhtml#_idTextAnchor147"><em class="italic">Chapter 7</em></a>, <em class="italic">Interrogating Infrastructure with Kubernetes, AWS, GCP, and Azure</em></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer052">
			</div>
		</div>
		<div>
			<div id="_idContainer053" class="Basic-Graphics-Frame">
			</div>
		</div>
	</body></html>