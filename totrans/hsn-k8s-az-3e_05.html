<html><head></head><body>
		<div>
			<div id="_idContainer025" class="Content">
			</div>
		</div>
		<div id="_idContainer026" class="Content">
			<h1 id="_idParaDest-28">2. <a id="_idTextAnchor029"/>Getting started with Azure Kubernetes Service</h1>
		</div>
		<div id="_idContainer055" class="Content">
			<p>Installing and maintaining Kubernetes clusters correctly and securely is difficult. Thankfully, all the major cloud providers, such as <strong class="bold">Azure</strong>, <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>), and <strong class="bold">Google Cloud Platform</strong> (<strong class="bold">GCP</strong>), facilitate installing and maintaining clusters. In this chapter, you will navigate through the Azure portal, launch your own cluster, and run a sample application. You will accomplish all of this from your browser.</p>
			<p>The following topics will be covered in this chapter:</p>
			<ul>
				<li>Creating a new Azure free account</li>
				<li>Creating and launching your first cluster</li>
				<li>Deploying and inspecting your first demo application</li>
			</ul>
			<p>Let's start by looking at different ways to create an <strong class="bold">Azure Kubernetes Service</strong> (<strong class="bold">AKS</strong>) cluster, and then we will run our sample application.</p>
			<h2 id="_idParaDest-29"><a id="_idTextAnchor030"/>Different ways to create an AKS cluster</h2>
			<p>In this chapter, you will use the Azure portal to deploy your AKS cluster. There are, however, multiple ways to create an AKS cluster:</p>
			<ul>
				<li><strong class="bold">Using the portal</strong>: The portal offers a <strong class="bold">graphical user interface</strong> (<strong class="bold">GUI</strong>) for deploying your cluster through a wizard. This is a great way to deploy your first cluster. For multiple deployments or automated deployments, one of the following methods is recommended.</li>
				<li><strong class="bold">Using the Azure CLI</strong>: The Azure <strong class="bold">command-line interface</strong> (<strong class="bold">CLI</strong>) is a cross-platform CLI for managing Azure resources. This allows you to script your cluster deployment, which can be integrated into other scripts.</li>
				<li><strong class="bold">Using Azure PowerShell</strong>: Azure PowerShell is a set of PowerShell commands used for managing Azure resources directly from PowerShell. It can also be used to create Kubernetes clusters.</li>
				<li><strong class="bold">Using ARM templates</strong>: <strong class="bold">Azure Resource Manager</strong> (<strong class="bold">ARM</strong>) templates are an Azure-native way to deploy Azure resources using <strong class="bold">Infrastructure as Code</strong> (<strong class="bold">IaC</strong>). You can declaratively deploy your cluster, allowing you to create a template that can be reused by multiple teams.</li>
				<li><strong class="bold">Using Terraform for Azure</strong>: Terraform is an open-source IaC tool developed by HashiCorp. The tool is very popular in the open-source community for deploying cloud resources, including AKS. Like ARM templates, Terraform also uses declarative templates for your cluster.</li>
			</ul>
			<p>In this chapter, you will create your cluster using the Azure portal. If you are interested in deploying a cluster using either CLI, ARM templates, or Terraform, the following Azure documentation contains steps on how to use these tools to create your own clusters <a href="https://docs.microsoft.com/azure/aks">https://docs.microsoft.com/azure/aks</a>.</p>
			<h2 id="_idParaDest-30"><a id="_idTextAnchor031"/>Getting started with the Azure portal</h2>
			<p>We will start our initial cluster deployment using the Azure portal. The Azure portal is a web-based management console. It allows you to build, manage, and monitor all your Azure deployments worldwide through a single console.</p>
			<h4>Note</h4>
			<p class="callout">To follow along with the examples in this book, you will need an Azure account. If you don't have an Azure account, you can create a free account by following the steps at <a href="http://azure.microsoft.com/free">azure.microsoft.com/free</a>. If you plan to run this in an existing subscription, you will need owner rights to the subscription and the ability to create service principals in <strong class="bold">Azure Active Directory</strong> (<strong class="bold">Azure AD</strong>).</p>
			<p class="callout">All the examples in this book have been verified with a free trial account.</p>
			<p>We are going to jump straight in by creating our AKS cluster. By doing so, we are also going to familiarize ourselves with the Azure portal.</p>
			<h3 id="_idParaDest-31"><a id="_idTextAnchor032"/>Creating your first AKS cluster</h3>
			<p>To start, browse to the Azure portal on <a href="https://portal.azure.com">https://portal.azure.com</a>. Enter the keyword <strong class="inline">aks</strong> in the search bar at the top of the Azure portal. Click on <span class="P---Screen-Text">Kubernetes services</span> under the <span class="P---Screen-Text">Services</span> category in the search results:</p>
			<div>
				<div id="_idContainer027" class="IMG---Figure">
					<img src="image/B17338_02_01.jpg" alt="Searching for AKS using the Azure portal search bar"/>
				</div>
			</div>
			<p class="figure">Figure 2.1: Searching for AKS with the search bar</p>
			<p>This will take you to the AKS pane in the portal. As you might have expected, you don't have any clusters yet. Go ahead and create a new cluster by hitting the <span class="P---Screen-Text">+ Add</span> button, and select the <span class="P---Screen-Text">+ Add Kubernetes cluster </span>option:</p>
			<div>
				<div id="_idContainer028" class="IMG---Figure">
					<img src="image/B17338_02_02.jpg" alt="Clicking the Add button and the Add Kubernetes cluster button to start the cluster creation process"/>
				</div>
			</div>
			<p class="figure">Figure 2.2: Clicking the + Add button and the + Add Kubernetes cluster button to start the cluster creation process</p>
			<h4>Note</h4>
			<p class="callout">There are a lot of options to configure when you're creating an AKS cluster. For your first cluster, we recommend sticking with the defaults from the portal and following our naming guidelines during this example. The following settings were tested by us to work reliably with a free account.</p>
			<p>This will take you to the creation wizard to create your first AKS cluster. The first step here is to create a new resource group. Click <span class="P---Screen-Text">Create new</span>, give your resource group a name, and hit <span class="P---Screen-Text">OK</span>. If you want to follow along with the examples in this book, please name the resource group <strong class="inline">rg-handsonaks</strong>:</p>
			<div>
				<div id="_idContainer029" class="IMG---Figure">
					<img src="image/B17338_02_03.jpg" alt="Providing essential information for creating a new resource group"/>
				</div>
			</div>
			<p class="figure">Figure 2.3: Creating a new resource group</p>
			<p>Next up, we'll provide the cluster details. Give your cluster a name—if you want to follow the examples in the book, please call it <strong class="inline">handsonaks</strong>. The region we will use in the book is <strong class="inline">(US) West US 2</strong>, but you could use any other region of choice close to your location. If the region you selected supports Availability Zones, unselect all the zones.</p>
			<p>Select a Kubernetes version—at the time of writing, version 1.19.6 is the latest version that is supported; don't worry if that specific version is not available for you. Kubernetes and AKS evolve very quickly, and new versions are introduced often:</p>
			<h4>Note</h4>
			<p class="callout">For production environments, deploying a cluster in an Availability Zone is recommended. However, since we are deploying a small cluster, not using Availability Zones works best for the examples in the book.</p>
			<div>
				<div id="_idContainer030" class="IMG---Figure">
					<img src="image/B17338_02_04.jpg" alt="Entering the cluster name and selecting a region and Kubernetes version"/>
				</div>
			</div>
			<p class="figure">Figure 2.4: Providing the cluster details</p>
			<p>Next, change the node count to 2. For the purposes of the demo in this book, the default <strong class="inline">Standard DS2 v2</strong> node size is sufficient. This should make your cluster size look similar to that shown in <em class="italics">Figure 2.5</em>:</p>
			<div>
				<div id="_idContainer031" class="IMG---Figure">
					<img src="image/B17338_02_05.jpg" alt="Updating the node count to 2 and verifying the Standard DS2 v2 machine size"/>
				</div>
			</div>
			<p class="figure">Figure 2.5: Updated Node size and Node count</p>
			<h4>Note</h4>
			<p class="callout">Your free account has a four-core limit that will be breached if you go with the defaults.</p>
			<p>The final view of the first pane should look like <em class="italics">Figure 2.6</em>. There are a number of configuration panes, which you need not change for the demo cluster we'll that you'll use throughout this book. Since you are ready, hit the <span class="P---Screen-Text">Review + create</span> button to do a final review and create your cluster:</p>
			<div>
				<div id="_idContainer032" class="IMG---Figure">
					<img src="image/B17338_02_06.jpg" alt="The final view of all the configurations under the Basics tab"/>
				</div>
			</div>
			<p class="figure">Figure 2.6: Setting the cluster configuration</p>
			<p>In the final view, Azure will validate the configuration that was applied to your first cluster. If you get the message <span class="P---Screen-Text">Validation passed</span>, click <span class="P---Screen-Text">Create</span>:</p>
			<div>
				<div id="_idContainer033" class="IMG---Figure">
					<img src="image/B17338_02_07.jpg" alt="Reviewing all the cluster configurations under the Review + create tab"/>
				</div>
			</div>
			<p class="figure">Figure 2.7: The final validation of your cluster configuration</p>
			<p>Deploying the cluster should take roughly 10 minutes. Once the deployment is complete, you can check the deployment details as shown in <em class="italics">Figure 2.8</em>:</p>
			<div>
				<div id="_idContainer034" class="IMG---Figure">
					<img src="image/B17338_02_08.jpg" alt="An overview of the deployment details once the cluster is successfully deployed"/>
				</div>
			</div>
			<p class="figure">Figure 2.8: Deployment details once the cluster is successfully deployed</p>
			<p>If you get a quota limitation error, as shown in <em class="italics">Figure 2.9</em>, check the settings and try again. Make sure that you select the <span class="P---Screen-Text">Standard DS2_v2 </span>node size and only two nodes:</p>
			<div>
				<div id="_idContainer035" class="IMG---Figure">
					<img src="image/B17338_02_09.jpg" alt="Redeploying the cluster with a smaller cluster size due to the quota limit error"/>
				</div>
			</div>
			<p class="figure">Figure 2.9: Retrying with a smaller cluster size due to a quota limit error</p>
			<p>Moving to the next section, we'll take a quick first look at your cluster; hit the <span class="P---Screen-Text">Go to resource</span> button as seen in <em class="italics">Figure 2.8.</em> This will take you to the AKS cluster dashboard in the portal.</p>
			<h3 id="_idParaDest-32"><a id="_idTextAnchor033"/>A quick overview of your cluster in the Azure portal</h3>
			<p>If you hit the <span class="P---Screen-Text">Go to resource</span> button in the previous section, you will see the overview of your cluster in the Azure portal:</p>
			<div>
				<div id="_idContainer036" class="IMG---Figure">
					<img src="image/B17338_02_10.jpg" alt="An overview of the AKS pane in the Azure portal"/>
				</div>
			</div>
			<p class="figure">Figure 2.10: The AKS pane in the Azure portal</p>
			<p>This is a quick overview of your cluster. It displays the name, the location, and the API server address. The navigation menu on the left provides different options to control and manage your cluster. Let's walk through a couple of interesting options that the has to portal offer.</p>
			<p>The <span class="P---Screen-Text">Kubernetes resources</span> section gives you an insight into the workloads that are running on your cluster. You could, for instance, see running deployments and running pods in your cluster. It also allows you to create new resources on your cluster. We will use this section later in the chapter after you have deployed your first application on AKS.</p>
			<p>In the <span class="P---Screen-Text">Node pools</span> pane, you can scale your existing node pool (meaning the nodes or servers in your cluster) either up or down by adding or removing nodes. You can add a new node pool, potentially with a different virtual machine size, and you can also upgrade your node pools individually. In <em class="italics">Figure 2.11</em>, you can see the <span class="P---Screen-Text">+ Add node pool</span> option at the top-left corner, and if you select your node pool, the <span class="P---Screen-Text">Upgrade and Scale</span> options also become available in the top bar:</p>
			<div>
				<div id="_idContainer037" class="IMG---Figure">
					<img src="image/B17338_02_11.jpg" alt="Adding, scaling, and upgrading node pools in the Node pools pane"/>
				</div>
			</div>
			<p class="figure">Figure 2.11: Adding, scaling, and upgrading node pools</p>
			<p>In the <span class="P---Screen-Text">Cluster configuration</span> pane, you can instruct AKS to upgrade the control plane to a newer version. Typically, in a Kubernetes upgrade, you first upgrade the control plane, and then the individual node pools separately. This pane also allows you to enable <strong class="bold">role-based access control</strong> (<strong class="bold">RBAC</strong>) (which is enabled by default), and optionally integrate your cluster with Azure AD. You will learn more about Azure AD integration in <em class="italics">Chapter 8, Role-based access control in AKS</em>:</p>
			<div>
				<div id="_idContainer038" class="IMG---Figure">
					<img src="image/B17338_02_12.jpg" alt="Upgrading the Kubernetes version of the API server using the Upgrade pane"/>
				</div>
			</div>
			<p class="figure">Figure 2.12: Upgrading the Kubernetes version of the API server using the Upgrade pane</p>
			<p>Finally, the <span class="P---Screen-Text">Insights</span> pane allows you to monitor your cluster infrastructure and the workloads running on your cluster. Since your cluster is brand new, there isn't a lot of data to investigate. We will return back to this, in <em class="italics">Chapter 7</em>, <em class="italics">Monitoring the AKS cluster and the application</em>:</p>
			<div>
				<div id="_idContainer039" class="IMG---Figure">
					<img src="image/B17338_02_13.jpg" alt="Monitoring cluster utilization using the Insights pane"/>
				</div>
			</div>
			<p class="figure">Figure 2.13: Displaying cluster utilization using the Insights pane</p>
			<p>This concludes our quick overview of the cluster and some of the interesting configuration options in the Azure portal. In the next section, we'll connect to our AKS cluster using Cloud Shell and then launch a demo application on top of this cluster.</p>
			<h3 id="_idParaDest-33"><a id="_idTextAnchor034"/>Accessing your cluster using Azure Cloud Shell</h3>
			<p>Once the deployment is completed successfully, find the small Cloud Shell icon near the search bar, as highlighted in <em class="italics">Figure 2.14</em>, and click it:</p>
			<div>
				<div id="_idContainer040" class="IMG---Figure">
					<img src="image/B17338_02_14.jpg" alt="Clicking the Cloud Shell icon to open Azure Cloud Shell"/>
				</div>
			</div>
			<p class="figure">Figure 2.14: Clicking the Cloud Shell icon to open Azure Cloud Shell</p>
			<p>The portal will ask you to select either <span class="P---Screen-Text">PowerShell</span> or <span class="P---Screen-Text">Bash</span> as your default shell experience. As we will be working mainly with Linux workloads, please select <span class="P---Screen-Text">Bash</span>:</p>
			<div>
				<div id="_idContainer041" class="IMG---Figure">
					<img src="image/B17338_02_15.jpg" alt="Selecting Bash as the default code editor"/>
				</div>
			</div>
			<p class="figure">Figure 2.15: Selecting the Bash option</p>
			<p>If this is the first time you have launched Cloud Shell, you will be asked to create a storage account; confirm and create it:</p>
			<div>
				<div id="_idContainer042" class="IMG---Figure">
					<img src="image/B17338_02_16.jpg" alt="Creating a new storage account for Cloud Shell"/>
				</div>
			</div>
			<p class="figure">Figure 2.16: Creating a new storage account for Cloud Shell</p>
			<p>After creating the storage, you might get an error message that contains a mount storage error. If that occurs, please restart your Cloud Shell:</p>
			<div>
				<div id="_idContainer043" class="IMG---Figure">
					<img src="image/B17338_02_17.jpg" alt="Hitting the restart button upon potentially receiving a mount storage error "/>
				</div>
			</div>
			<p class="figure">Figure 2.17: Hitting the restart button upon receiving a mount storage error</p>
			<p>Click on the power button. It should restart, and you should see something similar to <em class="italics">Figure 2.18</em>:</p>
			<div>
				<div id="_idContainer044" class="IMG---Figure">
					<img src="image/B17338_02_18.jpg" alt="Showing a user logged into Cloud Shell"/>
				</div>
			</div>
			<p class="figure">Figure 2.18: Launching Cloud Shell successfully</p>
			<p>You can pull the splitter/divider up or down to see more or less of the shell:</p>
			<div>
				<div id="_idContainer045" class="IMG---Figure">
					<img src="image/B17338_02_19.jpg" alt="Using the divider to resize the Cloud Shell window"/>
				</div>
			</div>
			<p class="figure">Figure 2.19: Using the divider to make Cloud Shell larger or smaller</p>
			<p>The command-line tool that is used to interface with Kubernetes clusters is called <strong class="inline">kubectl</strong>. The benefit of using Azure Cloud Shell is that this tool, along with many others, comes preinstalled and is regularly maintained. <strong class="inline">kubectl</strong> uses a configuration file stored in <strong class="inline">~/.kube/config</strong> to store credentials to access your cluster.</p>
			<h4>Note</h4>
			<p class="callout">There is some discussion in the Kubernetes community around the correct pronunciation of <strong class="inline">kubectl</strong>. The common way to pronounce it is either <em class="italics">kube-c-t-l</em>, <em class="italics">kube-control</em>, or <em class="italics">kube-cuddle</em>.</p>
			<p>To get the required credentials to access your cluster, you need to type the following command:</p>
			<p class="snippet">az aks get-credentials \</p>
			<p class="snippet">  --resource-group rg-handsonaks \</p>
			<p class="snippet">  --name handsonaks</p>
			<h4>Note</h4>
			<p class="callout">In this book, you will commonly see longer commands spread over multiple lines using the backslash symbol. This helps improve the readability of the commands, while still allowing you to copy and paste them. If you are typing these commands, you can safely ignore the backslash and type the full command in a single line.</p>
			<p>To verify that you have access, type the following:</p>
			<p class="snippet">kubectl get nodes</p>
			<p>You should see something like <em class="italics">Figure 2.20</em>:</p>
			<div>
				<div id="_idContainer046" class="IMG---Figure">
					<img src="image/B17338_02_20.jpg" alt="Output of the kubectl get nodes command"/>
				</div>
			</div>
			<p class="figure">Figure 2.20: Output of the kubectl get nodes command</p>
			<p>This command has verified that you can connect to your AKS cluster. In the next section, you'll go ahead and launch your first application.</p>
			<h3 id="_idParaDest-34"><a id="_idTextAnchor035"/>Deploying and inspecting your first demo application</h3>
			<p>As you are all connected, let's launch your very first application. In this section, you will deploy your first application and inspect it using <strong class="inline">kubectl</strong> and later using the Azure portal. Let's start by deploying the application.</p>
			<h3 id="_idParaDest-35"><a id="_idTextAnchor036"/>Deploying the demo application</h3>
			<p>In this section, you will deploy your demo application. For this, you will have to write a bit of code. In Cloud Shell, there are two options to edit code. You can do this either via command-line tools such as <strong class="inline">vi</strong> or <strong class="inline">nano</strong> or you can use a GUI-based code editor by typing the <strong class="inline">code</strong> commands in Cloud Shell. Throughout this book, you will mainly be instructed to use the graphical editor in the examples, but feel free to use any other tool you feel most comfortable with.</p>
			<p>For the purpose of this book, all the code examples are hosted in a GitHub repository. You can clone this repository to your Cloud Shell and work with the code examples directly. To clone the GitHub repo into your Cloud Shell, use the following command:</p>
			<p class="snippet">git clone <a href="https://github.com/PacktPublishing/Hands-on-Kubernetes-on-Azure-Third-Edition.git">https://github.com/PacktPublishing/Hands-on-Kubernetes-on-Azure-Third-Edition.git</a> Hands-On-Kubernetes-on-Azure</p>
			<p>To access the code examples for this chapter, navigate into the directory of the code examples and go to the <strong class="inline">Chapter02</strong> directory:</p>
			<p class="snippet">cd Hands-On-Kubernetes-on-Azure/Chapter02/</p>
			<p>You will use the code directly in the <strong class="inline">Chapter02</strong> folder for now. At this point in the book, you will not focus on what is in the code files just yet. The goal of this chapter is to launch a cluster and deploy an application on top of it. In the following chapters, we will dive into how Kubernetes configuration files are built and how you can create your own.</p>
			<p>You will create an application based on the definition in the <strong class="inline">azure-vote.yaml</strong> file. To open that file in Cloud Shell, you can type the following command:</p>
			<p class="snippet">code azure-vote.yaml</p>
			<p>Here is the code example for your convenience:</p>
			<p class="snippet">1 	apiVersion: apps/v1</p>
			<p class="snippet">2 	kind: Deployment</p>
			<p class="snippet">3 	metadata:</p>
			<p class="snippet">4 	  name: azure-vote-back</p>
			<p class="snippet">5 	spec:</p>
			<p class="snippet">6 	  replicas: 1</p>
			<p class="snippet">7 	  selector:</p>
			<p class="snippet">8 		matchLabels:</p>
			<p class="snippet">9 		  app: azure-vote-back</p>
			<p class="snippet">10	  template:</p>
			<p class="snippet">11		metadata:</p>
			<p class="snippet">12		  labels:</p>
			<p class="snippet">13			app: azure-vote-back</p>
			<p class="snippet">14		spec:</p>
			<p class="snippet">15		  containers:</p>
			<p class="snippet">16		  - name: azure-vote-back</p>
			<p class="snippet">17			image: redis</p>
			<p class="snippet">18			resources:</p>
			<p class="snippet">19			  requests:</p>
			<p class="snippet">20				cpu: 100m</p>
			<p class="snippet">21				memory: 128Mi</p>
			<p class="snippet">22			  limits:</p>
			<p class="snippet">23				cpu: 250m</p>
			<p class="snippet">24				memory: 256Mi</p>
			<p class="snippet">25			ports:</p>
			<p class="snippet">26			- containerPort: 6379</p>
			<p class="snippet">27			  name: redis</p>
			<p class="snippet">28	---</p>
			<p class="snippet">29	apiVersion: v1</p>
			<p class="snippet">30	kind: Service</p>
			<p class="snippet">31	metadata:</p>
			<p class="snippet">32	  name: azure-vote-back</p>
			<p class="snippet">33	spec:</p>
			<p class="snippet">34	  ports:</p>
			<p class="snippet">35	  - port: 6379</p>
			<p class="snippet">36	  selector:</p>
			<p class="snippet">37		app: azure-vote-back</p>
			<p class="snippet">38	---</p>
			<p class="snippet">39	apiVersion: apps/v1</p>
			<p class="snippet">40	kind: Deployment</p>
			<p class="snippet">41	metadata:</p>
			<p class="snippet">42	  name: azure-vote-front</p>
			<p class="snippet">43	spec:</p>
			<p class="snippet">44	  replicas: 1</p>
			<p class="snippet">45	  selector:</p>
			<p class="snippet">46		matchLabels:</p>
			<p class="snippet">47		  app: azure-vote-front</p>
			<p class="snippet">48	  template:</p>
			<p class="snippet">49		metadata:</p>
			<p class="snippet">50		  labels:</p>
			<p class="snippet">51			app: azure-vote-front</p>
			<p class="snippet">52		spec:</p>
			<p class="snippet">53		  containers:</p>
			<p class="snippet">54		  - name: azure-vote-front</p>
			<p class="snippet">55			image: microsoft/azure-vote-front:v1</p>
			<p class="snippet">56			resources:</p>
			<p class="snippet">57			  requests:</p>
			<p class="snippet">58				cpu: 100m</p>
			<p class="snippet">59				memory: 128Mi</p>
			<p class="snippet">60			  limits:</p>
			<p class="snippet">61				cpu: 250m</p>
			<p class="snippet">62				memory: 256Mi</p>
			<p class="snippet">63			ports:</p>
			<p class="snippet">64			- containerPort: 80</p>
			<p class="snippet">65			env:</p>
			<p class="snippet">66			- name: REDIS</p>
			<p class="snippet">67			  value: "azure-vote-back"</p>
			<p class="snippet">68	---</p>
			<p class="snippet">69	apiVersion: v1</p>
			<p class="snippet">70	kind: Service</p>
			<p class="snippet">71	metadata:</p>
			<p class="snippet">72	  name: azure-vote-front</p>
			<p class="snippet">73	spec:</p>
			<p class="snippet">74	  type: LoadBalancer</p>
			<p class="snippet">75	  ports:</p>
			<p class="snippet">76	  - port: 80</p>
			<p class="snippet">77	  selector:</p>
			<p class="snippet">78		app: azure-vote-front</p>
			<p>You can make changes to files in the Cloud Shell code editor. If you've made changes, you can save them by clicking on the <span class="P---Screen-Text">...</span> icon in the upper-right corner, and then click <span class="P---Screen-Text">Save</span> to save the file as highlighted in <em class="italics">Figure 2.21</em>:</p>
			<div>
				<div id="_idContainer047" class="IMG---Figure">
					<img src="image/B17338_02_21.jpg" alt="Saving changes in the Cloud Shell code editor"/>
				</div>
			</div>
			<p class="figure">Figure 2.21: Save the azure-vote.yaml file</p>
			<p>The file should be saved. You can check this with the following command:</p>
			<p class="snippet">cat azure-vote.yaml</p>
			<h4>Note:</h4>
			<p class="callout">Hitting the <em class="italics">Tab</em> button expands the file name in Linux. In the preceding scenario, if you hit <em class="italics">Tab</em> after typing <strong class="inline">az</strong>, it should expand to <strong class="inline">azure-vote.yaml</strong>.</p>
			<p>Now, let's launch the application:</p>
			<p class="snippet">kubectl create -f azure-vote.yaml</p>
			<p>You should quickly see the output as shown in <em class="italics">Figure 2.22</em>, it tells you which resources have been created:</p>
			<div>
				<div id="_idContainer048" class="IMG---Figure">
					<img src="image/B17338_02_22.jpg" alt="Output of the kubectl create command"/>
				</div>
			</div>
			<p class="figure">Figure 2.22: Output of the kubectl create command</p>
			<p>You have successfully created your demo application. In the next section, you will inspect all the different objects Kubernetes created for this application and connect to your application.</p>
			<h3>Exploring the demo application</h3>
			<p>In the previous section, you deployed a demo application. In this section, you will explore the different objects that Kubernetes created for this application and connect to it.</p>
			<p>You can check the progress of the deployment by typing the following command:</p>
			<p class="snippet">kubectl get pods</p>
			<p>If you typed this soon after creating the application, you might have seen that a certain pod was still in the <strong class="inline">ContainerCreating</strong> process:</p>
			<div>
				<div id="_idContainer049" class="IMG---Figure">
					<img src="image/B17338_02_23.jpg" alt="Output of the kubectl get pods command"/>
				</div>
			</div>
			<p class="figure">Figure 2.23: Output of the kubectl get pods command</p>
			<h4>Note</h4>
			<p class="callout">Typing <strong class="inline">kubectl</strong> can become tedious. You can use the <strong class="inline">alias</strong> command to make your life easier. You can use <strong class="inline">k</strong> instead of <strong class="inline">kubectl</strong> as the alias with the following command: <strong class="inline">alias k=kubectl</strong>. After running the preceding command, you can just use <strong class="inline">k get pods</strong>. For instructional purposes in this book, we will continue to use the full <strong class="inline">kubectl</strong> command.</p>
			<p>Hit the <em class="italics">up arrow</em> key and press <em class="italics">Enter</em> to repeat the <strong class="inline">kubectl get pods</strong> command until the status of all pods is <strong class="inline">Running</strong>. Setting up all the pods takes some time, and you could optionally follow their status using the following command:</p>
			<p class="snippet">kubectl get pods --watch</p>
			<p>To stop following the status of the pods (when they are all in a running state), you can press <em class="italics">Ctrl</em> + <em class="italics">C</em>.</p>
			<p>In order to access your application publicly, you need one more thing. You need to know the public IP of the load balancer so that you can access it. If you remember from <em class="italics">Chapter 1</em>, <em class="italics">Introduction to containers and Kubernetes</em>, a service in Kubernetes will create an Azure load balancer. This load balancer will get a public IP in your application so you can access it publicly.</p>
			<p>Type the following command to get the public IP of the load balancer:</p>
			<p class="snippet">kubectl get service azure-vote-front --watch</p>
			<p>At first, the external IP might show <strong class="inline">pending</strong>. Wait for the public IP to appear and then press <em class="italics">Ctrl</em> + <em class="italics">C</em> to exit:</p>
			<div>
				<div id="_idContainer050" class="IMG---Figure">
					<img src="image/B17338_02_24.jpg" alt="Watching the service IP change from pending to the actual IP address"/>
				</div>
			</div>
			<p class="figure">Figure 2.24: Watching the service IP change from pending to the actual IP address</p>
			<p>Note the external IP address and type it in a browser. You should see an output similar to <em class="italics">Figure 2.25</em>:</p>
			<div>
				<div id="_idContainer051" class="IMG---Figure">
					<img src="image/B17338_02_25.jpg" alt="Output of the application you just launched as seen in the browser"/>
				</div>
			</div>
			<p class="figure">Figure 2.25: The actual application you just launched</p>
			<p>Click on <span class="P---Screen-Text">Cats</span> or <span class="P---Screen-Text">Dogs</span> and watch the count go up.</p>
			<p>To see all the objects in Kubernetes that were created for your application, you can use the <strong class="inline">kubectl get all</strong> command. This will show an output similar to <em class="italics">Figure 2.26</em>:</p>
			<div>
				<div id="_idContainer052" class="IMG---Figure">
					<img src="image/B17338_02_26.jpg" alt="Viewing all the objects by executing the kubectl get all command"/>
				</div>
			</div>
			<p class="figure">Figure 2.26: Exploring all the Kubernetes objects created for your application</p>
			<p>As you can see, a number of objects were created:</p>
			<ul>
				<li>Pods: You will see two pods, one for the back end and one for the front end.</li>
				<li>Services: You will also see two services, one for the back end of type <strong class="inline">ClusterIP</strong> and one for the front end of type LoadBalancer. What these types mean will be explored in <em class="italics">Chapter 3</em>, <em class="italics">Application deployment on AKS.</em></li>
				<li>Deployments: You will also see two deployments.</li>
				<li>ReplicaSets: And finally you'll see two ReplicaSets. </li>
			</ul>
			<p>You can also view these objects from the Azure portal. To see, for example, the two deployments, you can click on <strong class="bold">Workloads</strong> in the left-hand navigation menu of the AKS pane, and you will see all the deployments in your cluster as shown in <em class="italics">Figure 2.27</em>. This figure shows you all the deployments in your cluster, including the system deployments. At the bottom of the list, you can see your own deployments. As you can also see in this figure, you can explore other objects such as pods and ReplicaSets using the top menu:</p>
			<div>
				<div id="_idContainer053" class="IMG---Figure">
					<img src="image/B17338_02_27.jpg" alt="Viewing all the deployments in our cluster using the Azure portal"/>
				</div>
			</div>
			<p class="figure">Figure 2.27: Exploring the two deployments part of your application in the Azure portal</p>
			<p>You have now launched your own cluster and your first Kubernetes application. Note that Kubernetes took care of tasks such as connecting the front end and the back end, and exposing them to the outside world, as well as providing storage for the services.</p>
			<p>Before moving on to the next chapter, let's clean up your deployment. Since you created everything from a file, you can also delete everything by pointing Kubernetes to that file. Type <strong class="inline">kubectl delete -f azure-vote.yaml</strong> and watch all your objects get deleted:</p>
			<div>
				<div id="_idContainer054" class="IMG---Figure">
					<img src="image/B17338_02_28.jpg" alt="Deleting all the objects by running the kubectl delete command"/>
				</div>
			</div>
			<p class="figure">Figure 2.28: Cleaning up the application</p>
			<p>In this section, you have connected to your AKS cluster using Cloud Shell, successfully launched and connected to a demo application, explored the objects created using Cloud Shell and the Azure portal, and finally, cleaned up the resources that were created.</p>
			<h2 id="_idParaDest-36"><a id="_idTextAnchor037"/>Summary</h2>
			<p>Having completed this chapter, you will now be able to access and navigate the Azure portal to perform all the functions required to deploy an AKS cluster. We used the free trial on Azure to our advantage to learn the ins and outs of AKS. We also launched our own AKS cluster with the ability to customize configurations if required using the Azure portal.</p>
			<p>We also used Cloud Shell without installing anything on the computer. This is important for all the upcoming sections, where you will be doing more than just launching simple applications. Finally, we launched a publicly accessible service. The skeleton of this application is the same as for complex applications that we will cover in the later chapters.</p>
			<p>In the next chapter, we will take an in-depth look at different deployment options to deploy applications onto AKS.</p>
		</div>
	</body></html>