- en: '4'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '4'
- en: k3OS Installation and Configurations
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: k3OS 安装与配置
- en: In edge computing contexts, companies are looking to simplify their tasks while
    using edge devices. Talking about the success of the K3s adoption, some industries
    need a ready-to-use operating system that can include an edge Kubernetes distribution.
    This is where k3OS fits the industry's needs. k3OS was designed to speed up the
    installation of K3s on edge devices.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在边缘计算的背景下，企业希望简化使用边缘设备的任务。谈到 K3s 的成功采用，一些行业需要一个现成的操作系统，能够包括一个边缘 Kubernetes 发行版。这正是
    k3OS 满足行业需求的地方。k3OS 的设计目的是加速在边缘设备上安装 K3s。
- en: k3OS packages all the necessary software to install K3s. This chapter explores
    how to use the k3OS ISO image to install K3s on x86_64 devices and how to use
    configuration files. You will learn from different configuration examples how
    to customize your K3s installations, from single node to multi-node. Finally,
    you will learn how to install k3OS on ARM devices using the overlay installation,
    taking in detailed configurations such as networking, the hostname that you would
    need when installing k3OS on edge devices, especially when you use ARM devices.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: k3OS 打包了安装 K3s 所需的所有软件。本章将探讨如何使用 k3OS 的 ISO 镜像在 x86_64 设备上安装 K3s，并介绍如何使用配置文件。你将通过不同的配置示例学习如何自定义你的
    K3s 安装，从单节点到多节点。最后，你将学习如何在 ARM 设备上使用覆盖安装安装 k3OS，详细配置包括网络设置、主机名等，特别是在为边缘设备安装 k3OS
    时，尤其是使用 ARM 设备时。
- en: 'In this chapter, we''re going to cover the following main topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下主要内容：
- en: k3OS installation for x86_64 devices using an ISO image
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 ISO 镜像为 x86_64 设备安装 k3OS
- en: Advanced installations of k3OS using config files
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用配置文件进行的 k3OS 高级安装
- en: Multi-node ARM overlay installation
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多节点 ARM 覆盖安装
- en: Technical requirements
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'For this chapter, you need one of the following VMs or devices:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本章需要以下虚拟机或设备之一：
- en: A Raspberry Pi 4B model with 4 GB RAM (minimum suggested)
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一台 4GB RAM（建议最小） 的 Raspberry Pi 4B 模型
- en: A cloud server or VM with **Ubuntu 20.04 LTS**
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一台运行 **Ubuntu 20.04 LTS** 的云服务器或虚拟机
- en: A VM created using VirtualBox or other software for virtualization
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 VirtualBox 或其他虚拟化软件创建的虚拟机
- en: In addition, you need a cloud storage service such as Amazon S3, Google Cloud
    Storage, or similar, to upload the configuration file for k3OS.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你需要一个云存储服务，如 Amazon S3、Google Cloud Storage 或类似服务，用于上传 k3OS 的配置文件。
- en: With this, we are ready to learn how to install k3OS in your preferred edge
    device. So, let's get started.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 这样，我们已经准备好学习如何在你首选的边缘设备上安装 k3OS。那就开始吧。
- en: 'For more detail and code snippets, check out this resource on GitHub: [https://github.com/PacktPublishing/Edge-Computing-Systems-with-Kubernetes/tree/main/ch4](https://github.com/PacktPublishing/Edge-Computing-Systems-with-Kubernetes/tree/main/ch4)'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 更多详细信息和代码片段，请查看 GitHub 上的资源：[https://github.com/PacktPublishing/Edge-Computing-Systems-with-Kubernetes/tree/main/ch4](https://github.com/PacktPublishing/Edge-Computing-Systems-with-Kubernetes/tree/main/ch4)
- en: k3OS – the Kubernetes operating system
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: k3OS – Kubernetes 操作系统
- en: k3OS is a Linux distribution that includes the minimal kernel, drivers, and
    binaries that you need to install Kubernetes at the edge. It features a lightweight
    distribution of Kubernetes called K3s. k3OS could be used as a fast operating
    system solution to install a lightweight Kubernetes cluster; this means that the
    k3OS image could be used to install master and agent nodes. k3OS uses K3s as the
    main software to create a single or multi-cluster node for the edge. So, with
    k3OS, you are ready to run your edge clusters without spending a lot of time.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: k3OS 是一个 Linux 发行版，包含安装 Kubernetes 所需的最小内核、驱动程序和二进制文件。它提供了一个轻量级的 Kubernetes
    发行版，称为 K3s。k3OS 可以作为一种快速操作系统解决方案来安装轻量级 Kubernetes 集群；这意味着 k3OS 镜像可以用于安装主节点和代理节点。k3OS
    使用 K3s 作为主要软件，在边缘设备上创建单节点或多节点集群。因此，使用 k3OS，你可以快速运行边缘集群，而不需要花费太多时间。
- en: 'k3OS can be installed using the following methods:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: k3OS 可以通过以下方式安装：
- en: '**ISO image**'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ISO 镜像**'
- en: '**Overlay installation**'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**覆盖安装**'
- en: There are other methods to install a K3s cluster, but this is an easier way
    to get started fast. At this moment, k3OS is under development but supports a
    lot of features for ARM devices. So, let's move on to learn how to install your
    lightweight Kubernetes cluster using k3OS in the next section.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 还有其他安装 K3s 集群的方法，但这是一个更简便的快速入门方式。目前，k3OS 仍在开发中，但已经支持许多 ARM 设备的功能。所以，让我们继续学习下一部分，了解如何使用
    k3OS 安装轻量级 Kubernetes 集群。
- en: k3OS installation for x86_64 devices using an ISO image
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 ISO 镜像为 x86_64 设备安装 k3OS
- en: 'We are going to install k3OS in a VM created using VirtualBox and an ISO image
    for a x86_64 architecture using a Macintosh. To do this, follow these steps:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: 'Download the `k3OS x86_64 v0.20.7 ISO` image from this link:'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[https://github.com/rancher/k3os/releases](https://github.com/rancher/k3os/releases)'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: 'Open your VirtualBox. The main window will appear, as shown in the following
    screenshot:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.1 – VirtualBox main window](img/B16945_Figure_4.1.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
- en: Figure 4.1 – VirtualBox main window
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: Enter the name to identify the VM – in this case, `k3OS` – and choose the type
    of VM as **Linux** and the **version** as **Other Linux (64 bit)**. Then, click
    on **Continue**.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.2 – Name and operating system dialog'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.2.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.2 – Name and operating system dialog
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: Choose at least **2048 MB** of RAM memory for the Live CD and interactive installation.
    Then, click on **Continue**.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.3 – Memory size dialog'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.3.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.3 – Memory size dialog
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: Now let's create the hard disk; choose **Create a virtual hard disk now** and
    click on **Create**.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.4 – Hard disk dialog'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.4.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.4 – Hard disk dialog
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: Choose **VDI** for **Hard disk file type** and click **Continue**.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.5 – Hard disk file type dialog](img/B16945_Figure_4.5.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
- en: Figure 4.5 – Hard disk file type dialog
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: Choose **Dynamically allocated** for physical storage, as this will dynamically
    allocate the space for your hard disk. Then, click **Continue**.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.6 – Hard disk type dialog'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.6.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.6 – Hard disk type dialog
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: Choose at least **4.00 GB** of disk space for your installation; it could be
    more, depending on your own requirements. Then, click on **Create**.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.7 – Disk space dialog'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.7.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.7 – Disk space dialog
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: VirtualBox is going to move you to the **main window**; click on the **Settings**
    icon.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.8 – Main window and Settings icon'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.8.jpg)'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.8 – Main window and Settings icon
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: Click on **Storage** and choose the **Empty** drive icon. Now, click on the
    small CD icon (![](img/B16945_04_icon1.png)) next to the **Optical Drive** combo
    box.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.9 – Storage dialog'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.9.jpg)'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.9 – Storage dialog
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: Choose the **Choose a disk file...** menu.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.10 – Optical drive options'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.10.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.10 – Optical drive options
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: 'Now find your **k3OS ISO image** and click **Open**:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.11 – Open ISO dialog](img/B16945_Figure_4.11.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
- en: Figure 4.11 – Open ISO dialog
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: Click on the **Live CD/DVD** checkbox and then click **OK**.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 4.12 – Activating the Live CD/DVD feature'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16945_Figure_4.12.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.12 – Activating the Live CD/DVD feature
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: 'Now click on **Network**, and under **Adapter 1**, change the **Attached to**:
    combo box to **Bridged Adapter** for your VM to get an IP inside your local network.
    This is useful to access the VM remotely. Then, click **OK**.'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在点击**网络**，在**适配器 1**下，将**附加到**的下拉框更改为**桥接适配器**，使你的虚拟机能够获取到局域网内的 IP 地址。这样可以远程访问虚拟机。然后，点击**确定**。
- en: '![Figure 4.13 – Network configuration dialog'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.13 – 网络配置对话框'
- en: '](img/B16945_Figure_4.13.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.13.jpg)'
- en: Figure 4.13 – Network configuration dialog
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.13 – 网络配置对话框
- en: VirtualBox is going to return to the main window again; now click on the **Start**
    icon.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: VirtualBox 将再次返回主窗口，现在点击**启动**图标。
- en: Now, you should wait for the process of loading the k3OS distribution. At the
    end, you are going to see a login prompt. Use `rancher` as both the username and
    password. For newer versions, you don't have to enter any password.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你应该等待 k3OS 发行版的加载过程。加载完成后，你将看到一个登录提示符。使用`rancher`作为用户名和密码。在较新的版本中，你无需输入任何密码。
- en: '![Figure 4.14 – k3OS live CD first-time login'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.14 – k3OS live CD 初次登录'
- en: '](img/B16945_Figure_4.14.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.14.jpg)'
- en: Figure 4.14 – k3OS live CD first-time login
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.14 – k3OS live CD 初次登录
- en: 'Then, execute `sudo k3os install` to start the interactive script to install
    k3OS in your VM:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，执行 `sudo k3os install` 来启动交互式脚本，在虚拟机中安装 k3OS：
- en: '![Figure 4.15 – k3OS starting the interactive installation'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.15 – k3OS 启动交互式安装'
- en: '](img/B16945_Figure_4.15.jpg)'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.15.jpg)'
- en: Figure 4.15 – k3OS starting the interactive installation
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.15 – k3OS 启动交互式安装
- en: 'Complete the script installation with the following values:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下值完成脚本安装：
- en: Install to disk with key `1`.
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用键 `1` 安装到磁盘。
- en: Config system with cloud-init with `N`.
  id: totrans-86
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `N` 配置 cloud-init 系统。
- en: Authorize the GitHub user to SSH with `N`.
  id: totrans-87
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 授权 GitHub 用户通过 SSH 连接，使用 `N`。
- en: Set up and confirm your new password for the rancher user with `YOUR_PASSWORD`.
  id: totrans-88
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为 rancher 用户设置并确认新密码，使用 `YOUR_PASSWORD`。
- en: Configure Wi-Fi with `N`.
  id: totrans-89
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`N`配置 Wi-Fi。
- en: Run as a server or agent with `1`.
  id: totrans-90
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`1`作为服务器或代理运行。
- en: Token or cluster secret – leave it empty and then press *Enter*.
  id: totrans-91
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 令牌或集群密钥 – 留空后按*Enter*。
- en: Your disk will be formatted with `y`.
  id: totrans-92
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你的磁盘将被使用 `y` 格式化。
- en: 'The dialog will resemble the following screenshot:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 对话框将类似于以下屏幕截图：
- en: '![Figure 4.16 – Installation of the CLI dialog'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.16 – CLI 对话框安装'
- en: '](img/B16945_Figure_4.16.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.16.jpg)'
- en: Figure 4.16 – Installation of the CLI dialog
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.16 – CLI 对话框安装
- en: After that, the VM is going to reboot; when starting to load, close the VM window,
    and the dialog from *Figure 4.17* will appear. Choose **Power off the machine**
    and then click **OK**.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后，虚拟机会重启；当开始加载时，关闭虚拟机窗口，*图 4.17* 中的对话框将会出现。选择**关闭计算机**，然后点击**确定**。
- en: '![Figure 4.17 – Power off the VM'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.17 – 关闭虚拟机'
- en: '](img/B16945_Figure_4.17.jpg)'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.17.jpg)'
- en: Figure 4.17 – Power off the VM
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.17 – 关闭虚拟机
- en: Once the VM is stopped, go to **Settings** and move to the **System** section
    under the **Motherboard** tab. Choose the **Boot order** section and select the
    **Hard Disk** option to prevent the optical disk from not loading again and prevent
    the launching of the installation script when the VM boots.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦虚拟机停止，进入**设置**，然后在**主板**标签下的**系统**部分选择**启动顺序**，并选择**硬盘**选项，以防止光盘再次未能加载，并防止在虚拟机启动时启动安装脚本。
- en: '![Figure 4.18 – Reconfiguring to boot on disk'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.18 – 重新配置为从磁盘启动'
- en: '](img/B16945_Figure_4.18.jpg)'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.18.jpg)'
- en: Figure 4.18 – Reconfiguring to boot on disk
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.18 – 重新配置为从磁盘启动
- en: Now, VirtualBox is going to return to the main window, so click on **Start**
    to start your VM again and your fresh k3OS installation will be loaded.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，VirtualBox 将返回主窗口，点击**启动**以重新启动虚拟机，加载你新安装的 k3OS。
- en: Now, your k3OS installation is running. You have to enter the `rancher` username
    and your new password to log in.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你的 k3OS 安装正在运行。你需要输入 `rancher` 用户名和新密码进行登录。
- en: '![Figure 4.19 – k3OS first-time boot from disk'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.19 – k3OS 从磁盘首次启动'
- en: '](img/B16945_Figure_4.19.jpg)'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.19.jpg)'
- en: Figure 4.19 – k3OS first-time boot from disk
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.19 – k3OS 从磁盘首次启动
- en: Now, you have a fresh installation of k3OS that is ready to use.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你已经完成了 k3OS 的全新安装，准备好使用了。
- en: In the next section, you are going to learn how to do more advanced configurations
    using the same steps of creating a VM for k3OS, so let's move on to the next section.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个部分，你将学习如何使用相同的创建 k3OS 虚拟机的步骤进行更高级的配置，接下来我们进入下一个部分。
- en: Advanced installations of k3OS using config files
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用配置文件的 k3OS 高级安装
- en: Now, we are ready to learn how to use config files to install k3OS; for this,
    you need a public GitHub repository where you can push these files. Before creating
    a `config.yaml` file to install k3OS, let's understand the different sections
    of this file. You are going to need a file for your master node and one for your
    agent node.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们准备学习如何使用配置文件来安装 k3OS；为此，你需要一个公共的 GitHub 仓库，在那里你可以推送这些文件。在创建 `config.yaml`
    文件以安装 k3OS 之前，让我们了解一下这个文件的不同部分。你需要为主节点和代理节点各创建一个文件。
- en: k3OS config file sections
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: k3OS 配置文件部分
- en: 'Let''s begin with an explanation of the sections to configure the host. These
    are as follows:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们先从配置主机的部分开始。这些部分如下：
- en: '**Hostname section**:'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主机名部分**：'
- en: '[PRE0]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Here is where you set the hostname – in this case, `master`.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是设置主机名的位置——在这个例子中是 `master`。
- en: '**SSH section**:'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SSH 部分**：'
- en: '[PRE1]'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This section is used to set the default SSH public key that can access the node
    using SSH. You have to replace `YOUR_KEY` with your own public key.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分用于设置可以通过 SSH 访问节点的默认 SSH 公钥。你需要将 `YOUR_KEY` 替换为你自己的公钥。
- en: '**Write files section**:'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**写入文件部分**：'
- en: '[PRE2]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: This section defines your network configuration. In this case, we have connected
    our Raspberry Pi to an ethernet connection with the internet. The IP of this node
    is set to `192.168.0.11`, the mask to `255.255.255.0`, and the gateway to `192.168.0.1`,
    and this connection is going to use the `8.8.8.8` nameserver. Remember that you
    can customize these values as per your internet provider.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分定义了你的网络配置。在这个例子中，我们已将 Raspberry Pi 连接到带有互联网的以太网连接。此节点的 IP 设置为 `192.168.0.11`，子网掩码为
    `255.255.255.0`，网关为 `192.168.0.1`，且此连接将使用 `8.8.8.8` 名称服务器。记住，你可以根据你的互联网服务提供商自定义这些值。
- en: 'Now, let''s explore the sections to configure K3s. These are as follows:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们探索配置 K3s 的各个部分。它们如下：
- en: '**k3OS DNS nameservers section**:'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**k3OS DNS 名称服务器部分**：'
- en: '[PRE3]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This section sets the default DNS for the pods in the cluster; in this case,
    it is set to `8.8.8.8` and `1.1.1.1`.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分设置了集群中 pod 的默认 DNS；在这个例子中，设置为 `8.8.8.8` 和 `1.1.1.1`。
- en: '**NTP servers section**:'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**NTP 服务器部分**：'
- en: '[PRE4]'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This section sets the NTP servers to synchronize the time; in this case, it
    is set to `0.us.pool.ntp.org` and `1.us.pool.ntp.org`.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分设置了 NTP 服务器来同步时间；在这个例子中，设置为 `0.us.pool.ntp.org` 和 `1.us.pool.ntp.org`。
- en: '**Password section**:'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**密码部分**：'
- en: '[PRE5]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Here is where you set the password to access the host with k3OS.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是设置密码以访问使用 k3OS 的主机的位置。
- en: '**Labels section**:'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标签部分**：'
- en: '[PRE6]'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This section configures the labels of the node; this is equivalent to using
    the `kubectl labels` command.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分配置了节点的标签；这等同于使用 `kubectl labels` 命令。
- en: We have explained the common sections for the master and agent nodes. Now, let's
    continue with the sections that are different for the master and agent nodes.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经解释了主节点和代理节点的共同部分。现在，让我们继续介绍那些主节点和代理节点不同的部分。
- en: Configurations for master and agent nodes
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 主节点和代理节点的配置
- en: 'This section describes the specific sections that you have to use to configure
    a master or agent node. Let''s get started with the master node:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分描述了配置主节点或代理节点时必须使用的特定部分。让我们从主节点开始：
- en: 'This is an example of a specific configuration for a master node:'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这是主节点的特定配置示例：
- en: '[PRE7]'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This k3OS configuration sets the master node, including the token that will
    be used to add new agent nodes, the password for the node, and parameters to send
    to the server binary. In this case, only modify the installation to execute `kubectl`
    without using `sudo`.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 这个 k3OS 配置将主节点设置为包括将用于添加新代理节点的令牌、节点的密码以及发送给服务器二进制文件的参数。在此例中，仅修改安装以执行 `kubectl`
    而不使用 `sudo`。
- en: 'This is an example of a specific configuration for an agent node:'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这是代理节点的特定配置示例：
- en: '[PRE8]'
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: This k3OS configuration sets an agent node to connect to the master node defined
    in `server_url`, using the token defined to be added to the cluster, and uses
    the defined password to access the node.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这个 k3OS 配置将代理节点设置为连接到在 `server_url` 中定义的主节点，使用定义的令牌将其加入集群，并使用定义的密码访问节点。
- en: Important Note
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'For more options or arguments, you can check the next link: [https://rancher.com/docs/k3s](https://rancher.com/docs/k3s).'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 若要查看更多选项或参数，可以查看下一个链接：[https://rancher.com/docs/k3s](https://rancher.com/docs/k3s)。
- en: We have explained all the basic sections to create your cluster using config
    files. In the next section, we are going to create basic configuration files to
    create a multi-node cluster. So, let's get started.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经解释了创建集群所需的所有基本部分。接下来的部分，我们将创建基本配置文件来创建一个多节点集群。让我们开始吧。
- en: Multi-node cluster creation using config files
  id: totrans-150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用配置文件创建多节点集群
- en: 'Now is time to configure your cluster using config files, so let''s put all
    the pieces together; the file for a master node will look like the following:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是时候使用配置文件配置您的集群了，让我们将所有部分拼凑在一起；主节点的配置文件将如下所示：
- en: '[PRE9]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The configuration file for an agent node will look like this:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 代理节点的配置文件将如下所示：
- en: '[PRE10]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Now that we have the basic configuration files for master and agent nodes, it
    is time to use these files to deploy your multi-node cluster, as discussed in
    the following section.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经有了主节点和代理节点的基本配置文件，是时候使用这些文件来部署您的多节点集群，具体过程将在以下部分中讨论。
- en: Creating a multi-node K3s cluster using config files
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用配置文件创建多节点K3s集群
- en: 'Before you start creating the multi-node cluster, you must be equipped with
    the following requirements:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始创建多节点集群之前，您必须具备以下要求：
- en: 1 VM for the master node.
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1个虚拟机用于主节点。
- en: 1 VM for the agent node.
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1个虚拟机用于代理节点。
- en: 'Your `master_example.yaml` master config file uploaded to a cloud storage service,
    such as Amazon S3, Google Cloud Storage, or similar. For example, if you use Google
    Storage, the URL for your file will be like this: [https://storage.googleapis.com/k3s/master_example.yaml](https://storage.googleapis.com/k3s/master_example.yaml).'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您的`master_example.yaml`主配置文件已上传到云存储服务，如Amazon S3、Google Cloud Storage或类似服务。例如，如果您使用Google存储，您的文件URL将类似于：[https://storage.googleapis.com/k3s/master_example.yaml](https://storage.googleapis.com/k3s/master_example.yaml)。
- en: 'Your `agent_example.yaml` agent config file uploaded to a cloud storage service,
    such as Amazon S3, Google Cloud Storage, or similar. For example, if you use Google
    Storage, the URL for your file will be like this: [https://storage.googleapis.com/k3s/agent_example.yaml](https://storage.googleapis.com/k3s/agent_example.yaml).'
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您的`agent_example.yaml`代理配置文件已上传到云存储服务，如Amazon S3、Google Cloud Storage或类似服务。例如，如果您使用Google存储，您的文件URL将类似于：[https://storage.googleapis.com/k3s/agent_example.yaml](https://storage.googleapis.com/k3s/agent_example.yaml)。
- en: Important Note
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: The VM for the master and agent nodes must be configured to boot using the k3OS
    ISO image; in the next section, we will explain how to run the installation for
    master and agent nodes.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 主节点和代理节点的虚拟机必须配置为使用k3OS ISO镜像启动；在接下来的部分中，我们将解释如何为主节点和代理节点运行安装。
- en: Now, we are ready to create our K3s cluster using config files. The next section
    explains how to use the k3OS ISO image to install a multi-node cluster. So, let's
    get started.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们准备好使用配置文件创建K3s集群。接下来的部分将解释如何使用k3OS ISO镜像安装多节点集群。我们开始吧。
- en: Creating a master node with config files
  id: totrans-165
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用配置文件创建主节点
- en: 'To create a master node, follow these steps:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 创建主节点时，请按以下步骤操作：
- en: Load your VM and then log in.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动虚拟机（VM），然后登录。
- en: Log in to the VM with the `rancher` username and password.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`rancher`用户名和密码登录到虚拟机（VM）。
- en: 'Run the following command to start the k3OS installation:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令以启动k3OS安装：
- en: '[PRE11]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Follow the installation script using the following options:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照以下选项执行安装脚本：
- en: '[PRE12]'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Remember to boot from the disk the next time to load your k3OS installation,
    following the last steps of the *k3OS installation for x86_64 devices using an
    ISO image* section. Now, let's move on to agent node creation.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 记得下次从磁盘启动以加载您的k3OS安装，按照*使用ISO镜像安装x86_64设备的k3OS安装*部分的最后步骤操作。现在，让我们继续进行代理节点的创建。
- en: Creating an agent node with config files
  id: totrans-174
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用配置文件创建代理节点
- en: 'Now, follow the next steps to create an agent node:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，按照以下步骤创建代理节点：
- en: Load your VM and then log in.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动虚拟机（VM），然后登录。
- en: Log in to the VM with the `rancher` username and password.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`rancher`用户名和密码登录到虚拟机（VM）。
- en: 'Run the following command to start the k3OS installation:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令以启动k3OS安装：
- en: '[PRE13]'
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Follow the installation script using the following options:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照以下选项执行安装脚本：
- en: '[PRE14]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Remember to boot from the disk as you did with your master node. Now that your
    cluster is ready to be used, try to run `kubectl get nodes`. To verify whether
    your node was added, the output of the command should display the node name and
    the `Ready` status.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 记得像主节点那样从磁盘启动。现在，您的集群已准备就绪，尝试运行`kubectl get nodes`。要验证节点是否已添加，命令输出应显示节点名称和`Ready`状态。
- en: You have installed a multi-node cluster with master and agent nodes using VMs.
    Now it's time to install a multi-node cluster using ARM devices; in the next section,
    we are going to explore this kind of setup.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 您已使用虚拟机安装了包含主节点和代理节点的多节点集群。现在是时候使用ARM设备安装多节点集群；在接下来的部分中，我们将探索这种设置。
- en: Multi-node ARM overlay installation
  id: totrans-184
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多节点ARM叠加安装
- en: An overlay installation replaces some parts of your current OS installation
    or some parts of your system. In this case, when you use the `/sbin/init` file.
    Then, when you reboot your ARM device, the user space will be initialized and
    k3OS will be loaded. This kind of installation is supported for ARMv7 and ARM64
    devices. One important thing is that you can customize this installation using
    the config YAML files, which must be stored on `/k3os/system/config.yaml`.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 覆盖安装会替换你当前操作系统安装的一些部分或你系统中的一些部分。在这种情况下，当你使用`/sbin/init`文件时，重启ARM设备后，用户空间将被初始化并加载k3OS。这种安装支持ARMv7和ARM64设备。一个重要的事项是，你可以通过配置YAML文件来自定义此安装，这些文件必须存储在`/k3os/system/config.yaml`中。
- en: 'Before performing this overlay installation, you need the following:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行此覆盖安装之前，你需要准备以下内容：
- en: An ARMv7 or ARM64 device, such as a Raspberry PI with **Ubuntu 20.04 LTS** installed
    (you can use **Raspberry PI Imager** or **balenaEtcher**; check [*Chapter 3*](B16945_03_Final_PG.xhtml#_idTextAnchor056),
    *K3s Advanced Configurations and Management*, for reference)
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一台已安装**Ubuntu 20.04 LTS**的ARMv7或ARM64设备，例如一台树莓派（你可以使用**树莓派映像工具**或**balenaEtcher**；参考[*第3章*](B16945_03_Final_PG.xhtml#_idTextAnchor056)，*K3s高级配置与管理*）
- en: A network device connection with access to the internet and **Dynamic Host Configuration
    Protocol** (**DHCP**) to auto-assign an IP to your device
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 具有互联网访问权限的网络设备，并且支持**动态主机配置协议**（**DHCP**）以自动为你的设备分配IP地址
- en: An HDMI port connected to your monitor
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个通过HDMI连接到显示器的端口
- en: A keyboard connected
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接的键盘
- en: Raspberry Pi Imager installed on your Macintosh or PC
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在你的Macintosh或PC上安装树莓派映像工具
- en: In this case, we are going to use a Raspberry Pi 4B with 8 GB of RAM and a 64
    GB Micro SD card for the master node, and 4 GB of RAM and a 32 GB Micro SD card
    for storage for the agent node. So, let's get started with the overlay installation
    for the master node first.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们将使用一台配备8GB RAM和64GB Micro SD卡的树莓派 4B作为主节点，另外一台配备4GB RAM和32GB Micro
    SD卡的树莓派作为代理节点存储。首先，让我们开始为主节点进行覆盖安装。
- en: Master node overlay installation
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 主节点覆盖安装
- en: 'Follow these steps to install the master node overlay:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤安装主节点覆盖：
- en: 'Install Ubuntu 20.04 LTS with ARM64 by navigating to **Operating System** |
    **Other general purpose OS** | **Ubuntu** | **Ubuntu 20.04.2 LTS (RPi 3/4/400)**.
    Insert your Micro SD card and choose it in **Storage**; then click on **WRITE**,
    as shown in the following screenshot:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用ARM64架构安装Ubuntu 20.04 LTS，方法是导航到**操作系统** | **其他通用操作系统** | **Ubuntu** | **Ubuntu
    20.04.2 LTS (RPi 3/4/400)**。插入你的Micro SD卡并在**存储**中选择它；然后点击**写入**，如下所示的截图：
- en: '![Figure 4.20 – Ubuntu server installation using Raspberry Pi Imager'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.20 – 使用树莓派映像工具安装Ubuntu服务器'
- en: '](img/B16945_Figure_4.20.jpg)'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.20.jpg)'
- en: Figure 4.20 – Ubuntu server installation using Raspberry Pi Imager
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.20 – 使用树莓派映像工具安装Ubuntu服务器
- en: 'This is going to ask for your credentials to start the installation; when the
    process finishes, it will show the following screen:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 这将要求你提供凭据以开始安装；当过程完成时，将显示以下屏幕：
- en: '![Figure 4.21 – Write Successful dialog'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.21 – 写入成功对话框'
- en: '](img/B16945_Figure_4.21.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16945_Figure_4.21.jpg)'
- en: Figure 4.21 – Write Successful dialog
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.21 – 写入成功对话框
- en: Now, extract your MicroSD card and insert it into your SD slot in your Raspberry
    Pi.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，取出你的MicroSD卡并将其插入到树莓派的SD卡槽中。
- en: Turn on your Raspberry Pi.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开你的树莓派。
- en: Log in to your ARM device. The default user/password for Ubuntu is `ubuntu`;
    the system will ask you to set a new password. Set your desired password.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到你的ARM设备。Ubuntu的默认用户名/密码是`ubuntu`；系统会要求你设置一个新密码。设置你想要的密码。
- en: 'Install the `net-tools` package to see which IP has your ARM device with the
    following command:'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令安装`net-tools`软件包，以查看你的ARM设备的IP地址：
- en: '[PRE15]'
  id: totrans-207
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Check for your IP with the following command:'
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令检查你的IP：
- en: '[PRE16]'
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Log in to your device using SSH, the `ubuntu` username, and the password that
    you set when logging in to your Ubuntu device for the first time. `DEVICE_IP`
    is the IP that `ifconfig` returned. Run this on your laptop to log in:'
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用SSH登录到你的设备，使用`ubuntu`用户名和你首次登录Ubuntu设备时设置的密码。`DEVICE_IP`是`ifconfig`返回的IP地址。在你的笔记本电脑上运行此命令进行登录：
- en: '[PRE17]'
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Add the `cgroup_memory=1 cgroup_enable=memory` options to your kernel parameters
    in the `/boot/firmware/cmdline.txt` file with the following command:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令将`cgroup_memory=1 cgroup_enable=memory`选项添加到你的内核参数中，在`/boot/firmware/cmdline.txt`文件中：
- en: '[PRE18]'
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Alternatively, you can use any editor to add this text at the end of the `cmdline.txt`
    file.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你也可以使用任何编辑器将这段文本添加到`cmdline.txt`文件的末尾。
- en: 'Run the following commands to install k3OS; this will unpack the `tar.gz` file
    into the `/ folder`:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令安装 k3OS；这将把 `tar.gz` 文件解压到 `/` 文件夹中：
- en: '[PRE19]'
  id: totrans-216
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'If you want to configure a master node, follow these steps:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想配置主节点，请按照以下步骤操作：
- en: 'Download or copy a config into your local directory; let''s use our previous
    master configuration using `wget`, plus the URL:'
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载或复制一个配置到您的本地目录；让我们使用先前的主配置，并使用 `wget` 加上 URL：
- en: '[PRE20]'
  id: totrans-219
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Copy the configuration to /`k3os/system/config` using the following command:'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令将配置复制到 `/k3os/system/config`：
- en: '[PRE21]'
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: You can customize these files as you need; remember that this example uses an
    SSH key that you can use to log in to your node remotely.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以根据需要自定义这些文件；请记住，此示例使用了一个可以用来远程登录到您的节点的 SSH 密钥。
- en: '(*Optional*) If you want to configure an **agent node**, follow the next steps:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: （*可选*）如果您想配置**代理节点**，请按照以下步骤操作：
- en: 'Download or copy a config in your local directory, let''s use our previous
    master configuration using `wget` plus the URL:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载或复制配置到您的本地目录，让我们使用先前的主配置，使用 `wget` 加上 URL：
- en: '[PRE22]'
  id: totrans-225
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Copy the configuration to `/k3os/system/config` using the following command:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令将配置复制到 `/k3os/system/config`：
- en: '[PRE23]'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: You can customize these files as you need; remember that this example uses an
    SSH key that you can use to log in to your node remotely.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以根据需要自定义这些文件；请记住，此示例使用了一个可以用来远程登录到您的节点的 SSH 密钥。
- en: 'Sync the filesystem for each node with the following command:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令为每个节点同步文件系统：
- en: '[PRE24]'
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Reboot the system:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新启动系统：
- en: '[PRE25]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Log in to your device:'
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到您的设备：
- en: '[PRE26]'
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Remember that this configuration has set a static IP for your node.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，此配置已为您的节点设置了静态 IP。
- en: 'If you are logged in to the master node, you can run the following command
    to check whether all the nodes were detected:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您已登录到主节点，您可以运行以下命令检查所有节点是否已被检测到：
- en: '[PRE27]'
  id: totrans-237
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Now, your K3s cluster has been installed and is ready to be used. You now know
    how to configure the cluster using the overlay installation, which is quicker
    compared to the execution of the default K3s script found on the K3s official
    website.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您的 K3s 集群已安装并准备就绪。您现在知道如何使用覆盖安装配置集群，这比在 K3s 官方网站上找到的默认 K3s 脚本执行更快。
- en: Summary
  id: totrans-239
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 概要
- en: In this chapter, we learned how to install K3s using the k3OS, a production-ready
    Linux distribution, covering how to prepare your VMs in case that you want to
    create a cluster for x86_64 architectures. Then, we moved on to explain how configuration
    files are used to perform advanced and custom cluster installations, and how you
    can configure them to create a multi-node cluster using the ISO image or the overlay
    installation. Finally, we covered how to create a multi-node cluster using the
    overlay installation, to reduce the manual configurations to install K3s using
    the k3OS potential. Now, we are close to starting use cases and real configuration
    in the coming chapters. In the next chapter, we are going to create a production-ready
    cluster using all the things that we learned in the previous chapters.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了如何使用 k3OS 安装 K3s，这是一个生产就绪的 Linux 发行版，涵盖了如何准备您的 VM 以便为 x86_64 架构创建集群。然后，我们继续解释了如何使用配置文件执行高级和自定义集群安装，并介绍了如何配置它们以使用
    ISO 镜像或覆盖安装创建多节点集群。最后，我们介绍了如何使用覆盖安装创建多节点集群，以减少使用 k3OS 潜力安装 K3s 的手动配置。现在，我们即将在接下来的章节中开始使用案例和真实配置。在下一章中，我们将使用之前章节学到的所有内容创建一个生产就绪的集群。
- en: Questions
  id: totrans-241
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'Here are a few questions to validate your new knowledge:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一些问题可以验证你的新知识：
- en: What kind of k3OS installations are available if you are using x86 or x86_64
    devices?
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您使用 x86 或 x86_64 设备，k3OS 有哪些可用的安装类型？
- en: How do you install k3OS using an ISO image?
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何使用 ISO 镜像安装 k3OS？
- en: What kind of k3OS installations are available if you are using ARMv7 or ARM64
    devices?
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您使用 ARMv7 或 ARM64 设备，k3OS 有哪些可用的安装类型？
- en: How do you install k3OS using overlay installation?
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何使用覆盖安装安装 k3OS？
- en: How can I use configuration files to customize my cluster installations?
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何使用配置文件自定义我的集群安装？
- en: How can I send parameters to my master or agent node using the k3OS arguments
    section?
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何通过 k3OS 参数部分向主节点或代理节点发送参数？
- en: How can I create a multi-node cluster using the k3OS ISO image or the overlay
    installation?
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何使用 k3OS ISO 镜像或覆盖安装创建多节点集群？
- en: Where can I find more information about available parameters for K3s?
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在哪里可以找到关于 K3s 可用参数的更多信息？
- en: What are the other types of installations available for k3OS?
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: k3OS 还有哪些其他类型的安装可用？
- en: Further reading
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 深入阅读
- en: 'You can refer to the following references for more information on the topics
    covered in this chapter:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以参考以下文献以获取更多关于本章内容的信息：
- en: 'Official k3OS documentation: [https://github.com/rancher/k3os](https://github.com/rancher/k3os)'
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '官方k3OS文档: [https://github.com/rancher/k3os](https://github.com/rancher/k3os)'
- en: 'Available releases for k3OS: [https://github.com/rancher/k3os/releases](https://github.com/rancher/k3os/releases)'
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'k3OS的可用版本: [https://github.com/rancher/k3os/releases](https://github.com/rancher/k3os/releases)'
- en: 'K3s installation options to add custom parameters to your config files: [https://rancher.com/docs/k3s/latest/en/installation/install-options](https://rancher.com/docs/k3s/latest/en/installation/install-options)'
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'K3s安装选项，允许你向配置文件添加自定义参数: [https://rancher.com/docs/k3s/latest/en/installation/install-options](https://rancher.com/docs/k3s/latest/en/installation/install-options)'
- en: 'k3OS image generator: [https://github.com/sgielen/picl-k3OS-image-generator](https://github.com/sgielen/picl-k3OS-image-generator)'
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'k3OS镜像生成器: [https://github.com/sgielen/picl-k3OS-image-generator](https://github.com/sgielen/picl-k3OS-image-generator)'
- en: '*Installing k3s with Alpine Linux on Raspberry Pi 3B+*: [https://blog.jiayihu.net/install-k3s-with-alpine-linux-on-raspberry-pi-3b](https://blog.jiayihu.net/install-k3s-with-alpine-linux-on-raspberry-pi-3b)'
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*在Raspberry Pi 3B+上安装带Alpine Linux的k3s*: [https://blog.jiayihu.net/install-k3s-with-alpine-linux-on-raspberry-pi-3b](https://blog.jiayihu.net/install-k3s-with-alpine-linux-on-raspberry-pi-3b)'
- en: 'k3OS configuration file examples: [https://www.chriswoolum.dev/k3s-cluster-on-raspberry-pi](https://www.chriswoolum.dev/k3s-cluster-on-raspberry-pi)'
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'k3OS配置文件示例: [https://www.chriswoolum.dev/k3s-cluster-on-raspberry-pi](https://www.chriswoolum.dev/k3s-cluster-on-raspberry-pi)'
- en: '*How to launch ARM aarch64 VM with QEMU from scratch*: [https://futurewei-cloud.github.io/ARM-Datacenter/qemu/how-to-launch-aarch64-vm](https://futurewei-cloud.github.io/ARM-Datacenter/qemu/how-to-launch-aarch64-vm)'
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*如何从零开始使用QEMU启动ARM aarch64虚拟机*: [https://futurewei-cloud.github.io/ARM-Datacenter/qemu/how-to-launch-aarch64-vm](https://futurewei-cloud.github.io/ARM-Datacenter/qemu/how-to-launch-aarch64-vm)'
- en: 'k3sup for K3s cluster creation: [https://blog.alexellis.io/test-drive-k3s-on-raspberry-pi](https://blog.alexellis.io/test-drive-k3s-on-raspberry-pi)'
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '用于K3s集群创建的k3sup工具: [https://blog.alexellis.io/test-drive-k3s-on-raspberry-pi](https://blog.alexellis.io/test-drive-k3s-on-raspberry-pi)'
