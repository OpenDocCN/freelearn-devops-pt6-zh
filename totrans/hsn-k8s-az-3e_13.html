<html><head></head><body>
		<div>
			<div id="_idContainer235" class="Content">
			</div>
		</div>
		<div id="_idContainer236" class="Content">
			<h1 id="_idParaDest-99">8. <a id="_idTextAnchor101"/>Role-based access control in AKS</h1>
		</div>
		<div id="_idContainer263" class="Content">
			<p>Up to this point, you've been using a form of access to <strong class="bold">Azure Kubernetes Service</strong> (<strong class="bold">AKS</strong>) that gave you permissions to create, read, update, and delete all objects in your cluster. This has worked great for testing and development but is not recommended on production clusters. On production clusters, the recommendation is to leverage <strong class="bold">role-based access control</strong> (<strong class="bold">RBAC</strong>) in Kubernetes to only grant a limited set of permissions to users.</p>
			<p>In this chapter, you will explore Kubernetes RBAC in more depth. You will be introduced to the concept of RBAC in Kubernetes. You will then configure RBAC in Kubernetes and integrate it with <strong class="bold">Azure Active Directory</strong> (<strong class="bold">Azure AD</strong>).</p>
			<p>The following topics will be covered in this chapter:</p>
			<ul>
				<li>RBAC in Kubernetes</li>
				<li>Enabling Azure AD integration in your AKS cluster</li>
				<li>Creating a user and a group in Azure AD</li>
				<li>Configuring RBAC in AKS</li>
				<li>Verifying RBAC for a user<h4>Note	</h4><p class="callout">To complete the example on RBAC, you need access to an Azure AD instance, with global administrator permissions.</p></li>
			</ul>
			<p>Let's start this chapter by explaining RBAC.</p>
			<h2 id="_idParaDest-100"><a id="_idTextAnchor102"/>RBAC in Kubernetes explained</h2>
			<p>In production systems, you need to allow different users different levels of access to certain resources; this is known as <strong class="bold">RBAC</strong>. The benefit of establishing RBAC is that it not only acts as a guardrail against the accidental deletion of critical resources but also is an important security feature that limits full access to the cluster to roles that really need it. On an RBAC-enabled cluster, users can only access and modify those resources for which they have permission.</p>
			<p>Up until now, using Cloud Shell, you have been acting as <em class="italics">root</em>, which allowed you to do anything and everything in the cluster. For production use cases, root access is dangerous and should be restricted as much as possible. It is a generally accepted best practice to use the <strong class="bold">principle of least privilege</strong> (<strong class="bold">PoLP</strong>) to sign in to any computer system. This prevents both access to secure data and unintentional downtime through the deletion of key resources. Anywhere between 22% and 29% of data loss is attributed to human error. You don't want to be a part of that statistic.</p>
			<p>Kubernetes developers realized this was a problem and added RBAC to Kubernetes along with the concept of service roles to control access to clusters. Kubernetes RBAC has three important concepts:</p>
			<ul>
				<li><strong class="bold">Role</strong>: A role contains a set of permissions. A role defaults to <strong class="inline">no permissions</strong>, and every permission needs to be specifically called out. Examples of permissions include <strong class="inline">get</strong>, <strong class="inline">watch</strong>, and <strong class="inline">list</strong>. The role also contains which resources these permissions are given to. Resources can be either all pods, deployments, and so on, or can be a specific object (such as <strong class="inline">pod/mypod</strong>).</li>
				<li><strong class="bold">Subject</strong>: The subject is either a person or a service account that is assigned a role. In AKS clusters integrated with Azure AD, these subjects can be Azure AD users or groups.</li>
				<li><strong class="bold">RoleBinding</strong>: A RoleBinding links a subject to a role in a certain namespace or, in the case of a ClusterRoleBinding, the whole cluster.</li>
			</ul>
			<p>An important concept to understand is that when interfacing with AKS, there are two layers of RBAC: Azure RBAC and Kubernetes RBAC, as shown in <em class="italics">Figure 8.1</em>. Azure RBAC deals with the roles given to people to make changes in Azure, such as creating, modifying, and deleting clusters. Kubernetes RBAC deals with the access rights to resources in a cluster. Both are independent control planes but can use the same users and groups originating in Azure AD.</p>
			<div>
				<div id="_idContainer237" class="IMG---Figure">
					<img src="image/B17338_08_01.jpg" alt="A representation of the two RBAC planes, Azure and Kubernetes"/>
				</div>
			</div>
			<p class="figure">Figure 8.1: Two different RBAC planes, Azure and Kubernetes</p>
			<p>RBAC in Kubernetes is an optional feature. The default in AKS is to create clusters that have RBAC enabled. However, by default, the cluster is not integrated with Azure AD. This means that by default you cannot grant Kubernetes permissions to Azure AD users. In the coming section, you will enable Azure AD integration in your cluster.</p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor103"/>Enabling Azure AD integration in your AKS cluster</h2>
			<p>In this section, you will update your existing cluster to include Azure AD integration. You will do this using the Azure portal:</p>
			<h4>Note</h4>
			<p class="callout">Once a cluster has been integrated with Azure AD, this functionality cannot be disabled.</p>
			<ol>
				<li>To start, you will need an Azure AD group. You will later give admin privileges for your AKS cluster to this group. To create this group, search for <strong class="inline">azure active directory</strong> in the Azure search bar:<div id="_idContainer238" class="IMG---Figure"><img src="image/B17338_08_02.jpg" alt="Searching for Azure Active Directory in the Azure search bar"/></div><p class="figure">Figure 8.2: Searching for azure active directory in the Azure search bar</p></li>
				<li>In the left pane, select <span class="P---Screen-Text">Groups</span>, which will bring you to the <span class="P---Screen-Text">All groups</span> screen. Click <span class="P---Screen-Text">+ New Group</span>, as shown in <em class="italics">Figure 8.3</em>:<div id="_idContainer239" class="IMG---Figure"><img src="image/B17338_08_03.jpg" alt="In the group pane, clicking the +New group button to create a new Azure AD group"/></div><p class="figure">Figure 8.3: Creating a new Azure AD group</p></li>
				<li>On the resulting page, create a security group and give it a name and description. Select your user as the owner and a member of this group. Click the <span class="P---Screen-Text">Create</span> button on the screen: <div id="_idContainer240" class="IMG---Figure"><img src="image/B17338_08_04.jpg" alt="Providing necessary information to create the Azure AD group"/></div><p class="figure">Figure 8.4: Providing details for creating the Azure AD group</p></li>
				<li>Now that this group is created, search for your Azure cluster in the Azure search bar to open the AKS pane:<div id="_idContainer241" class="IMG---Figure"><img src="image/B17338_08_05.jpg" alt="Searching for the cluster using the Azure search bar"/></div><p class="figure">Figure 8.5: Searching for your cluster in the Azure search bar</p></li>
				<li>In the AKS pane, select <span class="P---Screen-Text">Cluster configuration</span> under <span class="P---Screen-Text">Settings</span>. In this pane, you will be able to turn on <span class="P---Screen-Text">AKS-managed Azure Active Directory</span>. Enable the functionality and select the Azure AD group you created earlier to set as the admin Azure AD group. Finally, hit the <span class="P---Screen-Text">Save </span>button in the command bar, as shown in <em class="italics">Figure 8.6</em>:</li>
			</ol>
			<div>
				<div id="_idContainer242" class="IMG---Figure">
					<img src="image/B17338_08_06.jpg" alt="Enabling AKS-managed Azure Active Directory and clicking the Save button"/>
				</div>
			</div>
			<p class="figure">Figure 8.6: Enabling AKS-managed Azure Active Directory and clicking the Save button</p>
			<p>This enables Azure ADâ€“integrated RBAC on your AKS cluster. In the next section, you will create a new user and a new group that will be used in the section afterward to set up and test RBAC in Kubernetes.</p>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor104"/>Creating a user and group in Azure AD</h2>
			<p>In this section, you will create a new user and a new group in Azure AD. You will use them later on in the chapter to assign them permissions to your AKS cluster:</p>
			<h4>Note</h4>
			<p class="callout">You need the <em class="italics">User Administrator role</em> in Azure AD to be able to create users and groups.</p>
			<ol>
				<li value="1">To start with, search for <strong class="inline">azure active directory</strong> in the Azure search bar:<div id="_idContainer243" class="IMG---Figure"><img src="image/B17338_08_07.jpg" alt="Searching for Azure Active Directory in the Azure search bar"/></div><p class="figure">Figure 8.7: Searching for azure active directory in the search bar</p></li>
				<li>Click on <span class="P---Screen-Text">All users</span> in the left pane. Then select <span class="P---Screen-Text">+ New user</span> to create a new user:<div id="_idContainer244" class="IMG---Figure"><img src="image/B17338_08_08.jpg" alt="Clicking the +New user button to create a new user"/></div><p class="figure">Figure 8.8: Clicking on + New user to create a new user</p></li>
				<li>Provide the information about the user, including the username. Make sure to note down the password, as this will be required to sign in:<div id="_idContainer245" class="IMG---Figure"><img src="image/B17338_08_09.jpg" alt="Providing the necessary details to create a new user"/></div><p class="figure">Figure 8.9: Providing the user details</p></li>
				<li>Once the user is created, go back to the Azure AD pane and select <span class="P---Screen-Text">Groups</span>. Then click the <span class="P---Screen-Text">+ New group</span> button to create a new group:<div id="_idContainer246" class="IMG---Figure"><img src="image/B17338_08_10.jpg" alt="Clicking the + New group button to create a new group"/></div><p class="figure">Figure 8.10: Clicking on + New group to create a new group</p></li>
				<li>Create a new security group. Call the group <strong class="inline">handson aks users</strong> and add <strong class="inline">Tim</strong> as a member of the group. Then hit the <span class="P---Screen-Text">Create</span> button at the bottom:<div id="_idContainer247" class="IMG---Figure"><img src="image/B17338_08_11.jpg" alt="Providing necessary details to create a new group"/></div><p class="figure">Figure 8.11: Providing the group type, group name, and group description</p></li>
				<li>You have now created a new user and a new group. Next, you'll make that user a cluster user in AKS RBAC. This enables them to use the Azure CLI to get access to the cluster. To do that, search for your cluster in the Azure search bar:<div id="_idContainer248" class="IMG---Figure"><img src="image/B17338_08_12.jpg" alt="Searching for the cluster using the Azure search bar"/></div><p class="figure">Figure 8.12: Searching for your cluster in the Azure search bar</p></li>
				<li>In the cluster pane, click on <span class="P---Screen-Text">Access control (IAM)</span> and then click on the <span class="P---Screen-Text">+ Add</span> button to add a new role assignment. Select <span class="P---Screen-Text">Azure Kubernetes Service Cluster User Role</span> and assign that to the new user you just created:<div id="_idContainer249" class="IMG---Figure"><img src="image/B17338_08_13.jpg" alt="Assigning the cluster user role to the new user we just created"/></div><p class="figure">Figure 8.13: Assigning the cluster user role to the new user you created</p></li>
				<li>As you will also be using Cloud Shell with the new user, you will need to give them contributor access to the Cloud Shell storage account. First, search for <strong class="inline">storage</strong> in the Azure search bar:<div id="_idContainer250" class="IMG---Figure"><img src="image/B17338_08_14.jpg" alt="Searching for storage accounts using the Azure search bar"/></div><p class="figure">Figure 8.14: Searching for storage in the Azure search bar</p></li>
				<li>There should be a storage account under <span class="P---Screen-Text">Resource group</span> with a name that starts with <span class="P---Screen-Text">cloud-shell-storage</span>. Click on the resource group:<div id="_idContainer251" class="IMG---Figure"><img src="image/B17338_08_15.jpg" alt="Selecting the resource group of the storage account"/></div><p class="figure">Figure 8.15: Selecting the resource group</p></li>
				<li>Go to <span class="P---Screen-Text">Access control (IAM)</span> and click on the <span class="P---Screen-Text">+ Add</span> button. Give the <span class="P---Screen-Text">Storage Account Contributor </span>role to your newly created user:</li>
			</ol>
			<div>
				<div id="_idContainer252" class="IMG---Figure">
					<img src="image/B17338_08_16.jpg" alt="Assigning the Contributor role to the newly created user storage account"/>
				</div>
			</div>
			<p class="figure">Figure 8.16: Assigning Storage Account Contributor role to the new user</p>
			<p>This has concluded the creation of a new user and a group and giving that user access to AKS. In the next section, you will configure RBAC for that user and group in your AKS cluster.</p>
			<h2 id="_idParaDest-103"><a id="_idTextAnchor105"/>Configuring RBAC in AKS</h2>
			<p>To demonstrate RBAC in AKS, you will create two namespaces and deploy the Azure voting application in each namespace. You will give the group cluster-wide read-only access to pods, and you will give the user the ability to delete pods in only one namespace. Practically, you will need to create the following objects in Kubernetes:</p>
			<ul>
				<li><strong class="inline">ClusterRole</strong> to give read-only access</li>
				<li><strong class="inline">ClusterRoleBinding</strong> to grant the group access to this role</li>
				<li><strong class="inline">Role</strong> to give delete permissions in the <strong class="inline">delete-access</strong> namespace</li>
				<li><strong class="inline">RoleBinding</strong> to grant the user access to this role</li>
			</ul>
			<div>
				<div id="_idContainer253" class="IMG---Figure">
					<img src="image/B17338_08_17.jpg" alt="A flowchart showing the demo youâ€™ll be building. A user is part of a group. The group has a clusterrole to read pods. The user has an additional namespace scoped role allowing them to delete pods"/>
				</div>
			</div>
			<p class="figure">Figure 8.17: The group getting read-only access to the whole cluster, and the user getting delete permissions to the delete-access namespace</p>
			<p>Let's set up the different roles on your cluster:</p>
			<ol>
				<li value="1">To start our example, you will need to retrieve the ID of the group. The following commands will retrieve the group ID:<p class="snippet">az ad group show -g 'handson aks users' \</p><p class="snippet">Â Â --query objectId -o tsv</p><p>This will show your group ID. Note this down because you'll need it in the next steps:</p><div id="_idContainer254" class="IMG---Figure"><img src="image/B17338_08_18.jpg" alt="Output displaying the group ID"/></div><p class="figure">Figure 8.18: Getting the group ID</p></li>
				<li>In Kubernetes, you will create two namespaces for this example:<p class="snippet">kubectl create ns no-access</p><p class="snippet">kubectl create ns delete-access</p></li>
				<li>You will also deploy the <strong class="inline">azure-vote</strong> application in both namespaces:<p class="snippet">kubectl create -f azure-vote.yaml -n no-access</p><p class="snippet">kubectl create -f azure-vote.yaml -n delete-access</p></li>
				<li>Next, you will create the <strong class="inline">ClusterRole</strong> object. This is provided in the <strong class="inline">clusterRole.yaml</strong> file:<p class="snippet">1Â Â Â apiVersion: rbac.authorization.k8s.io/v1</p><p class="snippet">2Â Â Â kind: ClusterRole</p><p class="snippet">3Â Â Â metadata:</p><p class="snippet">4Â Â Â Â Â name: readOnly</p><p class="snippet">5Â Â Â rules:</p><p class="snippet">6Â Â Â - apiGroups: [""]</p><p class="snippet">7Â Â Â Â Â resources: ["pods"]</p><p class="snippet">8Â Â Â Â Â verbs: ["get", "watch", "list"]</p><p>Let's have a closer look at this file:</p><ul><li><strong class="bold">Line 2</strong>: Defines the creation of a <strong class="inline">ClusterRole</strong> instance</li><li><strong class="bold">Line 4</strong>: Gives a name to our <strong class="inline">ClusterRole</strong> instance</li><li><strong class="bold">Line 6</strong>: Gives access to all API groups</li><li><strong class="bold">Line 7</strong>: Gives access to all pods</li><li><strong class="bold">Line 8</strong>: Gives access to the actions <strong class="inline">get</strong>, <strong class="inline">watch</strong>, and <strong class="inline">list</strong></li></ul><p>We will create <strong class="inline">ClusterRole</strong> using the following command:</p><p class="snippet">kubectl create -f clusterRole.yaml</p></li>
				<li>The next step is to create a cluster role binding. The binding links the role to a user or a group. This is provided in the <strong class="inline">clusterRoleBinding.yaml</strong> file:<p class="snippet">1Â Â Â apiVersion: rbac.authorization.k8s.io/v1</p><p class="snippet">2Â Â Â kind: ClusterRoleBinding</p><p class="snippet">3Â Â Â metadata:</p><p class="snippet">4Â Â Â Â Â name: readOnlyBinding</p><p class="snippet">5Â Â Â roleRef:</p><p class="snippet">6Â Â Â Â Â kind: ClusterRole</p><p class="snippet">7Â Â Â Â Â name: readOnly</p><p class="snippet">8Â Â Â Â Â apiGroup: rbac.authorization.k8s.io</p><p class="snippet">9Â Â Â subjects:</p><p class="snippet">10Â Â - kind: Group</p><p class="snippet">11Â Â Â Â apiGroup: rbac.authorization.k8s.io</p><p class="snippet">12Â Â Â Â name: "&lt;group-id&gt;"</p><p>Let's have a closer look at this file:</p><ul><li><strong class="bold">Line 2</strong>: Defines that we are creating a <strong class="inline">ClusterRoleBinding</strong> instance.</li><li><strong class="bold">Line 4</strong>: Gives a name to <strong class="inline">ClusterRoleBinding</strong>.</li><li><strong class="bold">Lines 5â€“8</strong>: Refer to the <strong class="inline">ClusterRole</strong> object we created in the previous step</li><li><strong class="bold">Lines 9â€“12</strong>: Refer to your group in Azure AD. Make sure to replace <strong class="inline">&lt;group-id&gt;</strong> on <em class="italics">line 12</em> with the group ID you got earlier.</li></ul><p>We can create <strong class="inline">ClusterRoleBinding</strong> using the following command:</p><p class="snippet">kubectl create -f clusterRoleBinding.yaml</p></li>
				<li>Next, you'll create a role that is limited to the <strong class="inline">delete-access</strong> namespace. This is provided in the <strong class="inline">role.yaml</strong> file:<p class="snippet">1Â Â Â apiVersion: rbac.authorization.k8s.io/v1</p><p class="snippet">2Â Â Â kind: Role</p><p class="snippet">3Â Â Â metadata:</p><p class="snippet">4Â Â Â Â Â name: deleteRole</p><p class="snippet">5Â Â Â Â Â namespace: delete-access</p><p class="snippet">6Â Â Â rules:</p><p class="snippet">7Â Â Â - apiGroups: [""]</p><p class="snippet">8Â Â Â Â Â resources: ["pods"]</p><p class="snippet">9Â Â Â Â Â verbs: ["delete"]</p><p>This file is similar to the <strong class="inline">ClusterRole</strong> object from earlier. There are two meaningful differences:</p><ul><li><strong class="bold">Line 2</strong>: Defines that you are creating a <strong class="inline">Role</strong> instance and not a <strong class="inline">ClusterRole</strong> instance</li><li><strong class="bold">Line 5</strong>: Defines the namespace this role is created in</li></ul><p>You can create <strong class="inline">Role</strong> using the following command:</p><p class="snippet">kubectl create -f role.yaml</p></li>
				<li>Finally, you will create a <strong class="inline">RoleBinding</strong> instance that links our user to the namespace role. This is provided in the <strong class="inline">roleBinding.yaml</strong> file:<p class="snippet">1Â Â Â apiVersion: rbac.authorization.k8s.io/v1</p><p class="snippet">2Â Â Â kind: RoleBinding</p><p class="snippet">3Â Â Â metadata:</p><p class="snippet">4Â Â Â Â Â name: deleteBinding</p><p class="snippet">5Â Â Â Â Â namespace: delete-access</p><p class="snippet">6Â Â Â roleRef:</p><p class="snippet">7Â Â Â Â Â kind: Role</p><p class="snippet">8Â Â Â Â Â name: deleteRole</p><p class="snippet">9Â Â Â Â Â apiGroup: rbac.authorization.k8s.io</p><p class="snippet">10Â Â subjects:</p><p class="snippet">11Â Â - kind: User</p><p class="snippet">12Â Â Â Â apiGroup: rbac.authorization.k8s.io</p><p class="snippet">13Â Â Â Â name: "&lt;user e-mail address&gt;"</p><p>This file is similar to the <strong class="inline">ClusterRoleBinding</strong> object from earlier. There are a couple of meaningful differences:</p><ul><li><strong class="bold">Line 2</strong>: Defines the creation of a <strong class="inline">RoleBinding</strong> instance and not a <strong class="inline">ClusterRoleBinding</strong> instance</li><li><strong class="bold">Line 5</strong>: Defines the namespace this <strong class="inline">RoleBinding</strong> instance is created in</li><li><strong class="bold">Line 7</strong>: Refers to a regular role and not a <strong class="inline">ClusterRole</strong> instance</li><li><strong class="bold">Lines 11â€“13</strong>: Defines a user instead of a group</li></ul><p>You can create <strong class="inline">RoleBinding</strong> using the following command:</p><p class="snippet">kubectl create -f roleBinding.yaml</p></li>
			</ol>
			<p>This has concluded the requirements for RBAC. You have created two rolesâ€”<strong class="inline">ClusterRole</strong> and one namespace-bound role, and set up two <strong class="inline">RoleBindings</strong> objectsâ€”<strong class="inline">ClusterRoleBinding</strong> and the namespace-bound <strong class="inline">RoleBinding</strong>. In the next section, you will explore the impact of RBAC by signing in to the cluster as the new user.</p>
			<h2 id="_idParaDest-104"><a id="_idTextAnchor106"/>Verifying RBAC for a user</h2>
			<p>To verify that RBAC works as expected, you will sign in to the Azure portal using the newly created user. Go to <a href="">https://portal.azure.com</a> in a new browser, or an InPrivate window, and sign in with the newly created user. You will be prompted immediately to change your password. This is a security feature in Azure AD to ensure that only that user knows their password:</p>
			<div>
				<div id="_idContainer255" class="IMG---Figure">
					<img src="image/B17338_08_19.jpg" alt="Prompt asking the user to update their password"/>
				</div>
			</div>
			<p class="figure">Figure 8.19: You will be asked to change your password</p>
			<p>Once you have changed your password, you can start testing the different RBAC roles:</p>
			<ol>
				<li value="1">You will start this experiment by setting up Cloud Shell for the new user. Launch Cloud Shell and select <span class="P---Screen-Text">Bash</span>:<div id="_idContainer256" class="IMG---Figure"><img src="image/B17338_08_20.jpg" alt="Selecting Bash as Cloud Shell"/></div><p class="figure">Figure 8.20: Selecting Bash in Cloud Shell</p></li>
				<li>In the next dialog box, select <span class="P---Screen-Text">Show advanced settings</span>:<div id="_idContainer257" class="IMG---Figure"><img src="image/B17338_08_21.jpg" alt="Clicking the Show advanced settings button"/></div><p class="figure">Figure 8.21: Selecting Show advanced settings</p></li>
				<li>Then, point Cloud Shell to the existing storage account and create a new file share:<div id="_idContainer258" class="IMG---Figure"><img src="image/B17338_08_22.jpg" alt="Pointing Cloud Shell to the existing storage account and creating a new file share"/></div><p class="figure">Figure 8.22: Pointing to the existing storage account and creating a new file share</p></li>
				<li>Once Cloud Shell is available, get the credentials to connect to the AKS cluster:<p class="snippet">az aks get-credentials -n handsonaks -g rg-handsonaks</p><p>Then, try a command in <strong class="inline">kubectl</strong>. Let's try to get the nodes in the cluster:</p><p class="snippet">kubectl get nodes</p><p>Since this is the first command executed against an RBAC-enabled cluster, you are asked to sign in again. Browse to <a href="">https://microsoft.com/devicelogin</a> and provide the code Cloud Shell showed you (this code is highlighted in <em class="italics">Figure 8.24</em>). Make sure you sign in here with your new user credentials:</p><div id="_idContainer259" class="IMG---Figure"><img src="image/B17338_08_23.jpg" alt="Entering the code Cloud Shell showed us in the prompt"/></div><p class="figure">Figure 8.23: Copying and pasting the code Cloud Shell showed you in the prompt</p><p>After you have signed in, you should get a <strong class="inline">Forbidden</strong> error message from <strong class="inline">kubectl</strong>, informing you that you don't have permission to view the nodes in the cluster. This was expected since the user is configured only to have access to pods:</p><div id="_idContainer260" class="IMG---Figure"><img src="image/B17338_08_24.jpg" alt="The Forbidden error message from kubectl"/></div><p class="figure">Figure 8.24: The prompt asking you to sign in and the Forbidden message</p></li>
				<li>Now you can verify that your user has access to view pods in all namespaces and that the user has permission to delete pods in the <strong class="inline">delete-access</strong> namespace:<p class="snippet">kubectl get pods -n no-access</p><p class="snippet">kubectl get pods -n delete-access</p><p>This should succeed for both namespaces. This is due to the <strong class="inline">ClusterRole</strong> object configured for the user's group:</p><div id="_idContainer261" class="IMG---Figure"><img src="image/B17338_08_25.jpg" alt="Output confirming access to view pods in both namespaces"/></div><p class="figure">Figure 8.25: The user has access to view pods in both namespaces</p></li>
				<li>Let's also verify the <strong class="inline">delete</strong> permissions:<p class="snippet">kubectl delete pod --all -n no-access</p><p class="snippet">kubectl delete pod --all -n delete-access</p><p>As expected, this is denied in the <strong class="inline">no-access</strong> namespace and allowed in the <strong class="inline">delete-access</strong> namespace, as seen in <em class="italics">Figure 8.26</em>:</p></li>
			</ol>
			<div>
				<div id="_idContainer262" class="IMG---Figure">
					<img src="image/B17338_08_26.jpg" alt="Output verifying the user is not able to delete resources in the no-access namespace, but is able to delete resources in the delete-access namespace"/>
				</div>
			</div>
			<p class="figure">Figure 8.26: Deletes are denied in the no-access namespace and allowed in the delete-access namespace</p>
			<p>In this section, you have verified the functionality of RBAC on your Kubernetes cluster. Since this is the last section of this chapter, let's make sure to clean up the deployments and namespaces in the cluster. Make sure to execute these steps from Cloud Shell with your main user, not the new user:</p>
			<p class="snippet">kubectl delete -f azure-vote.yaml -n no-access</p>
			<p class="snippet">kubectl delete -f azure-vote.yaml -n delete-access</p>
			<p class="snippet">kubectl delete -f .</p>
			<p class="snippet">kubectl delete ns no-access</p>
			<p class="snippet">kubectl delete ns delete-access</p>
			<p>This concludes the overview of RBAC on AKS.</p>
			<h2 id="_idParaDest-105"><a id="_idTextAnchor107"/>Summary</h2>
			<p>In this chapter, you learned about RBAC on AKS. You enabled Azure ADâ€“integrated RBAC in your cluster. After that, you created a new user and group and set up different RBAC roles on your cluster. Finally, you signed in using that user and were able to verify that the RBAC roles that were configured gave you limited access to the cluster you were expecting. </p>
			<p>This deals with how users can get access to your Kubernetes cluster. The pods running on your cluster might also need an identity in Azure AD that they can use to access resources in Azure services such as Blob Storage or Key Vault. You will learn more about this use case and how to set this up using an Azure AD pod identity in AKS in the next chapter.</p>
		</div>
	</body></html>