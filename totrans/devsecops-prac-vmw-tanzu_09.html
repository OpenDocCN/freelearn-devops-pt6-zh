<html><head></head><body>
<div id="_idContainer253">
<h1 class="chapter-number" id="_idParaDest-173"><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-174"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.2.1">Managing and Controlling Kubernetes Clusters with Tanzu Mission Control</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In the previous section of the book, we covered the tools in the Tanzu portfolio that help us run cloud-native applications. </span><span class="koboSpan" id="kobo.3.2">We covered how Harbor can provide a secure home for your container images and how we can run those images using Tanzu Kubernetes Grid, which provides a uniform user experience across public and private cloud infrastructure. </span><span class="koboSpan" id="kobo.3.3">Finally, we took a deep dive into the area of developer productivity to automate and secure the software supply chain from an idea to a running application </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">in production.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">This section is about managing cloud-native apps and their corresponding Kubernetes infrastructure. </span><span class="koboSpan" id="kobo.5.2">To begin this section, in this chapter, we will learn about managing, securing, and governing a fleet of Kubernetes clusters of any flavor and on any infrastructure using </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">Tanzu Mission Control</span></strong><span class="koboSpan" id="kobo.7.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.8.1">TMC</span></strong><span class="koboSpan" id="kobo.9.1">). </span><span class="koboSpan" id="kobo.9.2">Followed by that, we will cover VMware Aria Operations for Applications, a tool to monitor every part of your running applications, including distributed tracing between microservices, application performance, Kubernetes objects, virtual infrastructure, and other services used by the applications. </span><span class="koboSpan" id="kobo.9.3">Finally, we will learn how to connect your apps running on Kubernetes and deploy them in different clusters and environments securely with out-of-the-box mutual TLS configuration using Tanzu </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">Service Mesh.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.11.1">Sidenote</span></p>
<p class="callout"><span class="koboSpan" id="kobo.12.1">Henceforth in this chapter, we will refer to a </span><em class="italic"><span class="koboSpan" id="kobo.13.1">Kubernetes cluster</span></em><span class="koboSpan" id="kobo.14.1"> just as a </span><em class="italic"><span class="koboSpan" id="kobo.15.1">cluster</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.16.1">for brevity.</span></span></p>
<p><span class="koboSpan" id="kobo.17.1">With the background from the last section and our forward-looking statement for the upcoming chapters in this section, let’s begin our journey of understanding TMC in depth. </span><span class="koboSpan" id="kobo.17.2">We will cover the following topics in </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">this chapter:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.19.1">Why TMC?</span></em><span class="koboSpan" id="kobo.20.1"> – Understand the challenges around managing large Kubernetes environments and the solutions offered by Tanzu </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">Mission Control</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.22.1">Getting started with TMC</span></em><span class="koboSpan" id="kobo.23.1"> – Learn how to start using TMC to manage the </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">cluster lifecycle</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.25.1">Protecting cluster data using TMC</span></em><span class="koboSpan" id="kobo.26.1"> – Learn how to back up clusters and namespaces, and how to restore them when required to protect running workloads </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">from disasters</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.28.1">Applying and ensuring governance policies on clusters using TMC </span></em><span class="koboSpan" id="kobo.29.1">– Learn how to apply different cluster user governance policies to cluster and Kubernetes namespace groups and run inspections to find anomalies in clusters as a preventative </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">security measure</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.31.1">TMC is a very powerful SaaS offering under the Tanzu portfolio that provides a single pane of control for all your Kubernetes environments. </span><span class="koboSpan" id="kobo.31.2">Let’s learn more </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">about it.</span></span></p>
<h1 id="_idParaDest-175"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.33.1">Why TMC?</span></h1>
<p><span class="koboSpan" id="kobo.34.1">With its increasing</span><a id="_idIndexMarker683"/><span class="koboSpan" id="kobo.35.1"> popularity, Kubernetes is the new infrastructure layer. </span><span class="koboSpan" id="kobo.35.2">Just as 10 years back, almost every software used to run on the virtual infrastructure, in the next few years, almost every new application will probably be deployed on Kubernetes by default. </span><span class="koboSpan" id="kobo.35.3">In fact, most of the vendor-provided solutions are now available to run on Kubernetes. </span><span class="koboSpan" id="kobo.35.4">As per a survey done by the </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">Cloud Native Computing Foundation</span></strong><span class="koboSpan" id="kobo.37.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.38.1">CNCF</span></strong><span class="koboSpan" id="kobo.39.1">) in</span><a id="_idIndexMarker684"/><span class="koboSpan" id="kobo.40.1"> December 2021, over 5.6 million developers said they used Kubernetes to deploy their applications, which is a 67% increase in just 1 year! </span><span class="koboSpan" id="kobo.40.2">Because of the array of business and technical benefits provided by Kubernetes, it is here to stay for a long time. </span><span class="koboSpan" id="kobo.40.3">Based on this CNCF survey, over 96% of organizations have embraced Kubernetes with a different level of maturity to run their cloud-native applications! </span><span class="koboSpan" id="kobo.40.4">And 73% of them have workloads running in production on Kubernetes already! </span><span class="koboSpan" id="kobo.40.5">As per a blog post by the CNCF in February 2022, the community is seeing its highest-ever adoption of this technology. </span><span class="koboSpan" id="kobo.40.6">Learn more about the details published by the CNCF </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">here: </span></span><a href=""><span class="No-Break"><span class="koboSpan" id="kobo.42.1">https://www.cncf.io/announcements/2022/02/10/cncf-sees-record-kubernetes-and-container-adoption-in-2021-cloud-native-survey/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.43.1">.</span></span></p>
<h2 id="_idParaDest-176"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.44.1">Challenges with Kubernetes</span></h2>
<p><span class="koboSpan" id="kobo.45.1">Even though </span><a id="_idIndexMarker685"/><span class="koboSpan" id="kobo.46.1">Kubernetes is an extremely popular tool to run containerized applications, operating Kubernetes is difficult in a production-grade environment. </span><span class="koboSpan" id="kobo.46.2">As you may know about Kubernetes, it only talks via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">kubectl</span></strong><span class="koboSpan" id="kobo.48.1"> command-line interface or using its REST APIs. </span><span class="koboSpan" id="kobo.48.2">Every configuration in Kubernetes is in YAML, which is often long and difficult to understand unless you have a good grasp of different </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">Kubernetes constructs.</span></span></p>
<h3><span class="koboSpan" id="kobo.50.1">Challenges with very large clusters</span></h3>
<p><span class="koboSpan" id="kobo.51.1">A large cluster, in </span><a id="_idIndexMarker686"/><span class="koboSpan" id="kobo.52.1">this context, is a cluster with more than 50 nodes in it. </span><span class="koboSpan" id="kobo.52.2">Adding to the basic complexity of using Kubernetes, running a production-grade platform has several other security and operational challenges. </span><span class="koboSpan" id="kobo.52.3">To reduce complexity and operational overhead, I have seen enterprises deploy very large clusters to maintain, operate, and secure only a few critical clusters. </span><span class="koboSpan" id="kobo.52.4">Very large Kubernetes deployments host applications from several </span><a id="_idIndexMarker687"/><span class="koboSpan" id="kobo.53.1">different </span><strong class="bold"><span class="koboSpan" id="kobo.54.1">lines of business</span></strong><span class="koboSpan" id="kobo.55.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.56.1">LOBs</span></strong><span class="koboSpan" id="kobo.57.1">) using the logical isolation provided by Kubernetes namespaces. </span><span class="koboSpan" id="kobo.57.2">At first, this approach may sound logical, but there are several drawbacks to this approach, as listed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">following points:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.59.1">A large cluster serving multiple distinct LOBs and applications is very difficult to maintain, as all the applications and their LOBs will have different preferences in terms of the maintenance window and tolerance to any downtime. </span><span class="koboSpan" id="kobo.59.2">If an application is deployed with two or more Pods in a cluster, then it will mostly not face downtime. </span><span class="koboSpan" id="kobo.59.3">However, ensuring this level of compliance is a different challenge. </span><span class="koboSpan" id="kobo.59.4">Additionally, large clusters need a large maintenance window to complete activities such </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">as upgrades.</span></span></li>
<li><span class="koboSpan" id="kobo.61.1">When there are hundreds of apps running in a large cluster, they all get impacted together if the cluster faces any issue or downtime. </span><span class="koboSpan" id="kobo.61.2">The large clusters have large blast radii and large </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">disaster impacts.</span></span></li>
<li><span class="koboSpan" id="kobo.63.1">As a large cluster is used by several different applications, the application teams do not get any freedom of choice to deploy and run their apps with a specific cluster setup and resource requirements such as using a specific operating system or using a GPU for compute needs. </span><span class="koboSpan" id="kobo.63.2">Although Kubernetes provides a way to deploy certain application Pods on certain nodes using constructs such as taints and tolerations, implementing, maintaining, and using this kind of setup is practically </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">very difficult.</span></span></li>
<li><span class="koboSpan" id="kobo.65.1">Although Kubernetes isolates applications of different teams using namespaces, this is only a logical level of isolation. </span><span class="koboSpan" id="kobo.65.2">In reality, Pods belonging to different namespaces may run in the same node. </span><span class="koboSpan" id="kobo.65.3">This may create issues of potential security threats posed by a malicious actor running in the same cluster and possible resource starvation because of a “noisy neighbor” if the application has not requested and reserved required resources as a part of its </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">deployment manifest.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.67.1">Considering these challenges around large clusters, it is recommended to use multiple smaller clusters, especially for heterogeneous workloads. </span><span class="koboSpan" id="kobo.67.2">If all the apps running on a large cluster have </span><a id="_idIndexMarker688"/><span class="koboSpan" id="kobo.68.1">the same requirements, then it should be okay; otherwise, the recommended approach is to create smaller clusters for different teams, LOBs, </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">or applications.</span></span></p>
<h3><span class="koboSpan" id="kobo.70.1">Challenges with many clusters and solutions from TMC</span></h3>
<p><span class="koboSpan" id="kobo.71.1">People generally</span><a id="_idIndexMarker689"/><span class="koboSpan" id="kobo.72.1"> prefer large clusters to avoid the operational overhead that increases in proportion to the number of clusters to be maintained. </span><span class="koboSpan" id="kobo.72.2">Hence, on one side, we may need several small clusters that belong to different teams, environments, and purposes, and on the other side, there are several operational and security challenges involved in keeping them functional. </span><span class="koboSpan" id="kobo.72.3">That is where TMC comes into the picture, which addresses these challenges by managing a fleet of clusters from a single pane of glass. </span><span class="koboSpan" id="kobo.72.4">Let’s understand briefly what those challenges are and how TMC helps to </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">solve them.</span></span></p>
<h4><span class="koboSpan" id="kobo.74.1">Increased overhead of cluster lifecycle management</span></h4>
<p><span class="koboSpan" id="kobo.75.1">Basic lifecycle </span><a id="_idIndexMarker690"/><span class="koboSpan" id="kobo.76.1">management operations of several clusters, such as creating, scaling, upgrading, and deleting, could be a nightmarish situation without complete automation in place. </span><span class="koboSpan" id="kobo.76.2">Any manual intervention in this process could lead to configuration drifts resulting from basic human errors. </span><span class="koboSpan" id="kobo.76.3">This could soon result in a group of clusters having different configurations, and the need for cluster upgrades would be frequent for all the clusters, as the upstream Kubernetes releases a new version every 3 to 4 months and patch versions even more frequently. </span><span class="koboSpan" id="kobo.76.4">Regular maintenance of clusters via upgrades and patches is highly recommended to stay secure and supported. </span><span class="koboSpan" id="kobo.76.5">Such frequent maintenance of a large number of clusters requires a sophisticated automation setup. </span><span class="koboSpan" id="kobo.76.6">On the other hand, building and maintaining full end-to-end automation for these lifecycle processes require huge in-house effort. </span><span class="koboSpan" id="kobo.76.7">In that case, it’s a question of the organizations building this automation asking themselves whether they should invest in this much effort for below-value-line activities to support a container platform, or whether they would rather invest these resources to add new business functionalities to their applications, which would bring </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">more revenue.</span></span></p>
<p><span class="koboSpan" id="kobo.78.1">TMC addresses this challenge with the</span><a id="_idIndexMarker691"/><span class="koboSpan" id="kobo.79.1"> help of </span><strong class="bold"><span class="koboSpan" id="kobo.80.1">Tanzu Kubernetes Grid</span></strong><span class="koboSpan" id="kobo.81.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.82.1">TKG</span></strong><span class="koboSpan" id="kobo.83.1">). </span><span class="koboSpan" id="kobo.83.2">In the previous chapter, we learned about TKG and its concept of a management control plane to manage the lifecycle of several workload clusters under that management cluster. </span><span class="koboSpan" id="kobo.83.3">TMC provides an out-of-the-box integration experience to link TKG management control plane clusters and allows TMC users to perform all TKG cluster lifecycle operations using the TMC portal. </span><span class="koboSpan" id="kobo.83.4">Such an easy, quick, and user-friendly approach to managing cluster lifecycles addresses the challenges involved in keeping the Kubernetes versions up to date for security reasons. </span><span class="koboSpan" id="kobo.83.5">Additionally, a complete out-of-the-box cluster lifecycle automation offering from TKG and its integration with TMC reduces the additional toil required to create and </span><a id="_idIndexMarker692"/><span class="koboSpan" id="kobo.84.1">maintain in-house automation for the </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">same reason.</span></span></p>
<h4><span class="koboSpan" id="kobo.86.1">Distinct configuration requirements for different clusters</span></h4>
<p><span class="koboSpan" id="kobo.87.1">Things get even more complex when different clusters have different configuration requirements. </span><span class="koboSpan" id="kobo.87.2">The security requirements for a group of non-production clusters would not be the same as the production clusters. </span><span class="koboSpan" id="kobo.87.3">Furthermore, the compliance requirements of the environments </span><a id="_idIndexMarker693"/><span class="koboSpan" id="kobo.88.1">handling </span><strong class="bold"><span class="koboSpan" id="kobo.89.1">Payment Card Industry</span></strong><span class="koboSpan" id="kobo.90.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.91.1">PCI</span></strong><span class="koboSpan" id="kobo.92.1">) data are even more stringent. </span><span class="koboSpan" id="kobo.92.2">Depending on the environment, the clusters may have different needs for user access, container network, workload isolation, and deployment policies. </span><span class="koboSpan" id="kobo.92.3">A security policy such as preventing the deployment of privileged containers that may allow root-level access to the host they are deployed on, or a policy ensuring high availability only allowing two more Pods to be deployed for an application are just some examples of these kinds of policies. </span><span class="koboSpan" id="kobo.92.4">It is difficult to find that one size that fits all clusters. </span><span class="koboSpan" id="kobo.92.5">Adding more flavors of clusters adds increasingly </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">more complexity.</span></span></p>
<p><span class="koboSpan" id="kobo.94.1">To address this challenge, TMC allows us to create groups of clusters and then create different sets of policies and treatments for different groups of clusters. </span><span class="koboSpan" id="kobo.94.2">That way, the access policy of a development group of clusters could be different and more lenient than that of a group of production clusters. </span><span class="koboSpan" id="kobo.94.3">Additionally, TMC also allows you to create a group of Kubernetes</span><a id="_idIndexMarker694"/><span class="koboSpan" id="kobo.95.1"> namespaces, called </span><strong class="bold"><span class="koboSpan" id="kobo.96.1">Workspaces</span></strong><span class="koboSpan" id="kobo.97.1">, which can span across the boundaries of clusters and cluster groups. </span><span class="koboSpan" id="kobo.97.2">Then, we can create policies for these Workspaces that are applicable at the namespace level. </span><span class="koboSpan" id="kobo.97.3">One such policy in Kubernetes is network policy defining, which applications/services may connect to which ones across </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">different namespaces.</span></span></p>
<h4><span class="koboSpan" id="kobo.99.1">Installation and configuration of tools</span></h4>
<p><span class="koboSpan" id="kobo.100.1">Every organization has a set of tools that they want to deploy on their clusters for cross-cutting concerns such as logging, monitoring, certificate management, </span><strong class="bold"><span class="koboSpan" id="kobo.101.1">identity and access management</span></strong><span class="koboSpan" id="kobo.102.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.103.1">IAM</span></strong><span class="koboSpan" id="kobo.104.1">), and more. </span><span class="koboSpan" id="kobo.104.2">When different teams are in charge of the management</span><a id="_idIndexMarker695"/><span class="koboSpan" id="kobo.105.1"> of their own small clusters, it can become challenging to provide a self-service approach to the cluster owners where they can pick and deploy required tools on their clusters as and when required quickly </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">and consistently.</span></span></p>
<p><span class="koboSpan" id="kobo.107.1">To address this point, TMC has a catalog of some popular open source packages that different cluster owners may install based on their requirements with a single click. </span><span class="koboSpan" id="kobo.107.2">This capability not only </span><a id="_idIndexMarker696"/><span class="koboSpan" id="kobo.108.1">reduces the overhead for different teams but also allows you to instate a guardrail for other cluster owners so that only certain authorized packages can be installed on their clusters. </span><span class="koboSpan" id="kobo.108.2">As an additional advantage, all these packages can be installed using a common approach, and only for the published versions in </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">the catalog.</span></span></p>
<h4><span class="koboSpan" id="kobo.110.1">Cluster configuration and workload data protection</span></h4>
<p><span class="koboSpan" id="kobo.111.1">Access to a quick and easy procedure to back up and restore cluster states is also an important concern for most of the clusters in an organization. </span><span class="koboSpan" id="kobo.111.2">For static workloads that do not use persistent storage volumes, backing up the Kubernetes configuration YAML files may work to restore these objects by applying those configurations again, but what if there was a delta in the running state versus the documented state? </span><span class="koboSpan" id="kobo.111.3">The restored data, in this case, would not be identical. </span><span class="koboSpan" id="kobo.111.4">Backup and restoration of the stateful workloads add more complexity, as we need to also back up the storage volumes used by those workloads along with their configuration YAML files. </span><span class="koboSpan" id="kobo.111.5">Additionally, performing these activities for many clusters to make sure this happens at the required frequency to lose minimal data asks for huge automation efforts. </span><span class="koboSpan" id="kobo.111.6">On the other side, if the ownership of backup and restoration is left to the teams responsible for each individual cluster, then either the ball will be dropped or there will be a standardization challenge in how this is done across </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">different teams.</span></span></p>
<p><span class="koboSpan" id="kobo.113.1">To address this, TMC</span><a id="_idIndexMarker697"/><span class="koboSpan" id="kobo.114.1"> uses </span><strong class="bold"><span class="koboSpan" id="kobo.115.1">Velero</span></strong><span class="koboSpan" id="kobo.116.1"> (</span><a href=""><span class="koboSpan" id="kobo.117.1">https://velero.io</span></a><span class="koboSpan" id="kobo.118.1">), an open source project backed by VMware, to back up and restore Kubernetes clusters. </span><span class="koboSpan" id="kobo.118.2">TMC users can either schedule cluster</span><a id="_idIndexMarker698"/><span class="koboSpan" id="kobo.119.1"> backups or do them on demand. </span><span class="koboSpan" id="kobo.119.2">These backups are saved in </span><strong class="bold"><span class="koboSpan" id="kobo.120.1">Simple Storage Service</span></strong><span class="koboSpan" id="kobo.121.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.122.1">S3</span></strong><span class="koboSpan" id="kobo.123.1">)-compatible object storage locations accessible using web URLs. </span><span class="koboSpan" id="kobo.123.2">Taking, scheduling, and restoring backups using the TMC console is very easy and provides a consistent method and storage location to ensure the required data protection for everything running on a cluster, including stateless and stateful workloads. </span><span class="koboSpan" id="kobo.123.3">By means of Velero, TMC also allows you to only back up selected important namespaces </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">if desired.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.125.1">What is S3?</span></p>
<p class="callout"><span class="koboSpan" id="kobo.126.1">S3 is an object or file storage service offered by AWS. </span><span class="koboSpan" id="kobo.126.2">S3 has become a standard for object storage that implements the S3 interfaces required. </span><span class="koboSpan" id="kobo.126.3">Presently, there are several cloud-hosted and on-premises S3-compatible storage options available on the market in addition to the one</span><a id="_idIndexMarker699"/><span class="koboSpan" id="kobo.127.1"> offered by AWS, including MinIO and Dell </span><strong class="bold"><span class="koboSpan" id="kobo.128.1">Elastic Cloud </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.129.1">Storage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.130.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.131.1">ECS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">).</span></span></p>
<h4><span class="koboSpan" id="kobo.133.1">Conducting cluster inspections</span></h4>
<p><span class="koboSpan" id="kobo.134.1">When an organization has </span><a id="_idIndexMarker700"/><span class="koboSpan" id="kobo.135.1">hundreds of clusters owned by multiple teams, it is a mammoth effort to inspect each cluster in terms of its security and operational policy compliance. </span><span class="koboSpan" id="kobo.135.2">Enterprises operating in highly secure domains such as healthcare and finance have formal obligations to audit their application platforms at a regular frequency to find compliance and address violations. </span><span class="koboSpan" id="kobo.135.3">It is almost impossible to audit and inspect several different clusters manually to see whether they follow required security compliance practices. </span><span class="koboSpan" id="kobo.135.4">It requires a great amount of automation to build a scanning engine that can check all the different rules on a checklist for a given cluster and then report violations of different severities. </span><span class="koboSpan" id="kobo.135.5">There is a list of recommendations from the official Kubernetes specification that a secure production-grade cluster should follow. </span><span class="koboSpan" id="kobo.135.6">Similarly, the </span><strong class="bold"><span class="koboSpan" id="kobo.136.1">Center for Internet Security</span></strong><span class="koboSpan" id="kobo.137.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.138.1">CIS</span></strong><span class="koboSpan" id="kobo.139.1">) also has</span><a id="_idIndexMarker701"/><span class="koboSpan" id="kobo.140.1"> a benchmarking list of recommendations that should be followed in a cluster for security. </span><span class="koboSpan" id="kobo.140.2">Conducting different types of inspections for hundreds of clusters is a very </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">difficult endeavor.</span></span></p>
<p><span class="koboSpan" id="kobo.142.1">However, running inspections for clusters only takes a few clicks using TMC. </span><span class="koboSpan" id="kobo.142.2">To provide this feature, TMC</span><a id="_idIndexMarker702"/><span class="koboSpan" id="kobo.143.1"> uses </span><strong class="bold"><span class="koboSpan" id="kobo.144.1">Sonobuoy</span></strong><span class="koboSpan" id="kobo.145.1"> (</span><a href=""><span class="koboSpan" id="kobo.146.1">https://sonobuoy.io</span></a><span class="koboSpan" id="kobo.147.1">), another open source project backed by VMware, providing Kubernetes cluster configuration validation. </span><span class="koboSpan" id="kobo.147.2">TMC allows you to run two different types of inspection – CIS benchmarking and Kubernetes specification conformance. </span><span class="koboSpan" id="kobo.147.3">Upon the completion of these inspections, the TMC user gets a detailed report of the compliance and violation of different recommendations. </span><span class="koboSpan" id="kobo.147.4">These results can help you take quick preventative measures to close vulnerable security loopholes before they </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">are exploited.</span></span></p>
<p><span class="koboSpan" id="kobo.149.1">Along with solving these challenges around managing a large group of clusters, TMC also emits critical events related to the clusters under its purview to keep their owners fully informed about their health and critical lifecycle stages. </span><span class="koboSpan" id="kobo.149.2">Additionally, TMC offers a comprehensive set of REST APIs to allow you to perform all these operations programmatically. </span><span class="koboSpan" id="kobo.149.3">Finally, as </span><a id="_idIndexMarker703"/><span class="koboSpan" id="kobo.150.1">a major benefit, TMC</span><a id="_idIndexMarker704"/><span class="koboSpan" id="kobo.151.1"> can perform all these operations for any conformant</span><a id="_idIndexMarker705"/><span class="koboSpan" id="kobo.152.1"> Kubernetes flavor, including AWS </span><strong class="bold"><span class="koboSpan" id="kobo.153.1">Elastic Kubernetes Service</span></strong><span class="koboSpan" id="kobo.154.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.155.1">EKS</span></strong><span class="koboSpan" id="kobo.156.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.157.1">Azure Kubernetes Service</span></strong><span class="koboSpan" id="kobo.158.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.159.1">AKS</span></strong><span class="koboSpan" id="kobo.160.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.161.1">Google Kubernetes Engine</span></strong><span class="koboSpan" id="kobo.162.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.163.1">GKE</span></strong><span class="koboSpan" id="kobo.164.1">), OpenShift, Rancher, open source upstream distributions, and </span><a id="_idIndexMarker706"/><span class="koboSpan" id="kobo.165.1">many other types. </span><span class="koboSpan" id="kobo.165.2">This excludes the full cluster lifecycle management that we covered in the first point under </span><em class="italic"><span class="koboSpan" id="kobo.166.1">Increased overhead of cluster lifecycle management</span></em><span class="koboSpan" id="kobo.167.1">. </span><span class="koboSpan" id="kobo.167.2">Upgrading Kubernetes clusters is only supported for TKG clusters at the time of writing. </span><span class="koboSpan" id="kobo.167.3">This capability makes TMC a great tool to implement a multi-cloud Kubernetes strategy for an enterprise. </span><span class="koboSpan" id="kobo.167.4">The following screenshot shows the TMC console with multiple Kubernetes clusters deployed on different </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">cloud environments:</span></span></p>
<p class="IMG---Figure"><span class="koboSpan" id="kobo.169.1"><img alt="Figure 9.1 – TMC console with multiple Kubernetes clusters managed" src="image/B18145_09_01.png"/></span></p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.170.1">Figure 9.1 – TMC console with multiple Kubernetes clusters managed</span></p>
<p><span class="koboSpan" id="kobo.171.1">With this, you should have gotten a convincible answer to the question, why TMC? </span><span class="koboSpan" id="kobo.171.2">We will get into the details</span><a id="_idIndexMarker707"/><span class="koboSpan" id="kobo.172.1"> of many of these capabilities later in this chapter, but for now, let’s see how to get started </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">with TMC.</span></span></p>
<h1 id="_idParaDest-177"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.174.1">Getting started with TMC</span></h1>
<p><span class="koboSpan" id="kobo.175.1">TMC is a </span><strong class="bold"><span class="koboSpan" id="kobo.176.1">Software-as-a-Service</span></strong><span class="koboSpan" id="kobo.177.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.178.1">SaaS</span></strong><span class="koboSpan" id="kobo.179.1">) offering</span><a id="_idIndexMarker708"/><span class="koboSpan" id="kobo.180.1"> under VMware</span><a id="_idIndexMarker709"/><span class="koboSpan" id="kobo.181.1"> Cloud Services. </span><span class="koboSpan" id="kobo.181.2">Because of that, there is no installation and setup required to start using TMC, which is a big relief that SaaS products provide. </span><span class="koboSpan" id="kobo.181.3">In TMC, we can have two types of clusters, as described in the </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">following points:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.183.1">Clusters that are under a Kubernetes platform management control plane that is registered on TMC</span></strong><span class="koboSpan" id="kobo.184.1"> – Presently, TMC only supports TKG clusters under this category. </span><span class="koboSpan" id="kobo.184.2">Once a TKG management cluster (a TKG platform control plane) running on vSphere, AWS, or Azure is registered in TMC, we can use the TMC interface to perform all lifecycle operations for all the clusters created under that </span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">management cluster.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.186.1">Clusters that are attached to TMC</span></strong><span class="koboSpan" id="kobo.187.1"> – These can be any conformant Kubernetes clusters that are created externally. </span><span class="koboSpan" id="kobo.187.2">We can attach these clusters to TMC for several management activities discussed previously in this chapter, except for full lifecycle operations, such as creating, deleting, and upgrading. </span><span class="koboSpan" id="kobo.187.3">TMC offers a common management control plane for all Kubernetes clusters irrespective of their flavors </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">and vendors.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.189.1">In this section, we will perform the following operations to get started </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">with TMC:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.191.1">Accessing the TMC portal via the VMware Cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">Services console</span></span></li>
<li><span class="koboSpan" id="kobo.193.1">Registering an existing TKG management cluster running </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">on AWS</span></span></li>
<li><span class="koboSpan" id="kobo.195.1">Creating a TKG workload cluster under the registered </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">management cluster</span></span></li>
<li><span class="koboSpan" id="kobo.197.1">Attaching a GKE cluster </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">for management</span></span></li>
<li><span class="koboSpan" id="kobo.199.1">Creating a </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">cluster group</span></span></li>
<li><span class="koboSpan" id="kobo.201.1">Adding two associated clusters in the newly created </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">cluster group</span></span></li>
<li><span class="koboSpan" id="kobo.203.1">Creating a Workspace, a group of cross-cluster </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">Kubernetes namespaces</span></span></li>
<li><span class="koboSpan" id="kobo.205.1">Adding two Kubernetes namespaces from two different clusters to the </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">created Workspace</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.207.1">However, before</span><a id="_idIndexMarker710"/><span class="koboSpan" id="kobo.208.1"> you can follow along, the following prerequisites must </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">be fulfilled:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.210.1">Administrator-level access to TMC via a VMware Cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">Services account.</span></span></li>
<li><span class="koboSpan" id="kobo.212.1">An existing TKG management cluster (version 1.4.1 or later) with a production plan with at least three control </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">plane nodes</span></span></li>
<li><span class="koboSpan" id="kobo.214.1">An existing Kubernetes cluster not managed by the previously mentioned TKG management cluster – this could be a GKE, AKS, EKS, OpenShift, Rancher, or even an open source </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">Kubernetes cluster</span></span></li>
<li><span class="koboSpan" id="kobo.216.1">The cluster nodes should contain 4 vCPUs and 8 GB memory for the smooth execution </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">of steps</span></span></li>
<li><span class="koboSpan" id="kobo.218.1">A user workstation with an internet browser (preferably Google Chrome) and the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">kubectl</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.220.1"> CLI</span></span></li>
<li><span class="koboSpan" id="kobo.221.1">Full internet connectivity from the Kubernetes clusters without any proxy servers, as the procedure to configure TMC for different operations differs with a proxy in between, which we are not considering in </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">this chapter</span></span></li>
<li><span class="koboSpan" id="kobo.223.1">Access to either AWS S3 or any other S3-compatible object store service from the clusters linked </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">with TMC.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.225.1">Additionally, if your TKG management cluster is running on AWS and if you have configured the IAM permissions defined in the CloudFormation stack used by TKG manually, then you</span><a id="_idIndexMarker711"/><span class="koboSpan" id="kobo.226.1"> must add the following listed permissions to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">nodes.tkg.cloud.vmware.com</span></strong><span class="koboSpan" id="kobo.228.1"> IAM policy </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">or role:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.230.1">
{
  "Action": [
    "servicequotas:ListServiceQuotas",
    "ec2:DescribeKeyPairs",
    "ec2:DescribeInstanceTypeOfferings",
    "ec2:DescribeInstanceTypes",
    "ec2:DescribeAvailabiilityZones",
    "ec2:DescribeRegions",
    "ec2:DescribeSubnets",
    "ec2:DescribeRouteTables",
    "ec2:DescribeVpcs",
    "ec2:DescribeNatGateways",
    "ec2:DescribeAddresses",
    "elasticloadbalancing:DescribeLoadBalancers"
  ],
  "Resource": [
    "*"
  ],
  "Effect": "Allow"
}</span></pre>
<p><span class="koboSpan" id="kobo.231.1">However, these permissions are included automatically when you create or update the CloudFormation stack by running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">tanzu mc permissions aws set</span></strong><span class="koboSpan" id="kobo.233.1"> command. </span><span class="koboSpan" id="kobo.233.2">Once these</span><a id="_idIndexMarker712"/><span class="koboSpan" id="kobo.234.1"> prerequisites are addressed, we should be good for the rest of the chapter. </span><span class="koboSpan" id="kobo.234.2">Let’s start executing our plan to get started </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">with TMC.</span></span></p>
<h2 id="_idParaDest-178"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.236.1">Accessing the TMC portal</span></h2>
<p><span class="koboSpan" id="kobo.237.1">Let’s first open</span><a id="_idIndexMarker713"/><span class="koboSpan" id="kobo.238.1"> the TMC portal via the VMware Cloud Services portal with the </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.240.1">Visit the VMware Cloud Services portal at this </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">URL: </span></span><a href=""><span class="No-Break"><span class="koboSpan" id="kobo.242.1">https://console.cloud.vmware.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.243.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.244.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.245.1">LAUNCH SERVICE</span></strong><span class="koboSpan" id="kobo.246.1"> link on the </span><strong class="bold"><span class="koboSpan" id="kobo.247.1">VMware Tanzu Mission Control</span></strong><span class="koboSpan" id="kobo.248.1"> tile as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer165">
<span class="koboSpan" id="kobo.250.1"><img alt="Figure 9.2 – VMware Cloud Services console" src="image/B18145_09_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.251.1">Figure 9.2 – VMware Cloud Services console</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.252.1">That should </span><a id="_idIndexMarker714"/><span class="koboSpan" id="kobo.253.1">open the TMC portal as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">following screen:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer166">
<span class="koboSpan" id="kobo.255.1"><img alt="Figure 9.3 – Tanzu Mission Control console" src="image/B18145_09_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.256.1">Figure 9.3 – Tanzu Mission Control console</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.257.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.258.1">If you are not entitled to TMC in your VMware Cloud Services account, then you will not see the TMC tile on the VMware Cloud Services console. </span><span class="koboSpan" id="kobo.258.2">You may need to request access for a TMC trial by getting in touch with your VMware contact point, or you can request access to TMC Starter via this </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">URL: </span></span><a href=""><span class="No-Break"><span class="koboSpan" id="kobo.260.1">https://tanzu.vmware.com/tmc-starter</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.261.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.262.1">Now, as we are on the </span><a id="_idIndexMarker715"/><span class="koboSpan" id="kobo.263.1">TMC portal, let’s register our first TKG management cluster </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">in TMC.</span></span></p>
<h2 id="_idParaDest-179"><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.265.1">Registering a TKG management cluster on TMC</span></h2>
<p><span class="koboSpan" id="kobo.266.1">Take the</span><a id="_idIndexMarker716"/><span class="koboSpan" id="kobo.267.1"> following </span><a id="_idIndexMarker717"/><span class="koboSpan" id="kobo.268.1">steps on the TMC portal to register your existing TKG management cluster, running either on top of vSphere, AWS, or Azure cloud environments. </span><span class="koboSpan" id="kobo.268.2">The management cluster used in this chapter is deployed on top of AWS, which does not change any procedure in the following steps, except entering some configuration details for the workload cluster that we </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">will create:</span></span></p>
<h2 id="_idParaDest-180"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.270.1">Registering a TKG management cluster on TMC</span></h2>
<p><span class="koboSpan" id="kobo.271.1">Take the</span><a id="_idIndexMarker718"/><span class="koboSpan" id="kobo.272.1"> following </span><a id="_idIndexMarker719"/><span class="koboSpan" id="kobo.273.1">steps on the TMC portal to register your existing TKG management cluster, running either on top of vSphere, AWS, or Azure cloud environments. </span><span class="koboSpan" id="kobo.273.2">The management cluster used in this chapter is deployed on top of AWS, which does not change any procedure in the following steps, except entering some configuration details for the workload cluster that we </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">will create:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.275.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.276.1">Administration</span></strong><span class="koboSpan" id="kobo.277.1"> menu option from the left navigation bar and open the </span><strong class="bold"><span class="koboSpan" id="kobo.278.1">Management clusters</span></strong><span class="koboSpan" id="kobo.279.1"> tab as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer167">
<span class="koboSpan" id="kobo.281.1"><img alt="Figure 9.4 – Opening the Management clusters screen" src="image/B18145_09_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.282.1">Figure 9.4 – Opening the Management clusters screen</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.283.1">On the </span><strong class="bold"><span class="koboSpan" id="kobo.284.1">Management clusters</span></strong><span class="koboSpan" id="kobo.285.1"> tab, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.286.1">REGISTER MANAGEMENT CLUSTER</span></strong><span class="koboSpan" id="kobo.287.1"> dropdown, and select the </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">Tanzu Kubernetes Grid</span></strong><span class="koboSpan" id="kobo.289.1"> option as highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer168">
<span class="koboSpan" id="kobo.291.1"><img alt="Figure 9.5 – Selecting Tanzu Kubernetes Grid to register as a management cluster" src="image/B18145_09_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.292.1">Figure 9.5 – Selecting Tanzu Kubernetes Grid to register as a management cluster</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.293.1">On the </span><a id="_idIndexMarker720"/><span class="koboSpan" id="kobo.294.1">detail </span><a id="_idIndexMarker721"/><span class="koboSpan" id="kobo.295.1">screen to register the management cluster, enter a unique name, select </span><strong class="bold"><span class="koboSpan" id="kobo.296.1">default</span></strong><span class="koboSpan" id="kobo.297.1"> from the drop-down list of groups, optionally add a small description, and finally, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.298.1">NEXT</span></strong><span class="koboSpan" id="kobo.299.1"> button. </span><span class="koboSpan" id="kobo.299.2">We will discuss cluster groups in detail later in </span><span class="No-Break"><span class="koboSpan" id="kobo.300.1">the chapter:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer169">
<span class="koboSpan" id="kobo.301.1"><img alt="Figure 9.6 – Entering management cluster details" src="image/B18145_09_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.302.1">Figure 9.6 – Entering management cluster details</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.303.1">Click </span><a id="_idIndexMarker722"/><span class="koboSpan" id="kobo.304.1">on</span><a id="_idIndexMarker723"/><span class="koboSpan" id="kobo.305.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.306.1">NEXT</span></strong><span class="koboSpan" id="kobo.307.1"> button in the </span><strong class="bold"><span class="koboSpan" id="kobo.308.1">Proxy Configuration</span></strong><span class="koboSpan" id="kobo.309.1"> section, as we will not </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">need it:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer170">
<span class="koboSpan" id="kobo.311.1"><img alt="Figure 9.7 – Skipping proxy configuration" src="image/B18145_09_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.312.1">Figure 9.7 – Skipping proxy configuration</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.313.1">You will be given a URL of a YAML file that contains the Kubernetes resources that you need to create for your management cluster to link it with your TMC account. </span><span class="koboSpan" id="kobo.313.2">Copy the URL as shown in the following screenshot. </span><span class="koboSpan" id="kobo.313.3">You may expand the </span><strong class="bold"><span class="koboSpan" id="kobo.314.1">View YAML</span></strong><span class="koboSpan" id="kobo.315.1"> section to see the details of the Kubernetes resources that will be created on your management cluster and </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">their configuration:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer171">
<span class="koboSpan" id="kobo.317.1"><img alt="Figure 9.8 – Copying the registration URL to link to the management cluster" src="image/B18145_09_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.318.1">Figure 9.8 – Copying the registration URL to link to the management cluster</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.319.1">Click</span><a id="_idIndexMarker724"/><span class="koboSpan" id="kobo.320.1"> on </span><a id="_idIndexMarker725"/><span class="koboSpan" id="kobo.321.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">VIEW MANAGEMENT CLUSTER</span></strong><span class="koboSpan" id="kobo.323.1"> button to inspect the newly registered management cluster </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">on TMC:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer172">
<span class="koboSpan" id="kobo.325.1"><img alt="Figure 9.9 – Verifying the creation of the management cluster" src="image/B18145_09_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.326.1">Figure 9.9 – Verifying the creation of the management cluster</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.327.1">You</span><a id="_idIndexMarker726"/><span class="koboSpan" id="kobo.328.1"> should</span><a id="_idIndexMarker727"/><span class="koboSpan" id="kobo.329.1"> see the page as displayed in the following screenshot. </span><span class="koboSpan" id="kobo.329.2">The status of the cluster is </span><strong class="bold"><span class="koboSpan" id="kobo.330.1">Unknown</span></strong><span class="koboSpan" id="kobo.331.1">, as we are yet to apply the registration YAML configuration to our </span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">management cluster:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer173">
<span class="koboSpan" id="kobo.333.1"><img alt="Figure 9.10 – Management cluster status unknown" src="image/B18145_09_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.334.1">Figure 9.10 – Management cluster status unknown</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.335.1">Open your console window where you have access to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">kubectl</span></strong><span class="koboSpan" id="kobo.337.1"> CLI on your workstation with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">kubectl</span></strong><span class="koboSpan" id="kobo.339.1"> context pointing to the </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">management cluster.</span></span></li>
<li><span class="koboSpan" id="kobo.341.1">Run the following </span><strong class="source-inline"><span class="koboSpan" id="kobo.342.1">kubectl apply</span></strong><span class="koboSpan" id="kobo.343.1"> command using the URL copied in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.344.1">step 4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.346.1">
$ kubectl apply -f &lt;tmc-url&gt;</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.347.1">This should list a bunch of different Kubernetes resources created for your management cluster. </span><span class="koboSpan" id="kobo.347.2">Once completed, we have created a two-way link between the TKG management cluster and the TMC account. </span><span class="koboSpan" id="kobo.347.3">We should be able to see the management cluster successfully verified </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">on TMC.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.349.1">After 5 to 10 minutes, either click on the </span><strong class="bold"><span class="koboSpan" id="kobo.350.1">VERIFY CONNECTION</span></strong><span class="koboSpan" id="kobo.351.1"> button as shown in </span><em class="italic"><span class="koboSpan" id="kobo.352.1">step 6</span></em><span class="koboSpan" id="kobo.353.1">, or navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.354.1">Administration</span></strong><span class="koboSpan" id="kobo.355.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.356.1">Management clusters</span></strong><span class="koboSpan" id="kobo.357.1"> to verify the successful registration of the management cluster. </span><span class="koboSpan" id="kobo.357.2">As you</span><a id="_idIndexMarker728"/><span class="koboSpan" id="kobo.358.1"> can </span><a id="_idIndexMarker729"/><span class="koboSpan" id="kobo.359.1">see in the following screenshot, the cluster is </span><strong class="bold"><span class="koboSpan" id="kobo.360.1">Healthy</span></strong><span class="koboSpan" id="kobo.361.1"> and in a </span><strong class="bold"><span class="koboSpan" id="kobo.362.1">Ready</span></strong><span class="koboSpan" id="kobo.363.1"> state now. </span><span class="koboSpan" id="kobo.363.2">Click on the cluster name link as highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.364.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer174">
<span class="koboSpan" id="kobo.365.1"><img alt="Figure 9.11 – Management cluster registration verification" src="image/B18145_09_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.366.1">Figure 9.11 – Management cluster registration verification</span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.367.1">Once you click on the name of the management cluster as shown in the previous step, you will see something similar to the following screenshot showing the details of the management cluster, including the health indicators of different components running on </span><span class="No-Break"><span class="koboSpan" id="kobo.368.1">the cluster:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer175">
<span class="koboSpan" id="kobo.369.1"><img alt="Figure 9.12 – Management cluster details" src="image/B18145_09_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.370.1">Figure 9.12 – Management cluster details</span></p>
<p><span class="koboSpan" id="kobo.371.1">This concludes</span><a id="_idIndexMarker730"/><span class="koboSpan" id="kobo.372.1"> our</span><a id="_idIndexMarker731"/><span class="koboSpan" id="kobo.373.1"> steps to register a TKG management cluster in a TMC account using the TMC portal. </span><span class="koboSpan" id="kobo.373.2">In the next section, we will see how to use the TMC portal to create a new TKG workload cluster under the newly added </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">management cluster.</span></span></p>
<h2 id="_idParaDest-181"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.375.1">Creating a new workload cluster under a management cluster</span></h2>
<p><span class="koboSpan" id="kobo.376.1">After setting</span><a id="_idIndexMarker732"/><span class="koboSpan" id="kobo.377.1"> up the first TKG management cluster on TMC, let’s use this setup to create a new TKG workload cluster. </span><span class="koboSpan" id="kobo.377.2">As discussed in the previous chapter covering TKG in detail, a TKG workload cluster is used to run your containerized apps, whereas the management cluster is the control plane for several of these </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">workload clusters.</span></span></p>
<p><span class="koboSpan" id="kobo.379.1">All TKG workload clusters are created</span><a id="_idIndexMarker733"/><span class="koboSpan" id="kobo.380.1"> under a </span><strong class="bold"><span class="koboSpan" id="kobo.381.1">provisioner</span></strong><span class="koboSpan" id="kobo.382.1">. </span><span class="koboSpan" id="kobo.382.2">A provisioner is a namespace within the management cluster that owns required workload clusters within the management cluster. </span><span class="koboSpan" id="kobo.382.3">This way, the provisioners in TKG provide a multi-tenancy construct to allow different teams to create and manage their own workload clusters without interfering with others. </span><span class="koboSpan" id="kobo.382.4">In our case, we will use the </span><strong class="bold"><span class="koboSpan" id="kobo.383.1">default</span></strong><span class="koboSpan" id="kobo.384.1"> namespace of the management cluster, which should be present </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">by default.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">Take the following steps to create a new TKG workload cluster for your TKG </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">management cluster:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.388.1">Go to the </span><strong class="bold"><span class="koboSpan" id="kobo.389.1">Administration</span></strong><span class="koboSpan" id="kobo.390.1"> menu of the left-hand navigation bar, open the </span><strong class="bold"><span class="koboSpan" id="kobo.391.1">Management clusters</span></strong><span class="koboSpan" id="kobo.392.1"> tab, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.393.1">tkg-aws-mgmt-cluster</span></strong><span class="koboSpan" id="kobo.394.1"> link to open its </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">detail page:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer176">
<span class="koboSpan" id="kobo.396.1"><img alt="Figure 9.13 – Opening the management cluster page" src="image/B18145_09_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.397.1">Figure 9.13 – Opening the management cluster page</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.398.1">Go to</span><a id="_idIndexMarker734"/><span class="koboSpan" id="kobo.399.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.400.1">Clusters</span></strong><span class="koboSpan" id="kobo.401.1"> menu on the left-hand navigation bar and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.402.1">CREATE CLUSTER</span></strong><span class="koboSpan" id="kobo.403.1"> button as highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.404.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer177">
<span class="koboSpan" id="kobo.405.1"><img alt="Figure 9.14 – Creating a workload cluster" src="image/B18145_09_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.406.1">Figure 9.14 – Creating a workload cluster</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.407.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.408.1">tkg-aws-mgmt-cluster</span></strong><span class="koboSpan" id="kobo.409.1"> from the list that was registered on TMC earlier and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.410.1">CONTINUE TO CREATE </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.411.1">CLUSTER</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.412.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer178">
<span class="koboSpan" id="kobo.413.1"><img alt="Figure 9.15 – Continue creating a workload cluster" src="image/B18145_09_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.414.1">Figure 9.15 – Continue creating a workload cluster</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.415.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.416.1">default</span></strong><span class="koboSpan" id="kobo.417.1"> from </span><a id="_idIndexMarker735"/><span class="koboSpan" id="kobo.418.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.419.1">Provisioner</span></strong><span class="koboSpan" id="kobo.420.1"> dropdown and click </span><span class="No-Break"><span class="koboSpan" id="kobo.421.1">on </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.422.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer179">
<span class="koboSpan" id="kobo.424.1"><img alt="Figure 9.16 – Selecting the provisioner for the workload cluster" src="image/B18145_09_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.425.1">Figure 9.16 – Selecting the provisioner for the workload cluster</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.426.1">Enter the cluster name, optionally add a description, and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.427.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.428.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer180">
<span class="koboSpan" id="kobo.429.1"><img alt="Figure 9.17 – Entering the workload cluster details" src="image/B18145_09_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.430.1">Figure 9.17 – Entering the workload cluster details</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.431.1">Enter the </span><a id="_idIndexMarker736"/><span class="koboSpan" id="kobo.432.1">required infrastructure-specific details in this step and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.433.1">NEXT</span></strong><span class="koboSpan" id="kobo.434.1"> button. </span><span class="koboSpan" id="kobo.434.2">As the TKG management cluster used in this chapter is running on AWS, the following screenshot shows AWS-specific details. </span><span class="koboSpan" id="kobo.434.3">For vSphere and Azure, some fields will be different. </span><span class="koboSpan" id="kobo.434.4">You can get more details about them </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">here: </span></span><a href=""><span class="No-Break"><span class="koboSpan" id="kobo.436.1">https://docs.vmware.com/en/VMware-Tanzu-Mission-Control/services/tanzumc-using/GUID-42150344-CD4C-43AE-8C39-C059A97EF47C.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.437.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer181">
<span class="koboSpan" id="kobo.438.1"><img alt="Figure 9.18 – Entering the workload cluster configuration" src="image/B18145_09_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.439.1">Figure 9.18 – Entering the workload cluster configuration</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.440.1">Choose</span><a id="_idIndexMarker737"/><span class="koboSpan" id="kobo.441.1"> the control plane plan for the workload cluster to be created. </span><span class="koboSpan" id="kobo.441.2">You can also optionally change the values of the other fields, but this is not required and we recommend following the procedure in this chapter. </span><span class="koboSpan" id="kobo.441.3">Finally, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.442.1">NEXT</span></strong><span class="koboSpan" id="kobo.443.1"> button to select the worker </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">node details:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer182">
<span class="koboSpan" id="kobo.445.1"><img alt="Figure 9.19 – Selecting the workload cluster type" src="image/B18145_09_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.446.1">Figure 9.19 – Selecting the workload cluster type</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.447.1">Enter the</span><a id="_idIndexMarker738"/><span class="koboSpan" id="kobo.448.1"> count of the worker nodes for the workload cluster and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.449.1">CREATE </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.450.1">CLUSTER</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.451.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer183">
<span class="koboSpan" id="kobo.452.1"><img alt="Figure 9.20 – Entering the worker node count" src="image/B18145_09_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.453.1">Figure 9.20 – Entering the worker node count</span></p>
<p><span class="koboSpan" id="kobo.454.1">You will see a message saying that the workload cluster is being created with its specifications</span><a id="_idIndexMarker739"/><span class="koboSpan" id="kobo.455.1"> as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">following screen:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer184">
<span class="koboSpan" id="kobo.457.1"><img alt="Figure 9.21 – Workload cluster being created" src="image/B18145_09_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.458.1">Figure 9.21 – Workload cluster being created</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.459.1">You will see a cluster detail screen like the following screenshot once the workload cluster is created successfully. </span><span class="koboSpan" id="kobo.459.2">It might take 5 to 10 minutes depending on the size </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">and infrastructure:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer185">
<span class="koboSpan" id="kobo.461.1"><img alt="Figure 9.22 – Workload cluster detail page" src="image/B18145_09_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.462.1">Figure 9.22 – Workload cluster detail page</span></p>
<p><span class="koboSpan" id="kobo.463.1">This concludes our third step, creating a TKG workload cluster using a TKG management cluster using </span><a id="_idIndexMarker740"/><span class="koboSpan" id="kobo.464.1">the TMC portal. </span><span class="koboSpan" id="kobo.464.2">Now, we will attach an externally managed Kubernetes cluster to TMC so that we can perform various day-2 activities for that cluster </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">using TMC.</span></span></p>
<h2 id="_idParaDest-182"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.466.1">Attaching an existing Kubernetes cluster with TMC</span></h2>
<p><span class="koboSpan" id="kobo.467.1">In this section, we</span><a id="_idIndexMarker741"/><span class="koboSpan" id="kobo.468.1"> will </span><a id="_idIndexMarker742"/><span class="koboSpan" id="kobo.469.1">attach an existing GKE cluster to the TMC account. </span><span class="koboSpan" id="kobo.469.2">You may select any other type of Kubernetes cluster, including Rancher, AKS, EKS, OpenShift, upstream open source, and more. </span><span class="koboSpan" id="kobo.469.3">TMC will allow you to attach a Kubernetes cluster as far as it is a conformant Kubernetes cluster with admin-level </span><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">kubectl</span></strong><span class="koboSpan" id="kobo.471.1"> access for the cluster. </span><span class="koboSpan" id="kobo.471.2">So, let’s attach an </span><span class="No-Break"><span class="koboSpan" id="kobo.472.1">external cluster:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.473.1">Go to the </span><strong class="bold"><span class="koboSpan" id="kobo.474.1">Clusters</span></strong><span class="koboSpan" id="kobo.475.1"> menu from the left-hand menu bar and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.476.1">ATTACH CLUSTER</span></strong><span class="koboSpan" id="kobo.477.1"> button as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.478.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer186">
<span class="koboSpan" id="kobo.479.1"><img alt="Figure 9.23 – Go﻿ing to the Attach cluster page" src="image/B18145_09_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.480.1">Figure 9.23 – Going to the Attach cluster page</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.481.1">Enter the cluster name, select the cluster group as </span><strong class="bold"><span class="koboSpan" id="kobo.482.1">default</span></strong><span class="koboSpan" id="kobo.483.1">, optionally enter a description, and</span><a id="_idIndexMarker743"/><span class="koboSpan" id="kobo.484.1"> finally, click </span><a id="_idIndexMarker744"/><span class="koboSpan" id="kobo.485.1">on the </span><strong class="bold"><span class="koboSpan" id="kobo.486.1">NEXT</span></strong><span class="koboSpan" id="kobo.487.1"> button as highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer187">
<span class="koboSpan" id="kobo.489.1"><img alt="Figure 9.24 – Entering the attached cluster details" src="image/B18145_09_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.490.1">Figure 9.24 – Entering the attached cluster details</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.491.1">Skip the proxy configuration and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.492.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.493.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer188">
<span class="koboSpan" id="kobo.494.1"><img alt="Figure 9.25 – Skipping the proxy configuration details" src="image/B18145_09_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.495.1">Figure 9.25 – Skipping the proxy configuration details</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.496.1">Just as we</span><a id="_idIndexMarker745"/><span class="koboSpan" id="kobo.497.1"> registered </span><a id="_idIndexMarker746"/><span class="koboSpan" id="kobo.498.1">the management cluster using a Kubernetes YAML configuration file earlier in this chapter, it is now time to register the external cluster using a similar approach. </span><span class="koboSpan" id="kobo.498.2">You can view the details of the Kubernetes resources that will be created on the targeted cluster to establish two-way communication between the cluster </span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">and TMC:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer189">
<span class="koboSpan" id="kobo.500.1"><img alt="Figure ﻿9.26 – Copying the agent configuration command to attach the cluster to TMC" src="image/B18145_09_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.501.1">Figure 9.26 – Copying the agent configuration command to attach the cluster to TMC</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.502.1">Open the command window where you have access to the cluster being attached via </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">kubectl</span></strong><span class="koboSpan" id="kobo.504.1"> and change the </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">kubectl</span></strong><span class="koboSpan" id="kobo.506.1"> context to point to the cluster </span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">being attached.</span></span></li>
<li><span class="koboSpan" id="kobo.508.1">Run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.509.1">kubectl</span></strong><span class="koboSpan" id="kobo.510.1"> command copied in </span><em class="italic"><span class="koboSpan" id="kobo.511.1">step 4</span></em><span class="koboSpan" id="kobo.512.1"> on your command window to create the required agent deployment resources in your cluster to attach </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">to TMC.</span></span></li>
<li><span class="koboSpan" id="kobo.514.1">After the successful execution of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">kubectl create</span></strong><span class="koboSpan" id="kobo.516.1"> command, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.517.1">VERIFY CONNECTION</span></strong><span class="koboSpan" id="kobo.518.1"> button. </span><span class="koboSpan" id="kobo.518.2">You should see the recently attached cluster in the list as shown in the following screenshot. </span><span class="koboSpan" id="kobo.518.3">Then, click on the attached</span><a id="_idIndexMarker747"/><span class="koboSpan" id="kobo.519.1"> cluster </span><a id="_idIndexMarker748"/><span class="koboSpan" id="kobo.520.1">name to verify </span><span class="No-Break"><span class="koboSpan" id="kobo.521.1">its details:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer190">
<span class="koboSpan" id="kobo.522.1"><img alt="Figure 9.27 – Verifying an attached cluster in the list" src="image/B18145_09_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.523.1">Figure 9.27 – Verifying an attached cluster in the list</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.524.1">Examine the details of the attached cluster. </span><span class="koboSpan" id="kobo.524.2">As you can see in the following screen, the type of the cluster </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">is </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.526.1">Attached</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer191">
<span class="koboSpan" id="kobo.528.1"><img alt="Figure 9.28 – Attached cluster details" src="image/B18145_09_28.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.529.1">Figure 9.28 – Attached cluster details</span></p>
<p><span class="koboSpan" id="kobo.530.1">This concludes </span><a id="_idIndexMarker749"/><span class="koboSpan" id="kobo.531.1">our task of </span><a id="_idIndexMarker750"/><span class="koboSpan" id="kobo.532.1">attaching an externally managed Kubernetes cluster to TMC. </span><span class="koboSpan" id="kobo.532.2">As the next steps, we will create a cluster group and add our TKG workload and GKE-attached clusters to </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">that group.</span></span></p>
<h2 id="_idParaDest-183"><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.534.1">Creating a cluster group on TMC</span></h2>
<p><span class="koboSpan" id="kobo.535.1">As discussed </span><a id="_idIndexMarker751"/><span class="koboSpan" id="kobo.536.1">earlier in this chapter, TMC</span><a id="_idIndexMarker752"/><span class="koboSpan" id="kobo.537.1"> allows you to group different clusters of similar natures and manage and handle them using common configurations. </span><span class="koboSpan" id="kobo.537.2">Configuring groups of several clusters makes the operation of large Kubernetes foundations very easy and efficient. </span><span class="koboSpan" id="kobo.537.3">So, let’s learn how to create cluster groups in TMC in </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">this section:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.539.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.540.1">Cluster groups</span></strong><span class="koboSpan" id="kobo.541.1"> menu item from the left-hand navigation bar and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.542.1">CREATE CLUSTER GROUP</span></strong><span class="koboSpan" id="kobo.543.1"> button as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer192">
<span class="koboSpan" id="kobo.545.1"><img alt="Figure 9.29 – Creating cluster groups" src="image/B18145_09_29.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.546.1">Figure 9.29 – Creating cluster groups</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.547.1">Enter the cluster group name, add an optional description, and click the </span><strong class="bold"><span class="koboSpan" id="kobo.548.1">CREATE</span></strong><span class="koboSpan" id="kobo.549.1"> button</span><a id="_idIndexMarker753"/><span class="koboSpan" id="kobo.550.1"> as shown in</span><a id="_idIndexMarker754"/><span class="koboSpan" id="kobo.551.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer193">
<span class="koboSpan" id="kobo.553.1"><img alt="Figure 9.30 – Entering cluster group details" src="image/B18145_09_30.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.554.1">Figure 9.30 – Entering cluster group details</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.555.1">You should see the newly created cluster group in the list as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer194">
<span class="koboSpan" id="kobo.557.1"><img alt="Figure 9.31 – Verifying the presence of the cluster group" src="image/B18145_09_31.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.558.1">Figure 9.31 – Verifying the presence of the cluster group</span></p>
<p><span class="koboSpan" id="kobo.559.1">Now, let’s add our</span><a id="_idIndexMarker755"/><span class="koboSpan" id="kobo.560.1"> two clusters to this</span><a id="_idIndexMarker756"/><span class="koboSpan" id="kobo.561.1"> newly created group using the </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">following steps.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.563.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.564.1">default</span></strong><span class="koboSpan" id="kobo.565.1"> cluster group as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer195">
<span class="koboSpan" id="kobo.567.1"><img alt="Figure 9.32 – Selecting the cluster group as default" src="image/B18145_09_32.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.568.1">Figure 9.32 – Selecting the cluster group as default</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.569.1">Select the two clusters we have on TMC, for the TKG workload and GKE, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.570.1">MOVE</span></strong><span class="koboSpan" id="kobo.571.1"> button as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer196">
<span class="koboSpan" id="kobo.573.1"><img alt="Figure 9.33 – Selecting clusters for grouping" src="image/B18145_09_33.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.574.1">Figure 9.33 – Selecting clusters for grouping</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.575.1">Select</span><a id="_idIndexMarker757"/><span class="koboSpan" id="kobo.576.1"> the cluster group we</span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.577.1"> created in </span><em class="italic"><span class="koboSpan" id="kobo.578.1">step 2</span></em><span class="koboSpan" id="kobo.579.1"> and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.580.1">MOVE</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.581.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer197">
<span class="koboSpan" id="kobo.582.1"><img alt="Figure 9.34 – Selecting the cluster group" src="image/B18145_09_34.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.583.1">Figure 9.34 – Selecting the cluster group</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.584.1">Go to </span><a id="_idIndexMarker759"/><span class="koboSpan" id="kobo.585.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.586.1">Cluster groups</span></strong><span class="koboSpan" id="kobo.587.1"> page</span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.588.1"> and click on the new cluster group we created to examine the presence of the two clusters we added in the </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">previous step:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer198">
<span class="koboSpan" id="kobo.590.1"><img alt="Figure 9.35 – Getting into the new cluster group" src="image/B18145_09_35.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.591.1">Figure 9.35 – Getting into the new cluster group</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.592.1">As you can </span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.593.1">see in the following </span><a id="_idIndexMarker762"/><span class="koboSpan" id="kobo.594.1">screenshot, both clusters that we created in this section are in the </span><span class="No-Break"><span class="koboSpan" id="kobo.595.1">cluster group:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer199">
<span class="koboSpan" id="kobo.596.1"><img alt="Figure 9.36 – Listed clusters in the cluster group" src="image/B18145_09_36.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.597.1">Figure 9.36 – Listed clusters in the cluster group</span></p>
<p><span class="koboSpan" id="kobo.598.1">Grouping clusters with similar requirements is a very powerful way to manage hundreds of clusters with heterogeneous requirements. </span><span class="koboSpan" id="kobo.598.2">Along with groups of clusters, TMC also allows you to group Kubernetes namespaces to perform certain namespace-level configurations </span><a id="_idIndexMarker763"/><span class="koboSpan" id="kobo.599.1">applicable to more than</span><a id="_idIndexMarker764"/><span class="koboSpan" id="kobo.600.1"> one namespace in different clusters. </span><span class="koboSpan" id="kobo.600.2">Let’s learn more </span><span class="No-Break"><span class="koboSpan" id="kobo.601.1">about it.</span></span></p>
<h2 id="_idParaDest-184"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.602.1">Understanding Workspaces in TMC</span></h2>
<p><span class="koboSpan" id="kobo.603.1">As we discussed </span><a id="_idIndexMarker765"/><span class="koboSpan" id="kobo.604.1">before in this chapter, TMC allows you </span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.605.1">to group clusters of similar natures. </span><span class="koboSpan" id="kobo.605.2">Grouping helps us create a common configuration and policies for them for operational efficiency. </span><span class="koboSpan" id="kobo.605.3">However, certain policies in Kubernetes can only be applied at the namespace level, such as network policies that define which Pods from one namespace can talk to which Pods in another namespace. </span><span class="koboSpan" id="kobo.605.4">Additionally, we can also configure cluster user access policies at the namespace level, and TMC also allows us to create image registry access policies at the namespace level. </span><span class="koboSpan" id="kobo.605.5">While applying cluster-level policies to a cluster group is an easy task, applying namespace-level policies for individual namespaces could be very impractical. </span><span class="koboSpan" id="kobo.605.6">Moreover, a way to apply namespace-level policies to a group of namespaces within a cluster would also not help much if we were trying to manage hundreds of Kubernetes clusters. </span><span class="koboSpan" id="kobo.605.7">For these reasons, TMC offers a construct called </span><strong class="bold"><span class="koboSpan" id="kobo.606.1">Workspaces</span></strong><span class="koboSpan" id="kobo.607.1">, which allows us to create a group of namespaces across different clusters – then, we can create a namespace-level policy applicable to the entire Workspace and hence for all the namespaces within the same Workspace. </span><span class="koboSpan" id="kobo.607.2">A multi-cloud application that is deployed in different clusters might need similar configurations for either user access or network policy configuration. </span><span class="koboSpan" id="kobo.607.3">For a Workspace containing all the namespaces of this application and running different clusters, it would come in very handy to treat them as </span><span class="No-Break"><span class="koboSpan" id="kobo.608.1">a unit.</span></span></p>
<p><span class="koboSpan" id="kobo.609.1">Let’s create two namespaces in the two clusters we have added in the previous section of this chapter and then create a Workspace to add those two </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">namespaces into:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.611.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.612.1">Workspaces</span></strong><span class="koboSpan" id="kobo.613.1"> menu from the left-hand navigation bar and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.614.1">CREATE WORKSPACE</span></strong><span class="koboSpan" id="kobo.615.1"> button as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer200">
<span class="koboSpan" id="kobo.617.1"><img alt="Figure 9.37 – Creating a Workspace" src="image/B18145_09_37.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.618.1">Figure 9.37 – Creating a Workspace</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.619.1">Enter a name, optionally add a description, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.620.1">CREATE</span></strong><span class="koboSpan" id="kobo.621.1"> button on the page</span><a id="_idIndexMarker767"/><span class="koboSpan" id="kobo.622.1"> as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">following</span></span><span class="No-Break"><a id="_idIndexMarker768"/></span><span class="No-Break"><span class="koboSpan" id="kobo.624.1"> screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer201">
<span class="koboSpan" id="kobo.625.1"><img alt="Figure 9.38 – Entering Workspace details" src="image/B18145_09_38.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.626.1">Figure 9.38 – Entering Workspace details</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.627.1">As you can see in the following screenshot, a new Workspace has been created. </span><span class="koboSpan" id="kobo.627.2">Click on the Workspace name to ensure there are no namespaces listed </span><span class="No-Break"><span class="koboSpan" id="kobo.628.1">in there:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer202">
<span class="koboSpan" id="kobo.629.1"><img alt="Figure ﻿9.39 – Verifying that the Workspace has been created" src="image/B18145_09_39.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.630.1">Figure 9.39 – Verifying that the Workspace has been created</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.631.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.632.1">tmc-demo-clusters</span></strong><span class="koboSpan" id="kobo.633.1"> cluster group that we previously created on the TMC portal </span><a id="_idIndexMarker769"/><span class="koboSpan" id="kobo.634.1">as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">following </span></span><span class="No-Break"><a id="_idIndexMarker770"/></span><span class="No-Break"><span class="koboSpan" id="kobo.636.1">screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer203">
<span class="koboSpan" id="kobo.637.1"><img alt="Figure ﻿9.40 – Opening the cluster group" src="image/B18145_09_40.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.638.1">Figure 9.40 – Opening the cluster group</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.639.1">Click on the TKG workload cluster as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.640.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer204">
<span class="koboSpan" id="kobo.641.1"><img alt="Figure ﻿9.41 – Opening a cluster detail page" src="image/B18145_09_41.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.642.1">Figure 9.41 – Opening a cluster detail page</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.643.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.644.1">Namespaces</span></strong><span class="koboSpan" id="kobo.645.1"> tab of the cluster detail page, select the </span><strong class="bold"><span class="koboSpan" id="kobo.646.1">default</span></strong><span class="koboSpan" id="kobo.647.1"> namespace, and</span><a id="_idIndexMarker771"/><span class="koboSpan" id="kobo.648.1"> click on the </span><strong class="bold"><span class="koboSpan" id="kobo.649.1">ATTACH 1 NAMESPACE</span></strong><span class="koboSpan" id="kobo.650.1"> button </span><a id="_idIndexMarker772"/><span class="koboSpan" id="kobo.651.1">as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer205">
<span class="koboSpan" id="kobo.653.1"><img alt="Figure ﻿9.42 – Selecting a namespace to attach to a Workspace" src="image/B18145_09_42.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.654.1">Figure 9.42 – Selecting a namespace to attach to a Workspace</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.655.1">Select or enter the Workspace name and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.656.1">ATTACH</span></strong><span class="koboSpan" id="kobo.657.1"> button as shown in</span><a id="_idIndexMarker773"/><span class="koboSpan" id="kobo.658.1"> the</span><a id="_idIndexMarker774"/> <span class="No-Break"><span class="koboSpan" id="kobo.659.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer206">
<span class="koboSpan" id="kobo.660.1"><img alt="Figure ﻿9.43 – Selecting the Workspace to attach" src="image/B18145_09_43.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.661.1">Figure 9.43 – Selecting the Workspace to attach</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.662.1">As you can </span><a id="_idIndexMarker775"/><span class="koboSpan" id="kobo.663.1">see in the following screenshot, the </span><strong class="bold"><span class="koboSpan" id="kobo.664.1">default</span></strong><span class="koboSpan" id="kobo.665.1"> namespace</span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.666.1"> is now under </span><strong class="bold"><span class="koboSpan" id="kobo.667.1">tmc-demo-workspace</span></strong><span class="koboSpan" id="kobo.668.1">, which we created in the </span><span class="No-Break"><span class="koboSpan" id="kobo.669.1">previous step:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer207">
<span class="koboSpan" id="kobo.670.1"><img alt="Figure ﻿9.44 – Verifying the namespace-Workspace association" src="image/B18145_09_44.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.671.1">Figure 9.44 – Verifying the namespace-Workspace association</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.672.1">Repeat </span><em class="italic"><span class="koboSpan" id="kobo.673.1">steps 5</span></em><span class="koboSpan" id="kobo.674.1"> to </span><em class="italic"><span class="koboSpan" id="kobo.675.1">8</span></em><span class="koboSpan" id="kobo.676.1"> from this list to add the </span><strong class="bold"><span class="koboSpan" id="kobo.677.1">default</span></strong><span class="koboSpan" id="kobo.678.1"> namespace to this new Workspace for the other cluster, </span><strong class="bold"><span class="koboSpan" id="kobo.679.1">gke-cluster-1</span></strong><span class="koboSpan" id="kobo.680.1">, as per this chapter, which we previously attached to TMC and added to the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.681.1">tmc-demo-clusters</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.682.1"> group.</span></span></li>
<li><span class="koboSpan" id="kobo.683.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.684.1">Workspaces</span></strong><span class="koboSpan" id="kobo.685.1"> menu from the left-hand navigation bar, and click on the new Workspace, </span><strong class="bold"><span class="koboSpan" id="kobo.686.1">tmc-demo-workspace</span></strong><span class="koboSpan" id="kobo.687.1">, that we </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">created earlier:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer208">
<span class="koboSpan" id="kobo.689.1"><img alt="Figure ﻿9.45 – Opening Workspace details" src="image/B18145_09_45.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.690.1">Figure 9.45 – Opening Workspace details</span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.691.1">You should </span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.692.1">be able to see two default namespaces from two different clusters listed as a part of the new Workspace we created in this part as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.693.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer209">
<span class="koboSpan" id="kobo.694.1"><img alt="Figure ﻿9.46 – Verifying namespaces in the Workspace" src="image/B18145_09_46.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.695.1">Figure 9.46 – Verifying namespaces in the Workspace</span></p>
<p><span class="koboSpan" id="kobo.696.1">With this, we have covered how to create Workspaces and how to attach existing namespaces to different clusters in the Workspace. </span><span class="koboSpan" id="kobo.696.2">In the example that we covered earlier, we used the default namespaces with the same name as the clusters that were in the same cluster group in TMC. </span><span class="koboSpan" id="kobo.696.3">However, you can add any namespaces to a Workspace irrespective of the namespace names and the group status of their </span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">parent clusters.</span></span></p>
<p><span class="koboSpan" id="kobo.698.1">With this, we conclude all the steps that we planned to cover under this part of the chapter – </span><em class="italic"><span class="koboSpan" id="kobo.699.1">Getting started with TMC</span></em><span class="koboSpan" id="kobo.700.1">. </span><span class="koboSpan" id="kobo.700.2">We learned how to register a TKG management cluster in TMC and created a TKG workload cluster using the TMC interface. </span><span class="koboSpan" id="kobo.700.3">Then, we also attached an externally managed GKE cluster to TMC. </span><span class="koboSpan" id="kobo.700.4">Finally, we learned how to group clusters and</span><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.701.1"> Kubernetes namespaces to perform common </span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.702.1">operations on them as a unit. </span><span class="koboSpan" id="kobo.702.2">In the next part of the chapter, we will learn about making and restoring cluster data backups </span><span class="No-Break"><span class="koboSpan" id="kobo.703.1">using TMC.</span></span></p>
<h1 id="_idParaDest-185"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.704.1">Protecting cluster data using TMC</span></h1>
<p><span class="koboSpan" id="kobo.705.1">Kubernetes is widely </span><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.706.1">used to run business-critical applications in production environments. </span><span class="koboSpan" id="kobo.706.2">In these cases, a reliable disaster recovery mechanism should be present to make regular cluster data and configuration backups and restore them in the event of data loss for any reason. </span><span class="koboSpan" id="kobo.706.3">Although Kubernetes is mostly used to run stateless workloads where the persistent data is stored outside the clusters in the databases, running stateful software, such as caches, queues, and databases, is also being adopted slowly. </span><span class="koboSpan" id="kobo.706.4">In </span><a href="B18145_06.xhtml#_idTextAnchor112"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.707.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.708.1">, </span><em class="italic"><span class="koboSpan" id="kobo.709.1">Managing Container Images with Harbor</span></em><span class="koboSpan" id="kobo.710.1">, the Harbor registry deployment used the data stores that were deployed on Kubernetes itself. </span><span class="koboSpan" id="kobo.710.2">That makes backing up data even </span><span class="No-Break"><span class="koboSpan" id="kobo.711.1">more important.</span></span></p>
<p><span class="koboSpan" id="kobo.712.1">So, to cover this important topic, we will learn how to make cluster backups and restore them using TMC with the following </span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">high-level steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.714.1">Configure an S3-compatible remote backup </span><span class="No-Break"><span class="koboSpan" id="kobo.715.1">storage location.</span></span></li>
<li><span class="koboSpan" id="kobo.716.1">Configure a cluster to use the remote storage location for </span><span class="No-Break"><span class="koboSpan" id="kobo.717.1">backup data.</span></span></li>
<li><span class="koboSpan" id="kobo.718.1">Deploy a custom application to </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">the cluster.</span></span></li>
<li><span class="koboSpan" id="kobo.720.1">Take a backup of </span><span class="No-Break"><span class="koboSpan" id="kobo.721.1">the cluster.</span></span></li>
<li><span class="koboSpan" id="kobo.722.1">Delete the cluster namespace with the custom deployment to simulate </span><span class="No-Break"><span class="koboSpan" id="kobo.723.1">a disaster.</span></span></li>
<li><span class="koboSpan" id="kobo.724.1">Restore the </span><span class="No-Break"><span class="koboSpan" id="kobo.725.1">cluster backup.</span></span></li>
<li><span class="koboSpan" id="kobo.726.1">Verify the presence of the deleted namespace and the custom deployment within </span><a id="_idIndexMarker781"/><span class="No-Break"><span class="koboSpan" id="kobo.727.1">it post-restoration.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.728.1">Let’s start the work to execute these steps one </span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">by one.</span></span></p>
<h3><span class="koboSpan" id="kobo.730.1">Configuring the backup target location</span></h3>
<p><span class="koboSpan" id="kobo.731.1">TMC allows you </span><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.732.1">to create separate backup target locations for separate cluster groups. </span><span class="koboSpan" id="kobo.732.2">Configuring a backup location for a cluster group is a one-time administrative activity. </span><span class="koboSpan" id="kobo.732.3">Once a target location is associated with a cluster group, we can make either on-demand or scheduled backups for any cluster in the cluster group using the backup location configuration. </span><span class="koboSpan" id="kobo.732.4">Additionally, one configured backup location can be used by many cluster groups. </span><span class="koboSpan" id="kobo.732.5">In this chapter, we will use the AWS S3 option as the </span><span class="No-Break"><span class="koboSpan" id="kobo.733.1">storage location.</span></span></p>
<p><span class="koboSpan" id="kobo.734.1">The following steps describe how to configure a backup target location for a cluster group </span><span class="No-Break"><span class="koboSpan" id="kobo.735.1">in TMC:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.736.1">Create your AWS account credentials for TMC to use to store backup data in an </span><span class="No-Break"><span class="koboSpan" id="kobo.737.1">S3 bucket:</span></span><ol><li><span class="koboSpan" id="kobo.738.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.739.1">Administration</span></strong><span class="koboSpan" id="kobo.740.1"> menu from the left-hand navigation bar and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.741.1">CREATE ACCOUNT CREDENTIAL</span></strong><span class="koboSpan" id="kobo.742.1"> button as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1">following</span></span><span class="No-Break"><a id="_idIndexMarker783"/></span><span class="No-Break"><span class="koboSpan" id="kobo.744.1"> screenshot:</span></span></li></ol></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer210">
<span class="koboSpan" id="kobo.745.1"><img alt="Figure ﻿9.47 – Creating AWS account credentials" src="image/B18145_09_47.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.746.1">Figure 9.47 – Creating AWS account credentials</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.747.1">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.748.1">AWS S3</span></strong><span class="koboSpan" id="kobo.749.1"> option from the </span><strong class="bold"><span class="koboSpan" id="kobo.750.1">TMC provisioned </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.751.1">storage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.752.1"> option:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer211">
<span class="koboSpan" id="kobo.753.1"><img alt="Figure ﻿9.48 – Selecting provisioned storage" src="image/B18145_09_48.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.754.1">Figure 9.48 – Selecting provisioned storage</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.755.1">Enter a name for the </span><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.756.1">account credentials and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.757.1">GENERATE </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.758.1">TEMPLATE</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.759.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer212">
<span class="koboSpan" id="kobo.760.1"><img alt="Figure ﻿9.49 – Entering a credential name and generating a template" src="image/B18145_09_49.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.761.1">Figure 9.49 – Entering a credential name and generating a template</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.762.1">A credential template file should be downloaded. </span><span class="koboSpan" id="kobo.762.2">This is an AWS CloudFormation template that creates the required S3 buckets and grants required permissions to TMC to access that bucket for backup and restoration operations. </span><span class="koboSpan" id="kobo.762.3">Save that template file on your local workstation and</span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.763.1"> click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.764.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.765.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer213">
<span class="koboSpan" id="kobo.766.1"><img alt="Figure ﻿9.50 – Downloading the generated AWS CloudFormation template" src="image/B18145_09_50.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.767.1">Figure 9.50 – Downloading the generated AWS CloudFormation template</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.768.1">Follow the </span><strong class="bold"><span class="koboSpan" id="kobo.769.1">QUICKSTART GUIDE</span></strong><span class="koboSpan" id="kobo.770.1"> link to apply the downloaded template to your AWS account. </span><span class="koboSpan" id="kobo.770.2">Once the CloudFormation template is applied, you will get the </span><strong class="bold"><span class="koboSpan" id="kobo.771.1">Amazon Resource Name</span></strong><span class="koboSpan" id="kobo.772.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.773.1">ARN</span></strong><span class="koboSpan" id="kobo.774.1">) in the output of the template execution, which will be required in the next step. </span><span class="koboSpan" id="kobo.774.2">You will find these instructions in the quick start guide as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.775.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer214">
<span class="koboSpan" id="kobo.776.1"><img alt="Figure ﻿9.51 – Following the quick start guide to create the required AWS S3 objects" src="image/B18145_09_51.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.777.1">Figure 9.51 – Following the quick start guide to create the required AWS S3 objects</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.778.1">Apply the </span><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.779.1">copied ARN from AWS after applying the CloudFormation template and click the </span><strong class="bold"><span class="koboSpan" id="kobo.780.1">CREATE</span></strong><span class="koboSpan" id="kobo.781.1"> button to finally create the account credentials that we can use for the backup and restoration operations for </span><span class="No-Break"><span class="koboSpan" id="kobo.782.1">any cluster:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer215">
<span class="koboSpan" id="kobo.783.1"><img alt="Figure ﻿9.52 – Applying the copied ARN and creating the credentials" src="image/B18145_09_52.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.784.1">Figure 9.52 – Applying the copied ARN and creating the credentials</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.785.1">Upon successful creation of the account credentials, you should see it listed under</span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.786.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.787.1">Accounts</span></strong><span class="koboSpan" id="kobo.788.1"> tab of the </span><strong class="bold"><span class="koboSpan" id="kobo.789.1">Administration</span></strong><span class="koboSpan" id="kobo.790.1"> menu as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer216">
<span class="koboSpan" id="kobo.792.1"><img alt="Figure ﻿9.53 – Verifying account credential creation" src="image/B18145_09_53.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.793.1">Figure 9.53 – Verifying account credential creation</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.794.1">Go to the </span><strong class="bold"><span class="koboSpan" id="kobo.795.1">Target locations</span></strong><span class="koboSpan" id="kobo.796.1"> tab under the </span><strong class="bold"><span class="koboSpan" id="kobo.797.1">Administration</span></strong><span class="koboSpan" id="kobo.798.1"> menu and click on </span><strong class="bold"><span class="koboSpan" id="kobo.799.1">CREATE TARGET LOCATION</span></strong><span class="koboSpan" id="kobo.800.1"> for the AWS S3 option as per the </span><span class="No-Break"><span class="koboSpan" id="kobo.801.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer217">
<span class="koboSpan" id="kobo.802.1"><img alt="Figure ﻿9.54 – Creating the target location" src="image/B18145_09_54.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.803.1">Figure 9.54 – Creating the target location</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.804.1">Select the </span><a id="_idIndexMarker788"/><span class="koboSpan" id="kobo.805.1">account credentials that we created in </span><em class="italic"><span class="koboSpan" id="kobo.806.1">step 1</span></em><span class="koboSpan" id="kobo.807.1"> of this section and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.808.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.809.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer218">
<span class="koboSpan" id="kobo.810.1"><img alt="Figure ﻿9.55 – Selecting account credentials" src="image/B18145_09_55.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.811.1">Figure 9.55 – Selecting account credentials</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.812.1">Select the cluster group that we created earlier in this chapter and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.813.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.814.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer219">
<span class="koboSpan" id="kobo.815.1"><img alt="Figure ﻿9.56 – Adding the cluster group to the target location" src="image/B18145_09_56.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.816.1">Figure 9.56 – Adding the cluster group to the target location</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.817.1">Enter</span><a id="_idIndexMarker789"/><span class="koboSpan" id="kobo.818.1"> the name of the target location and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.819.1">CREATE</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.820.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer220">
<span class="koboSpan" id="kobo.821.1"><img alt="Figure ﻿9.57 – Entering the target location name" src="image/B18145_09_57.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.822.1">Figure 9.57 – Entering the target location name</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.823.1">You</span><a id="_idIndexMarker790"/><span class="koboSpan" id="kobo.824.1"> should see a new target location created under the </span><strong class="bold"><span class="koboSpan" id="kobo.825.1">Target locations</span></strong><span class="koboSpan" id="kobo.826.1"> tab of the </span><strong class="bold"><span class="koboSpan" id="kobo.827.1">Administration</span></strong><span class="koboSpan" id="kobo.828.1"> menu along with the account credentials and the relevant S3 bucket name as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.829.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer221">
<span class="koboSpan" id="kobo.830.1"><img alt="Figure ﻿9.58 – Verifying target location creation" src="image/B18145_09_58.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.831.1">Figure 9.58 – Verifying target location creation</span></p>
<p><span class="koboSpan" id="kobo.832.1">Now, as we </span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.833.1">have set up a backup target location and assigned it to the cluster group, we can proceed to perform the backup and restoration operations for a cluster in </span><span class="No-Break"><span class="koboSpan" id="kobo.834.1">that group.</span></span></p>
<h3><span class="koboSpan" id="kobo.835.1">Enabling data protection for a cluster</span></h3>
<p><span class="koboSpan" id="kobo.836.1">After completing</span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.837.1"> the steps required to perform backup and restoration for a cluster group, let’s enable it for one of the clusters in the group. </span><span class="koboSpan" id="kobo.837.2">In this example, we will use the externally managed GKE cluster that we had attached with TMC. </span><span class="koboSpan" id="kobo.837.3">Take the following steps to complete </span><span class="No-Break"><span class="koboSpan" id="kobo.838.1">this task:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.839.1">Click on the attached cluster, </span><strong class="bold"><span class="koboSpan" id="kobo.840.1">gke-cluster-1</span></strong><span class="koboSpan" id="kobo.841.1">, in the </span><strong class="bold"><span class="koboSpan" id="kobo.842.1">tmc-demo-clusters</span></strong><span class="koboSpan" id="kobo.843.1"> group. </span><span class="koboSpan" id="kobo.843.2">If you have used names other than the ones used in this chapter, you will need to select the </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">cluster appropriately:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer222">
<span class="koboSpan" id="kobo.845.1"><img alt="Figure ﻿9.59 – Opening the attached cluster details page" src="image/B18145_09_59.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.846.1">Figure 9.59 – Opening the attached cluster details page</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.847.1">Click on </span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.848.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.849.1">ENABLE DATA PROTECTION</span></strong><span class="koboSpan" id="kobo.850.1"> link as highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.851.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer223">
<span class="koboSpan" id="kobo.852.1"><img alt="Figure ﻿9.60 – Clicking on the ENABLE DATA PROTECTION link" src="image/B18145_09_60.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.853.1">Figure 9.60 – Clicking on the ENABLE DATA PROTECTION link</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.854.1">Click on</span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.855.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.856.1">ENABLE</span></strong><span class="koboSpan" id="kobo.857.1"> button to confirm </span><span class="No-Break"><span class="koboSpan" id="kobo.858.1">the operation:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer224">
<span class="koboSpan" id="kobo.859.1"><img alt="Figure ﻿9.61 – Enabling data protection for the cluster" src="image/B18145_09_61.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.860.1">Figure 9.61 – Enabling data protection for the cluster</span></p>
<p><span class="koboSpan" id="kobo.861.1">This operation deploys Velero, an open source Kubernetes cluster backup and restoration tool. </span><span class="koboSpan" id="kobo.861.2">With this, we have prepared the cluster to take backups with the required toolset deployed</span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.862.1"> on it. </span><span class="koboSpan" id="kobo.862.2">Now, let’s deploy a test workload in </span><span class="No-Break"><span class="koboSpan" id="kobo.863.1">the cluster.</span></span></p>
<h3><span class="koboSpan" id="kobo.864.1">Deploying a custom application in the cluster</span></h3>
<p><span class="koboSpan" id="kobo.865.1">Execute the</span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.866.1"> following steps to run an nginx deployment on the cluster we enabled for backup and restoration in the </span><span class="No-Break"><span class="koboSpan" id="kobo.867.1">previous task:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.868.1">While in the targeted cluster’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.869.1">kubectl</span></strong><span class="koboSpan" id="kobo.870.1"> context, run the following command, which creates a namespace named </span><strong class="source-inline"><span class="koboSpan" id="kobo.871.1">nginx</span></strong><span class="koboSpan" id="kobo.872.1"> and a Kubernetes deployment named </span><strong class="source-inline"><span class="koboSpan" id="kobo.873.1">nginx-deployment</span></strong><span class="koboSpan" id="kobo.874.1"> with three Pods running. </span><span class="koboSpan" id="kobo.874.2">You can check the deployment manifest file used in the following command to get </span><span class="No-Break"><span class="koboSpan" id="kobo.875.1">more details:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.876.1">
$ kubectl apply -f https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/nginx-deployment.yaml</span></pre></li>
<li><span class="koboSpan" id="kobo.877.1">Verify the deployment using the TMC portal under the </span><strong class="bold"><span class="koboSpan" id="kobo.878.1">Workloads</span></strong><span class="koboSpan" id="kobo.879.1"> tab of the cluster details page. </span><span class="koboSpan" id="kobo.879.2">As you can see in the following screen, the nginx deployment and ReplicaSet are running with a </span><strong class="bold"><span class="koboSpan" id="kobo.880.1">Healthy</span></strong><span class="koboSpan" id="kobo.881.1"> status. </span><span class="koboSpan" id="kobo.881.2">To minimize the clutter on the screen, you can also filter Tanzu and Kubernetes-specific workloads using the switches </span><span class="No-Break"><span class="koboSpan" id="kobo.882.1">as highlighted:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer225">
<span class="koboSpan" id="kobo.883.1"><img alt="Figure ﻿9.62 – Verifying workload deployment for a cluster" src="image/B18145_09_62.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.884.1">Figure 9.62 – Verifying workload deployment for a cluster</span></p>
<p><span class="koboSpan" id="kobo.885.1">Now, we have a workload deployed in its own namespace on a target cluster that can be backed up. </span><span class="koboSpan" id="kobo.885.2">Let’s make </span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.886.1">a backup of the cluster using the </span><span class="No-Break"><span class="koboSpan" id="kobo.887.1">following steps.</span></span></p>
<h3><span class="koboSpan" id="kobo.888.1">Backing up a cluster</span></h3>
<p><span class="koboSpan" id="kobo.889.1">Take the following</span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.890.1"> steps to take a backup of the cluster where we deployed the nginx workload in the </span><span class="No-Break"><span class="koboSpan" id="kobo.891.1">previous task:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.892.1">On the cluster’s </span><strong class="bold"><span class="koboSpan" id="kobo.893.1">Overview</span></strong><span class="koboSpan" id="kobo.894.1"> tab, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.895.1">CREATE BACKUP</span></strong><span class="koboSpan" id="kobo.896.1"> link as highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.897.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer226">
<span class="koboSpan" id="kobo.898.1"><img alt="Figure ﻿9.63 – Initiating the cluster backup process" src="image/B18145_09_63.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.899.1">Figure 9.63 – Initiating the cluster backup process</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.900.1">Select the option to make a backup of the entire cluster and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.901.1">NEXT</span></strong><span class="koboSpan" id="kobo.902.1"> button. </span><span class="koboSpan" id="kobo.902.2">We can also make a backup only of selected namespaces or selected objects identified using a label value, which is a very </span><span class="No-Break"><span class="koboSpan" id="kobo.903.1">flexible choice:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer227">
<span class="koboSpan" id="kobo.904.1"><img alt="Figure ﻿9.64 – Selecting the backup scope" src="image/B18145_09_64.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.905.1">Figure 9.64 – Selecting the backup scope</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.906.1">Select the backup target location that we created previously in this chapter pointing to an </span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.907.1">AWS S3 bucket and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.908.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.909.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer228">
<span class="koboSpan" id="kobo.910.1"><img alt="Figure ﻿9.65 – Selecting the backup target location" src="image/B18145_09_65.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.911.1">Figure 9.65 – Selecting the backup target location</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.912.1">Select the backup schedule. </span><span class="koboSpan" id="kobo.912.2">While we can create a regular backup schedule, here, we will select </span><strong class="bold"><span class="koboSpan" id="kobo.913.1">NOW</span></strong><span class="koboSpan" id="kobo.914.1"> to make an on-demand backup to learn about the concept. </span><span class="koboSpan" id="kobo.914.2">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.915.1">NEXT</span></strong><span class="koboSpan" id="kobo.916.1"> button to move on </span><span class="No-Break"><span class="koboSpan" id="kobo.917.1">after that:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer229">
<span class="koboSpan" id="kobo.918.1"><img alt="Figure ﻿9.66 – Selecting the backup schedule" src="image/B18145_09_66.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.919.1">Figure 9.66 – Selecting the backup schedule</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.920.1">Enter the</span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.921.1"> backup </span><strong class="bold"><span class="koboSpan" id="kobo.922.1">Retention (days)</span></strong><span class="koboSpan" id="kobo.923.1"> value and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.924.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.925.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer230">
<span class="koboSpan" id="kobo.926.1"><img alt="Figure ﻿9.67 – Entering the backup retention days" src="image/B18145_09_67.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.927.1">Figure 9.67 – Entering the backup retention days</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.928.1">Finally, enter the backup’s name and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.929.1">CREATE</span></strong><span class="koboSpan" id="kobo.930.1"> button as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.931.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer231">
<span class="koboSpan" id="kobo.932.1"><img alt="Figure ﻿9.68 – Entering the backup name" src="image/B18145_09_68.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.933.1">Figure 9.68 – Entering the backup name</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.934.1">This will </span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.935.1">trigger the backup process and within 2 to 5 minutes, you should be able to see the backup completed under the </span><strong class="bold"><span class="koboSpan" id="kobo.936.1">Data protection</span></strong><span class="koboSpan" id="kobo.937.1"> tab of the cluster as shown in the following screenshot. </span><span class="koboSpan" id="kobo.937.2">The backup process may take more time if the cluster has other </span><span class="No-Break"><span class="koboSpan" id="kobo.938.1">workloads running:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer232">
<span class="koboSpan" id="kobo.939.1"><img alt="Figure ﻿9.69 – Verifying backup completion" src="image/B18145_09_69.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.940.1">Figure 9.69 – Verifying backup completion</span></p>
<p><span class="koboSpan" id="kobo.941.1">After successfully making a backup of the cluster, let’s now restore it – but before we restore it, let’s </span><em class="italic"><span class="koboSpan" id="kobo.942.1">accidentally</span></em><span class="koboSpan" id="kobo.943.1"> delete the </span><strong class="bold"><span class="koboSpan" id="kobo.944.1">nginx</span></strong><span class="koboSpan" id="kobo.945.1"> namespace that contains the nginx deployment </span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.946.1">we created earlier before making </span><span class="No-Break"><span class="koboSpan" id="kobo.947.1">the backup.</span></span></p>
<h3><span class="koboSpan" id="kobo.948.1">Deleting a custom deployment running on the cluster</span></h3>
<p><span class="koboSpan" id="kobo.949.1">Take the</span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.950.1"> following steps to perform </span><span class="No-Break"><span class="koboSpan" id="kobo.951.1">this task:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.952.1">Run the following command to delete the </span><strong class="bold"><span class="koboSpan" id="kobo.953.1">nginx</span></strong><span class="koboSpan" id="kobo.954.1"> namespace from the </span><span class="No-Break"><span class="koboSpan" id="kobo.955.1">targeted cluster:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.956.1">
$ kubectl delete namespace nginx</span></pre></li>
<li><span class="koboSpan" id="kobo.957.1">Verify the absence of the nginx deployment in the </span><strong class="bold"><span class="koboSpan" id="kobo.958.1">Workloads</span></strong><span class="koboSpan" id="kobo.959.1"> tab of the cluster. </span><span class="koboSpan" id="kobo.959.2">As you can see, </span><strong class="bold"><span class="koboSpan" id="kobo.960.1">nginx-deployment</span></strong><span class="koboSpan" id="kobo.961.1"> and its corresponding ReplicaSet that we verified previously are </span><span class="No-Break"><span class="koboSpan" id="kobo.962.1">now missing:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer233">
<span class="koboSpan" id="kobo.963.1"><img alt="Figure ﻿9.70 – Verifying the workload deletion" src="image/B18145_09_70.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.964.1">Figure 9.70 – Verifying the workload deletion</span></p>
<p><span class="koboSpan" id="kobo.965.1">Now, as we have </span><em class="italic"><span class="koboSpan" id="kobo.966.1">accidentally</span></em><span class="koboSpan" id="kobo.967.1"> deleted the entire namespace and the workloads running in that namespace to simulate a disaster situation, let’s use the backup we made for the cluster to </span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.968.1">restore the deleted namespace and get its objects back up </span><span class="No-Break"><span class="koboSpan" id="kobo.969.1">and running.</span></span></p>
<h3><span class="koboSpan" id="kobo.970.1">Restoring the cluster backup</span></h3>
<p><span class="koboSpan" id="kobo.971.1">Take the </span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.972.1">following steps to restore the backup of the targeted cluster and bring back the deleted Kubernetes objects in </span><span class="No-Break"><span class="koboSpan" id="kobo.973.1">that cluster:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.974.1">Go to the </span><strong class="bold"><span class="koboSpan" id="kobo.975.1">Data protection</span></strong><span class="koboSpan" id="kobo.976.1"> tab of the cluster, select the backup that we took previously from the </span><strong class="bold"><span class="koboSpan" id="kobo.977.1">Backups</span></strong><span class="koboSpan" id="kobo.978.1"> list, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.979.1">RESTORE</span></strong><span class="koboSpan" id="kobo.980.1"> link as highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.981.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer234">
<span class="koboSpan" id="kobo.982.1"><img alt="Figure ﻿9.71 – Restoring a backup" src="image/B18145_09_71.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.983.1">Figure 9.71 – Restoring a backup</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.984.1">Since we had only one namespace deleted, we will just restore that one by selecting the highlighted option to restore specific namespaces. </span><span class="koboSpan" id="kobo.984.2">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.985.1">nginx</span></strong><span class="koboSpan" id="kobo.986.1"> namespace from the list of what we need to restore. </span><span class="koboSpan" id="kobo.986.2">Here, TMC also allows us to restore the source namespace from the backup to a different target namespace if that is intended. </span><span class="koboSpan" id="kobo.986.3">This can be done using the little pencil icon beside the target namespace caption. </span><span class="koboSpan" id="kobo.986.4">After selecting the namespace, click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.987.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.988.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer235">
<span class="koboSpan" id="kobo.989.1"><img alt="Figure ﻿9.72 – Selecting the Restore backup specification" src="image/B18145_09_72.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.990.1">Figure 9.72 – Selecting the Restore backup specification</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.991.1">Enter a</span><a id="_idIndexMarker806"/><span class="koboSpan" id="kobo.992.1"> name for the restored instance and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.993.1">RESTORE</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.994.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer236">
<span class="koboSpan" id="kobo.995.1"><img alt="Figure ﻿9.73 – Entering a restore instance name" src="image/B18145_09_73.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.996.1">Figure 9.73 – Entering a restore instance name</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.997.1">Upon successful restoration, you will see a restored entry in the </span><strong class="bold"><span class="koboSpan" id="kobo.998.1">Data protection</span></strong><span class="koboSpan" id="kobo.999.1"> tab of the cluster under the </span><strong class="bold"><span class="koboSpan" id="kobo.1000.1">Restores</span></strong><span class="koboSpan" id="kobo.1001.1"> section as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1002.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer237">
<span class="koboSpan" id="kobo.1003.1"><img alt="Figure ﻿9.74 – Verifying that the restoration has completed" src="image/B18145_09_74.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1004.1">Figure 9.74 – Verifying that the restoration has completed</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1005.1">Verify the</span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.1006.1"> presence of the </span><strong class="bold"><span class="koboSpan" id="kobo.1007.1">nginx</span></strong><span class="koboSpan" id="kobo.1008.1"> namespace and its objects under the </span><strong class="bold"><span class="koboSpan" id="kobo.1009.1">Workloads</span></strong><span class="koboSpan" id="kobo.1010.1"> tab of the cluster details page. </span><span class="koboSpan" id="kobo.1010.2">As you can see, the </span><strong class="bold"><span class="koboSpan" id="kobo.1011.1">nginx</span></strong><span class="koboSpan" id="kobo.1012.1"> namespace has now been </span><span class="No-Break"><span class="koboSpan" id="kobo.1013.1">restored successfully:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer238">
<span class="koboSpan" id="kobo.1014.1"><img alt="Figure 9.75 – Verifying the presence of the restored objects " src="image/B18145_09_75.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1015.1">Figure 9.75 – Verifying the presence of the restored objects</span></p>
<p><span class="koboSpan" id="kobo.1016.1">With this, we can conclude our very long but important section on backing up and restoring Kubernetes clusters. </span><span class="koboSpan" id="kobo.1016.2">It is worth noting that several configurations made in this section were one-time activities. </span><span class="koboSpan" id="kobo.1016.3">This includes creating AWS S3 account credentials, creating a target location of the backup, and associating a target location with a cluster group, among </span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.1017.1">other things. </span><span class="koboSpan" id="kobo.1017.2">Once this setup is done, backing up and restoring a cluster or a part of the cluster only takes a </span><span class="No-Break"><span class="koboSpan" id="kobo.1018.1">few clicks.</span></span></p>
<p><span class="koboSpan" id="kobo.1019.1">Let’s now look into another very important capability of TMC – </span><span class="No-Break"><span class="koboSpan" id="kobo.1020.1">policy management.</span></span></p>
<h1 id="_idParaDest-186"><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.1021.1">Applying governance policies to clusters using TMC</span></h1>
<p><span class="koboSpan" id="kobo.1022.1">In the previous</span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.1023.1"> section of the chapter, we learned how to get started with TMC by registering a TKG management cluster, creating a TKG workload cluster, attaching a GKE cluster, and finally, grouping them – but why do we bring all the clusters to TMC? </span><span class="koboSpan" id="kobo.1023.2">In this section, we will check this out by performing various activities with these clusters using the TMC interface. </span><span class="koboSpan" id="kobo.1023.3">We will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1">following activities:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1025.1">Configuring a security policy for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1026.1">cluster group</span></span></li>
<li><span class="koboSpan" id="kobo.1027.1">Configuring an image registry governance policy for </span><span class="No-Break"><span class="koboSpan" id="kobo.1028.1">a Workspace</span></span></li>
<li><span class="koboSpan" id="kobo.1029.1">Configuring a deployment governance policy for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1030.1">cluster group</span></span></li>
<li><span class="koboSpan" id="kobo.1031.1">Checking policy violation status </span><span class="No-Break"><span class="koboSpan" id="kobo.1032.1">for clusters</span></span></li>
<li><span class="koboSpan" id="kobo.1033.1">Inspecting a cluster for CIS </span><span class="No-Break"><span class="koboSpan" id="kobo.1034.1">benchmark compliance</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1035.1">This is a long list of activities to cover in this section. </span><span class="koboSpan" id="kobo.1035.2">Let’s knock them off one </span><span class="No-Break"><span class="koboSpan" id="kobo.1036.1">by one.</span></span></p>
<h2 id="_idParaDest-187"><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.1037.1">Configuring a security policy for a cluster group</span></h2>
<p><span class="koboSpan" id="kobo.1038.1">When it comes </span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.1039.1">to running containers, several things can be misconfigured from a security point of view, which keeps the door open for hackers to leverage these. </span><span class="koboSpan" id="kobo.1039.2">Depending on the nature of the workloads running on the cluster, a Kubernetes administrator may need to secure several things. </span><span class="koboSpan" id="kobo.1039.3">In this world of microservices, the Kubernetes platform team often needs to allow different teams to deploy their apps with their own configurations required by the apps. </span><span class="koboSpan" id="kobo.1039.4">However, ensuring that all the teams follow the required security practices outlined by the platform team can be a very difficult task. </span><span class="koboSpan" id="kobo.1039.5">That is why Kubernetes administrators need to guardrail their clusters so that they do not allow workloads to be deployed in unsecured ways. </span><span class="koboSpan" id="kobo.1039.6">To address this need, Kubernetes offers a construct</span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.1040.1"> called </span><strong class="bold"><span class="koboSpan" id="kobo.1041.1">PodSecurityPolicy</span></strong><span class="koboSpan" id="kobo.1042.1">, which defines what a Pod can and </span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.1043.1">cannot do in the Kubernetes cluster with a PodSecurityPolicy in effect. </span><span class="koboSpan" id="kobo.1043.2">TMC allows you to configure these security policies for a group of clusters so that there is no chance of configuration drifts </span><span class="No-Break"><span class="koboSpan" id="kobo.1044.1">between clusters.</span></span></p>
<p><span class="koboSpan" id="kobo.1045.1">Let’s create one such security policy for the cluster group that we previously created. </span><span class="koboSpan" id="kobo.1045.2">This policy will prevent any Pod from gaining privileged access to the Kubernetes node’s operating system and resources. </span><span class="koboSpan" id="kobo.1045.3">The following steps will help create and test </span><span class="No-Break"><span class="koboSpan" id="kobo.1046.1">this policy:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.1047.1">Ensure that a privileged access Pod can be deployed before applying the policy, taking the </span><span class="No-Break"><span class="koboSpan" id="kobo.1048.1">following substeps:</span></span><ol><li><span class="koboSpan" id="kobo.1049.1">Deploy a privileged Pod in the TKG workload cluster under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1050.1">tmc-demo-clusters</span></strong><span class="koboSpan" id="kobo.1051.1"> group using the following command. </span><span class="koboSpan" id="kobo.1051.2">You can check the Pod definition file used in the following command – notice that the security context is defined there to enable the Pod to get </span><span class="No-Break"><span class="koboSpan" id="kobo.1052.1">privileged access:</span></span></li></ol><pre class="source-code"><span class="koboSpan" id="kobo.1053.1">
$ kubectl apply -f https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/privileged-pod.yaml</span></pre><ol><li value="2"><span class="koboSpan" id="kobo.1054.1">Verify whether the Pod has been created and is running successfully. </span><span class="koboSpan" id="kobo.1054.2">Here, it is assumed that there is no security policy in place that would prevent a privileged Pod from </span><span class="No-Break"><span class="koboSpan" id="kobo.1055.1">being created:</span></span></li></ol><pre class="source-code"><span class="koboSpan" id="kobo.1056.1">
$ kubectl get pod</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1057.1">
NAME             READY   STATUS    RESTARTS   AGE</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1058.1">
privileged-pod   1/1     Running   0          48s</span></pre></li>
<li><span class="koboSpan" id="kobo.1059.1">After verifying that we can run a privileged Pod in the cluster, let’s now create a security </span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.1060.1">policy</span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.1061.1"> in TMC for the cluster group using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1062.1">following substeps:</span></span><ol><li><span class="koboSpan" id="kobo.1063.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.1064.1">Policies</span></strong><span class="koboSpan" id="kobo.1065.1"> &gt; </span><strong class="bold"><span class="koboSpan" id="kobo.1066.1">Assignments</span></strong><span class="koboSpan" id="kobo.1067.1"> menu from the left-hand navigation bar and the </span><strong class="bold"><span class="koboSpan" id="kobo.1068.1">Security</span></strong><span class="koboSpan" id="kobo.1069.1"> tab. </span><span class="koboSpan" id="kobo.1069.2">Then, click on the cluster group, </span><strong class="bold"><span class="koboSpan" id="kobo.1070.1">tmc-demo-clusters</span></strong><span class="koboSpan" id="kobo.1071.1">, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1072.1">CREATE SECURITY POLICY</span></strong><span class="koboSpan" id="kobo.1073.1"> button as highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1074.1">following screenshot:</span></span></li></ol></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer239">
<span class="koboSpan" id="kobo.1075.1"><img alt="Figure ﻿9.76 – Creating a security policy for a cluster group" src="image/B18145_09_76.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1076.1">Figure 9.76 – Creating a security policy for a cluster group</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1077.1">TMC allows you to fully customize your security requirements by defining a custom security policy from scratch. </span><span class="koboSpan" id="kobo.1077.2">However, it also provides two out-of-the-box choices: </span><strong class="bold"><span class="koboSpan" id="kobo.1078.1">Baseline</span></strong><span class="koboSpan" id="kobo.1079.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1080.1">Strict</span></strong><span class="koboSpan" id="kobo.1081.1">. </span><span class="koboSpan" id="kobo.1081.2">Let’s select </span><strong class="bold"><span class="koboSpan" id="kobo.1082.1">Baseline</span></strong><span class="koboSpan" id="kobo.1083.1"> from the </span><strong class="bold"><span class="koboSpan" id="kobo.1084.1">Security template</span></strong><span class="koboSpan" id="kobo.1085.1"> dropdown. </span><span class="koboSpan" id="kobo.1085.2">You will notice that it restricts the creation of privileged containers as highlighted in the following screenshot. </span><span class="koboSpan" id="kobo.1085.3">Finally, click on</span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.1086.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.1087.1">CREATE POLICY</span></strong><span class="koboSpan" id="kobo.1088.1"> button</span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.1089.1"> to apply the restrictions to the relevant </span><span class="No-Break"><span class="koboSpan" id="kobo.1090.1">cluster group:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer240">
<span class="koboSpan" id="kobo.1091.1"><img alt="Figure ﻿9.77 – Entering the security policy configuration" src="image/B18145_09_77.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1092.1">Figure 9.77 – Entering the security policy configuration</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1093.1">You will see the policy listed for the cluster group as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1094.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer241">
<span class="koboSpan" id="kobo.1095.1"><img alt="Figure ﻿9.78 – Verifying security policy creation" src="image/B18145_09_78.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1096.1">Figure 9.78 – Verifying security policy creation</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1097.1">Let’s now verify whether the policy has been applied to the clusters in the group. </span><span class="koboSpan" id="kobo.1097.2">Take the following substeps to </span><span class="No-Break"><span class="koboSpan" id="kobo.1098.1">do so:</span></span><ol><li><span class="koboSpan" id="kobo.1099.1">First, delete the Pod we created in the first step in the TKG workload cluster by running </span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.1100.1">the </span><a id="_idIndexMarker818"/><span class="No-Break"><span class="koboSpan" id="kobo.1101.1">following command:</span></span></li></ol><pre class="source-code"><span class="koboSpan" id="kobo.1102.1">
$ kubectl delete pod privileged-pod</span></pre><ol><li value="2"><span class="koboSpan" id="kobo.1103.1">Create the same Pod again by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.1104.1">following command:</span></span></li></ol><pre class="source-code"><span class="koboSpan" id="kobo.1105.1">
$ kubectl apply -f https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/privileged-pod.yaml</span></pre><ol><li value="3"><span class="koboSpan" id="kobo.1106.1">You will see an error message as follows, explaining that the Pod could not successfully be created because of the security policy </span><span class="No-Break"><span class="koboSpan" id="kobo.1107.1">in place:</span></span></li></ol><pre class="source-code"><span class="koboSpan" id="kobo.1108.1">
Error from server ([tmc.cgp.tmc-security-policy-demo] Privileged container is not allowed: centos, securityContext: {"privileged": true}): error when creating "https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/privileged-pod.yaml": admission webhook "validation.gatekeeper.sh" denied the request: [tmc.cgp.tmc-security-policy-demo] Privileged container is not allowed: centos, securityContext: {"privileged": true}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.1109.1">That concludes our learning on how to configure a Kubernetes cluster security policy applicable to deploying and running workloads using TMC. </span><span class="koboSpan" id="kobo.1109.2">We tested one of the clusters in the cluster group to which we applied the policy, but you can also do the same exercise for another cluster in the group and should see similar test results. </span><span class="koboSpan" id="kobo.1109.3">Like the one explained here for running privileged containers, we can create several different types of security policies using TMC for a cluster group. </span><span class="koboSpan" id="kobo.1109.4">Let’s now learn how to apply a Workspace-level policy that defines how the workloads running in the specific cluster namespaces can</span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.1110.1"> pull container images from a</span><a id="_idIndexMarker820"/> <span class="No-Break"><span class="koboSpan" id="kobo.1111.1">container registry.</span></span></p>
<h2 id="_idParaDest-188"><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.1112.1">Configuring an image registry policy for a Workspace</span></h2>
<p><span class="koboSpan" id="kobo.1113.1">When it comes to </span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.1114.1">pulling container images from a container registry, several proven practices are recommended. </span><span class="koboSpan" id="kobo.1114.2">The restrictions applicable to pulling images for regulatory environments could be more stringent. </span><span class="koboSpan" id="kobo.1114.3">The following are the parameters that TMC allows you to configure for a container registry policy depending on different compliance requirements. </span><span class="koboSpan" id="kobo.1114.4">A registry policy in TMC may either have all or some parameters applicable </span><span class="No-Break"><span class="koboSpan" id="kobo.1115.1">as required:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1116.1">Pulling images only using a digest (SHA) and not with a tag</span></strong><span class="koboSpan" id="kobo.1117.1"> – This is an important rule to set up for a production environment, as a tag could technically have different content for different pull instances, whereas the content of an image for the same digest will always be the same. </span><span class="koboSpan" id="kobo.1117.2">Pulling images using their digest will give you the confidence that they will always have the same </span><span class="No-Break"><span class="koboSpan" id="kobo.1118.1">bits inside.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1119.1">Pulling images only from a certain image repository</span></strong><span class="koboSpan" id="kobo.1120.1"> – If there is a requirement that a container can only pull images from an internally hosted container registry, this rule </span><span class="No-Break"><span class="koboSpan" id="kobo.1121.1">can help.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1122.1">Allowing images with a specific prefix or patterns using wildcard characters</span></strong><span class="koboSpan" id="kobo.1123.1"> – If you only want to permit images to be pulled for a specific project, then you can set up a criterion such as allowing images </span><span class="No-Break"><span class="koboSpan" id="kobo.1124.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1">myapp/*</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1126.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1127.1">Allowing images with specific tag values</span></strong><span class="koboSpan" id="kobo.1128.1"> – This is like the previous rule but applicable to </span><span class="No-Break"><span class="koboSpan" id="kobo.1129.1">tag names.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1130.1">In this section, we will learn how to configure a policy that requires image pulls only with digest and not with tags. </span><span class="koboSpan" id="kobo.1130.2">The following are the steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.1131.1">do so:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.1132.1">Go to the </span><strong class="bold"><span class="koboSpan" id="kobo.1133.1">Policies</span></strong><span class="koboSpan" id="kobo.1134.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.1135.1">Assignment</span></strong><span class="koboSpan" id="kobo.1136.1"> menu from the left-hand navigation bar and select the </span><strong class="bold"><span class="koboSpan" id="kobo.1137.1">Image registry</span></strong><span class="koboSpan" id="kobo.1138.1"> tab. </span><span class="koboSpan" id="kobo.1138.2">From there, select the Workspace we have previously created and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1139.1">CREATE IMAGE REGISTRY POLICY</span></strong><span class="koboSpan" id="kobo.1140.1"> button</span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.1141.1"> as highlighted in the</span><a id="_idIndexMarker823"/> <span class="No-Break"><span class="koboSpan" id="kobo.1142.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer242">
<span class="koboSpan" id="kobo.1143.1"><img alt="Figure ﻿9.79 – Creating an image registry policy" src="image/B18145_09_79.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1144.1">Figure 9.79 – Creating an image registry policy</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1145.1">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.1146.1">Require Digest</span></strong><span class="koboSpan" id="kobo.1147.1"> option from the </span><strong class="bold"><span class="koboSpan" id="kobo.1148.1">Image registry template</span></strong><span class="koboSpan" id="kobo.1149.1"> dropdown, provide a policy name, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1150.1">CREATE </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1151.1">POLICY</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1152.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer243">
<span class="koboSpan" id="kobo.1153.1"><img alt="Figure ﻿9.80 – Entering image registry policy details" src="image/B18145_09_80.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1154.1">Figure 9.80 – Entering image registry policy details</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1155.1">You can</span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.1156.1"> see</span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.1157.1"> the new image registry policy created for the selected Workspace as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1158.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer244">
<span class="koboSpan" id="kobo.1159.1"><img alt="Figure ﻿9.81 – Verifying the creation of the image registry policy" src="image/B18145_09_81.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1160.1">Figure 9.81 – Verifying the creation of the image registry policy</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1161.1">Create a Pod in the GKE-attached cluster in a new namespace that is not affected by the policy. </span><span class="koboSpan" id="kobo.1161.2">This Pod pulls an image using a tag. </span><span class="koboSpan" id="kobo.1161.3">The Pod definition YAML file is given </span><span class="No-Break"><span class="koboSpan" id="kobo.1162.1">at </span></span><a href=""><span class="No-Break"><span class="koboSpan" id="kobo.1163.1">https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/image-tag-using-pod.yaml</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1164.1">:</span></span><ol><li><span class="koboSpan" id="kobo.1165.1">Create</span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.1166.1"> a new namespace </span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.1167.1">in the cluster using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1168.1">following command:</span></span></li></ol><pre class="source-code"><span class="koboSpan" id="kobo.1169.1">
$ kubectl create namespace test-registry-policy</span></pre><ol><li value="2"><span class="koboSpan" id="kobo.1170.1">Create the Pod that uses a tagged </span><span class="No-Break"><span class="koboSpan" id="kobo.1171.1">image pull:</span></span></li></ol><pre class="source-code"><span class="koboSpan" id="kobo.1172.1">
$ kubectl apply -f https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/image-tag-using-pod.yaml -n test-registry-policy</span></pre></li>
<li><span class="koboSpan" id="kobo.1173.1">You will see that the Pod is being created without </span><span class="No-Break"><span class="koboSpan" id="kobo.1174.1">any issues:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1175.1">
NAME                  READY   STATUS    RESTARTS   AGE</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1176.1">
image-tag-using-pod   1/1     Running   0          7s</span></pre></li>
<li><span class="koboSpan" id="kobo.1177.1">Create the same Pod in the </span><strong class="bold"><span class="koboSpan" id="kobo.1178.1">default</span></strong><span class="koboSpan" id="kobo.1179.1"> namespace where we have applied the image registry policy that does not allow you to pull an image with a tag value using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1180.1">following command:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1181.1">
$ kubectl apply -f https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/image-tag-using-pod.yaml</span></pre></li>
<li><span class="koboSpan" id="kobo.1182.1">You will see that the Pod cannot be created, with the following error message explaining</span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.1183.1"> the restrictions </span><a id="_idIndexMarker829"/><span class="No-Break"><span class="koboSpan" id="kobo.1184.1">in place:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1185.1">
Error from server ([tmc.wsp.default.tmc-image-registry-policy-demo] container &lt;busybox&gt; has an invalid image reference &lt;busybox:stable-uclibc&gt;. </span><span class="koboSpan" id="kobo.1185.2">allowed image patterns are: {hostname: [], image name: [] and require digest}): error when creating "image-tag-useing-pod.yaml": admission webhook "validation.gatekeeper.sh" denied the request: [tmc.wsp.default.tmc-image-registry-policy-demo] container &lt;busybox&gt; has an invalid image reference &lt;busybox:stable-uclibc&gt;. </span><span class="koboSpan" id="kobo.1185.3">allowed image patterns are: {hostname: [], image name: [] and require digest}</span></pre></li>
<li><span class="koboSpan" id="kobo.1186.1">Create the same Pod with a digest replacing the tag for the image using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1187.1">following command:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1188.1">
$ kubectl apply -f https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/image-digest-using-pod.yaml</span></pre></li>
<li><span class="koboSpan" id="kobo.1189.1">You will see that the Pod is created successfully this time in the </span><strong class="bold"><span class="koboSpan" id="kobo.1190.1">default</span></strong><span class="koboSpan" id="kobo.1191.1"> namespace where the image policy restrictions </span><span class="No-Break"><span class="koboSpan" id="kobo.1192.1">are applicable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1193.1">
NAME                     READY   STATUS    RESTARTS   AGE</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1194.1">
image-digest-using-pod   1/1     Running   0          3s</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.1195.1">This concludes the topic of learning how to create a policy that is applicable to a Workspace. </span><span class="koboSpan" id="kobo.1195.2">The previously configured and tested restrictions will also be applicable in the other cluster’s </span><strong class="bold"><span class="koboSpan" id="kobo.1196.1">default</span></strong><span class="koboSpan" id="kobo.1197.1"> namespace, being part of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1198.1">same Workspace.</span></span></p>
<p><span class="koboSpan" id="kobo.1199.1">In the next topic, we</span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.1200.1"> will learn how to apply a deployment governance policy for a cluster group </span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1">using TMC.</span></span></p>
<h2 id="_idParaDest-189"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.1202.1">Configuring a deployment governance policy for a cluster group</span></h2>
<p><span class="koboSpan" id="kobo.1203.1">In the majority of</span><a id="_idIndexMarker831"/><span class="koboSpan" id="kobo.1204.1"> Kubernetes platform deployments, a platform team is responsible for ensuring that their internal customers, the application teams, use the platform with discipline. </span><span class="koboSpan" id="kobo.1204.2">This discipline involves the fair usage of the computes available and high-availability-prone application deployments. </span><span class="koboSpan" id="kobo.1204.3">When multiple different Kubernetes platform teams are managing a smaller number of clusters, it will be challenging to implement a set of standards that are applicable enterprise-wide, as all the platform teams may have their own likes and dislikes. </span><span class="koboSpan" id="kobo.1204.4">On the other hand, if a central management team </span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.1205.1">manages all the clusters, it would be too much to ensure compliance with the governing policies. </span><span class="koboSpan" id="kobo.1205.2">To address these challenges, TMC allows you to create deployment governance policies. </span><span class="koboSpan" id="kobo.1205.3">TMC uses an open source project </span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.1206.1">named </span><strong class="bold"><span class="koboSpan" id="kobo.1207.1">Open Policy Agent</span></strong><span class="koboSpan" id="kobo.1208.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1209.1">OPA</span></strong><span class="koboSpan" id="kobo.1210.1">) </span><strong class="bold"><span class="koboSpan" id="kobo.1211.1">Gatekeeper</span></strong><span class="koboSpan" id="kobo.1212.1"> (</span><a href=""><span class="koboSpan" id="kobo.1213.1">https://github.com/open-policy-agent/gatekeeper</span></a><span class="koboSpan" id="kobo.1214.1">) to implement these policies. </span><span class="koboSpan" id="kobo.1214.2">Because </span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.1215.1">of the declarative nature of the Gatekeeper policy configuration, TMC also allows you to create custom deployment policies for any use case – the sky is </span><span class="No-Break"><span class="koboSpan" id="kobo.1216.1">the limit!</span></span></p>
<p><span class="koboSpan" id="kobo.1217.1">The following are some of the out-of-the-box policies that TMC provides that can be applied to different cluster groups </span><span class="No-Break"><span class="koboSpan" id="kobo.1218.1">as required:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1219.1">Blocking the creation of certain </span><span class="No-Break"><span class="koboSpan" id="kobo.1220.1">Kubernetes resources</span></span></li>
<li><span class="koboSpan" id="kobo.1221.1">Mandating the assignment of labels to certain </span><span class="No-Break"><span class="koboSpan" id="kobo.1222.1">Kubernetes resources</span></span></li>
<li><span class="koboSpan" id="kobo.1223.1">Blocking specific subjects from being used for role binding </span><span class="No-Break"><span class="koboSpan" id="kobo.1224.1">in clusters</span></span></li>
<li><span class="koboSpan" id="kobo.1225.1">Restricting the usage of certain load balancer IP addresses to be used by </span><span class="No-Break"><span class="koboSpan" id="kobo.1226.1">Kubernetes services</span></span></li>
<li><span class="koboSpan" id="kobo.1227.1">Enforcing HTTPS for the ingress resource configuration </span><span class="No-Break"><span class="koboSpan" id="kobo.1228.1">in clusters</span></span></li>
<li><span class="koboSpan" id="kobo.1229.1">Blocking the creation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1230.1">NodePort</span></strong><span class="koboSpan" id="kobo.1231.1">-type services </span><span class="No-Break"><span class="koboSpan" id="kobo.1232.1">in clusters</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1233.1">Let’s learn how to create one such governing policy for the cluster group that we created earlier and test its impact on the cluster operations. </span><span class="koboSpan" id="kobo.1233.2">In the following example, we will create a policy to prevent the creation of a Pod without a label named </span><em class="italic"><span class="koboSpan" id="kobo.1234.1">app</span></em><span class="koboSpan" id="kobo.1235.1">. </span><span class="koboSpan" id="kobo.1235.2">In other words, creating a Pod in the cluster, where this policy is applied, should fail if that Pod does not specify the name of the application it </span><span class="No-Break"><span class="koboSpan" id="kobo.1236.1">belongs to.</span></span></p>
<p><span class="koboSpan" id="kobo.1237.1">Take the following steps to create and test </span><span class="No-Break"><span class="koboSpan" id="kobo.1238.1">this policy:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.1239.1">Go to the </span><strong class="bold"><span class="koboSpan" id="kobo.1240.1">Policies</span></strong><span class="koboSpan" id="kobo.1241.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.1242.1">Assignments</span></strong><span class="koboSpan" id="kobo.1243.1"> menu from the left-hand navigation bar and open the </span><strong class="bold"><span class="koboSpan" id="kobo.1244.1">Custom</span></strong><span class="koboSpan" id="kobo.1245.1"> tab. </span><span class="koboSpan" id="kobo.1245.2">Then, select the cluster group we created from the list and</span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.1246.1"> click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1247.1">CREATE CUSTOM POLICY</span></strong><span class="koboSpan" id="kobo.1248.1"> button </span><a id="_idIndexMarker836"/><span class="No-Break"><span class="koboSpan" id="kobo.1249.1">as highlighted:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer245">
<span class="koboSpan" id="kobo.1250.1"><img alt="Figure ﻿9.82 – Creating a custom deployment policy" src="image/B18145_09_82.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1251.1">Figure 9.82 – Creating a custom deployment policy</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1252.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.1253.1">tmc-require-labels</span></strong><span class="koboSpan" id="kobo.1254.1"> from the </span><strong class="bold"><span class="koboSpan" id="kobo.1255.1">Custom policy</span></strong><span class="koboSpan" id="kobo.1256.1"> dropdown, provide a name for the policy, select </span><strong class="bold"><span class="koboSpan" id="kobo.1257.1">Pod</span></strong><span class="koboSpan" id="kobo.1258.1"> as the target resource to which to apply the policy, and add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1259.1">app</span></strong><span class="koboSpan" id="kobo.1260.1"> as a required key under </span><strong class="bold"><span class="koboSpan" id="kobo.1261.1">Labels</span></strong><span class="koboSpan" id="kobo.1262.1">. </span><span class="koboSpan" id="kobo.1262.2">Finally, scroll down and create </span><span class="No-Break"><span class="koboSpan" id="kobo.1263.1">the policy:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer246">
<span class="koboSpan" id="kobo.1264.1"><img alt="Figure ﻿9.83 – Entering the custom deployment policy details" src="image/B18145_09_83.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1265.1">Figure 9.83 – Entering the custom deployment policy details</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1266.1">After </span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.1267.1">creating</span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.1268.1"> the policy, you should be able to see these settings configured under the cluster group as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1269.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer247">
<span class="koboSpan" id="kobo.1270.1"><img alt="Figure ﻿9.84 – Verifying the creation of the policy" src="image/B18145_09_84.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1271.1">Figure 9.84 – Verifying the creation of the policy</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1272.1">Create a Pod in one of the two clusters (the TKG workload or GKE) that we added to the cluster group with the policy applied using the following command. </span><span class="koboSpan" id="kobo.1272.2">You can see the Pod definition file used in the following command and verify that the Pod does not have any labels in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1273.1">specification YAML:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1274.1">
$ kubectl apply -f https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/pod-without-label.yaml</span></pre></li>
<li><span class="koboSpan" id="kobo.1275.1">You </span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.1276.1">should</span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.1277.1"> see a similar error message </span><span class="No-Break"><span class="koboSpan" id="kobo.1278.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1279.1">
Error from server ([tmc.cgp.tmc-deployment-policy-demo] You must provide labels with keys: {"app"}): error when creating "https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/pod-without-label.yaml": admission webhook "validation.gatekeeper.sh" denied the request: [tmc.cgp.tmc-deployment-policy-demo] You must provide labels with keys: {"app"}</span></pre></li>
<li><span class="koboSpan" id="kobo.1280.1">Now, let’s create a Pod with the required label using the following command. </span><span class="koboSpan" id="kobo.1280.2">This time, we will use a different Pod specification file where the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1281.1">app</span></strong><span class="koboSpan" id="kobo.1282.1"> label is specified. </span><span class="koboSpan" id="kobo.1282.2">Open the file used in the command to see the newly added label – </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1283.1">app</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1284.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1285.1">
$ kubectl apply -f https://raw.githubusercontent.com/PacktPublishing/DevSecOps-in-Practice-with-VMware-Tanzu/main/chapter-10/pod-with-label.yaml</span></pre></li>
<li><span class="koboSpan" id="kobo.1286.1">You will see that, this time, the Pod is created without any issues, as we supplied the label as required by the policy we created earlier in </span><span class="No-Break"><span class="koboSpan" id="kobo.1287.1">this section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1288.1">
$ kubectl get pod</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1289.1">
NAME                     READY   STATUS    RESTARTS   AGE</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1290.1">
pod-with-label           1/1     Running   0          117s</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.1291.1">This concludes how to create a custom policy that is applicable to all the clusters in a group and test its impact. </span><span class="koboSpan" id="kobo.1291.2">TMC admins can create these policies for any logical requirements and create their templates. </span><span class="koboSpan" id="kobo.1291.3">Later, these templates can be used with custom parameters (such as the name of the label key in the previous example) to apply the policy for a group of clusters – but how do we keep track of policy compliance failures to stay</span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.1292.1"> fully informed about these issues</span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.1293.1"> popping across hundreds of clusters managed by TMC? </span><span class="koboSpan" id="kobo.1293.2">Let’s find that out in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1294.1">following section.</span></span></p>
<h2 id="_idParaDest-190"><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.1295.1">Checking policy violation statuses across all clusters</span></h2>
<p><span class="koboSpan" id="kobo.1296.1">As discussed </span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.1297.1">previously in this chapter, there are several different types of policies we can create using TMC at the cluster group and Workspace level. </span><span class="koboSpan" id="kobo.1297.2">In addition to creating guardrails for later Kubernetes platforms, TMC also provides a way to monitor them for policy violation insights across all the clusters under TMC’s purview. </span><span class="koboSpan" id="kobo.1297.3">To do so, just open </span><strong class="bold"><span class="koboSpan" id="kobo.1298.1">Policies</span></strong><span class="koboSpan" id="kobo.1299.1"> &gt; the </span><strong class="bold"><span class="koboSpan" id="kobo.1300.1">Insights</span></strong><span class="koboSpan" id="kobo.1301.1"> menu from the left-hand navigation bar and you will see a detailed report, as shown in the following screenshot. </span><span class="koboSpan" id="kobo.1301.2">As you can see, it shows a couple of records for the policy testing we did that violated </span><span class="No-Break"><span class="koboSpan" id="kobo.1302.1">our policies:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer248">
<span class="koboSpan" id="kobo.1303.1"><img alt="Figure ﻿9.85 – Getting policy insights" src="image/B18145_09_85.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1304.1">Figure 9.85 – Getting policy insights</span></p>
<p><span class="koboSpan" id="kobo.1305.1">Having learned about policies and checking their compliance status, let’s now learn how to audit clusters</span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.1306.1"> for </span><span class="No-Break"><span class="koboSpan" id="kobo.1307.1">CIS benchmarking.</span></span></p>
<h2 id="_idParaDest-191"><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.1308.1">Inspecting clusters for CIS benchmark compliance</span></h2>
<p><span class="koboSpan" id="kobo.1309.1">As discussed</span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.1310.1"> earlier in this chapter, a security compliance audit of the clusters for common loopholes is a proactive stance to prevent cyber-attacks. </span><span class="koboSpan" id="kobo.1310.2">Scanning Kubernetes clusters for a set of best security practices with a long checklist is a challenging task unless there is sophisticated automation built to do so. </span><span class="koboSpan" id="kobo.1310.3">TMC provides this capability for all its managed</span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.1311.1"> clusters using an open source tool, Sonobuoy, as discussed earlier. </span><span class="koboSpan" id="kobo.1311.2">As of the current version, TMC can perform the following two types of </span><span class="No-Break"><span class="koboSpan" id="kobo.1312.1">cluster inspections:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.1313.1">Conformance</span></em><span class="koboSpan" id="kobo.1314.1"> – to check the cluster configuration against the official </span><span class="No-Break"><span class="koboSpan" id="kobo.1315.1">Kubernetes specification</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1316.1">CIS benchmark</span></em><span class="koboSpan" id="kobo.1317.1"> – to check whether the Kubernetes cluster deployment is following the security best practices outlined in the CIS benchmark </span><span class="No-Break"><span class="koboSpan" id="kobo.1318.1">for Kubernetes</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1319.1">Let’s learn how to inspect a cluster managed by TMC for CIS Benchmark. </span><span class="koboSpan" id="kobo.1319.2">Take the following steps to perform the inspection and check the inspection results using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1320.1">TMC console:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.1321.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1322.1">Inspections</span></strong><span class="koboSpan" id="kobo.1323.1"> menu in the left-hand navigation bar and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1324.1">RUN INSPECTION</span></strong><span class="koboSpan" id="kobo.1325.1"> button as highlighted in </span><span class="No-Break"><span class="koboSpan" id="kobo.1326.1">the screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer249">
<span class="koboSpan" id="kobo.1327.1"><img alt="Figure ﻿9.86 – Running a cluster inspection" src="image/B18145_09_86.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1328.1">Figure 9.86 – Running a cluster inspection</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1329.1">Select an</span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.1330.1"> existing cluster, set the </span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.1331.1">inspection type as </span><strong class="bold"><span class="koboSpan" id="kobo.1332.1">CIS benchmark</span></strong><span class="koboSpan" id="kobo.1333.1">, and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1334.1">RUN</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1335.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer250">
<span class="koboSpan" id="kobo.1336.1"><img alt="Figure ﻿9.87 – Selecting the inspection to run" src="image/B18145_09_87.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1337.1">Figure 9.87 – Selecting the inspection to run</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1338.1">You will see the inspection results in a few minutes as displayed in the following screenshot. </span><span class="koboSpan" id="kobo.1338.2">As you can see, the scan has found some failed test cases that should be addressed for a stronger </span><span class="No-Break"><span class="koboSpan" id="kobo.1339.1">security posture:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer251">
<span class="koboSpan" id="kobo.1340.1"><img alt="Figure ﻿9.88 – Checking the inspection results" src="image/B18145_09_88.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1341.1">Figure 9.88 – Checking the inspection results</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1342.1">Click on the test result link on the previous screen and you will get a detailed report of the failed test cases, warnings, and successful cases, as shown in the following screenshot. </span><span class="koboSpan" id="kobo.1342.2">The report provides details of each test case and recommendations </span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.1343.1">for it. </span><span class="koboSpan" id="kobo.1343.2">You can</span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.1344.1"> also download the report to look at </span><span class="No-Break"><span class="koboSpan" id="kobo.1345.1">it offline:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer252">
<span class="koboSpan" id="kobo.1346.1"><img alt="Figure ﻿9.89 – Checking the detailed inspection report" src="image/B18145_09_89.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1347.1">Figure 9.89 – Checking the detailed inspection report</span></p>
<p><span class="koboSpan" id="kobo.1348.1">That brings us to the end of the topic of running cluster inspections. </span><span class="koboSpan" id="kobo.1348.2">We can also trigger cluster inspections from the cluster detail sections as well on TMC in addition to the main </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1349.1">Inspections</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1350.1"> menu.</span></span></p>
<p><span class="koboSpan" id="kobo.1351.1">With that, we have also covered all the planned operations that we wanted to cover around applying governance policies for Kubernetes clusters using TMC. </span><span class="koboSpan" id="kobo.1351.2">First, we saw how to create a security policy to restrict the ability to run privileged containers. </span><span class="koboSpan" id="kobo.1351.3">Then, we learned how to create an image registry policy, with the example of preventing image pulls without its digest. </span><span class="koboSpan" id="kobo.1351.4">After that, we created a deployment policy to prevent Pods from being created without a specific label and saw all the different types of custom policies we can create using TMC. </span><span class="koboSpan" id="kobo.1351.5">Later, we saw how to find policy violations. </span><span class="koboSpan" id="kobo.1351.6">Finally, we learned how to run conformance inspections for clusters and get their detailed reports. </span><span class="koboSpan" id="kobo.1351.7">In addition to all these capabilities of TMC, there are a few other operations that we did not cover in </span><span class="No-Break"><span class="koboSpan" id="kobo.1352.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1353.1">Managing user access policies for cluster groups, clusters, Workspaces, </span><span class="No-Break"><span class="koboSpan" id="kobo.1354.1">and namespaces</span></span></li>
<li><span class="koboSpan" id="kobo.1355.1">Installing various tools from a published catalog on a cluster managed </span><span class="No-Break"><span class="koboSpan" id="kobo.1356.1">by TMC</span></span></li>
<li><span class="koboSpan" id="kobo.1357.1">Inspecting various events emitted by the clusters managed </span><span class="No-Break"><span class="koboSpan" id="kobo.1358.1">by TMC</span></span></li>
<li><span class="koboSpan" id="kobo.1359.1">Performing </span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.1360.1">several administrative</span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.1361.1"> activities for TMC, including configuring TMC access permissions, external integrations, and proxy configuration, among </span><span class="No-Break"><span class="koboSpan" id="kobo.1362.1">other things</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1363.1">To get more details about them, refer to this documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.1364.1">link: </span></span><a href=""><span class="No-Break"><span class="koboSpan" id="kobo.1365.1">https://docs.vmware.com/en/VMware-Tanzu-Mission-Control/index.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1366.1">.</span></span></p>
<h1 id="_idParaDest-192"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.1367.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1368.1">We covered a lot of ground in this chapter considering what TMC can do to minimize the effort of managing any distribution of upstream Kubernetes that could be running on different cloud environments. </span><span class="koboSpan" id="kobo.1368.2">The high-level value proposition of this tool is to provide management control for multi-cloud, multi-cluster, and multi-team usage. </span><span class="koboSpan" id="kobo.1368.3">First, we understood the different challenges of deployment approaches with a small number of large clusters or a large number of small clusters. </span><span class="koboSpan" id="kobo.1368.4">Then, we saw use cases for TMC and the solutions it provides for complex problems when managing Kubernetes deployments. </span><span class="koboSpan" id="kobo.1368.5">We discussed how challenging it can be to operate on different clusters deployed in different cloud environments and keep the operator and developer experience consistent across them. </span><span class="koboSpan" id="kobo.1368.6">We saw how TMC makes this easy using cluster groups and Workspaces, a group of Kubernetes namespaces across </span><span class="No-Break"><span class="koboSpan" id="kobo.1369.1">different clusters.</span></span></p>
<p><span class="koboSpan" id="kobo.1370.1">Then, we learned how to get started with TMC, covering the way to integrate a TKG management cluster with TMC. </span><span class="koboSpan" id="kobo.1370.2">Then, we discussed how to perform cluster lifecycle operations on that TKG foundation using TMC. </span><span class="koboSpan" id="kobo.1370.3">After that, we saw how to create new workload clusters under the TKG control plane, which become a part of the TMC-managed clusters. </span><span class="koboSpan" id="kobo.1370.4">Then, we also learned how to bring externally created or managed clusters such as GKE clusters into TMC and make them part of the cluster groups defined in TMC. </span><span class="koboSpan" id="kobo.1370.5">We also learned how to create groups of Kubernetes namespaces, the Workspaces, for clusters that are deployed in two different cloud environments. </span><span class="koboSpan" id="kobo.1370.6">After getting started with TMC, the first thing we learned was how to protect cluster data with the backup and restore capabilities of TMC. </span><span class="koboSpan" id="kobo.1370.7">Then, we covered a long section on governing a fleet of clusters using various policies that we can apply either at the cluster group or Workspace level. </span><span class="koboSpan" id="kobo.1370.8">Lastly, we covered how to inspect different clusters to take a proactive stance </span><span class="No-Break"><span class="koboSpan" id="kobo.1371.1">toward security.</span></span></p>
<p><span class="koboSpan" id="kobo.1372.1">As TMC is a single pane of glass for </span><em class="italic"><span class="koboSpan" id="kobo.1373.1">controlling</span></em><span class="koboSpan" id="kobo.1374.1"> large-scale Kubernetes deployments, VMware Aria operations for Applications is a single pane of glass for </span><em class="italic"><span class="koboSpan" id="kobo.1375.1">observing</span></em><span class="koboSpan" id="kobo.1376.1"> the scale of a Kubernetes deployment with its full-stack observability capabilities, starting from the application layer and moving to the infrastructure layer. </span><span class="koboSpan" id="kobo.1376.2">In the next chapter, we will cover this topic </span><span class="No-Break"><span class="koboSpan" id="kobo.1377.1">in detail.</span></span></p>
</div>
</body></html>