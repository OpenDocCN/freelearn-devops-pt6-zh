["```\n{ \"Code\" : \"Success\",\n  \"LastUpdated\" : \"2022-04-26T16:39:16Z\",\n  \"Type\" : \"AWS-HMAC\",\n  \"AccessKeyId\" : \"ASIAIOSFODNN7EXAMPLE\",\n  \"SecretAccessKey\" : \"bPxRfiCYEXAMPLEKEY\",\n  \"Token\" : \"token\",\n  \"Expiration\" : \"2022-05-17T15:09:54Z\"}\n```", "```\n$ aws sts get-caller-identity\n{\n \"UserId\": \"hdghd78898:i-014\",\n \"Account\": \"11223344,\n \"Arn\": \"arn:aws:sts::11223344:assumed-role/<IPROFILE>/i-014\"\n}\n```", "```\n$ aws ec2 modify-instance-metadata-options --instance-id i-1122233 --http-tokens required --http-put-response-hop-limit 1\n{\n    \"InstanceId\": \"i-112233\",\n    \"InstanceMetadataOptions\": {\n        \"State\": \"pending\",\n        \"HttpEndpoint\": \"enabled\",\n        \"HttpTokens\": \"required\",\n        \"HttpPutResponseHopLimit\": 1\n    }\n}\n```", "```\n$ aws eks describe-cluster --name myipv4cluster --query \"cluster.identity.oidc.issuer\" --output text\nhttps://oidc.eks.eu-central-1.amazonaws.com/id/763683678\n```", "```\n$ eksctl utils associate-iam-oidc-provider --cluster cluster_name –approve\n```", "```\n{ \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:GetAccountPublicAccessBlock\",\n                \"s3:GetBucketAcl\",\n                \"s3:GetBucketLocation\",\n                \"s3:GetBucketPolicyStatus\",\n                \"s3:GetBucketPublicAccessBlock\",\n                \"s3:ListAccessPoints\",\n                \"s3:ListAllMyBuckets\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```", "```\n$ aws iam create-policy --policy-name bespoke-pod-policy --policy-document file://s3-policy.json\n{\n    \"Policy\": {\n        \"PolicyName\": \"bespoke-pod-policy\",\n        \"PermissionsBoundaryUsageCount\": 0,\n        \"CreateDate\": \"2022-11-09T15:03:58Z\",\n        \"AttachmentCount\": 0,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"ANPARDV7UN626ZCPMFH4X\",\n        \"DefaultVersionId\": \"v1\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::112233444:policy/bespoke-pod-policy\",\n        \"UpdateDate\": \"2022-11-09T15:03:58Z\"\n    }\n}\n```", "```\n$ export account_id=$(aws sts get-caller-identity --query \"Account\" --output text)\n$ export oidc_provider=$(aws eks describe-cluster --name myipv4cluster --region eu-central-1 --query \"cluster.identity.oidc.issuer\" --output text | sed -e \"s/^https:\\/\\///\")\n$ export namespace=default\n$ export service_account=s3-access\n```", "```\ncat >trust-relationship.json <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::$account_id:oidc-provider/$oidc_provider\"\n      },\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"$oidc_provider:aud\": \"sts.amazonaws.com\",\n          \"$oidc_provider:sub\": \"system:serviceaccount:$namespace:$service_account\"\n        }\n      }\n    }\n  ]\n}\nEOF\n```", "```\n$ aws iam create-role --role-name s3-access-default --assume-role-policy-document file://trust-relationship.json --description \"s3 access role for pod SA s3-access/default\"\n{\n    \"Role\": {\n        ………\n        \"Arn\": \"arn:aws:iam::11223344:role/s3-access-default\"\n    }\n}\n$ aws iam attach-role-policy --role-name s3-access-default --policy-arn=arn:aws:iam::$account_id:policy/bespoke-pod-policy\n```", "```\n$ cat >my-service-account.yaml <<EOF\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: s3-access\n  namespace: default\nEOF\n$ kubectl apply -f my-service-account.yaml\n$ kubectl annotate serviceaccount -n $namespace $service_account eks.amazonaws.com/role-arn=arn:aws:iam::$account_id:role/s3-access-default\nserviceaccount/s3-access annotated\n$ kubectl describe sa $service_account\nName:                s3-access\nNamespace:           default\nLabels:              <none>\nAnnotations:         eks.amazonaws.com/role-arn: arn:aws:iam::11223344:role/s3-access-default\nImage pull secrets:  <none>\nMountable secrets:   s3-access-token-9z6\nTokens:              s3-access-token-9z6\nEvents:              <none>\n```", "```\n$ kubectl run –rm -ti cli  --image=amazon/aws-cli –overrides=\"{ 'spec': { 'serviceAccount': 's3-access' }  }\" s3 ls\n2022-09-29 09:26:05 ingress-123-bb\n2022-03-29 17:49:50 servicecatalog456643\n……..\n```", "```\n$ eksctl create iamserviceaccount --cluster=<clusterName> --name=<serviceAccountName> --namespace=<serviceAccountNamespace> --attach-policy-arn=<policyARN>\n```", "```\n$ kubectl run -ti cli  --image=amazon/aws-cli --overrides='{ \"spec\": { \"serviceAccount\": \"default\" }  }' s3 ls\nIf you don't see a command prompt, try pressing enter.\nAn error occurred (AccessDenied) when calling the ListBuckets operation: Access Denied\n```", "```\n$ kubectl get po cli -o yaml | grep serviceAccountName\n  serviceAccountName: default\n```", "```\n$ kubectl describe sa default\nName:                default\nNamespace:           default\nLabels:              <none>\nAnnotations:         <none>\nImage pull secrets:  <none>\nMountable secrets:   default-token-wjpnc\nTokens:              default-token-wjpnc\nEvents:              <none>\n```", "```\n$ kubectl describe sa default\n…..\nAnnotations:         eks.amazonaws.com/role-arn: arn:aws:iam::11223344:role/s3-access-default\n…..\n$ aws iam list-attached-role-policies --role-name s3-access-default\n{\n    \"AttachedPolicies\": [\n        {\n            \"PolicyName\": \"bespoke-pod-policy\",\n            \"PolicyArn\": \"arn:aws:iam::11223344:policy/bespoke-pod-policy\"\n        }\n    ]\n}\n```", "```\n$ aws iam get-policy --policy-arn arn:aws:iam::076637564853:policy/bespoke-pod-policy{\n    \"Policy\": {\n        \"PolicyName\": \"bespoke-pod-policy\",\n        \"Tags\": [],\n        \"PermissionsBoundaryUsageCount\": 0,\n        \"CreateDate\": \"2022-11-09T15:03:58Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"ANPARDV7UN626ZCPMFH4X\",\n        \"DefaultVersionId\": \"v1\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::076637564853:policy/bespoke-pod-policy\",\n        \"UpdateDate\": \"2022-11-09T15:03:58Z\"\n    }\n}\n```", "```\n$ aws iam get-policy-version    --policy-arn arn:aws:iam::076637564853:policy/bespoke-pod-policy   --version-id v1\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2022-11-09T15:03:58Z\",\n        \"VersionId\": \"v1\",\n        \"Document\": {\n            \"Version\": \"2012-10-17\",\n            \"Statement\": [\n                {\n                    \"Action\": [\n                        \"s3:GetAccountPublicAccessBlock\",\n                        \"s3:GetBucketAcl\",\n                        \"s3:GetBucketLocation\",\n                        \"s3:GetBucketPolicyStatus\",\n                        \"s3:GetBucketPublicAccessBlock\",\n                        \"s3:ListAccessPoints\"\n                    ],\n                    \"Resource\": \"*\",\n                    \"Effect\": \"Allow\"\n                }\n            ]\n        },\n        \"IsDefaultVersion\": true\n    }\n}\n```", "```\n    $ aws iam get-role --role-name\n    ```", "```\n    $ kubectl get mutatingwebhookconfiguration pod-identity-webhook  -o yaml\n    ```"]