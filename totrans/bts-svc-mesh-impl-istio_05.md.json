["```\nspec:\n  hosts:\n  - \"catalogue.sock-shop.svc.cluster.local\"\n  gateways:\n  - mesh\n  http:\n  - match:\n    - uri:\n        prefix: \"/catalogue/3395a43e-2d88-40de-b95f-e00e1502085b\"\n      ignoreUriCase: true\n    fault:\n      delay:\n        percentage:\n          value: 100.0\n        fixedDelay: 10s\n    route:\n    - destination:\n        host: catalogue.sock-shop.svc.cluster.local\n        port:\n          number: 80\n```", "```\n$ kubectl create ns chapter5\n$ kubectl label ns chapter5 istio-injection=enabled\n```", "```\n$ kubectl apply -f Chapter5/01-sockshop-istio-gateway.yaml\n```", "```\n$ kubectl apply -f Chapter5/02-faultinjection_delay.yaml\n```", "```\n% kubectl logs -l name=front-end -c istio-proxy -n sock-shop | grep /catalogue/3395a43e-2d88-40de-b95f-e00e1502085b\n[2022-08-27T00:39:09.547Z] \"GET /catalogue/3395a43e-2d88-40de-b95f-e00e1502085b HTTP/1.1\" 200 DI via_upstream - \"-\" 0 286 10005 4 \"-\" \"-\" \"d83fc92e-4781-99ec-91af-c523e55cdbce\" \"catalogue\" \"10.10.10.170:80\" outbound|80||catalogue.sock-shop.svc.cluster.local 10.10.10.155:59312 172.20.246.13:80 10.10.10.155:40834 - -\n```", "```\nspec:\n  hosts:\n  - \"catalogue.sock-shop.svc.cluster.local\"\n  gateways:\n  - mesh\n  http:\n  - match:\n    - uri:\n        prefix: \"/catalogue/3395a43e-2d88-40de-b95f-e00e1502085b\"\n      ignoreUriCase: true\n    fault:\n      abort:\n        httpStatus: 500\n        percentage:\n          value: 100.0\n    route:\n    - destination:\n        host: catalogue.sock-shop.svc.cluster.local\n        port:\n          number: 80\n```", "```\n$ kubectl apply -f Chapter5/03-faultinjection_abort.yaml\n```", "```\n% kubectl logs -l name=front-end -c istio-proxy -n sock-shop | grep /catalogue/3395a43e-2d88-40de-b95f-e00e1502085b\n[2022-08-27T00:42:45.260Z] \"GET /catalogue/3395a43e-2d88-40de-b95f-e00e1502085b HTTP/1.1\" 500 FI fault_filter_abort - \"-\" 0 18 0 - \"-\" \"-\" \"b364ca88-cb39-9501-b4bd-fd9ea143fa2e\" \"catalogue\" \"-\" outbound|80||catalogue.sock-shop.svc.cluster.local - 172.20.246.13:80 10.10.10.155:57762 - -\n```", "```\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: orders\n  namespace: chapter5\nspec:\n  hosts:\n  - \"orders.sock-shop.svc.cluster.local\"\n  gateways:\n  - mesh\n  http:\n  - timeout: 1s\n    route:\n    - destination:\n        host: orders.sock-shop.svc.cluster.local\n        port:\n          number: 80\n```", "```\n% kubectl apply -f Chapter5/04-request-timeouts.yaml\n```", "```\n% kubectl logs --follow -l name=orders -c istio-proxy -n sock-shop | grep payment\n[2022-08-28T01:24:31.968Z] \"POST /paymentAuth HTTP/1.1\" 200 - via_upstream - \"-\" 326 51 2 2 \"-\" \"Java/1.8.0_111-internal\" \"ce406513-fd29-9dfc-b9cd-cb2b3dbd24a6\" \"payment\" \"10.10.10.171:80\" outbound|80||payment.sock-shop.svc.cluster.local 10.10.10.229:60984 172.20.93.36:80 10.10.10.229:40816 - -\n[2022-08-28T01:25:55.244Z] \"POST /paymentAuth HTTP/1.1\" 200 DI via_upstream - \"-\" 326 51 10007 2 \"-\" \"Java/1.8.0_111-internal\" \"ae00c14e-409c-94b1-8cfb-951a89411246\" \"payment\" \"10.10.10.171:80\" outbound|80||payment.sock-shop.svc.cluster.local 10.10.10.229:36752 172.20.93.36:80 10.10.10.229:52932 - -\n```", "```\n% kubectl logs --follow -l name=front-end -c istio-proxy -n sock-shop | grep orders\n[2022-08-28T01:25:55.204Z] \"POST /orders HTTP/1.1\" 504 UT upstream_response_timeout - \"-\" 232 24 1004 - \"-\" \"-\" \"b02ea4a2-b834-95a6-b5be-78db31fabf28\" \"orders\" \"10.10.10.229:80\" outbound|80||orders.sock-shop.svc.cluster.local 10.10.10.155:49808 172.20.11.100:80 10.10.10.155:55974 - -\n[2022-08-28T01:25:55.173Z] \"POST /orders HTTP/1.1\" 504 - via_upstream - \"-\" 0 26 1058 1057 \"10.10.10.217\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36\" \"a8cb6589-4fd1-9b2c-abef-f049cd1f6beb\" \"sockshop.com\" \"10.10.10.155:8079\" inbound|8079|| 127.0.0.6:36185 10.10.10.155:8079 10.10.10.217:0 outbound_.80_._.front-end.sock-shop.svc.cluster.local default\n```", "```\n$ kubectl create ns utilities\n$ kubectl label ns utilities istio-injection=enabled\n```", "```\n$ kubectl apply -f Chapter5/envoy-proxy-01.yaml\n```", "```\n$ kubectl apply -f Chapter5/mockshop-ingress_01.yaml\n```", "```\n  http_filters:\n              - name: envoy.filters.http.fault\n                typed_config:\n                  \"@type\": type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n                  abort:\n                    http_status: 503\n                    percentage:\n                      numerator: 50\n                      denominator: HUNDRED\n```", "```\n$ kubectl apply -f Chapter5/envoy-proxy-02-abort-02.yaml\n```", "```\n  http:\n  - match:\n    - uri:\n        prefix: /\n    route:\n    - destination:\n        port:\n          number: 80\n        host: envoydummy.utilities.svc.cluster.local\n    retries:\n      attempts: 0\n```", "```\n    retries:\n      attempts: 2\n      perTryTimeout: 2s\n      retryOn: 5xx,gateway-error,reset,connect-failure,refused-stream,retriable-4xx\n```", "```\n$ kubectl apply -f  Chapter5/05-request-retry.yaml\n```", "```\n$ kubectl apply -f Chapter5/envoy-proxy-02.yaml\n```", "```\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: envoydummy\nspec:\n  host: envoydummy\n  trafficPolicy:\n       loadBalancer:\n         simple: ROUND_ROBIN\n```", "```\n$ kubectl apply -f Chapter5/06-loadbalancing-roundrobbin.yaml\n```", "```\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: envoydummy\nspec:\n  host: envoydummy\n  trafficPolicy:\n       loadBalancer:\n         simple: RANDOM\n```", "```\n$ kubectl apply -f Chapter5/07-loadbalancing-random.yaml\n```", "```\napiVersion: v1\nkind: Service\nmetadata:\n  name: envoydummy2\n  labels:\n    name: envoydummy2\n    service: envoydummy2\n  namespace: chapter5\nspec:\n  ports:\n    # the port that this service should serve on\n  - port: 80\n    targetPort: 10000\n  selector:\n    name: envoydummy\n```", "```\n  trafficPolicy:\n       loadBalancer:\n         simple: LEAST_REQUEST\n    version: v2\n```", "```\n$ kubectl apply -f Chapter5/08-loadbalancing-leastrequest.yaml\n```", "```\n$ kubectl port-forward svc/envoydummy2 10000:80 -n utilities\n```", "```\n$ for ((i=1;i<1000000000;i++)); do curl -v \"http://localhost:10000\"; done\n```", "```\n$ curl -Hhost:mockshop.com http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/\nV1----------Bootstrap Service Mesh Implementation with Istio----------V1\nV1----------Bootstrap Service Mesh Implementation with Istio----------V1\nV1----------Bootstrap Service Mesh Implementation with Istio----------V1\nV1----------Bootstrap Service Mesh Implementation with Istio----------V1\n```", "```\n  host: envoydummy\n  trafficPolicy:\n       loadBalancer:\n         simple: ROUND_ROBIN\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n    trafficPolicy:\n      loadBalancer:\n        simple: LEAST_REQUEST\n  - name: v2\n    labels:\n      version: v2\n    trafficPolicy:\n      loadBalancer:\n        simple: RANDOM\n```", "```\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: envoydummy\n  namespace: chapter5\nspec:\n  host: envoydummy\n  trafficPolicy:\n      connectionPool:\n        http:\n          http2MaxRequests: 1\n          maxRequestsPerConnection: 1\n          http1MaxPendingRequests: 0\n```", "```\n$ kubectl apply -f samples/httpbin/sample-client/fortio-deploy.yaml -n utilities\n```", "```\n$ kubectl apply -f Chapter5/06-loadbalancing-roundrobbin.yaml\n```", "```\n$ kubectl exec -it fortio-deploy-7dcd84c469-xpggh -n utilities -c fortio -- /usr/bin/fortio load -qps 0 -c 2 -t 1s -H \"Host:mockshop.com\" http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/\n```", "```\nCode 200 : 486 (100.0 %)\nResponse Header Sizes: count 486 avg 151.01235 +/- 0.1104 min 151 max 152 sum 73392\nResponse Body/Total Sizes : count 486 avg 223.01235 +/- 0.1104 min 223 max 224 sum 108384\nAll done 486 calls (plus 2 warmup) 4.120 ms avg, 484.8 qps\n```", "```\n$ kubectl apply -f Chapter5/10-connection-pooling.yaml\n```", "```\nkubectl exec -it fortio-deploy-7dcd84c469-xpggh -n utilities -c fortio -- /usr/bin/fortio load -qps 0 -c 1 -t 1s -H \"Host:mockshop.com\" http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/\nCode 200 : 175 (100.0 %)\nResponse Header Sizes : count 175 avg 151.01143 +/- 0.1063 min 151 max 152 sum 26427\nResponse Body/Total Sizes : count 175 avg 223.01143 +/- 0.1063 min 223 max 224 sum 39027\nAll done 175 calls (plus 1 warmup) 5.744 ms avg, 174.0 qps\n```", "```\nCode 200 : 193 (66.6 %)\nCode 503 : 97 (33.4 %)\nResponse Header Sizes : count 290 avg 100.55517 +/- 71.29 min 0 max 152 sum 29161\nResponse Body/Total Sizes : count 290 avg 240.45517 +/- 24.49 min 223 max 275 sum 69732\nAll done 290 calls (plus 2 warmup) 6.915 ms avg, 288.8 qps\n```", "```\nKubectl apply -f Chapter5/envoy-proxy-02.yaml\nKubectl apply -f Chapter5/envoy-proxy-02-abort-02.yaml\n```", "```\n$ kubectl apply -f Chapter5/11-request-retry-disabled.yaml\n```", "```\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: envoydummy\n  namespace: utilities\nspec:\n  host: envoydummy.utilities.svc.cluster.local\n  trafficPolicy:\n      connectionPool:\n        http:\n          http2MaxRequests: 2\n          maxRequestsPerConnection: 1\n          http1MaxPendingRequests: 0\n      outlierDetection:\n        baseEjectionTime: 5m\n        consecutive5xxErrors: 1\n        interval: 1s\n        maxEjectionPercent: 100\n```", "```\n$ kubectl apply -f  Chapter5/12-outlier-detection.yaml\n```"]