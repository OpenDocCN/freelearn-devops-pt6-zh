# 前言

Istio 是最广泛采用的 Service Mesh 技术之一。它用于管理应用程序网络，提供微服务的安全性和操作效率。本书逐层探讨 Istio，解释它如何用于管理应用程序网络、弹性、可观察性和安全性。通过各种实际操作示例，你将学习 Istio Service Mesh 的安装、架构及其各个组件。你将进行 Istio 的多集群安装，并集成部署在虚拟机上的遗留工作负载。你还将学习如何使用**WebAssembly**（**WASM**）扩展 Istio 数据平面，并了解 Envoy 及其作为 Istio 数据平面的作用。你将看到如何使用 OPA Gatekeeper 自动化 Istio 的最佳实践。你还将学习如何通过 Kiali、Prometheus、Grafana 和 Jaeger 观察和操作 Istio。你还将探索其他 Service Mesh 技术，如 Linkerd、Consul、Kuma 和 Gloo Mesh。全书通过轻量级应用程序构建的易于跟随的实践示例，帮助你集中精力实现和部署 Istio 到云端和生产环境，而无需处理复杂的演示应用程序。

阅读本书后，你将能够在应用程序之间执行可靠的零信任通信，解决应用程序网络挑战，并使用 Istio 在分布式应用程序中构建弹性。

# 本书适合的人群

本书适合有 Kubernetes 环境中使用微服务经验的软件开发人员、架构师和 DevOps 工程师，他们希望解决在微服务通信中出现的应用程序网络挑战。为了从本书中获得最大收益，你需要具备一定的云计算、微服务和 Kubernetes 的工作经验。

# 本书涵盖的内容

*第一章*，*介绍 Service Mesh*，讲解了云计算、微服务架构和 Kubernetes 的基础知识。接着，它概述了为何需要 Service Mesh 及其所带来的价值。如果你没有在 Kubernetes、云计算和微服务架构中处理大规模部署架构的实际经验，那么本章将帮助你熟悉这些概念，并为理解后续章节中的更复杂主题打下良好的基础。

*第二章*，*Istio 入门*，描述了为何 Istio 在众多可用的 Service Mesh 技术中会获得广泛的流行。该章节接着提供了安装和运行 Istio 的说明，并带你了解 Istio 的架构及其各个组件。安装完成后，你将启用 Istio 旁车注入，应用于与 Istio 安装包一起提供的示例应用程序中。章节详细介绍了在示例应用程序中启用前后的步骤，帮助你理解 Istio 的工作原理。

*第三章*，*理解 Istio 控制平面和数据平面*，深入探讨了 Istio 的控制平面和数据平面。本章将帮助你理解 Istio 控制平面的工作原理，以便你能在生产环境中规划控制平面的安装。阅读完本章后，你将能够识别 Istio 控制平面的各个组成部分，包括 istiod，以及它们在 Istio 整体运作中的功能。本章还将让你熟悉 Envoy 及其架构，并学习如何将 Envoy 作为独立代理使用。

*第四章*，*管理应用程序流量*，详细介绍了如何使用 Istio 管理应用程序流量。本章充满了实际操作示例，首先探索了使用 Kubernetes Ingress 资源管理 Ingress 流量，然后展示了如何使用 Istio Gateway 来实现这一点，同时确保通过 HTTPS 安全暴露 Ingress。本章还提供了金丝雀发布、流量镜像以及将流量路由到网格外部服务的示例。最后，我们将看到如何管理从网格流出的流量。

*第五章*，*管理应用程序弹性*，详细介绍了如何利用 Istio 提高微服务的应用弹性。本章讨论了应用弹性的各个方面，包括故障注入、超时和重试、负载均衡、限流、断路器和异常流量检测，并说明了 Istio 如何应对这些问题。

*第六章*，*保障微服务通信安全*，深入探讨了安全领域的高级话题。本章首先解释了 Istio 的安全架构，然后介绍了如何实现相互 TLS（双向 TLS）来确保服务之间以及与网格外部的下游客户端的通信安全。接着，本章将通过各种实践练习，带你创建自定义的身份验证和授权安全策略。

*第七章*，*服务网格可观察性*，提供了关于为什么可观察性重要的见解，如何从 Istio 收集遥测信息，介绍了各种可用的度量指标以及如何通过 API 获取这些指标，并展示了如何为部署在网格中的应用程序启用分布式追踪。

*第八章*，*将 Istio 扩展到跨 Kubernetes 集群的部署*，将带你了解如何使用 Istio 在多个 Kubernetes 集群之间提供无缝的应用程序连接。本章还介绍了多种 Istio 安装选项，以实现服务网格的高可用性和连续性。内容涵盖了 Istio 安装的高级话题，帮助你了解如何在多个网络上的主-远程配置、单一网络上的主-远程配置、不同网络上的多主配置以及单一网络上的多主配置中设置 Istio。

*第九章*，*扩展 Istio 数据平面*，提供了多种扩展 Istio 数据平面的选项。本章节详细讨论了 EnvoyFilter 和 WebAssembly，并探讨了如何利用这些技术扩展 Istio 数据平面的功能，超出开箱即用的功能。

*第十章*，*为非 Kubernetes 工作负载部署 Istio 服务网格*，介绍了为什么许多组织仍将大量工作负载部署在虚拟机上的背景。该章节随后介绍了混合架构的概念，即现代架构与遗留架构的结合，并展示了 Istio 如何帮助将这两种遗留和现代技术结合起来，并展示了如何将 Istio 扩展到 Kubernetes 之外，应用于虚拟机。

*第十一章*，*Istio 故障排除与操作*，提供了在操作 Istio 时可能遇到的常见问题的详细信息，并讲解了如何区分和隔离这些问题与其他问题。该章节随后介绍了多种分析和排除运营和可靠性工程团队常见的 Day-2 问题的技术。该章节提供了多种最佳实践，用于部署和操作 Istio，并展示了如何使用 OPA Gatekeeper 自动化最佳实践的执行。

*第十二章*，*总结我们所学到的内容与下一步*，帮助您通过实际部署和配置开源应用程序来复习本书所学内容，帮助您在将所学知识应用于实际应用中时增强信心。该章节还提供了各种资源，供您进一步探索，以提升在 Istio 方面的学习和专业知识。最后，本章介绍了 eBPF，这是一项有望对服务网格产生积极影响的先进技术。

*附录 –* *其他服务网格技术*，介绍了其他正在获得流行度、认可和组织采纳的服务网格技术，包括 Linkerd、Gloo Mesh 和 Consul Connect。附录中提供的信息并不详尽，而是旨在让您熟悉 Istio 的替代方案，并帮助您形成对这些技术与 Istio 比较的看法。

# 为了充分利用本书

读者需要具备在基于 Kubernetes 的环境中使用和部署微服务的实践经验。读者需要熟悉使用 YAML 和 JSON，并执行 Kubernetes 的基本操作。由于本书大量使用了各种云服务提供商的服务，因此有一定的云平台使用经验会有所帮助。

| **书中涉及的软件/硬件** | **操作系统要求** |
| --- | --- |
| 至少配备四核处理器和 16GB 内存的工作站 | macOS 或 Linux |
| 访问 AWS、Azure 和 Google Cloud 订阅 | 不适用 |
| Visual Studio Code 或类似工具 | 不适用 |
| minikube，Terraform | 不适用 |

**如果你正在使用本书的数字版本，我们建议你自己输入代码，或者从本书的 GitHub 仓库获取代码（下节将提供链接）。这样做可以帮助你避免由于复制粘贴代码而可能出现的错误。**

# 下载示例代码文件

你可以从 GitHub 上下载本书的示例代码文件，地址为 [`github.com/PacktPublishing/Bootstrap-Service-Mesh-Implementations-with-Istio`](https://github.com/PacktPublishing/Bootstrap-Service-Mesh-Implementations-with-Istio)。如果代码有更新，它将会在 GitHub 仓库中更新。

我们还提供了其他来自我们丰富书籍和视频目录的代码包，地址是 [`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)。欢迎查看！

# 下载彩色图像

我们还提供了一份包含本书中使用的截图和图表的 PDF 文件，你可以在此下载：[`packt.link/DW41O`](https://packt.link/DW41O)。

# 使用的约定

本书中使用了一些文本约定。

`文本中的代码`：表示文本中的代码词、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 用户名。示例如下：“配置补丁应用于`HTTP_FILTER`，特别是应用于`http_connection_manager`网络过滤器的 HTTP 路由器过滤器。”

代码块的设置方式如下：

```
"filterChainMatch": {
                    "destinationPort": 80,
                    "transportProtocol": "raw_buffer"
                },
```

当我们希望你关注代码块的特定部分时，相关的行或项目会以粗体显示：

```
"filterChainMatch": {
                    "destinationPort": 80,
                    "transportProtocol": "raw_buffer"
                },
```

任何命令行输入或输出都按照如下方式编写：

```
% curl -H "Host:httpbin.org" http://a816bb2638a5e4a8c990ce790b47d429-1565783620.us-east-1.elb.amazonaws.com/get
```

**粗体**：表示新术语、重要词汇或在屏幕上显示的单词。例如，菜单或对话框中的单词以**粗体**显示。示例如下：“**云计算**是一种公用事业型计算，商业模式类似于那些向我们家中提供液化石油气和电力等公用设施的企业。”

提示或重要注意事项

以这样的形式出现。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果你对本书的任何方面有疑问，请通过电子邮件联系我们，地址是 [customercare@packtpub.com](http://customercare@packtpub.com)，并在邮件主题中注明书名。

**勘误**：虽然我们已尽最大努力确保内容的准确性，但错误难免发生。如果你发现本书中的错误，请向我们报告。请访问 [www.packtpub.com/support/errata](http://www.packtpub.com/support/errata) 并填写表单。

**盗版**：如果你在互联网上发现我们作品的任何非法复制形式，我们将非常感谢你提供位置地址或网站名称。请通过 [copyright@packt.com](http://copyright@packt.com) 联系我们，并附上相关材料的链接。

**如果您有兴趣成为作者**：如果您在某个主题方面有专业知识，并且有兴趣撰写或为书籍做贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

阅读完*Bootstrapping Service Mesh Implementations with Istio*后，我们非常希望听到您的想法！[请点击这里直接进入亚马逊评论页面并分享您的反馈](https://packt.link/r/1803246812)

)。

您的评价对我们和技术社区非常重要，将帮助我们确保提供卓越的内容质量。

# 下载本书的免费 PDF 副本

感谢购买本书！

您喜欢随时随地阅读，但无法随身携带纸质书籍吗？

您购买的电子书无法与您选择的设备兼容吗？

不用担心，现在每本 Packt 书籍都附带免费的无 DRM 版 PDF。

在任何地方、任何设备上随时阅读。可以搜索、复制并将您最喜欢的技术书籍中的代码直接粘贴到您的应用程序中。

福利还不止这些，您还可以每天在收件箱中获得独家折扣、时事通讯和精彩的免费内容。

按照以下简单步骤即可获得福利：

1.  扫描二维码或访问以下链接

![](img/B17989_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781803246819`](https://packt.link/free-ebook/9781803246819)

1.  提交您的购买凭证

1.  就这样！我们将直接把您的免费 PDF 和其他福利发送到您的电子邮件。

# 第一部分：基础知识

在本书的这一部分，我们将介绍服务网格的基本概念、它为何需要以及哪些类型的应用程序需要它。您将理解 Istio 与其他服务网格实现的区别。此部分还将带您一步步配置和设置环境并安装 Istio，同时揭示 Istio 控制面和数据面，它们如何运作以及在服务网格中的角色。

本部分包含以下章节：

+   *第一章*，*介绍服务网格*

+   *第二章*，*开始使用 Istio*

+   *第三章*，*理解 Istio 控制面和数据面*
