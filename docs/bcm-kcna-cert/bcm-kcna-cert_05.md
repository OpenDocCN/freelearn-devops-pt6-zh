# 5

# ä½¿ç”¨ Kubernetes ç¼–æ’å®¹å™¨

åœ¨æœ¬ç« åŠæ¥ä¸‹æ¥çš„å‡ ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» KCNA è®¤è¯ä¸­æœ€é‡è¦ã€ä¹Ÿè®¸æ˜¯æœ€éš¾çš„éƒ¨åˆ†â€”â€”*Kubernetes åŸºç¡€çŸ¥è¯†*ã€‚å®ƒå æ®äº†æ€»è€ƒè¯•é¢˜ç›®çš„è¿‘ä¸€åŠï¼ˆ46%ï¼‰ï¼Œæ‰€ä»¥ç†è§£æ‰€æœ‰ç»†èŠ‚è‡³å…³é‡è¦ã€‚æˆ‘ä»¬å°†ä¸€æ­¥æ­¥è¿›è¡Œï¼ŒåŒæ—¶ä¹Ÿä¼šè·å¾—å®é™…çš„ Kubernetes ç»éªŒï¼Œå¸®åŠ©ä½ è®°ä½é€šè¿‡è€ƒè¯•æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ã€‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹  K8s æ¶æ„çš„ç‰¹æ€§å’ŒåŸºç¡€çŸ¥è¯†ï¼Œå®ƒçš„ APIã€ç»„ä»¶ï¼Œä»¥åŠæœ€å°çš„å¯éƒ¨ç½²å•å…ƒâ€”â€”**Pod**ã€‚æˆ‘ä»¬å°†å€ŸåŠ©**minikube**é¡¹ç›®ï¼Œåœ¨æœ¬åœ°å®‰è£…å¹¶è¿è¡Œ Kubernetesï¼Œå¸®åŠ©æˆ‘ä»¬ä¸€æ­¥æ­¥å®Œæˆå­¦ä¹ ã€‚

æˆ‘ä»¬å°†è¦†ç›–ä»¥ä¸‹ä¸»é¢˜ï¼š

+   Kubernetes æ¶æ„

+   Kubernetes API

+   K8s â€“ å®¹å™¨ç¼–æ’çš„ç‘å£«å†›åˆ€

+   ä½¿ç”¨ minikube å®‰è£…å¹¶æ¢ç´¢ Kubernetes

è®©æˆ‘ä»¬å¼€å§‹å§ï¼

# Kubernetes æ¶æ„

æ­£å¦‚ä½ æ‰€çŸ¥ï¼ŒKubernetes ç”¨äºç¼–æ’è¿è¡Œåœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šçš„å®¹å™¨ï¼Œè¿™äº›æœåŠ¡å™¨ç»„æˆäº† Kubernetes é›†ç¾¤ã€‚é‚£äº›æœåŠ¡å™¨é€šå¸¸è¢«ç§°ä¸º*èŠ‚ç‚¹*ï¼ŒèŠ‚ç‚¹å¯ä»¥æ˜¯è¿è¡Œåœ¨æœ¬åœ°ã€äº‘ç«¯çš„è™šæ‹Ÿæœºï¼Œæˆ–è€…æ˜¯è£¸é‡‘å±æœåŠ¡å™¨ã€‚ä½ ç”šè‡³å¯ä»¥å°†ä¸åŒç±»å‹çš„èŠ‚ç‚¹ç»„åˆåœ¨ä¸€ä¸ª Kubernetes é›†ç¾¤ä¸­ï¼ˆä¾‹å¦‚ï¼Œå‡ ä¸ªç”±è™šæ‹Ÿæœºè¡¨ç¤ºçš„èŠ‚ç‚¹åŠ ä¸Šå…¶ä»–å‡ ä¸ªè£¸é‡‘å±æœåŠ¡å™¨èŠ‚ç‚¹ï¼‰ã€‚

Kubernetes ä¸­æœ‰ä¸¤ç§åŒºåˆ«æ˜æ˜¾çš„èŠ‚ç‚¹ç±»å‹ï¼š

+   *æ§åˆ¶å¹³é¢*èŠ‚ç‚¹ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸º*ä¸»èŠ‚ç‚¹*ï¼‰

+   *å·¥ä½œ*èŠ‚ç‚¹

å®¹å™¨åŒ–çš„åº”ç”¨è¿è¡Œåœ¨*å·¥ä½œ*èŠ‚ç‚¹ä¸Šï¼Œè€Œ K8s é›†ç¾¤ç®¡ç†ç»„ä»¶è¿è¡Œåœ¨*æ§åˆ¶å¹³é¢*èŠ‚ç‚¹ä¸Šã€‚æˆ‘ä»¬å¯ä»¥åœ¨*å›¾ 5.1*ä¸­çœ‹åˆ°æ›´è¯¦ç»†çš„è¯´æ˜ã€‚

![å›¾ 5.1 â€“ Kubernetes ç»„ä»¶](img/B18970_05_01.jpg)

å›¾ 5.1 â€“ Kubernetes ç»„ä»¶

æ§åˆ¶å¹³é¢èŠ‚ç‚¹è¿è¡Œå¤šä¸ªä¸“é—¨çš„ K8s æœåŠ¡ï¼Œå¹¶å¯¹ Kubernetes é›†ç¾¤è¿›è¡Œå…¨å±€å†³ç­–ï¼Œå¦‚è°ƒåº¦å®¹å™¨åŒ–åº”ç”¨ã€‚æ§åˆ¶å¹³é¢èŠ‚ç‚¹è¿˜è´Ÿè´£ç®¡ç†é›†ç¾¤ä¸­çš„å·¥ä½œèŠ‚ç‚¹ã€‚

ä»¥ä¸‹äº”ä¸ªæœåŠ¡åœ¨æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Šè¿è¡Œï¼š

+   *API æœåŠ¡å™¨*ï¼ˆ**kube-apiserver**ï¼‰ï¼šä¸€ä¸ªæ ¸å¿ƒæœåŠ¡ï¼Œå…¬å¼€ Kubernetes çš„ HTTP APIï¼Œç”¨äºå†…éƒ¨å’Œå¤–éƒ¨é›†ç¾¤çš„é€šä¿¡ã€‚é›†ç¾¤å†…çš„æ‰€æœ‰æ“ä½œéƒ½é€šè¿‡ API æœåŠ¡å™¨è¿›è¡Œâ€”â€”ä¾‹å¦‚ï¼Œå½“ä½ æŸ¥è¯¢é›†ç¾¤æˆ–ç‰¹å®šåº”ç”¨çš„çŠ¶æ€ï¼Œæˆ–è€…å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨æ—¶ã€‚

+   *é›†ç¾¤æ•°æ®å­˜å‚¨*ï¼ˆ**etcd**ï¼‰ï¼šå­˜å‚¨æ‰€æœ‰ Kubernetes é›†ç¾¤çŠ¶æ€å’Œé…ç½®çš„åœ°æ–¹ã€‚*etcd* æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼Œç”¨äºæ­¤ç›®çš„ï¼Œå®ƒæ˜¯å”¯ä¸€çš„æœ‰çŠ¶æ€ç»„ä»¶ã€‚

+   *è°ƒåº¦å™¨*ï¼ˆ**kube-scheduler**ï¼‰ï¼šä¸€ä¸ªå†³å®šåº”ç”¨å®¹å™¨å°†åœ¨é›†ç¾¤ä¸­çš„å“ªä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç»„ä»¶ã€‚å½±å“è°ƒåº¦å†³ç­–çš„å› ç´ åŒ…æ‹¬å•ä¸ªåº”ç”¨çš„éœ€æ±‚ã€èŠ‚ç‚¹è´Ÿè½½ã€ç¡¬ä»¶æˆ–ç­–ç•¥é™åˆ¶ç­‰ã€‚

+   *Controller manager* (**kube-controller-manager**)ï¼šè¿™æ˜¯ä¸€ä¸ªè¿è¡Œå„ç§æ§åˆ¶å™¨è¿›ç¨‹çš„ç»„ä»¶ï¼Œå¦‚ *Node*ã€*Job* æˆ– *Deployment* æ§åˆ¶å™¨ã€‚è¿™äº›æ§åˆ¶å™¨ç›‘è§†é›†ç¾¤ä¸­å„èµ„æºçš„å½“å‰çŠ¶æ€ï¼Œå¹¶åœ¨å½“å‰çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸ä¸€è‡´æ—¶é‡‡å–è¡ŒåŠ¨ã€‚

+   å¯é€‰çš„ *Cloud controller manager* (**cloud-controller-manager**)ï¼šè¿™æ˜¯ä¸€ä¸ªè®©ä½ é€šè¿‡è¿è¡Œç‰¹å®šäºæä¾›å•†çš„æ§åˆ¶å™¨è¿›ç¨‹ï¼Œå°† Kubernetes é›†ç¾¤ä¸äº‘æä¾›å•†é›†æˆçš„ç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œå®ƒå…è®¸ä½ ä¸ºå®¹å™¨åŒ–åº”ç”¨åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨ï¼Œæˆ–è€…åˆ¤æ–­ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹çš„äº‘å®ä¾‹æ˜¯å¦å·²è¢«åˆ é™¤ã€‚*Cloud controller manager* æ˜¯åœ¨ K8s éƒ¨ç½²åœ¨æœ¬åœ°æ—¶ä¸éœ€è¦çš„ç»„ä»¶ã€‚

è®©æˆ‘ä»¬ç»§ç»­è®¨è®ºå·¥ä½œèŠ‚ç‚¹çš„ç»„ä»¶ï¼š

+   **Kubelet**ï¼šä¸€ä¸ªä»£ç†ï¼Œç¡®ä¿åˆ†é…ç»™èŠ‚ç‚¹çš„å®¹å™¨æ­£åœ¨è¿è¡Œå¹¶ä¿æŒå¥åº·ã€‚Kubelet è¿˜ä¼šå‘ API æœåŠ¡å™¨æŠ¥å‘ŠçŠ¶æ€ã€‚

+   **Proxy** (**kube-proxy**)ï¼šè¿™æ˜¯ä¸€ä¸ªç½‘ç»œä»£ç†ï¼Œå¸®åŠ©å®ç° Kubernetes *Service* åŠŸèƒ½ã€‚Proxy åœ¨èŠ‚ç‚¹ä¸Šç»´æŠ¤ç½‘ç»œè§„åˆ™ï¼Œä»¥å…è®¸å®¹å™¨ä» K8s é›†ç¾¤å†…å¤–è¿›è¡Œé€šä¿¡ã€‚

+   **Container runtime**ï¼šè¿™æ˜¯ä¸€ä¸ªè´Ÿè´£åŸºæœ¬å®¹å™¨æ“ä½œçš„è½¯ä»¶ã€‚å¾—ç›Šäº *CRI*ï¼ŒKubernetes å¯ä»¥ä½¿ç”¨ä¸åŒçš„å®¹å™¨è¿è¡Œæ—¶ã€‚ç›®å‰æœ€æµè¡Œçš„è¿è¡Œæ—¶ä¹‹ä¸€æ˜¯ *containerd*ã€‚

æ³¨æ„

Kubelet ä¸ç®¡ç†é€šè¿‡ Kubernetes API ä»¥å¤–çš„æ–¹å¼åˆ›å»ºçš„å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å…¶ä»–æ–¹å¼åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šåˆ›å»ºçš„å®¹å™¨ï¼ŒKubernetes æ˜¯æ— æ³•è¯†åˆ«çš„ã€‚

ä»Šå¤©ï¼Œå·¥ä½œèŠ‚ç‚¹ç»„ä»¶**ä¹Ÿè¿è¡Œåœ¨æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Š**ã€‚æ²¡é”™â€”â€”åœ¨ Kubernetes æ§åˆ¶å¹³é¢ä¸­ï¼Œä½ ä¸ä»…ä¼šæœ‰ *scheduler*ã€*kube-apiserver*ã€*etcd* å’Œ *kube-controller-manager*ï¼Œè¿˜ä¼šæœ‰ *kubelet*ã€*kube-proxy* å’Œ *runtime*ã€‚è¿™æ„å‘³ç€å·¥ä½œç»„ä»¶ä¼šåœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰ Kubernetes èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚

ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼ŸåŸå› æ˜¯æ§åˆ¶å¹³é¢ç»„ä»¶æœ¬èº«å°±éƒ¨ç½²åœ¨å®¹å™¨ä¸­ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ‰€è°“çš„é™æ€ **pods** ç”± Kubernetes ç®¡ç†ã€‚æˆ–è€…ï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶å¯ä»¥é€šè¿‡ **systemd** å¯åŠ¨å’Œç®¡ç†ï¼Œä½†è¿™ç§æ–¹æ³•å¦‚ä»Šè¶Šæ¥è¶Šä¸æµè¡Œäº†ã€‚

ä»€ä¹ˆæ˜¯ podï¼Ÿ

Pod æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºçš„æœ€å°å¯éƒ¨ç½²å•å…ƒã€‚Pod æ˜¯ä¸€ç»„å…±äº«å­˜å‚¨ã€ç½‘ç»œå’Œå®¹å™¨è¿è¡Œè§„èŒƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚

ä½ å¯ä»¥å°†ä¸€ä¸ª pod çœ‹ä½œæ˜¯ Kubernetes å¯¹å®¹å™¨çš„å°è£…ï¼Œåœ¨ K8s é›†ç¾¤ä¸­éƒ¨ç½²ä»»ä½•åº”ç”¨æ—¶ï¼Œä½ æ€»æ˜¯ä¼šå¤„ç† podã€‚å³ä½¿ä½ åªéœ€è¦è¿è¡Œä¸€ä¸ªç”±å•ä¸ªå®¹å™¨ç»„æˆçš„å°å‹ç®€å•åº”ç”¨ï¼Œä½ ä¹Ÿéœ€è¦å®šä¹‰ä¸€ä¸ªåŒ…å«è¯¥å•ä¸€å®¹å™¨çš„ podã€‚æ¢å¥è¯è¯´ï¼Œ**æ²¡æœ‰ pod å°è£…å°±æ— æ³•åœ¨ Kubernetes ä¸Šè¿è¡Œå®¹å™¨**ã€‚

åœ¨ä¸€ä¸ª Pod ä¸­æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„æƒ…å†µä¹Ÿéå¸¸å¸¸è§ï¼Œå…¶ä¸­ Pod ä¸­çš„ç¬¬äºŒä¸ªæˆ–ç¬¬ä¸‰ä¸ªå®¹å™¨ä½œä¸º*è¾…åŠ©*å®¹å™¨æ¥å¸®åŠ©*ä¸»*å®¹å™¨ã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å¤šä¸ªå®¹å™¨éœ€è¦ååŒå·¥ä½œå¹¶å…±äº«èµ„æºæ—¶ã€‚è¿™ç§*è¾…åŠ©*å®¹å™¨è¢«ç§°ä¸º*è¾¹è½¦*å®¹å™¨ã€‚åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†*æœåŠ¡ç½‘æ ¼*ï¼Œå®ƒåˆ©ç”¨è¾¹è½¦å®¹å™¨å°†ä»£ç†ä¸åº”ç”¨å®¹å™¨ä¸€èµ·éƒ¨ç½²ã€‚å¦ä¸€ä¸ªå¯èƒ½åœ¨åŒä¸€ä¸ª Pod ä¸­è¿è¡Œå¤šä¸ªå®¹å™¨çš„ä¾‹å­æ˜¯ä»ä¸»å®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºæ”¶é›†ç›‘æ§æŒ‡æ ‡ã€‚è¾¹è½¦å®¹å™¨è¿˜å¯ä»¥ç”¨äºæ—¥å¿—èšåˆâ€”â€”ä¾‹å¦‚ï¼Œè¾¹è½¦å®¹å™¨å¯èƒ½ä¼šæ”¶é›†å¹¶è½¬å‘ä¸»åº”ç”¨å®¹å™¨çš„æ—¥å¿—åˆ°é•¿æœŸå­˜å‚¨ä¸­ï¼Œå¦‚*å›¾ 5.2*æ‰€ç¤ºï¼š

![å›¾ 5.2 â€“ åŒ…å«ä¸¤ä¸ªå®¹å™¨çš„ Pod ç¤ºä¾‹](img/B18970_05_02.jpg)

å›¾ 5.2 â€“ åŒ…å«ä¸¤ä¸ªå®¹å™¨çš„ Pod ç¤ºä¾‹

æ³¨æ„

åŒä¸€ä¸ª Pod ä¸­çš„å®¹å™¨å§‹ç»ˆè¢«å…±ç½®å¹¶å…±åŒè°ƒåº¦åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚

é™¤äº†*è¾¹è½¦*å®¹å™¨ï¼Œè¿˜æœ‰å¦ä¸€ç§ç±»å‹çš„å®¹å™¨ï¼Œç§°ä¸º**åˆå§‹åŒ–å®¹å™¨ï¼ˆInit Containersï¼‰**ã€‚å®ƒä»¬å¯¹äºè¿è¡Œè®¾ç½®è„šæœ¬å’Œåˆå§‹åŒ–å·¥å…·éå¸¸æœ‰ç”¨ï¼Œè¿™äº›å·¥å…·æ˜¯å®¹å™¨åŒ–åº”ç”¨æ‰€éœ€çš„ã€‚

initContainers

è¿™äº›å®¹å™¨åœ¨ Pod ä¸­çš„å…¶ä»–å®¹å™¨å¯åŠ¨ä¹‹å‰æŒ‰é¡ºåºæ‰§è¡Œã€‚ç›´åˆ°æ‰€æœ‰`initContainers`å®Œæˆï¼Œå…¶ä»–å®¹å™¨æ‰ä¼šå¯åŠ¨ï¼ŒinitContainers æ¯æ¬¡ Pod å¯åŠ¨æ—¶éƒ½ä¼šè¿è¡Œã€‚

é™¤äº†å…è®¸ä½ åœ¨ Kubernetes ä¸Šè¿è¡Œå…±ç½®å’Œç‹¬ç«‹çš„å®¹å™¨ï¼ŒPods è¿˜å…·æœ‰æ›´å¤šçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

+   **å…±äº«å­˜å‚¨**ï¼šPod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥è®¿é—®å…±äº«çš„å·ï¼Œä»è€Œå…è®¸å®¹å™¨å…±äº«æ•°æ®ã€‚

+   **å…±äº«ç½‘ç»œ**ï¼šPod ä¸­çš„æ‰€æœ‰å®¹å™¨å…±äº«*ç½‘ç»œå‘½åç©ºé—´*ï¼Œå¹¶æ‹¥æœ‰ä¸€ä¸ª IP åœ°å€å’Œç½‘ç»œç«¯å£ã€‚å®¹å™¨æ²¡æœ‰ç‹¬ç«‹çš„ IP åœ°å€ï¼Œä½† Pod æœ‰ï¼Œä¸” Pod ä¸­çš„å®¹å™¨å¯ä»¥é€šè¿‡*localhost*ç®€å•åœ°ç›¸äº’é€šä¿¡ã€‚æ­¤å¤–ï¼Œç”±äºå…±äº«ç½‘ç»œï¼ŒPod ä¸­çš„ä¸¤ä¸ªå®¹å™¨ä¸èƒ½ç›‘å¬ç›¸åŒçš„ç½‘ç»œç«¯å£ã€‚

+   **å…±äº«å†…å­˜**ï¼šPod ä¸­çš„å®¹å™¨å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Linux è¿›ç¨‹é—´é€šä¿¡ï¼Œå¦‚**SystemV ä¿¡å·é‡**æˆ–**POSIX** **å…±äº«å†…å­˜**ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¤šæ¬¡æåˆ°è¿‡ Kubernetes *é›†ç¾¤*ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦è‡³å°‘ä¸¤ä¸ªèŠ‚ç‚¹ã€‚æŠ€æœ¯ä¸Šï¼Œä½ å¯ä»¥åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ Kubernetesï¼ŒåŒæ—¶ç»“åˆæ§åˆ¶å¹³é¢å’Œå·¥ä½œèŠ‚ç‚¹çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œ**ä½ ç»ä¸åº”è¯¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿™æ ·åšã€‚è¿™ä»…é€‚ç”¨äºå­¦ä¹ æˆ–** **å¼€å‘ç”¨é€”**ã€‚

åœ¨ç°å®åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬è‡³å°‘ä¼šè¿è¡Œä¸‰ä¸ªæ§åˆ¶å¹³é¢èŠ‚ç‚¹å’Œå¤šä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚è¿™äº›èŠ‚ç‚¹åº”è¯¥åˆ†å¸ƒåœ¨å¤šä¸ª**æ•…éšœåŸŸ**ä¸­ï¼ˆé€šå¸¸ç”±äº‘æœåŠ¡æä¾›å•†ç§°ä¸º**å¯ç”¨åŒº**ï¼‰ï¼Œè¿™äº›æ•…éšœåŸŸå¯èƒ½æ˜¯ç”±å•ç‹¬çš„æ•°æ®ä¸­å¿ƒç»„æˆï¼Œé€šè¿‡é«˜é€Ÿå¸¦å®½ç½‘ç»œäº’è”ã€‚åœ¨å•ä¸ªæœåŠ¡å™¨æˆ–å¯ç”¨åŒºå‡ºç°æ•…éšœçš„æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„ Kubernetes é›†ç¾¤ä»ç„¶å¯ä»¥ä¿æŒè¿è¡Œã€‚

é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªæ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸è¶³ä»¥æ»¡è¶³ç”Ÿäº§ç¯å¢ƒçš„éœ€æ±‚ï¼Œå› ä¸ºåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œä½ å°†æ— æ³•æŸ¥è¯¢é›†ç¾¤å’Œåº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œæ— æ³•å¯åŠ¨å¸¦æœ‰å®¹å™¨çš„æ–° podï¼Œä¹Ÿæ— æ³•è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚è€Œä¸”ï¼Œä½ ä¸å¸Œæœ›ä¸¢å¤±ä½ çš„*etcd* æ•°æ®å­˜å‚¨ï¼Œå®ƒä¿å­˜ç€æœ‰å…³é›†ç¾¤çš„æ‰€æœ‰ä¿¡æ¯ã€‚

å› æ­¤ï¼Œåƒè®¸å¤šé›†ç¾¤ç³»ç»Ÿä¸€æ ·ï¼Œæœ€ä½³å®è·µæ˜¯**è¿è¡Œå¥‡æ•°ä¸ªæ§åˆ¶å¹³é¢èŠ‚ç‚¹**ï¼›ä¾‹å¦‚ä¸‰ä¸ªæˆ–äº”ä¸ªã€‚æ‹¥æœ‰å¥‡æ•°ä¸ªèŠ‚ç‚¹æœ‰åŠ©äºé˜²æ­¢*åˆ†è„‘*æƒ…å¢ƒï¼Œåœ¨ç½‘ç»œæ•…éšœçš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤çš„ä¸¤ä¸ªéƒ¨åˆ†å°†æ— æ³•å»ºç«‹å¤šæ•°ï¼ˆä¾‹å¦‚ï¼Œå››ä¸ªèŠ‚ç‚¹åˆ†æˆä¸¤éƒ¨åˆ†å¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´æˆ–æ— æ³•æ­£å¸¸å·¥ä½œï¼‰ã€‚

æ³¨æ„

è¿™ç§åšæ³•ä¸é€‚ç”¨äºå·¥ä½œèŠ‚ç‚¹ï¼Œåœ¨é›†ç¾¤ä¸­è¿è¡Œä¸¤ä¸ªã€å››ä¸ªã€ä¸ƒä¸ªç”šè‡³ 200 ä¸ªå·¥ä½œèŠ‚ç‚¹æ˜¯å¯ä»¥çš„ã€‚

æˆ‘çŸ¥é“è¿™æœ‰å¾ˆå¤šå†…å®¹éœ€è¦æ¶ˆåŒ–ï¼Œä½†å½“æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ Kubernetes å¹¶éƒ¨ç½²æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå‡ ä¸ª pod æ—¶ï¼Œäº‹æƒ…ä¼šå˜å¾—æ›´åŠ æ¸…æ™°å’Œç®€å•ã€‚ç¨ååœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°äº†è§£ pod è§„æ ¼ï¼Œä½†ç°åœ¨ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£æ›´å¤šå…³äº Kubernetes API ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚

# Kubernetes API

æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€å­¦ï¼ŒKubernetes API æœåŠ¡å™¨æ˜¯æ‰€æœ‰é›†ç¾¤æ“ä½œçš„ä¸»è¦å…¥å£ã€‚å½“æˆ‘ä»¬æƒ³äº†è§£é›†ç¾¤çš„çŠ¶æ€ã€èŠ‚ç‚¹æˆ– pod çš„æ•°é‡æˆ–å…¶ä»–èµ„æºåŠå…¶çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Kubernetes APIã€‚æ‰€æœ‰æ“ä½œéƒ½æ˜¯å¦‚æ­¤ï¼Œä¾‹å¦‚åˆ›å»ºæ–° pod æˆ–ä¿®æ”¹å…¶ä»–èµ„æºçš„è§„æ ¼ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒAPI æœåŠ¡å™¨æ˜¯ K8s çš„*å¤§è„‘*ã€‚

ä¸ Kubernetes API äº¤äº’æœ‰å¤šç§æ–¹å¼ï¼š

+   ä½¿ç”¨ `kubectl` ä¸ K8s é›†ç¾¤äº¤äº’ï¼Œå¹¶ç®¡ç†æˆ–è°ƒè¯•åœ¨ Kubernetes ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚

+   `dashboard`ï¼Œç„¶è€Œå¹¶ä¸æ”¯æŒ`kubectl`æ‰€æä¾›çš„æ‰€æœ‰åŠŸèƒ½ã€‚

+   **å®¢æˆ·ç«¯åº“**ï¼šæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ *Golang*ã€*Java*ã€*Python*ã€*JavaScript* ç­‰ã€‚å®ƒä»¬å…è®¸ä½ ç¼–å†™ä½¿ç”¨ Kubernetes API çš„è½¯ä»¶ï¼Œå¹¶å¸®åŠ©å¤„ç†å¸¸è§çš„ä»»åŠ¡ï¼Œå¦‚èº«ä»½éªŒè¯ã€‚

+   ä½¿ç”¨ `curl` æˆ– `wget`ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—® Kubernetes APIã€‚è¿™ç§æ–¹å¼ä¸å¸¸ç”¨ï¼Œä½†æœ‰æ—¶è¿˜æ˜¯æœ‰å¸®åŠ©çš„ã€‚

è¿™ä¸ªåˆ—è¡¨å¹¶ä¸è¯¦å°½ï¼Œä»Šå¤©ï¼Œä½ è¿˜å¯ä»¥æ‰¾åˆ°è®¸å¤šå…¶ä»–å·¥å…·ï¼ˆå¦‚ `kubectl`ï¼‰ã€‚

åœ¨å‰å‡ ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡ Kubernetes API æ˜¯**å£°æ˜å¼**çš„ã€‚

å£°æ˜å¼ API

å£°æ˜å¼ API æ„å‘³ç€ä½ å£°æ˜ Kubernetes èµ„æºå’Œ Kubernetes æ§åˆ¶å™¨çš„*æœŸæœ›çŠ¶æ€*ï¼Œå¹¶ä¸æ–­ç¡®ä¿ Kubernetes å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªåº”ç”¨çš„ Pod æ•°é‡ï¼‰ä¸å£°æ˜çš„æœŸæœ›çŠ¶æ€ä¿æŒä¸€è‡´ã€‚

å› æ­¤ï¼ŒKubernetes çš„ API ä¸å‘½ä»¤å¼æ–¹æ³•ä¸åŒï¼Œåœ¨å‘½ä»¤å¼æ–¹æ³•ä¸­ä½ ä¼šæŒ‡ç¤ºæœåŠ¡å™¨è¯¥åšä»€ä¹ˆã€‚åœ¨é€šè¿‡ API å®šä¹‰äº†æœŸæœ›çŠ¶æ€åï¼ŒKubernetes ä¼šä½¿ç”¨å…¶ *kube-controller-manager*ï¼ŒæŒ‡ç¤ºè¿è¡Œåœ¨æ— é™æ§åˆ¶å¾ªç¯ä¸­çš„æ§åˆ¶å™¨æ£€æŸ¥èµ„æºçŠ¶æ€æ˜¯å¦ä¸æœŸæœ›çŠ¶æ€ä¸€è‡´ï¼Œå¹¶åœ¨ä¸ä¸€è‡´æ—¶è¿›è¡Œ*åè°ƒ*ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å·²ç»æŒ‡ç¤º K8s è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶ä¿æŒä¸‰ä¸ªå‰¯æœ¬ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªå‰¯æœ¬æœ€ç»ˆå´©æºƒï¼ŒKubernetes å°†è‡ªåŠ¨æ£€æµ‹åˆ°åªå‰©ä¸¤ä¸ªå‰¯æœ¬åœ¨è¿è¡Œï¼Œå¹¶ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ Pod æ¥è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼š

![å›¾ 5.3 â€“ Kubernetes æ§åˆ¶å¾ªç¯](img/B18970_05_03.jpg)

å›¾ 5.3 â€“ Kubernetes æ§åˆ¶å¾ªç¯

æ³¨æ„

æ§åˆ¶å™¨ç®¡ç†å™¨çš„æ— é™æ§åˆ¶å¾ªç¯æœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºåè°ƒå¾ªç¯ã€‚

ç”±äº Kubernetes çš„å¼€å‘é€Ÿåº¦éå¸¸å¿«ï¼Œå…¶ API ä¸æ–­æ¼”è¿›ã€‚æ–°çš„ API èµ„æºå¯ä»¥é¢‘ç¹æ·»åŠ ï¼Œè€Œæ—§çš„èµ„æºæˆ–å­—æ®µä¼šæ ¹æ® Kubernetes çš„å¼ƒç”¨æ”¿ç­–åœ¨å¤šä¸ªå‘å¸ƒå‘¨æœŸåè¢«ç§»é™¤ã€‚ä¸ºäº†ä¾¿äºè¿›è¡Œè¿™äº›æ›´æ”¹ï¼ŒK8s æ”¯æŒå¤šä¸ª API ç‰ˆæœ¬å’Œ API åˆ†ç»„ï¼Œå¹¶åœ¨è¾ƒé•¿æ—¶é—´å†…ä¸ç°æœ‰çš„ API å®¢æˆ·ç«¯ä¿æŒå…¼å®¹ã€‚ä¾‹å¦‚ï¼ŒåŒä¸€èµ„æºå¯ä»¥æœ‰ä¸¤ä¸ª API ç‰ˆæœ¬ï¼š`v1` å’Œ `v1beta1`ã€‚ä½ å¯èƒ½æœ€åˆä½¿ç”¨ `v1beta1` ç‰ˆæœ¬åˆ›å»ºäº†ä¸€ä¸ªèµ„æºï¼Œä½†ä½ ä»ç„¶å¯ä»¥åœ¨å‡ ä¸ªç‰ˆæœ¬å‘å¸ƒæœŸé—´ï¼Œä½¿ç”¨ `v1` æˆ– `v1beta1` API ç‰ˆæœ¬å¯¹è¯¥èµ„æºè¿›è¡Œæ›´æ”¹ã€‚

æ¯ä¸ªæ–°çš„ Kubernetes åŠŸèƒ½éƒ½æœ‰ä¸€ä¸ªå®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œç›¸å…³çš„ API ä¼šåœ¨å¤šä¸ª K8s ç‰ˆæœ¬ä¸­ä» alpha å‘å±•åˆ° betaï¼Œå†åˆ°æ­£å¼å‘å¸ƒçš„çŠ¶æ€ï¼Œå¦‚ *å›¾ 5.4* æ‰€ç¤ºï¼š

![å›¾ 5.4 â€“ Kubernetes åŠŸèƒ½ç”Ÿå‘½å‘¨æœŸ](img/B18970_05_04.jpg)

å›¾ 5.4 â€“ Kubernetes åŠŸèƒ½ç”Ÿå‘½å‘¨æœŸ

å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒKubernetes çš„ alpha åŠŸèƒ½é€šå¸¸æ˜¯*ç¦ç”¨*çš„ã€‚ç„¶è€Œï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½®æ‰€è°“çš„ **feature gates** æ¥å¯ç”¨è¿™äº›åŠŸèƒ½ã€‚Beta å’Œç¨³å®šç‰ˆçš„ Kubernetes åŠŸèƒ½é»˜è®¤æ˜¯å¯ç”¨çš„ã€‚

åœ¨ Kubernetes ä¸­ï¼Œå¯¹ç°æœ‰åŠŸèƒ½çš„æ–°é‡å¤§æ›´æ”¹çš„å®ç°é€šå¸¸ä» **Kubernetes å¢å¼ºææ¡ˆ** (**KEP**) å¼€å§‹ã€‚è¿™äº›æ˜¯è¯¦ç»†çš„è§„èŒƒæ–‡æ¡£ï¼Œæ¦‚è¿°äº†æ›´æ”¹çš„åŠ¨æœºã€ç›®æ ‡å’Œè®¾è®¡ã€‚ä½ å¯ä»¥åœ¨ Kubernetes GitHub ä»“åº“ä¸­æ‰¾åˆ°ç°æœ‰çš„ KEPï¼ˆ[`github.com/kubernetes/enhancements/tree/master/keps`](https://github.com/kubernetes/enhancements/tree/master/keps)ï¼‰ã€‚

å› ä¸º Kubernetes æ˜¯ä¸€ä¸ªå¤æ‚çš„é¡¹ç›®ï¼ŒåŒ…å«è®¸å¤šç»„ä»¶ï¼Œæ‰€ä»¥å®ƒæœ‰å¤šä¸ªæ“ä½œé¢†åŸŸï¼ŒåŒ…æ‹¬å­˜å‚¨ã€ç½‘ç»œã€æ‰©å±•ç­‰ã€‚è¿™äº›é¢†åŸŸé€šå¸¸ç”± Kubernetes **ç‰¹åˆ«å…´è¶£å°ç»„**ï¼ˆ**SIGs**ï¼‰æ¥è¦†ç›–ã€‚SIGs æ˜¯ä¸“æ³¨äº Kubernetes ç‰¹å®šéƒ¨åˆ†çš„å°å‹å¼€å‘è€…ç¤¾åŒºã€‚ç”±äº K8s æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä»»ä½•äººéƒ½å¯ä»¥æˆä¸º SIG çš„ä¸€å‘˜ï¼Œä¿®å¤é—®é¢˜ã€å®¡æŸ¥ä»£ç å’Œæå‡ºæ”¹è¿›å»ºè®®ã€‚

æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼ŒKubernetes API æ˜¯é«˜åº¦å¯æ‰©å±•çš„ï¼Œæ‰©å±•æ–¹å¼æœ‰ä¸¤ç§ï¼š

+   ä½¿ç”¨ **è‡ªå®šä¹‰èµ„æºå®šä¹‰**ï¼ˆ**CRDs**ï¼‰ï¼šä¸€ç§ä¸éœ€è¦ç¼–ç¨‹çš„æ–¹æ³•

+   ä½¿ç”¨ **èšåˆå±‚**ï¼šä¸€ç§éœ€è¦ç¼–ç¨‹çš„æ–¹æ³•ï¼Œä½†å®ƒå…è®¸ä½ å¯¹ API è¡Œä¸ºæœ‰æ›´å¤šæ§åˆ¶

è¿™ä¸¤ç§æ–¹æ³•éƒ½å…è®¸ä½ ä¸º Kubernetes æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œè¶…å‡ºæ ‡å‡† Kubernetes API æ‰€æä¾›çš„èŒƒå›´ã€‚å¯¹äº KCNA è€ƒè¯•çš„èŒƒå›´ï¼Œä½ ä¸éœ€è¦äº†è§£å¤ªå¤šç»†èŠ‚ï¼Œä½†éšç€ä½ å®è·µç»éªŒçš„ç§¯ç´¯ï¼Œä½ ä¼šå‘ç°å¯æ‰©å±•çš„ API æ˜¯ Kubernetes çš„ä¸€é¡¹éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸éœ€è¦äº†è§£æˆ–ä¿®æ”¹ç°æœ‰ K8s æºä»£ç çš„æƒ…å†µä¸‹æ·»åŠ ç‹¬ç‰¹çš„åŠŸèƒ½ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº† Kubernetes APIï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£ Kubernetes çš„ä¸€äº›åŠŸèƒ½ï¼Œæ­£æ˜¯è¿™äº›åŠŸèƒ½ä½¿å…¶æˆä¸ºå®¹å™¨ç¼–æ’çš„ç¬¬ä¸€é€‰æ‹©ã€‚

# K8sâ€”â€”å®¹å™¨ç¼–æ’çš„ç‘å£«å†›åˆ€

æˆ‘ä»¬å¤šæ¬¡æåˆ° Kubernetes éå¸¸é€‚åˆè¿è¡Œç”±è®¸å¤šå¾®æœåŠ¡ç»„æˆçš„äº‘åŸç”Ÿåº”ç”¨ï¼Œè¿™äº›å¾®æœåŠ¡æ‰“åŒ…åœ¨å®¹å™¨ä¸­ã€‚é‚£åˆ°åº•æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

Kubernetes æä¾›äº†è®¸å¤šåŠŸèƒ½ï¼Œæå¤§åœ°ç®€åŒ–äº†å¤§è§„æ¨¡å®¹å™¨é›†ç¾¤çš„æ“ä½œã€‚æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå¯ä»¥ä½¿ç”¨ Kubernetes è‡ªåŠ¨æ‰©å±•å®¹å™¨çš„æ•°é‡æˆ–é‡å¯æ•…éšœçš„å®¹å™¨ã€‚é‚£ä¹ˆï¼ŒKubernetes è¿˜æœ‰å“ªäº›å…¶ä»–åŠŸèƒ½å‘¢ï¼Ÿ

+   **è‡ªåŠ¨åŒ–æ»šåŠ¨æ›´æ–°å’Œå›æ»š**ï¼šå…è®¸ä½ ä»¥å—æ§æ–¹å¼éƒ¨ç½²åº”ç”¨çš„æ–°ç‰ˆæœ¬å’Œé…ç½®æ›´æ”¹ï¼Œç›‘æ§åº”ç”¨çš„å¥åº·çŠ¶å†µå¹¶ç¡®ä¿å®ƒå§‹ç»ˆè¿è¡Œã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼ŒK8s è¿˜å…è®¸ä½ å›æ»šåˆ°åº”ç”¨çš„å…ˆå‰ç‰ˆæœ¬ã€é•œåƒæˆ–é…ç½®ã€‚

+   **æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡**ï¼šå…è®¸é›†ç¾¤ä¸­ä¸åŒçš„å¾®æœåŠ¡è½»æ¾æ‰¾åˆ°å½¼æ­¤ã€‚åœ¨ä¸€ç»„è¡¨ç¤ºç›¸åŒå¾®æœåŠ¡çš„ Pod ä¸­ï¼Œæ¯ä¸ª Pod éƒ½ä¼šæœ‰ä¸€ä¸ª IP åœ°å€ï¼Œä½†æ•´ä¸ªé›†åˆä¼šæœ‰ä¸€ä¸ªå•ä¸€çš„ DNS åç§°ï¼Œä»è€Œç®€åŒ–æœåŠ¡å‘ç°å’Œè´Ÿè½½åˆ†é…ã€‚

+   **ç§˜å¯†å’Œé…ç½®ç®¡ç†**ï¼šå…è®¸ä½ ç®¡ç†å¾®æœåŠ¡é…ç½®å’Œæœºå¯†ï¼Œè€Œæ— éœ€é‡æ–°æ„å»ºå®¹å™¨é•œåƒæˆ–æš´éœ²æ•æ„Ÿå‡­è¯â€”â€”ä¾‹å¦‚ï¼Œå½“æœåŠ¡éœ€è¦è®¿é—®æ•°æ®åº“æˆ–æœ‰è®¸å¤šé…ç½®å‚æ•°éœ€è¦å˜åŒ–æ—¶ã€‚

+   **è‡ªæ„ˆ**ï¼šå…è®¸ä½ è‡ªåŠ¨é‡å¯ç”±äºä»»ä½•åŸå› å¤±è´¥çš„å®¹å™¨ï¼Œå¦‚æœå·¥ä½œèŠ‚ç‚¹åœæ­¢å“åº”ï¼Œè‡ªåŠ¨å°†å®¹å™¨é‡æ–°è°ƒåº¦åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‡å¯æœªé€šè¿‡é¢„å®šä¹‰å¥åº·æ£€æŸ¥çš„å®¹å™¨ï¼Œå¹¶ä¸”ä»…å½“åº”ç”¨ç¨‹åºå®Œå…¨å¯åŠ¨å¹¶å‡†å¤‡å¥½æœåŠ¡æ—¶ï¼Œæ‰å°†è¯·æ±‚è·¯ç”±åˆ°å®¹å™¨ã€‚

+   **æ°´å¹³æ‰©å±•**ï¼šå…è®¸é€šè¿‡å¢åŠ æˆ–å‡å°‘è¿è¡Œåº”ç”¨ç¨‹åºçš„ Pod æ•°é‡æ¥æ¨ªå‘æ‰©å±•å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚è¿™å¯ä»¥æ‰‹åŠ¨å®Œæˆï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œä¾‹å¦‚ï¼ŒåŸºäº CPU ä½¿ç”¨ç‡è¿›è¡Œæ‰©å±•ã€‚

+   **æ‰¹å¤„ç†æ‰§è¡Œ**ï¼šå…è®¸ä½ è°ƒåº¦å®¹å™¨çš„æ‰§è¡Œï¼Œå¹¶çµæ´»ç®¡ç†æ‰¹å¤„ç†å¤„ç†æˆ– CI å·¥ä½œè´Ÿè½½ã€‚

+   **è‡ªåŠ¨åƒåœ¾å›æ”¶**ï¼šå…è®¸æ ¹æ®è¯·æ±‚çš„èµ„æºã€å½“å‰é›†ç¾¤åˆ©ç”¨ç‡æˆ–å…¶ä»–éœ€æ±‚ï¼Œè‡ªåŠ¨ç¡®å®šæœ€ä½³çš„å·¥ä½œèŠ‚ç‚¹æ¥å¯åŠ¨å®¹å™¨ã€‚å®ƒè¿˜å…è®¸å®šä¹‰å·¥ä½œè´Ÿè½½ä¼˜å…ˆçº§ï¼Œä»¥å¤„ç†ä¸åŒçš„å…³é”®å’Œéå…³é”®åº”ç”¨ç¨‹åºã€‚

+   **å­˜å‚¨ç¼–æ’**ï¼šå…è®¸ä½ é›†æˆå’Œç®¡ç†è‡ªå·±é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿã€‚å½“ Pod å¯åŠ¨æ—¶ï¼ŒKubernetes å¯ä»¥è‡ªåŠ¨é…ç½®å’ŒæŒ‚è½½å­˜å‚¨å·ï¼Œå¹¶æ ¹æ®éœ€è¦å°†å·é‡æ–°æŒ‚è½½åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚

è¿™æ˜¯ä¸€é•¿ä¸²å†…å®¹ï¼Œä½†ä»ç„¶ä¸æ˜¯ 100% å®Œæ•´çš„ã€‚åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯ä»¥æ‰©å±• Kubernetes API æ¥æ·»åŠ æ–°åŠŸèƒ½ã€‚å¦‚ä»Šï¼ŒKubernetes æ‹¥æœ‰ä¸€ä¸ªä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼Œæ‹¥æœ‰ä¼—å¤šæ‰©å±• Kubernetes çš„é¡¹ç›®ï¼Œç”šè‡³å¯ä»¥è®©ä½ ç®¡ç†é™¤å®¹å™¨ä¹‹å¤–çš„å…¶ä»–å·¥ä½œè´Ÿè½½ã€‚æ²¡é”™ï¼ŒKubernetes ä¸ä»…å¯ä»¥ç”¨æ¥ç¼–æ’å®¹å™¨ã€‚æˆ‘ä»¬åº”è¯¥æåˆ°å‡ ä¸ªé¡¹ç›®ï¼š

+   **KubeVirt**ï¼šä¸€ä¸ªç”¨äºé€šè¿‡ Kubernetes ç¼–æ’è™šæ‹Ÿæœºä¸å®¹å™¨ä¸€èµ·ä½¿ç”¨çš„é¡¹ç›®ã€‚è¿™é€šå¸¸ç”¨äºå½“å·¥ä½œè´Ÿè½½æ— æ³•è½»æ¾å®¹å™¨åŒ–çš„æƒ…å†µï¼Œæˆ–åœ¨è¿›è¡Œåº”ç”¨ç¨‹åºå®¹å™¨åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›åº”ç”¨ç¨‹åºä»ç„¶è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­ã€‚

+   **Kubeless**ï¼šä¸€ä¸ªè¿è¡Œåœ¨ Kubernetes ä¸Šçš„æ— æœåŠ¡å™¨è®¡ç®—æ¡†æ¶ã€‚å®ƒä¸ºä½ çš„ K8s é›†ç¾¤å¢åŠ äº† FaaS èƒ½åŠ›ï¼Œå¹¶å¯ä»¥ä½œä¸ºäº‘æä¾›å•† FaaS æœåŠ¡çš„æ›¿ä»£æ–¹æ¡ˆã€‚

+   **Knative**ï¼šå¦ä¸€ä¸ª Kubernetes çš„æ— æœåŠ¡å™¨è®¡ç®—æ¡†æ¶ï¼Œæœ€è¿‘è¢« CNCF æ¥å—ã€‚å®ƒæœ€åˆç”± Google åˆ›å»ºï¼Œè‡ª 2018 å¹´ä»¥æ¥ä¸€ç›´åœ¨ç§¯æå¼€å‘ã€‚

+   **OpenFaas**ï¼šå¦ä¸€ä¸ªå¯ä»¥ä¸ Kubernetes ä¸€èµ·ä½¿ç”¨æˆ–ç‹¬ç«‹ä½¿ç”¨çš„æ— æœåŠ¡å™¨æ¡†æ¶ã€‚ä¸å…¶ä»–ä¸¤ä¸ªæ— æœåŠ¡å™¨æ¡†æ¶ç±»ä¼¼ï¼Œå®ƒæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€æ¥ç¼–å†™å‡½æ•°ï¼ŒåŒ…æ‹¬*Golang*ã€*Java*ã€*Python*ã€*Ruby*ã€*C#* ç­‰ã€‚

å¯¹äº KCNA è€ƒè¯•æˆ– CNCF è®¤è¯çš„å…¶ä»– Kubernetes è®¤è¯ï¼Œä½ ä¸éœ€è¦äº†è§£è¿™äº›é¡¹ç›®çš„è¿›ä¸€æ­¥ç»†èŠ‚ã€‚åªéœ€è®°ä½ï¼Œå€ŸåŠ© KubeVirtï¼Œèƒ½å¤Ÿç¼–æ’è™šæ‹Ÿæœºï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å¦‚ Knative ç­‰é¡¹ç›®åœ¨ Kubernetes ä¸Šæä¾› FaaSã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šè¿™äº›é¡¹ç›®çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒæœ¬ç« æœ«å°¾çš„*è¿›ä¸€æ­¥é˜…è¯»*éƒ¨åˆ†ä¸­çš„é“¾æ¥ã€‚

æ³¨æ„

å³ä½¿æœ‰äº† Kubernetes çš„å¸®åŠ©ï¼Œä¹Ÿå¯ä»¥ç®¡ç†è™šæ‹Ÿæœºï¼Œä½†å®ƒä»ç„¶ä¸»è¦ç”¨äºåè°ƒå®¹å™¨ã€‚

åœ¨æˆ‘ä»¬å¼€å§‹å®‰è£… Kubernetes å¹¶å°è¯•å…¶ä¼—å¤šåŠŸèƒ½ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå±•ç¤º K8s å¦‚ä½•æˆä¸ºå¼€å‘å·¥ä½œæµçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚ *å›¾ 5.5* æ‰€ç¤ºï¼š

![å›¾ 5.5 â€“ ä½¿ç”¨ Kubernetes çš„ç®€å•å¼€å‘å·¥ä½œæµç¤ºä¾‹](img/B18970_05_05.jpg)

å›¾ 5.5 â€“ ä½¿ç”¨ Kubernetes çš„ç®€å•å¼€å‘å·¥ä½œæµç¤ºä¾‹

ç®€åŒ–çš„å·¥ä½œæµç¨‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š

1.  å¼€å‘è€…ç¼–å†™ä¸€ä¸ªæ–°å¾®æœåŠ¡çš„ä»£ç ï¼Œå¹¶å°†å…¶æäº¤åˆ° GitHub ä»“åº“ã€‚æ­£å¦‚ä½ å¯èƒ½è®°å¾—çš„é‚£æ ·ï¼Œå¼€å‘è€…æ— éœ€å­¦ä¹ æ–°çš„ç¼–ç¨‹è¯­è¨€å³å¯åœ¨å®¹å™¨ä¸­è¿è¡Œåº”ç”¨ç¨‹åºã€‚

1.  åº”è¯¥æœ‰ä¸€ä¸ª `Dockerfile`ï¼Œå®šä¹‰å°†åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸ºå®¹å™¨é•œåƒæ‰€éœ€çš„æ­¥éª¤ã€‚åœ¨æ„å»ºå®¹å™¨é•œåƒä¹‹å‰ï¼ŒCI ç®¡é“ä¸­ä¼šæ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œå°†æ„å»º Docker é•œåƒå¹¶æ¨é€åˆ°é•œåƒä»“åº“ã€‚

1.  æ¥ä¸‹æ¥ï¼Œå®¹å™¨çš„éƒ¨ç½²ä¼šåœ¨ Kubernetes é›†ç¾¤ä¸­è§¦å‘ã€‚è¦åœ¨ Kubernetes ä¸Šè¿è¡Œå®¹å™¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `kubectl` å·¥å…·ä¸­å®šä¹‰ä¸€ä¸ª pod è§„æ ¼ï¼Œå¹¶ç¡®ä¿å…¶å·²é…ç½®ä¸ºä¸æˆ‘ä»¬çš„ K8s é›†ç¾¤ååŒå·¥ä½œã€‚

1.  å½“è§„æ ¼åº”ç”¨æ—¶ï¼ŒKubernetes ä¼šè´Ÿè´£æ‰¾åˆ°åˆé€‚çš„å·¥ä½œèŠ‚ç‚¹ï¼Œä»é•œåƒä»“åº“ä¸‹è½½å®¹å™¨é•œåƒï¼Œå¹¶å¯åŠ¨æˆ‘ä»¬çš„å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„ podã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰å®ƒä»¥è¿è¡Œå¤šä¸ªå‰¯æœ¬ï¼Œä»¥æ»¡è¶³é«˜å¯ç”¨æ€§è¦æ±‚å¹¶å¹³è¡¡è´Ÿè½½ã€‚

1.  è¿™ä¸ªè¿‡ç¨‹å¯ä»¥é‡å¤å¤šæ¬¡ï¼ŒKubernetes å¯ä»¥ä»¥æ»šåŠ¨æ›´æ–°çš„æ–¹å¼å¤„ç†æ–°åº”ç”¨ç‰ˆæœ¬çš„é•œåƒéƒ¨ç½²ï¼Œä¾‹å¦‚ï¼Œæ¯æ¬¡åªä¼šæ›¿æ¢ä¸€ä¸ªå‰¯æœ¬ã€‚

ä¸€ä¸ª pod åªæ˜¯ Kubernetes å¯¹è±¡çš„ä¸€ä¸ªä¾‹å­ï¼Œå®ƒæ˜¯æœ€å°çš„å¯éƒ¨ç½²å•å…ƒã€‚åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†äº†è§£å…¶ä»–ä½¿ç”¨ Kubernetes æ§åˆ¶å™¨å¹¶æä¾›æ›´é«˜çº§åŠŸèƒ½çš„èµ„æºã€‚

Kubernetes å¯¹è±¡

Kubernetes å¯¹è±¡æ˜¯æŒä¹…åŒ–çš„æ¡ç›®ï¼Œè¡¨ç¤ºé›†ç¾¤çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å“ªäº›å®¹å™¨åŒ–åº”ç”¨ç¨‹åºåœ¨è¿è¡Œï¼Œåœ¨å“ªäº›èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œåº”ç”¨ç¨‹åºå¯ç”¨çš„èµ„æºåŠå…¶ç›¸å…³ç­–ç•¥ï¼ˆä¾‹å¦‚ï¼Œé‡å¯ç­–ç•¥ã€è°ƒåº¦è¦æ±‚ç­‰ï¼‰ã€‚

Kubernetes å¯¹è±¡åœ¨æˆ‘ä»¬åº”ç”¨è§„æ ¼å®šä¹‰çš„é‚£ä¸€åˆ»å°±ä¼šè¢«åˆ›å»ºï¼Œå®ƒä»¬æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª *æ„å›¾è®°å½•*ã€‚ä¸€æ—¦å¯¹è±¡è¢«åˆ›å»ºï¼ŒKubernetes ä¼šç¡®ä¿è¯¥å¯¹è±¡å­˜åœ¨ï¼Œå¹¶å¤„äº *æœŸæœ›çŠ¶æ€*ã€‚è¾¾åˆ°æœŸæœ›çŠ¶æ€æ‰€éœ€çš„æ—¶é—´å–å†³äºè®¸å¤šå› ç´ ï¼Œå¯èƒ½åªéœ€è¦ä¸€ç§’é’Ÿï¼Œæˆ–è€…å¦‚æœä¾‹å¦‚ä»é•œåƒä»“åº“ä¸‹è½½çš„å®¹å™¨é•œåƒå¾ˆå¤§ä¸”ç½‘ç»œæ€§èƒ½è¾ƒå·®ï¼Œåˆ™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚

æ³¨æ„

Kubernetes è§„æ ¼å®šä¹‰æ–‡ä»¶ä¹Ÿç§°ä¸º Kubernetes æ¸…å•ã€‚å®ƒæ˜¯ API å¯¹è±¡çš„ JSON æˆ– YAML æ ¼å¼çš„è§„èŒƒã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰äº†ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬äº²è‡ªå°è¯•ä¸€ä¸‹ã€‚åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®‰è£…ä¸€ä¸ªå•èŠ‚ç‚¹çš„ Kubernetes æ¥è·å¾—å®è·µç»éªŒã€‚

# å®‰è£…å¹¶æ¢ç´¢ä½¿ç”¨ minikube çš„ K8s

ä»Šå¤©ï¼Œè®¸å¤šé¡¹ç›®å…è®¸ä½ å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªç®€å•çš„ K8s é›†ç¾¤æˆ–ç”¨äºå­¦ä¹ æˆ–æœ¬åœ°å¼€å‘çš„å•èŠ‚ç‚¹ Kubernetesã€‚æˆ‘ä»¬å°†ä½¿ç”¨ **minikube**ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±å®˜æ–¹ Kubernetes SIG æ”¯æŒçš„é¡¹ç›®ï¼Œä¸“æ³¨äºé›†ç¾¤éƒ¨ç½²åŠå…¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚å…¶ä»–é¡¹ç›®ä¹Ÿèƒ½è¾¾åˆ°ç±»ä¼¼æ•ˆæœï¼Œæ¯”å¦‚ **Kind** å’Œ **CRC**ã€‚

é‡è¦æ³¨æ„äº‹é¡¹

miniKubeã€Kind å’Œå…¶ä»–ä¸€äº›é¡¹ç›®å¹¶éä¸ºç”Ÿäº§å°±ç»ªçš„ Kubernetes é›†ç¾¤è€Œè®¾è®¡ã€‚è¯·ä¸è¦ä½¿ç”¨è¿™äº›è®¾ç½®æ¥è¿è¡Œé‡è¦çš„å·¥ä½œè´Ÿè½½ï¼

å¿«é€Ÿç¡®è®¤ä½ çš„ç³»ç»Ÿæ»¡è¶³ *minikube* çš„è¦æ±‚ï¼š

+   æœ€æ–°ç‰ˆæœ¬çš„ Linuxã€macOS æˆ– Windows

+   2+ ä¸ª CPU æ ¸å¿ƒ

+   2+ GB çš„å¯ç”¨å†…å­˜

+   20+ GB çš„å¯ç”¨ç£ç›˜ç©ºé—´

+   ç½‘ç»œè¿æ¥

+   ç®¡ç†å‘˜/è¶…çº§ç”¨æˆ·æƒé™

+   å®¹å™¨æˆ–è™šæ‹Ÿæœºç®¡ç†å™¨ï¼ˆå¯ä»¥ä½¿ç”¨å‰é¢ç« èŠ‚ä¸­çš„ Docker å¼•æ“å®‰è£…ï¼‰

é¦–å…ˆï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ minikube å¯åŠ¨æ–‡æ¡£ï¼ˆ[`minikube.sigs.k8s.io/docs/start/`](https://minikube.sigs.k8s.io/docs/start/)ï¼‰ï¼Œç„¶ååœ¨ *å®‰è£…* éƒ¨åˆ†é€‰æ‹©ä½ çš„æ“ä½œç³»ç»Ÿã€‚ç¡®ä¿é€‰æ‹© *ç¨³å®š* ç‰ˆæœ¬ï¼Œå¹¶åœ¨è¿è¡Œ macOS æˆ– Linux æ—¶é€‰æ‹©æ­£ç¡®çš„ CPU æ¶æ„ã€‚

æ³¨æ„

å¦‚æœä½ æ²¡æœ‰å®‰è£… `curl` å·¥å…·ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¤åˆ¶æ–‡æ¡£ä¸­çš„ URLï¼Œç²˜è´´åˆ°æ–°çš„æµè§ˆå™¨æ ‡ç­¾é¡µå¹¶ä¿å­˜åˆ°è®¡ç®—æœºï¼Œå°±åƒä¸‹è½½å…¶ä»–æ–‡ä»¶ä¸€æ ·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`installation` å‘½ä»¤åº”è¯¥åœ¨ä¿å­˜ `minikube` äºŒè¿›åˆ¶æ–‡ä»¶çš„åŒä¸€ç›®å½•ä¸‹æ‰§è¡Œã€‚

æ‰“å¼€ç»ˆç«¯å¹¶æ‰§è¡Œé€‚åˆä½ æ“ä½œç³»ç»Ÿçš„å‘½ä»¤ï¼Œå¦‚æœéœ€è¦ï¼Œè¾“å…¥å¯†ç ã€‚ä¾‹å¦‚ï¼Œåœ¨ macOS ä¸Šä½¿ç”¨ x86-64 CPU æ—¶ï¼Œè¾“å‡ºå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š

```
$ curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64
Â Â % TotalÂ Â Â Â % Received % XferdÂ Â Average SpeedÂ Â Â Time Â Â Â Â TimeÂ Â Â Â Â TimeÂ Â Current
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â DloadÂ Â UploadÂ Â Â Total Â Â Â SpentÂ Â Â Â LeftÂ Â Speed
100 68.6MÂ Â 100 68.6MÂ Â Â Â 0Â Â Â Â Â 0Â Â 38.5MÂ Â Â Â Â Â 0Â Â 0:00:01 Â Â 0:00:01 --:--:-- 38.7M
$ sudo install minikube-darwin-amd64 /usr/local/bin/minikube
Password:
```

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½å€ŸåŠ© `minikube` çš„ `start` å‘½ä»¤å¯åŠ¨æœ¬åœ° Kubernetesï¼š

```
$ minikube start
ğŸ˜„Â Â minikube v1.25.2 on Darwin 12.4
âœ¨Â Â Automatically selected the docker driver. Other choices: hyperkit, ssh
ğŸ‘Â Â Starting control plane node minikube in cluster minikube
ğŸšœÂ Â Pulling base image ...
ğŸ’¾Â Â Downloading Kubernetes v1.23.3 preload ...
Â Â Â Â > preloaded-images-k8s-v17-v1...: 505.68 MiB / 505.68 MiBÂ Â 100.00% 40.26 Mi
Â Â Â Â > gcr.io/k8s-minikube/kicbase: 379.06 MiB / 379.06 MiBÂ Â 100.00% 14.81 MiB p
ğŸ”¥Â Â Creating docker container (CPUs=2, Memory=4000MB) ...
ğŸ³Â Â Preparing Kubernetes v1.23.3 on Docker 20.10.12 ...
Â Â Â Â â–ª kubelet.housekeeping-interval=5m
Â Â Â Â â–ª Generating certificates and keys ...
Â Â Â Â â–ª Booting up control plane ...
Â Â Â Â â–ª Configuring RBAC rules ...
ğŸŒŸÂ Â Enabled addons: storage-provisioner, default-storageclass
ğŸ„Â Â Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
```

æ³¨æ„

ä½ å¯èƒ½æœ‰ä¸€ä¸ªè¾ƒæ–°çš„ Kubernetes ç‰ˆæœ¬ï¼Œ`minikube start` çš„è¾“å‡ºä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œè¾“å‡ºä¸­å¾ˆå¯èƒ½ä¼šæœ‰æŒ‡å‘ç›¸å…³é—®é¢˜çš„é“¾æ¥ï¼Œå¸®åŠ©ä½ è§£å†³é—®é¢˜ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä¸å‰é¢ç« èŠ‚ä¸­ä¸åŒçš„ç³»ç»Ÿï¼Œä½ éœ€è¦å…ˆå®‰è£… Docker å¼•æ“ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ *ç¬¬ä¸‰ç« *ï¼Œ*å®¹å™¨å…¥é—¨*ï¼Œä»¥åŠ minikube çš„é©±åŠ¨ç¨‹åºæ–‡æ¡£é¡µé¢ï¼ˆ[`minikube.sigs.k8s.io/docs/drivers/`](https://minikube.sigs.k8s.io/docs/drivers/)ï¼‰ã€‚å¯¹äºå…¶ä»–é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æœ¬ç«  *è¿›ä¸€æ­¥é˜…è¯»* éƒ¨åˆ†ä¸­çš„ minikube æ•…éšœæ’é™¤æŒ‡å—ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»å¯åŠ¨äº† Kubernetesï¼Œåº”è¯¥èƒ½å¤Ÿä½¿ç”¨`kubectl` CLI å·¥å…·è®¿é—®å…¶ APIã€‚ä½ å¯ä»¥è‡ªå·±ä¸‹è½½`kubectl`ï¼Œä½† minikube å¯ä»¥ä¸ºä½ å®Œæˆè¿™é¡¹å·¥ä½œã€‚æ¨èè®©`minikube`æ¥åšè¿™ä»¶äº‹ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„ç‰ˆæœ¬ã€‚ä½ åªéœ€ç¬¬ä¸€æ¬¡è¿è¡Œä»»ä½•å¸¦æœ‰`kubectl`çš„å‘½ä»¤â€”â€”ä¾‹å¦‚åˆ—å‡ºé›†ç¾¤ä¸­æ‰€æœ‰ Kubernetes èŠ‚ç‚¹çš„å‘½ä»¤ï¼š

```
$ minikube kubectl get nodes
Â Â Â Â > kubectl.sha256: 64 B / 64 B [--------------------------] 100.00% ? p/s 0s
Â Â Â Â > kubectl: 50.65 MiB / 50.65 MiB [-------------] 100.00% 54.17 MiB p/s 1.1s
NAMEÂ Â Â Â Â Â Â STATUSÂ Â Â ROLESÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â AGEÂ Â Â VERSION
minikubeÂ Â Â ReadyÂ Â Â Â control-plane,masterÂ Â Â 18mÂ Â Â v1.23.3
```

Minikube å·²ç»ä¸ºæˆ‘ä»¬ä¸‹è½½äº† K8s CLI å¹¶æ‰§è¡Œäº†å‘½ä»¤ã€‚ä¸å‡ºæ‰€æ–™ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªåä¸º`minikube`çš„èŠ‚ç‚¹ï¼Œå®ƒçš„è§’è‰²æ˜¯`control-plane`å’Œ`master`ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å½“å‰åœ¨ Kubernetes ä¸­è¿è¡Œçš„å†…å®¹ã€‚ä½ å¯ä»¥ä½¿ç”¨`kubectl get` `pods`å‘½ä»¤åˆ—å‡º Podsï¼š

```
$ minikube kubectl get pods
No resources found in default namespace.
```

å¦‚æˆ‘ä»¬æ‰€è§ï¼Œç›®å‰æ²¡æœ‰ä»»ä½•å†…å®¹åœ¨è¿è¡Œï¼Œå› ä¸ºæˆ‘ä»¬åˆšåˆšå¯åŠ¨äº†ä¸€ä¸ªæ–°çš„é›†ç¾¤ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„é€‰é¡¹é‡æ–°è¿è¡Œç›¸åŒçš„å‘½ä»¤â€”â€”ä¹Ÿå°±æ˜¯`--all-namespaces`ï¼ˆæ³¨æ„`kubectl`å’Œ`get`ä¹‹é—´çš„ä¸¤ä¸ªé¢å¤–ç ´æŠ˜å·ï¼›å®ƒä»¬ç”¨äºå°†`kubectl`ä¸`minikube`çš„å‚æ•°åˆ†å¼€ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‘½ä»¤å„è‡ªæœ‰ä¸åŒçš„å‚æ•°é›†ï¼‰ï¼š

```
$ minikube kubectl -- get pods --all-namespaces
NAMESPACEÂ Â Â Â Â NAMEÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â READYÂ Â Â STATUSÂ Â Â Â RESTARTSÂ Â Â AGE
kube-systemÂ Â Â coredns-64897985d-x28hmÂ Â Â Â Â Â Â Â Â Â Â Â 1/1Â Â Â Â Â RunningÂ Â Â 0Â Â Â Â Â Â Â Â Â Â 31m
kube-systemÂ Â Â etcd-minikubeÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 1/1Â Â Â Â Â RunningÂ Â Â 0Â Â Â Â Â Â Â Â Â Â 32m
kube-systemÂ Â Â kube-apiserver-minikubeÂ Â Â Â Â Â Â Â Â Â Â Â 1/1Â Â Â Â Â RunningÂ Â Â 0Â Â Â Â Â Â Â Â Â Â 32m
kube-systemÂ Â Â kube-controller-manager-minikubeÂ Â Â 1/1Â Â Â Â Â RunningÂ Â Â 0Â Â Â Â Â Â Â Â Â Â 32m
kube-systemÂ Â Â kube-proxy-hwv2pÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 1/1Â Â Â Â Â RunningÂ Â Â 0Â Â Â Â Â Â Â Â Â Â 32m
kube-systemÂ Â Â kube-scheduler-minikubeÂ Â Â Â Â Â Â Â Â Â Â Â 1/1Â Â Â Â Â RunningÂ Â Â 0Â Â Â Â Â Â Â Â Â Â 32m
kube-systemÂ Â Â storage-provisionerÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 1/1Â Â Â Â Â RunningÂ Â Â 0Â Â Â Â Â Â Â Â Â Â 32m
```

è¾“å‡ºå·²ç»å‘ç”Ÿäº†å¾ˆå¤§å˜åŒ–ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æœ¬ç« å¼€å¤´å­¦ä¹ çš„æ‰€æœ‰ Kubernetes ç»„ä»¶ï¼š`kube-apiserver`ã€`kube-controller-manager`ã€`kube-proxy`ã€`kube-scheduler`ã€`etcd`ä»¥åŠå…¶ä»–å‡ ä¸ªåœ¨`kube-system`å‘½åç©ºé—´ä¸­çš„ç‹¬ç«‹ Pods ä¸­è¿è¡Œçš„ç»„ä»¶ã€‚

Kubernetes å‘½åç©ºé—´

Kubernetes å‘½åç©ºé—´æä¾›äº†ä¸€ç§åˆ†ç»„æœºåˆ¶ï¼Œç”¨äºåœ¨é›†ç¾¤å†…åŒºåˆ† Kubernetes å¯¹è±¡ã€‚é€šå¸¸ï¼ŒKubernetes å‘½åç©ºé—´ç”¨äºæŒ‰å›¢é˜Ÿã€é¡¹ç›®æˆ–åº”ç”¨ç¨‹åºåˆ†ç»„å·¥ä½œè´Ÿè½½ã€‚`kube-system`å‘½åç©ºé—´æ˜¯ä¸º Kubernetes çš„ç»„ä»¶ä¿ç•™çš„ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åœ¨æˆ‘ä»¬å…¨æ–°çš„ Kubernetes ä¸­æœ‰å“ªäº›å‘½åç©ºé—´ï¼š

```
$ minikube kubectl -- get namespaces
NAMEÂ Â Â Â Â Â Â Â Â Â Â Â Â Â STATUSÂ Â Â AGE
defaultÂ Â Â Â Â Â Â Â Â Â Â ActiveÂ Â Â 56m
kube-node-leaseÂ Â Â ActiveÂ Â Â 56m
kube-publicÂ Â Â Â Â Â Â ActiveÂ Â Â 56m
kube-systemÂ Â Â Â Â Â Â ActiveÂ Â Â 56m
```

`default`å‘½åç©ºé—´ï¼Œé¡¾åæ€ä¹‰ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„å‘½åç©ºé—´ï¼Œå®¹å™¨å·¥ä½œè´Ÿè½½å°†åœ¨è¯¥å‘½åç©ºé—´ä¸­é»˜è®¤åˆ›å»ºã€‚`kube-node-lease`æ˜¯å¦ä¸€ä¸ªä¸ºèŠ‚ç‚¹å¿ƒè·³ï¼ˆæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦è¿è¡Œï¼‰çš„ Kubernetes ä¿ç•™å‘½åç©ºé—´ï¼Œ`kube-public`æ˜¯ä¸€ä¸ªè‡ªåŠ¨åˆ›å»ºçš„å‘½åç©ºé—´ï¼Œç”¨äºå…¬å…±èµ„æºï¼Œä¾‹å¦‚é›†ç¾¤å‘ç°æ‰€éœ€çš„èµ„æºã€‚

ä¸€èˆ¬åšæ³•æ˜¯ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºã€åˆä½œå·¥ä½œçš„å¾®æœåŠ¡ç»„æˆ–æ¯ä¸ªå›¢é˜Ÿåˆ›å»ºæ–°çš„å‘½åç©ºé—´ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´å¹¶å‘½åä¸º`kcna`ï¼Œé€šè¿‡æ‰§è¡Œ`kubectl -- create` `namespace kcna`ï¼š

```
$ minikube kubectl -- create namespace kcna
namespace/kcna created
```

æ³¨æ„

ä½ è¿˜å¯ä»¥è®¾ç½®ä¸€ä¸ªåˆ«åæ¥ä»£æ›¿`minikube kubectl`ï¼Œæ­£å¦‚ minikube æ–‡æ¡£ä¸­å»ºè®®çš„é‚£æ ·ï¼ˆ`$ alias kubectl="minikube kubectl --"`ï¼‰ï¼Œä»¥ä¾¿çœå»æ¯æ¬¡éƒ½å†™`minikube`çš„éº»çƒ¦ã€‚ï¼ˆç¡®ä¿åœ¨ä¸å†ä½¿ç”¨`minikube`æ—¶åˆ é™¤å®ƒã€‚ï¼‰

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†ä¸€ä¸ªå®¹å™¨åŒ–çš„*Nginx* Web æœåŠ¡å™¨éƒ¨ç½²åˆ°æˆ‘ä»¬æ–°çš„`kcna`å‘½åç©ºé—´ä¸­ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ `--namespace`å‚æ•°æ¥å§‹ç»ˆè®¾ç½®æˆ‘ä»¬æƒ³è¦æ‰§è¡Œ`kubectl`å‘½ä»¤çš„å‘½åç©ºé—´ï¼š

```
$ minikube kubectl -- create -f https://k8s.io/examples/pods/simple-pod.yaml --namespace kcna
pod/nginx created
```

è¿™é‡Œï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª Pod è§„èŒƒæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä½äº [`k8s.io/`](https://k8s.io/) ç½‘é¡µä¸Šæ˜¾ç¤ºçš„ç¤ºä¾‹ä¸­ã€‚Kubernetes CLI è¶³å¤Ÿæ™ºèƒ½ï¼Œå¯ä»¥ä¸‹è½½æ–‡ä»¶ï¼ŒéªŒè¯è§„èŒƒå¹¶åº”ç”¨å®ƒï¼Œåˆ›å»ºå®ƒæ‰€å®šä¹‰çš„å¯¹è±¡â€”â€”åœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜¯ä¸€ä¸ªåŒ…å« Nginx çš„å•ä¸€ Podã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±ç¼–å†™è¿™ä¸ªç®€å•çš„ Pod è§„èŒƒæ–‡ä»¶å¹¶ä»¥ YAML æ ¼å¼ä¿å­˜ï¼Œå®ƒä¼šåƒè¿™æ ·ï¼š

```
$ cat simple-pod.yaml
apiVersion: v1
kind: Pod
metadata:
Â Â name: nginx
spec:
Â Â containers:
Â Â - name: nginx
Â Â Â Â image: nginx:1.14.2
Â Â Â Â ports:
Â Â Â Â - containerPort: 80
```

è®©æˆ‘ä»¬çœ‹çœ‹è¯¥è§„èŒƒæ–‡ä»¶çš„æ¯ä¸€è¡Œä»£è¡¨ä»€ä¹ˆã€‚

`apiVersion: v1` å®šä¹‰äº†æˆ‘ä»¬ç”¨äºåˆ›å»ºè¯¥å¯¹è±¡çš„ Kubernetes API ç‰ˆæœ¬ã€‚å¦‚ä½ æ‰€çŸ¥ï¼ŒKubernetes çš„ API ä¼šä» alpha å‘å±•åˆ° betaï¼Œå†åˆ°ç¨³å®šç‰ˆæœ¬ã€‚`v1` æ˜¯æœ¬ç¤ºä¾‹ä¸­çš„ç¨³å®šç‰ˆæœ¬ï¼š

+   `kind: Pod` â€“ å®šä¹‰äº†æˆ‘ä»¬æè¿°çš„å¯¹è±¡ç±»å‹ã€‚

+   `metadata:` â€“ å®šä¹‰å¯¹è±¡çš„å…ƒæ•°æ®ï¼Œå¦‚ `name` æˆ–å…¶ä»–æ³¨è§£ã€‚

+   `name: nginx` â€“ å®šä¹‰ Pod çš„åç§°ã€‚

+   `spec:` â€“ å®šä¹‰äº†æˆ‘ä»¬æè¿°å¯¹è±¡æœŸæœ›çŠ¶æ€çš„å—ã€‚

+   `containers:` â€“ å®šä¹‰äº†ä½œä¸ºè¯¥ Pod ä¸€éƒ¨åˆ†çš„å®¹å™¨åˆ—è¡¨ã€‚

+   `-` `name:` `nginx` â€“ Pod ä¸­ç¬¬ä¸€ä¸ªå®¹å™¨çš„åç§°ã€‚å¤šä¸ªå®¹å™¨å¯ä»¥åœ¨ä¸€ä¸ª Pod ä¸­ä¸€èµ·è¿è¡Œã€‚

+   `image: nginx:1.14.2` â€“ é•œåƒçš„åç§°ï¼ˆ`nginx`ï¼‰ï¼Œå¯ä»¥é€‰æ‹©åœ¨å‰é¢åŠ ä¸Šé•œåƒä»“åº“ URLï¼Œåé¢è·Ÿä¸Šé•œåƒæ ‡ç­¾ï¼ˆ`1.14.2`ï¼‰ã€‚å¦‚æœåœ¨ä¸€ä¸ª Pod ä¸­è¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œæ‚¨éœ€è¦ä¸ºæ¯ä¸ªå®¹å™¨å®šä¹‰é•œåƒå’Œåç§°ã€‚

+   `ports:` â€“ è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„ä¿¡æ¯å—ï¼Œç”¨äºå‘ŠçŸ¥æˆ‘ä»¬å“ªäº›ç«¯å£å°†è¢«æš´éœ²ã€‚è¿™äº›ç«¯å£æ˜¯å®¹å™¨ä¸­è¿›ç¨‹æ­£åœ¨ç›‘å¬çš„ç«¯å£ã€‚ç„¶è€Œï¼Œä¸æŒ‡å®šæ­¤å—å¹¶ä¸ä¼šé˜»æ­¢ç«¯å£æš´éœ²ã€‚

+   `- containerPort: 80` â€“ è¿™æ˜¯æœ¬ç¤ºä¾‹ä¸­çš„ç«¯å£`80`ã€‚

æ³¨

YAML æ ¼å¼ä¸­ç¼©è¿›éå¸¸é‡è¦ï¼Œç¼ºå°‘ä¸€ä¸ªç©ºæ ¼æˆ–å¤šå‡ºä¸€ä¸ªç©ºæ ¼éƒ½ä¼šå¯¼è‡´æ ¼å¼é”™è¯¯ã€‚å¦‚æœåº”ç”¨è§„èŒƒæ—¶å­˜åœ¨è§£æé”™è¯¯ï¼Œ`kubectl` ä¼šæŠ¥é”™ã€‚å»ºè®®ä»æœ¬ä¹¦çš„ GitHub ä»“åº“å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶ï¼Œä»¥é¿å…æ‹¼å†™å’Œæ ¼å¼é”™è¯¯ã€‚

å¥½çš„ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬çš„ Nginx Pod å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

```
$ minikube kubectl -- get pods --namespace kcna
NAMEÂ Â Â Â READYÂ Â Â STATUSÂ Â Â Â RESTARTSÂ Â Â AGE
nginxÂ Â Â 1/1Â Â Â Â Â RunningÂ Â Â 0Â Â Â Â Â Â Â Â Â Â 10m
```

å®ƒå¤„äº `Running` çŠ¶æ€ï¼Œå¹¶ä¸” Pod ä¸­çš„ `1/1`ï¼ˆä¸€ä¸ªä¸­çš„ä¸€ä¸ªï¼‰å®¹å™¨å·²å°±ç»ªã€‚Pod å¯èƒ½å¤„äºå¤šç§çŠ¶æ€ï¼š

+   `Pending`: è§„èŒƒå·²è¢« Kubernetes æ¥å—ï¼Œå½“å‰ Pod æ­£åœ¨ç­‰å¾…è°ƒåº¦ï¼Œæˆ–ç­‰å¾…ä»é•œåƒä»“åº“ä¸‹è½½æ‰€è¯·æ±‚çš„å®¹å™¨é•œåƒã€‚

+   `Running`: Pod å·²è¢«åˆ†é…åˆ°æŸä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸” Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²åˆ›å»ºã€‚è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œã€‚

+   `Succeeded`: Pod ä¸­çš„æ‰€æœ‰å®¹å™¨å·²æˆåŠŸå®Œæˆ/é€€å‡ºï¼Œä¸”ä»¥ *è‰¯å¥½* çš„é€€å‡ºä»£ç ï¼ˆä¾‹å¦‚é›¶ï¼‰é€€å‡ºã€‚å½“å®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºæ­£å¸¸å…³é—­æ—¶ï¼Œä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚

+   `Failed`: Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨å¤±è´¥ï¼›ä¾‹å¦‚ï¼Œå®¹å™¨ä»¥éé›¶é€€å‡ºä»£ç é€€å‡ºã€‚

+   `Unknown`ï¼šæ— æ³•è·å– pod çš„çŠ¶æ€ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨ Pod åº”è¯¥è¿è¡Œçš„èŠ‚ç‚¹æ— æ³•è®¿é—®æ—¶ï¼Œä¾‹å¦‚ï¼Œç”±äºç½‘ç»œé—®é¢˜ã€‚

+   `ErrImagePull` ï¼šæ¸…å•ä¸­æŒ‡å®šçš„é•œåƒæ— æ³•è·å–ï¼ˆæ‹‰å–ï¼‰ã€‚è¿™å¯èƒ½æ˜¯ç”±äºé•œåƒåç§°é”™è¯¯æˆ–æ ‡ç­¾é”™è¯¯ï¼Œå¯¼è‡´é•œåƒåœ¨é•œåƒåº“ä¸­ä¸å­˜åœ¨ã€‚

æ­¤å¤–ï¼Œä½ å¯èƒ½ä¼šé‡åˆ° `ContainerCreating` æˆ– `Terminating` çŠ¶æ€ï¼Œåˆ†åˆ«æè¿° Pod å®¹å™¨çš„å¯åŠ¨æˆ–ç»ˆæ­¢é˜¶æ®µã€‚

ç›®å‰ï¼Œæˆ‘ä»¬çš„ Nginx pod ä»€ä¹ˆä¹Ÿä¸åšï¼›é™¤äº†å®ƒçš„é»˜è®¤é™æ€é¡µé¢å¤–ï¼Œä¸æä¾›ä»»ä½•åº”ç”¨ç¨‹åºæˆ–å†…å®¹ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ `kubectl describe` å‘½ä»¤åœ¨ Kubernetes ä¸­æš´éœ²å’Œè®¿é—® `nginx` pod ä¸­çš„åº”ç”¨ç¨‹åºã€‚

```
$ minikube kubectl -- describe pods nginx --namespace kcna
```

ä½ ä¼šå‘ç°å…³äº pod çš„å¤§é‡ä¿¡æ¯ï¼Œä¾‹å¦‚è¿è¡Œå®ƒçš„èŠ‚ç‚¹ã€å¯åŠ¨æ—¶é—´ã€IP åœ°å€ã€ç¯å¢ƒå˜é‡ã€æœ€è¿‘çš„äº‹ä»¶ç­‰ã€‚æ­¤ä¿¡æ¯å¯¹äºæˆ‘ä»¬è°ƒè¯•å¤±è´¥çš„ pod æˆ–åº”ç”¨ç¨‹åºéå¸¸æœ‰å¸®åŠ©ã€‚

æ—¢ç„¶æˆ‘ä»¬å·²ç»ç¨å¾®ä½¿ç”¨è¿‡ `kubectl`ï¼Œç°åœ¨ä¹Ÿæ¥è¯•è¯• Kubernetes ä»ªè¡¨æ¿ã€‚Minikube æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„å•å‘½ä»¤ä»ªè¡¨æ¿å®‰è£…ï¼Œä½¿ç”¨ `minikube dashboard`ï¼š

```
$ minikube dashboard
ğŸ”ŒÂ Â Enabling dashboard ...
Â Â Â Â â–ª Using image kubernetesui/dashboard:v2.3.1
Â Â Â Â â–ª Using image kubernetesui/metrics-scraper:v1.0.7
ğŸ¤”Â Â Verifying dashboard health ...
ğŸš€Â Â Launching proxy ...
ğŸ¤”Â Â Verifying proxy health ...
ğŸ‰Â Â Opening http://127.0.0.1:55089/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...
```

æ­¤æ—¶ï¼Œä»ªè¡¨æ¿å°†è¢«å®‰è£…åˆ°æ–°çš„ `kubernetes-dashboard` å‘½åç©ºé—´ä¸­ï¼Œæµè§ˆå™¨åº”ä¼šè‡ªåŠ¨åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€å®ƒï¼ˆå¦‚æœæ²¡æœ‰è‡ªåŠ¨æ‰“å¼€ï¼Œè¯·å°è¯•æ‰§è¡Œ `minikube dashboard --url` ä»¥è·å–ä»ªè¡¨æ¿çš„ URLï¼‰ã€‚ä½ éœ€è¦åœ¨å·¦ä¸Šè§’çš„ä¸‹æ‹‰èœå•ä¸­åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå› ä¸º `default` å‘½åç©ºé—´ä¸­å½“å‰æ²¡æœ‰ä»»ä½•å†…å®¹ã€‚å¦‚æœä½ åˆ‡æ¢åˆ° `kcna` å‘½åç©ºé—´ï¼Œä½ å°†çœ‹åˆ°æˆ‘ä»¬çš„ `nginx` podï¼Œè€Œå¦‚æœåˆ‡æ¢åˆ° `kube-system`ï¼Œä½ å°†çœ‹åˆ°æˆ‘ä»¬åœ¨æœ¬ç« ä¸­æè¿°çš„ Kubernetes æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œé™¤äº† podï¼Œè¿˜æœ‰ **Deployment**ã€**Daemon Set** å’Œ **Replica Set** å·¥ä½œè´Ÿè½½ã€‚å®ƒä»¬å°†åœ¨ä¸‹ä¸€ç« ä¸­è®¨è®ºï¼Œå±Šæ—¶æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥åˆ›å»º podï¼Œå¹¶äº†è§£è¿™äº› K8s èµ„æºçš„ç‰¹ç‚¹ã€‚

éšæ—¶å¯ä»¥è‡ªå·±æ¢ç´¢æ›´å¤šçš„ä»ªè¡¨æ¿ï¼›å½“ä½ å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»ªè¡¨æ¿æˆ–é€šè¿‡ `kubectl delete` å‘½ä»¤åˆ é™¤æˆ‘ä»¬çš„ Nginx podã€‚è¦ä¸­æ–­ `minikube dashboard`ï¼Œä½ å¯ä»¥ä½¿ç”¨ *Ctrl* + *C* å¿«æ·é”®ï¼š

```
$Â Â minikube kubectl -- delete pods nginx --namespace kcna
pod "nginx" deleted
```

æ³¨æ„

`kubectl` æ˜¯ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„å·¥å…·ï¼Œå…è®¸ä½ è¾“å…¥ `pod`ã€`pods` æˆ–ç®€å•åœ°è¾“å…¥ `po`ï¼Œå®ƒä»¬çš„æ„æ€æ˜¯ä¸€æ ·çš„ã€‚å®ƒè¿˜æ‹¥æœ‰å¾ˆå¤šä¾¿æ·çš„ç®€çŸ­åç§°ï¼Œä¾‹å¦‚ `ns`ï¼Œä»£è¡¨å‘½åç©ºé—´ã€‚è¦åˆ—å‡ºæ‰€æœ‰ç®€çŸ­åç§°ï¼Œè¯·è¿è¡Œ `minikube` `kubectl api-resources`ã€‚

å¦‚æœä½ åœ¨è¿›å…¥ä¸‹ä¸€ç« ä¹‹å‰å‡†å¤‡å…³é—­å·¥ä½œç«™ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æ‰§è¡Œ `minikube` `stop` å‘½ä»¤ä¸´æ—¶åœæ­¢ä½ çš„ Kubernetes èŠ‚ç‚¹ï¼š

```
$ minikube stop
âœ‹Â Â Stopping node "minikube"Â Â ...
ğŸ›‘Â Â Powering off "minikube" via SSH ...
ğŸ›‘Â Â 1 node stopped.
```

è¿™ä¸€ç« å†…å®¹è¾ƒé•¿ä¸”éå¸¸å¯†é›†ï¼Œæ­å–œä½ å·²ç»èµ°åˆ°äº†è¿™ä¸€éƒ¨åˆ†ï¼åœ¨è¿›å…¥ä¸‹ä¸€ç« ä¹‹å‰ï¼Œå…ˆä¼‘æ¯ä¸€ä¸‹ï¼Œå¹¶ç¡®ä¿å›ç­”æä¾›çš„é—®é¢˜ã€‚

# æ¦‚è¦

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ç»ˆäºæ¥è§¦åˆ°äº† Kubernetesã€‚æˆ‘ä»¬äº†è§£äº†å¾ˆå¤šå…³äºå®ƒçš„æ¶æ„ã€ç»„ä»¶å’Œ APIã€‚Kubernetes é›†ç¾¤ç”±æ§åˆ¶å¹³é¢ï¼ˆä¹Ÿç§°ä¸ºä¸»èŠ‚ç‚¹ï¼‰å’Œå·¥ä½œèŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­æ§åˆ¶å¹³é¢èŠ‚ç‚¹è¿è¡Œ K8s ç®¡ç†ç»„ä»¶ï¼Œå·¥ä½œèŠ‚ç‚¹åœ¨ *kubelet*ã€*å®¹å™¨è¿è¡Œæ—¶* å’Œ *kube-proxy* çš„å¸®åŠ©ä¸‹è¿è¡Œå®é™…çš„å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚åœ¨ä¸»èŠ‚ç‚¹ç»„ä»¶ä¸­ï¼Œæœ‰ *kube-apiserver*ã€*etcd*ã€*kube-scheduler*ã€*kube-controller-manager*ï¼Œä»¥åŠå¯é€‰çš„ *cloud-controller-manager*ã€‚

æˆ‘ä»¬çœ‹åˆ° *pod* æ˜¯ Kubernetes ä¸­æœ€å°çš„å¯éƒ¨ç½²å•å…ƒï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ K8s ä¸Šè¿è¡Œå•ç‹¬çš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥å°†å¤šä¸ªå®¹å™¨ä¸€èµ·è¿è¡Œã€‚ä¸€ä¸ª pod å†…çš„å®¹å™¨æ˜¯è€¦åˆçš„ï¼Œå¯ä»¥å…±äº«å­˜å‚¨ã€ç½‘ç»œå’Œå†…å­˜ã€‚pod ä¸­çš„è¾…åŠ©å®¹å™¨é€šå¸¸è¢«ç§°ä¸º *sidecar*ï¼Œå®ƒå¯ä»¥é€šè¿‡åšæ—¥å¿—èšåˆç­‰ä»»åŠ¡æ¥å¸®åŠ©ä¸»å®¹å™¨è¿è¡Œä¸»åº”ç”¨ç¨‹åºã€‚

Kubernetes API æ˜¯ *å£°æ˜å¼* çš„ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ K8s æ—¶ï¼Œæˆ‘ä»¬æè¿°é›†ç¾¤ä¸­èµ„æºçš„æœŸæœ›çŠ¶æ€ï¼›Kubernetes ç¡®ä¿åœ¨å¯¹è±¡åˆ›å»ºåï¼Œå½“å‰çŠ¶æ€ä¼šè¾¾åˆ°æœŸæœ›çŠ¶æ€ã€‚ç”±äºå¼€å‘çš„å¿«é€Ÿå‘å±•ï¼ŒKubernetes API è¢«åˆ†ç»„å¹¶å¤šç‰ˆæœ¬åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…å¯ç”¨ *beta* å’Œ *ç¨³å®š*ï¼ˆGAï¼‰ç‰¹æ€§ã€‚æœ‰å¤šç§æ–¹å¼å¯ä»¥è®¿é—® Kubernetes APIï¼Œå…¶ä¸­ *kubectl* CLI å’Œ *ä»ªè¡¨æ¿* æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚K8s çš„ä¸€ä¸ªç‰¹è‰²æ˜¯å®ƒèƒ½å¤Ÿé€šè¿‡ CRD å’Œèšåˆå±‚æ‰©å±•å…¶ APIã€‚

è¯´åˆ°åŠŸèƒ½ï¼ŒKubernetes æä¾›äº†å¾ˆå¤šå¼ºå¤§åŠŸèƒ½ï¼Œä»è‡ªåŠ¨æ»šåŠ¨å‘å¸ƒã€æœåŠ¡å‘ç°ã€å’Œå¯†é’¥ç®¡ç†ï¼Œåˆ°è‡ªåŠ¨æ‰©å±•ã€è‡ªæˆ‘ä¿®å¤ï¼Œç”šè‡³å­˜å‚¨ç¼–æ’ã€‚æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­å®è·µå…¶ä¸­è®¸å¤šåŠŸèƒ½ã€‚è¿˜å¯ä»¥å€ŸåŠ© *KubeVirt* å’Œ *Knative* ç­‰ç‹¬ç«‹é¡¹ç›®ï¼Œä½¿ç”¨ Kubernetes æ¥ç®¡ç†è™šæ‹Ÿæœºæˆ–æä¾› FaaSã€‚

åœ¨æœ€åä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ *minikube* é¡¹ç›®å®‰è£…äº†ä¸€ä¸ªç®€å•çš„å•èŠ‚ç‚¹ Kubernetes éƒ¨ç½²ï¼Œå¹¶äº†è§£äº† Kubernetes *å‘½åç©ºé—´* çš„æ¦‚å¿µï¼Œç”¨äºèµ„æºçš„éš”ç¦»å’Œåˆ†ç»„ã€‚æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å•ä¸ª Nginx å®¹å™¨çš„ podï¼Œå¹¶æ¢ç´¢äº† YAML æ ¼å¼çš„æœ€ç®€ pod è§„æ ¼å®šä¹‰ã€‚

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å…¶ä»– Kubernetes èµ„æºåŠå…¶ä½¿ç”¨æ–¹æ³•ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Kubernetes é…ç½®å’Œæ‰©å±•å¤šå®¹å™¨åº”ç”¨ç¨‹åºï¼Œå¦‚ä½•ä½¿ç”¨ Kubernetes è¿è¡Œæœ‰çŠ¶æ€å·¥ä½œè´Ÿè½½ï¼Œä»¥åŠäº†è§£å¦‚ä½•æš´éœ²åœ¨ K8s ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚

# é—®é¢˜

åœ¨æˆ‘ä»¬æ€»ç»“æ—¶ï¼Œè¿™é‡Œæœ‰ä¸€ç³»åˆ—é—®é¢˜ä¾›æ‚¨æµ‹è¯•æœ‰å…³æœ¬ç« å†…å®¹çš„çŸ¥è¯†ã€‚æ‚¨å¯ä»¥åœ¨*é™„å½•*çš„*è¯„ä¼°*éƒ¨åˆ†æ‰¾åˆ°ç­”æ¡ˆï¼š

1.  ä»¥ä¸‹å“ªé¡¹æ˜¯ Kubernetes ä¸­æœ€å°çš„å¯è°ƒåº¦å•å…ƒï¼Ÿ

    1.  å®¹å™¨

    1.  è¾¹è½¦

    1.  Pod

    1.  éƒ¨ç½²

1.  åœ¨ä¸€ä¸ª pod ä¸­è¿è¡Œçš„å®¹å™¨å…±äº«ä»¥ä¸‹å“ªäº›é€‰é¡¹ï¼ˆå¯é€‰æ‹©å¤šä¸ªï¼‰ï¼Ÿ

    1.  åç§°

    1.  å­˜å‚¨

    1.  ç½‘ç»œ

    1.  å†…å­˜

1.  ä»¥ä¸‹ Kubernetes èŠ‚ç‚¹ç±»å‹æœ‰å“ªäº›ï¼ˆé€‰æ‹©å¤šä¸ªï¼‰ï¼Ÿ

    1.  Secondary

    1.  ä¸»èŠ‚ç‚¹

    1.  å·¥ä½œèŠ‚ç‚¹

    1.  Primary

1.  ä»¥ä¸‹å“ªäº›æ˜¯æ§åˆ¶å¹³é¢èŠ‚ç‚¹çš„ç»„ä»¶ï¼ˆé€‰æ‹©å¤šä¸ªï¼‰ï¼Ÿ

    1.  Docker, kube-scheduler, cloud-controller-manager

    1.  kube-master-server, kubelet, kube-proxy

    1.  kube-scheduler, kube-controller-manager

    1.  kube-api-server, etcd

1.  ä»¥ä¸‹å“ªä¸ª K8s é›†ç¾¤é…ç½®å¯ä»¥æ¨èï¼Ÿ

    1.  1 ä¸ªä¸»èŠ‚ç‚¹ï¼Œ5 ä¸ªå·¥ä½œèŠ‚ç‚¹

    1.  2 ä¸ªä¸»èŠ‚ç‚¹ï¼Œ3 ä¸ªå·¥ä½œèŠ‚ç‚¹

    1.  2 ä¸ªä¸»èŠ‚ç‚¹ï¼Œ20 ä¸ªå·¥ä½œèŠ‚ç‚¹

    1.  3 ä¸ªä¸»èŠ‚ç‚¹ï¼Œ10 ä¸ªå·¥ä½œèŠ‚ç‚¹

1.  ä»¥ä¸‹å“ªäº›ç»„ä»¶ç”¨äºå­˜å‚¨ Kubernetes é›†ç¾¤çŠ¶æ€ï¼Ÿ

    1.  kube-api-server

    1.  kube-volume

    1.  kubelet

    1.  etcd

1.  ä»¥ä¸‹å“ªä¸ªç»„ä»¶æ˜¯ Kubernetes ç”¨æ¥ä¸‹è½½é•œåƒå¹¶å¯åŠ¨å®¹å™¨çš„ï¼Ÿ

    1.  Kubelet

    1.  å®¹å™¨è¿è¡Œæ—¶

    1.  etcd

    1.  kube-proxy

1.  ä»¥ä¸‹å“ªä¸ªç»„ä»¶è´Ÿè´£ Kubernetes æ§åˆ¶å™¨æµç¨‹ï¼Ÿ

    1.  kube-api-server

    1.  kube-proxy

    1.  kube-controller-manager

    1.  kube-scheduler

1.  ä»¥ä¸‹å“ªäº›å¯ä»¥ç”¨æ¥è®¿é—® Kubernetes APIï¼ˆé€‰æ‹©å¤šä¸ªï¼‰ï¼Ÿ

    1.  kubeadmin

    1.  kubectl

    1.  kubelet

    1.  dashboard

1.  Kubernetes æœ‰ä¸€ä¸ªå£°æ˜å¼ APIï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ

    1.  æˆ‘ä»¬æ€»æ˜¯éœ€è¦å£°æ˜ä¸€ä¸ª YAML è§„æ ¼æ–‡ä»¶æ¥ä½¿ç”¨ K8s API

    1.  æˆ‘ä»¬å£°æ˜æœŸæœ›çš„çŠ¶æ€ï¼ŒK8s å°†ä¼šåœ¨æŸä¸ªæ—¶åˆ»è¾¾åˆ°è¿™ä¸ªçŠ¶æ€

    1.  æˆ‘ä»¬å‘Šè¯‰ Kubernetes å¦‚ä½•å¤„ç†å“ªäº›èµ„æº

    1.  æˆ‘ä»¬å£°æ˜æœŸæœ›çš„çŠ¶æ€ï¼ŒK8s å°†ä¼šä¸æ–­åŠªåŠ›è¾¾æˆè¿™ä¸ªçŠ¶æ€

1.  ä»¥ä¸‹å“ªäº› Kubernetes API ç‰ˆæœ¬é»˜è®¤å¯ç”¨ï¼ˆé€‰æ‹©å¤šä¸ªï¼‰ï¼Ÿ

    1.  Alpha

    1.  Beta

    1.  Gamma

    1.  ç¨³å®š

1.  å¦‚ä½•æ‰©å±• Kubernetes API æ·»åŠ æ–°åŠŸèƒ½ï¼ˆé€‰æ‹©å¤šä¸ªï¼‰ï¼Ÿ

    1.  ä»£ç èµ„æºå®šä¹‰

    1.  èšåˆå±‚

    1.  æ‰©å±•å±‚

    1.  è‡ªå®šä¹‰èµ„æºå®šä¹‰

1.  ä»¥ä¸‹å“ªä¸ªé¡¹ç›®å…è®¸ä½ å°† Kubernetes æ‰©å±•åˆ°å®¹å™¨ç¼–æ’ä¹‹å¤–ï¼ˆé€‰æ‹©å¤šä¸ªï¼‰ï¼Ÿ

    1.  Knative ç”¨äº FaaS

    1.  Linkerd ç”¨äº IPAM

    1.  Kvirt ç”¨äºè™šæ‹Ÿæœºç¼–æ’

    1.  KubeVirt ç”¨äºè™šæ‹Ÿæœºç¼–æ’

1.  ä»€ä¹ˆæœ‰åŠ©äºæ£€æµ‹ Kubernetes èµ„æºå½“å‰çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¹‹é—´çš„å·®å¼‚ï¼Ÿ

    1.  å®¹å™¨è¿è¡Œæ—¶

    1.  Kubernetes è°ƒåº¦å™¨

    1.  è‡ªå®šä¹‰èµ„æºå®šä¹‰

    1.  åè°ƒå¾ªç¯

1.  ä»€ä¹ˆæ˜¯è¿è¡Œåœ¨ pod ä¸­çš„æ¬¡è¦å®¹å™¨ï¼Ÿ

    1.  Flatcars

    1.  Sidecars

    1.  Podcars

    1.  Helpcars

1.  ä»¥ä¸‹å“ªä¸ªæ ¼å¼ç”¨äºç¼–å†™ Kubernetes è§„æ ¼æ–‡ä»¶ï¼Ÿ

    1.  CSV

    1.  Protobuf

    1.  YAML

    1.  Marshal

1.  ä»¥ä¸‹å“ªä¸ª Kubernetes ç»„ä»¶è´Ÿè´£å°†æ–° pod åˆ†é…åˆ°èŠ‚ç‚¹ä¸Šï¼Ÿ

    1.  kube-api

    1.  kube-proxy

    1.  kube-scheduler

    1.  kube-controller-manager

1.  ä»¥ä¸‹å“ªä¸ª K8s CLI å‘½ä»¤å¯ä»¥ç”¨æ¥åˆ—å‡º `development` å‘½åç©ºé—´ä¸­çš„ podsï¼Ÿ

    1.  `kubectl list pods -``n development`

    1.  `kubectl get pods --``namespace development`

    1.  `kubectl show pods --``namespace development`

    1.  `kubectl get` `pods --all-namespaces`

1.  ä»¥ä¸‹å“ªä¸ª K8s CLI å‘½ä»¤å¯ä»¥ç”¨æ¥åˆ—å‡ºé›†ç¾¤ä¸­çš„æ‰€æœ‰å‘½åç©ºé—´ï¼Ÿ

    1.  `kubectl list` `namespaces --all-namespaces`

    1.  `kubectl` `show namespaces`

    1.  `kubectl` `get namespaces`

    1.  `kubectl` `get all`

1.  ä»¥ä¸‹å“ªä¸ª pod çŠ¶æ€è¡¨ç¤ºå…¶å®¹å™¨æ­£åœ¨æ‰§è¡Œï¼Ÿ

    1.  æ‰§è¡Œä¸­

    1.  æˆåŠŸ

    1.  è¿è¡Œä¸­

    1.  ContainerCreated

1.  ä»¥ä¸‹å“ªäº› Pod çŠ¶æ€è¡¨ç¤ºå…¶æ‰€æœ‰å®¹å™¨éƒ½åœ¨è¿è¡Œï¼ˆå¯å¤šé€‰ï¼‰ï¼Ÿ

    1.  100%

    1.  1/2

    1.  2/2

    1.  1/1

# è¿›ä¸€æ­¥é˜…è¯»

è‹¥è¦äº†è§£æœ¬ç« ä¸­æ¶µç›–çš„æ›´å¤šå†…å®¹ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹èµ„æºï¼š

+   Minikube æ•…éšœæ’é™¤æŒ‡å—: [`minikube.sigs.k8s.io/docs/handbook/troubleshooting/`](https://minikube.sigs.k8s.io/docs/handbook/troubleshooting/)

+   å¸¸ç”¨çš„ `kubectl` å‘½ä»¤: [`kubernetes.io/docs/reference/kubectl/cheatsheet/`](https://kubernetes.io/docs/reference/kubectl/cheatsheet/)

+   K8s Pod æ¦‚å¿µ: [`kubernetes.io/docs/concepts/workloads/pods/`](https://kubernetes.io/docs/concepts/workloads/pods/)

+   K8s å‘½åç©ºé—´æ¦‚å¿µ: [`kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/`](https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/)
