# 前言

在当今数据驱动的世界里，处理和分析海量数据的能力已成为各行各业企业的重要竞争优势。大数据技术作为处理日益增长的数据量、速度和多样性的强大工具，帮助组织提取有价值的见解并推动基于数据的决策。然而，管理和扩展这些技术可能是一项艰巨的任务，通常需要大量的基础设施和运营开销。

进入 Kubernetes，这一开源容器编排平台已经彻底改变了我们部署和管理应用程序的方式。通过提供标准化和自动化的容器管理方法，Kubernetes 简化了复杂应用程序（包括大数据工作负载）的部署和扩展。本书旨在弥合这两种强大技术之间的差距，引导你通过在 Kubernetes 上实施强大且可扩展的大数据架构的过程。

在各章内容中，你将开始一段全面的学习之旅，从容器和 Kubernetes 架构的基础知识入手。你将学习如何构建和部署 Docker 镜像，了解 Kubernetes 的核心组件，并获得在本地和云端设置 Kubernetes 集群的实践经验。这一扎实的基础将为你后续深入现代数据堆栈的学习打下基础。

本书将向你介绍大数据生态系统中最广泛采用的工具，如用于数据处理的 Apache Spark、用于管道编排的 Apache Airflow 以及用于实时数据摄取的 Apache Kafka。你不仅将学习这些技术背后的理论概念，还将获得在 Kubernetes 上实施这些技术的实践经验。通过一系列动手实践和项目，你将深入理解如何构建和部署数据管道、处理大数据集，并在 Kubernetes 集群上编排复杂的工作流。

随着书籍的进展，你将探索更高级的主题，例如使用 Trino 和 Elasticsearch 部署数据消费层，以及通过 Amazon Bedrock 集成生成性 AI 工作负载。这些主题将为你提供在 Kubernetes 上构建和维护强大、可扩展的大数据架构所需的知识和技能，确保高效的数据处理、分析和分析应用程序的部署。

在本书的结尾，你将全面了解大数据与 Kubernetes 之间的协同作用，使你能够利用这些技术的强大功能推动创新和业务增长。无论你是数据工程师、DevOps 专业人士，还是技术爱好者，本书将为你提供在 Kubernetes 上成功实施和管理大数据工作负载所需的实用知识和动手经验。

# 本书适用对象

如果你是数据工程师、云架构师、DevOps 专业人士、数据或科学经理，或技术爱好者，那么本书适合你。你应该具备 Python 和 SQL 编程的基础知识，以及对 Apache Spark、Apache Kafka 和 Apache Airflow 的基本了解。对 Docker 和 Git 的基本理解也将有所帮助。

# 本书内容

*第一章*，*容器入门*，带你开始了解容器和 Docker，这是现代应用程序部署的基础技术。你将学习如何安装 Docker 并运行你的第一个容器镜像，亲身体验容器化的强大功能。此外，你还将深入研究 Dockerfile 的细节，掌握制作简洁且功能完善的容器镜像的技巧。通过实践示例，包括使用 Python 构建简单的 API 和数据处理任务，你将掌握将服务和任务容器化的技巧。到本章结束时，你将有机会通过构建自己的任务和 API 来巩固新获得的知识，为一系列基于容器的实际应用程序构建作品集奠定基础。

*第二章*，*Kubernetes 架构*，将向你介绍构成 Kubernetes 架构的核心组件。你将了解控制平面组件，如 API 服务器、etcd、调度器和控制器管理器，以及工作节点组件，如 kubelet、kube-proxy 和容器运行时。本章将解释每个组件的角色和职责，以及它们如何相互作用以确保 Kubernetes 集群的平稳运行。此外，你将深入了解 Kubernetes 中的关键概念，包括 pod、部署、服务、任务、有状态集合、持久化卷、ConfigMaps 和 Secrets。本章结束时，你将对 Kubernetes 的架构和核心概念有坚实的基础，为随后的实践操作做好准备。

*第三章*，*Kubernetes – 实践操作*，将指导你通过使用 kind 部署本地 Kubernetes 集群的过程，并使用 Amazon EKS 部署基于云的集群。你将学习成功部署 EKS 集群所需的最小 AWS 账户配置。设置集群后，你将有机会选择将应用程序部署到本地环境还是云环境。无论你做出什么选择，你都将重新进行*第一章*中开发的 API 和数据处理工作，并将其部署到 Kubernetes。这个实践经验将巩固你对 Kubernetes 概念的理解，并为后续章节的更高级话题做好准备。

*第四章*，*现代数据架构*，向你介绍了最著名的数据架构设计，重点讲解了“lambda”架构。你将了解构成现代数据架构的数据湖（房）架构所需的工具。这些工具包括用于数据处理的 Apache Spark、用于数据管道编排的 Apache Airflow，以及用于实时事件流处理和数据摄取的 Apache Kafka。本章将为你提供这些工具的概念性介绍，并展示它们如何协同工作，构建数据湖（房）架构的核心技术资产。

*第五章*，*使用 Apache Spark 进行大数据处理*，向你介绍了 Apache Spark，这是一种广泛使用的大数据处理工具。你将了解 Spark 程序的核心组件，如何扩展和处理分布式计算，以及与 Spark 协作的最佳实践。你将通过 DataFrames API 和 Spark SQL API 实现简单的数据处理任务，并使用 Python 与 Spark 进行交互。本章将指导你在本地安装 Spark 以进行测试，帮助你在将其部署到更大规模之前，先获得与这个强大工具的实际操作经验。

*第六章*，*使用 Apache Airflow 构建数据管道*，向你介绍了 Apache Airflow，这是一种被广泛采用的开源工具，用于数据管道的编排。你将了解如何使用 Docker 和 Astro CLI 安装 Airflow，使得安装过程变得简单。本章将让你熟悉 Airflow 的核心功能和最常用的操作符，以便执行数据工程任务。此外，你将深入了解如何构建具有韧性和高效性的可靠数据管道，充分利用 Airflow 的能力。通过本章的学习，你将牢固掌握如何使用 Airflow 编排复杂的数据工作流，这是任何从事大数据工作并在 Kubernetes 上运行的数工程师或数据架构师所必备的技能。

*第七章*，*使用 Apache Kafka 进行实时事件流处理和数据摄取*，向你介绍了 Apache Kafka，这是一种分布式事件流平台，广泛应用于构建实时数据管道和流式应用程序。你将理解 Kafka 的架构，以及它如何扩展并保持韧性，使其能够处理高容量的实时数据并保持低延迟。你将学习 Kafka 的分布式主题设计，这一设计支撑了其强大的实时事件处理能力。本章将引导你通过 Docker 在本地运行 Kafka，并实施基本的读取和写入操作。此外，你还将探讨不同的数据复制和主题分发策略，确保你能够设计并实现高效可靠的 Kafka 集群。

*第八章*，*在 Kubernetes 上部署大数据技术栈*，引导你了解如何将前几章学到的大数据工具部署到 Kubernetes 集群中。你将从编写 bash 脚本开始，部署 Spark 操作符并在 Kubernetes 上运行`SparkApplications`。接下来，你将部署 Apache Airflow 到 Kubernetes，从而在集群内协调数据管道。此外，你还将使用临时集群和 JBOD 技术将 Apache Kafka 部署到 Kubernetes。Kafka Connect 集群也会被部署，并通过连接器将数据从 SQL 数据库迁移到持久化对象存储。到本章结束时，你将拥有一个完全可运行的大数据技术栈，准备好进行进一步的探索和开发。

*第九章*，*数据消费层*，引导你了解如何在 Kubernetes 上部署的大数据架构中，安全地将数据提供给业务分析师。你将从了解使用“数据湖引擎”而非数据仓库的现代方法开始。在本章中，你将熟悉 Trino，了解如何直接通过 Kubernetes 从数据湖中进行数据消费。你将理解数据湖引擎的工作原理，将其部署到 Kubernetes 中，并监控查询执行和历史记录。此外，对于实时数据，你将熟悉 Elasticsearch 和 Kibana 进行数据消费。你将部署这些工具，并学习如何在其中索引数据以及如何使用 Kibana 构建简单的数据可视化。

*第十章*，*在 Kubernetes 中构建大数据管道*，引导你了解如何在 Kubernetes 集群中部署和协调两个完整的数据管道，一个用于批处理，另一个用于实时处理。你将连接本书中学到的所有工具，如 Apache Spark、Apache Airflow、Apache Kafka 和 Trino，构建一个单一的复杂解决方案。你将在 Kubernetes 上部署这些工具，编写数据处理和协调的代码，并通过 SQL 引擎使数据可供查询。到本章结束时，你将拥有在 Kubernetes 上构建和管理一个综合大数据管道的实际经验，将各种组件和技术整合成一个统一且可扩展的架构。

*第十一章*，*Kubernetes 上的生成式 AI*，引导你完成在 Kubernetes 上部署生成式 AI 应用的过程，使用 Amazon Bedrock 作为基础模型的服务套件。你将学习如何将应用连接到作为**检索增强生成**（**RAG**）层的知识库，这通过提供对外部信息源的访问，增强了 AI 模型的能力。此外，你将发现如何通过代理自动化任务执行，使生成式 AI 无缝集成到你的工作流中。在本章结束时，你将对如何在 Kubernetes 上利用生成式 AI 的力量有一个坚实的理解，从而为个性化客户体验、智能助手和自动化商业分析开启新可能。

*第十二章*，*从这里开始的旅程*，引导你迈向掌握大数据和 Kubernetes 的下一步。你将探索一些关键概念和技术，这些技术对在 Kubernetes 上构建强大且可扩展的解决方案至关重要。包括 Kubernetes 和应用程序的监控策略、实现高效通信的服务网格、保护你的集群和应用程序、启用自动扩展、采用 GitOps 和 CI/CD 实践以简化部署和管理，以及 Kubernetes 成本控制。每个主题，你都将获得概述和对进一步探索相关技术的建议，帮助你加深这些领域的知识和技能。

# 为了最大程度地利用本书

一些 Python 编程基础知识以及对 Spark、Docker、Airflow、Kafka 和 Git 的了解将帮助你更好地利用本书的内容。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| Python>=3.9 | Windows、macOS 或 Linux |
| Docker，最新版本 | Linux |
| Docker Desktop，最新版本 | Windows 或 macOS |
| Kubectl | Windows、macOS 或 Linux |
| Awscli | Windows、macOS 或 Linux |
| Eksctl | Windows、macOS 或 Linux |
| DBeaver 社区版 | Windows、macOS 或 Linux |

每一章都会提供软件安装所需的所有指导。

**如果你正在使用本书的电子版，我们建议你亲自输入代码，或从本书的 GitHub 仓库访问代码（链接在下一节提供）。这样可以帮助你避免因复制和粘贴代码而产生的潜在错误** **。**

# 下载示例代码文件

你可以从 GitHub 下载本书的示例代码文件，地址为 [`github.com/PacktPublishing/Bigdata-on-Kubernetes`](https://github.com/PacktPublishing/Bigdata-on-Kubernetes)。如果代码有更新，它将在 GitHub 仓库中更新。

我们还提供来自我们丰富书籍和视频目录的其他代码包，可以在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。快去看看吧！

# 使用的约定

本书中使用了许多文本约定。

`文本中的代码`：表示文本中的代码词、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 账户。示例：“此命令将从 Docker Hub 公共仓库拉取`hello-world`镜像，并在其中运行应用程序。”

代码块设置如下：

```
import pandas as pd
url = 'https://raw.githubusercontent.com/jbrownlee/Datasets/master/pima-indians-diabetes.data.csv'
df = pd.read_csv(url, header=None)
df["newcolumn"] = df[5].apply(lambda x: x*2)
print(df.columns)
print(df.head())
print(df.shape)
```

任何命令行输入或输出如下所示：

```
$ sudo apt install docker.io
```

以上代码片段上方的文件名将显示如下：

**Cjava.py**

**粗体**：表示新术语、重要词汇或屏幕上显示的文字。例如，菜单或对话框中的文字通常以**粗体**显示。示例：“您应该确保在**配置**页面上选中**使用 WSL 2 而非 Hyper-V**选项。”

小贴士或重要提示

显示为如下格式。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果您对本书的任何部分有疑问，请通过电子邮件联系我们：customercare@packtpub.com，并在邮件主题中注明书名。

**勘误表**：尽管我们已经尽力确保内容的准确性，但难免会有错误。如果您在本书中发现错误，我们将非常感激您能向我们报告。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果您在互联网上遇到我们作品的任何非法版本，恳请提供该内容的地址或网站名称。请通过电子邮件联系我们：copyright@packt.com，并附上相关链接。

**如果您有兴趣成为作者**：如果您在某个主题上拥有专长，并且有兴趣编写或参与书籍的撰写，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

阅读完*《Kubernetes 上的大数据》*后，我们很乐意听取您的反馈！请[点击这里直接访问本书的亚马逊评论页面](https://packt.link/r/1-835-46214-6)并分享您的意见。

您的评论对我们和技术社区非常重要，帮助我们确保提供优质内容。

# 下载本书的免费 PDF 副本

感谢购买本书！

喜欢随时阅读但无法随身携带纸质书籍？

您的电子书购买是否与您选择的设备不兼容？

不用担心，现在每本 Packt 书籍都附赠免费的无 DRM 版本 PDF。

随时随地在任何设备上阅读。从您最喜欢的技术书籍中直接搜索、复制并粘贴代码到您的应用程序中。

优惠不止于此，您还可以获取独家折扣、通讯和每日精彩免费内容的订阅

遵循以下简单步骤获取这些好处：

1.  扫描下方的 QR 码或访问以下链接

![下载本书的免费 PDF 副本](img/B21927_QR_Free_PDF.jpg)

[`packt.link/free-ebook/978-1-83546-214-0`](https://packt.link/free-ebook/978-1-83546-214-0)

1.  提交您的购买证明

1.  就这些了！我们将免费 PDF 和其他福利直接发送到您的电子邮件

# 第一部分：Docker 和 Kubernetes

在这部分中，您将学习容器化和 Kubernetes 的基础知识。您将首先了解容器的基础知识以及如何构建和运行 Docker 镜像。这将为您在处理容器化应用程序时提供坚实的基础。接下来，您将深入探讨 Kubernetes 架构，探索其组件、特性以及如 pod、部署和服务等核心概念。有了这些知识，您将能够熟练地操作 Kubernetes 生态系统。最后，您将通过部署本地和云端 Kubernetes 集群，并将之前构建的应用程序部署到这些集群上，获得实际操作经验。

此部分包含以下章节:

+   *第一章*，开始使用容器

+   *第二章*，Kubernetes 架构

+   *第三章*，Kubernetes – Hands On
