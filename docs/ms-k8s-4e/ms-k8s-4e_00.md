# 序言

Kubernetes 是一个开源系统，用于自动化容器化应用程序的部署、扩展和管理。如果你运行的不仅仅是几个容器，或者希望自动化管理你的容器，那么你就需要 Kubernetes。本书专注于引导你掌握 Kubernetes 集群的高级管理。

本书从解释 Kubernetes 架构的基础开始，详细介绍 Kubernetes 的设计。你将发现如何在 Kubernetes 上运行复杂的有状态微服务，包括横向扩展、滚动更新、资源配额和持久化存储后端等高级功能。通过真实的用例，你将探索网络配置的选项，并了解如何设置、操作、保护和排除 Kubernetes 集群的故障。最后，你将学习高级主题，如自定义资源、API 聚合、服务网格和无服务器计算。所有内容都与 Kubernetes 1.26 版本兼容。读完本书，你将掌握从中级到高级所需的所有知识。

# 本书的读者对象

本书面向那些具有中级 Kubernetes 知识的系统管理员和开发人员，并希望掌握高级功能的读者。你还应该具备基本的网络知识。本书是一本高级书籍，提供了一条通往掌握 Kubernetes 的道路。

# 本书内容

*第一章*，*理解 Kubernetes 架构*，在这一章中，我们将一起构建充分利用 Kubernetes 的必要基础。我们将首先理解什么是 Kubernetes，什么不是 Kubernetes，以及容器编排到底意味着什么。然后我们将介绍一些重要的 Kubernetes 概念，这些概念将构成我们在整本书中使用的术语。

*第二章*，*创建 Kubernetes 集群*，在这一章中，我们将卷起袖子，使用 minikube、KinD 和 k3d 构建一些 Kubernetes 集群。我们将讨论并评估其他工具，如 kubeadm 和 Kubespray。我们还将探索本地、云端和裸金属等不同的部署环境。

*第三章*，*高可用性与可靠性*，在这一章中，我们将深入探讨高可用集群的话题。这是一个复杂的话题。Kubernetes 项目和社区尚未就实现高可用性 nirvana（完美状态）达成一致的解决方案。

高可用 Kubernetes 集群涉及多个方面，如确保控制平面能够在故障发生时继续运行，保护 etcd 中的集群状态，保护系统数据，以及快速恢复容量和/或性能。不同的系统会有不同的可靠性和可用性要求。

*第四章*，*确保 Kubernetes 的安全性*，在本章中，我们将探讨安全性这一重要话题。Kubernetes 集群是由多个相互作用的组件层组成的复杂系统。在运行关键应用程序时，不同层次的隔离和分区非常重要。为了确保系统安全并确保对资源、能力和数据的适当访问，我们必须首先理解 Kubernetes 作为一个通用编排平台面临的独特挑战，特别是它运行的是未知的工作负载。然后，我们可以利用各种安全性、隔离和访问控制机制，确保集群、运行其上的应用程序和数据的安全性。我们将讨论各种最佳实践以及何时使用每种机制。

*第五章*，*在实践中使用 Kubernetes 资源*，在本章中，我们将设计一个虚构的大规模平台，挑战 Kubernetes 的能力和可扩展性。Hue 平台的目标是创建一个无所不知、无所不能的数字助手。Hue 是你的数字延伸，Hue 将帮助你做任何事情，找到任何东西，并且在许多情况下，会代替你做很多事情。显然，它需要存储大量信息，集成许多外部服务，响应通知和事件，并且在与你互动时表现得非常智能。

*第六章*，*管理存储*，在本章中，我们将探讨 Kubernetes 如何管理存储。存储与计算有很大的不同，但从高层次来看，它们都是资源。作为一个通用平台，Kubernetes 采取通过编程模型和存储提供商插件将存储抽象化的方式。

*第七章*，*在 Kubernetes 上运行有状态应用程序*，在本章中，我们将学习如何在 Kubernetes 上运行有状态应用程序。Kubernetes 通过根据复杂的需求和配置（如命名空间、限制和配额）自动启动和重启集群节点上的 pod，减轻了我们的工作负担。但当 pod 运行需要存储意识的软件，如数据库和队列时，迁移 pod 可能会导致系统崩溃。

*第八章*，*部署和更新应用程序*，在本章中，我们将探讨 Kubernetes 提供的自动化 pod 可扩展性，它如何影响滚动更新，以及如何与配额进行交互。我们将涉及一个重要的话题——资源配置，以及如何选择和管理集群的大小。最后，我们将介绍 Kubernetes 团队如何提高 Kubernetes 的性能，以及他们如何使用 Kubemark 工具测试 Kubernetes 的极限。

*第九章*，*打包应用程序*，在这一章中，我们将深入研究 Helm，Kubernetes 的包管理器。每个平台，尤其是那些成功且非平凡的平台，都必须有一个良好的打包系统。Helm 是由 Deis 开发的（2017 年 4 月 4 日被微软收购），并后来直接贡献给 Kubernetes 项目。它于 2018 年成为 CNCF 项目。我们将从理解 Helm 的动机、架构和组件开始。

*第十章*，*探索 Kubernetes 网络*，在这一章中，我们将研究网络这一重要话题。Kubernetes 作为一个编排平台，管理运行在不同机器（物理或虚拟）上的容器/Pod，并要求有一个明确的网络模型。

*第十一章*，*在多个集群上运行 Kubernetes*，在这一章中，我们将把它提升到一个新的层次，即在多个云和集群上运行 Kubernetes。Kubernetes 集群是一个紧密结合的单元，所有组件都在相对接近的地方运行，并通过快速网络连接（通常是物理数据中心或云服务提供商的可用区）。这对许多用例来说很有用，但也有一些重要的用例，系统需要超越单一集群进行扩展。

*第十二章*，*Kubernetes 上的无服务器计算*，在这一章中，我们将探索云中无服务器计算的迷人世界。术语“无服务器”受到了很多关注，但它是一个用来描述两种不同范式的误称。真正的无服务器应用程序在用户的浏览器或移动应用中运行，仅与外部服务交互。而我们在 Kubernetes 上构建的无服务器系统则不同。

*第十三章*，*监控 Kubernetes 集群*，在这一章中，我们将讨论如何确保系统正常运行并执行得当，以及在系统出现问题时如何响应。在*第三章*，*高可用性和可靠性*中，我们讨论了相关的主题。本章的重点是了解系统中发生的事情，以及可以使用哪些实践和工具。

*第十四章*，*利用服务网格*，在这一章中，我们将学习服务网格如何使您能够将监控和可观察性等跨切关注点从应用代码中外部化。服务网格是您在 Kubernetes 上设计、演进和操作分布式系统方式的真正范式转变。我喜欢将它看作是云原生分布式系统的面向方面编程。

*第十五章*，*扩展 Kubernetes*，在这一章中，我们将深入探讨 Kubernetes 的内部结构。我们将从 Kubernetes API 开始，学习如何通过直接访问 API、Go 客户端和自动化 kubectl 来进行编程式地与 Kubernetes 交互。接下来，我们将了解如何通过自定义资源扩展 Kubernetes API。最后一部分将重点讨论 Kubernetes 支持的各种插件。Kubernetes 的许多操作方面是模块化的，且设计为可扩展的。我们将检查 API 聚合层以及几种类型的插件，例如自定义调度器、授权、准入控制、自定义度量和存储卷。最后，我们将探讨如何扩展 kubectl 并添加自定义命令。

*第十六章*，*Kubernetes 的治理*，在这一章中，我们将了解 Kubernetes 在大型企业组织中的日益重要的角色，以及什么是治理，治理在 Kubernetes 中的应用。我们将探讨策略引擎，回顾一些流行的策略引擎，然后深入了解 Kyverno。

*第十七章*，*在生产环境中运行 Kubernetes*，在这一章中，我们将把注意力集中在 Kubernetes 在生产环境中的整体管理上。重点将放在如何在云中运行多个托管的 Kubernetes 集群。运行 Kubernetes 的生产环境有很多不同的方面，我们将主要关注计算方面，这是最基础和最重要的部分。

*第十八章*，*Kubernetes 的未来*，在这一章中，我们将从多个角度探讨 Kubernetes 的未来。我们将首先从 Kubernetes 自诞生以来的势头出发，涵盖社区、生态系统和思想领导力等维度。剧透：Kubernetes 凭借压倒性的优势赢得了容器编排大战。随着 Kubernetes 的成长和成熟，竞争的焦点不再是击败对手，而是与其自身的复杂性作斗争。可用性、工具链和教育将在容器编排这一仍然新兴、快速发展的、且尚未被充分理解的领域中发挥重要作用。接下来，我们将探讨一些非常有趣的模式和趋势。

# 最大化利用本书

为了跟随每一章的示例，你需要在机器上安装一个最新版本的 Docker 和 Kubernetes，理想情况下是 Kubernetes 1.18。如果你的操作系统是 Windows 10 专业版，你可以启用虚拟化模式；否则，你需要安装 VirtualBox 并使用 Linux 客户端操作系统。如果你使用 macOS，那么一切就绪。

## 下载示例代码文件

本书的代码包托管在 GitHub 上，网址为[`github.com/PacktPublishing/Mastering-Kubernetes-4th-Edition`](https://github.com/PacktPublishing/Mastering-Kubernetes-4th-Edition)。我们还有其他代码包，来自我们丰富的书籍和视频目录，网址为[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)。快来查看吧！

## 下载彩色图片

我们还提供了一个 PDF 文件，里面包含了本书使用的截图/图表的彩色图片。你可以在这里下载： [`packt.link/gXMql`](https://packt.link/gXMql)。

## 本书中使用的约定

本书中使用了多种文本约定。

`CodeInText`：表示文本中的代码词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名。例如：“如果你选择了 HyperKit 而不是 VirtualBox，你需要在启动集群时添加标志`--vm-driver=hyperkit`。”

一段代码如下所示：

```
apiVersion: "etcd.database.coreos.com/v1beta2"
kind: "EtcdCluster"
metadata:
  name: "example-etcd-cluster"
spec:
  size: 3
  version: "3.2.13" 
```

当我们希望引起你注意某个代码块的特定部分时，相关的行或项目会被高亮显示：

```
apiVersion: "etcd.database.coreos.com/v1beta2"
kind: "EtcdCluster"
metadata:
  **name:****"example-etcd-cluster"**
spec:
  size: 3
  version: "3.2.13" 
```

任何命令行输入或输出都如下所示：

```
$ k get pods
NAME                   READY   STATUS    RESTARTS   AGE
echo-855975f9c-r6kj8   1/1     Running   0          2m11s 
```

**粗体**：表示一个新术语、一个重要词或在屏幕上看到的词。例如，菜单或对话框中的词会像这样出现在文本中。例如：“从**管理**面板中选择**系统信息**。”

警告或重要注意事项如下所示。

提示和技巧如下所示。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：发送电子邮件至 `feedback@packtpub.com` 并在邮件主题中注明书名。如果你对本书的任何内容有疑问，请通过 `questions@packtpub.com` 与我们联系。

**勘误**：虽然我们已尽力确保内容的准确性，但错误难免。如果你在本书中发现错误，请帮助我们报告。请访问 [`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，点击**提交勘误**，并填写表单。

**盗版**：如果你在网上发现任何非法版本的我们的作品，感谢你提供该地址或网站名称。请通过 `copyright@packtpub.com` 联系我们，并附上相关资料的链接。

**如果你有兴趣成为作者**：如果你在某个领域拥有专长并且有兴趣写书或参与书籍编写，请访问 [`authors.packtpub.com`](http://authors.packtpub.com)。

# 分享你的想法

阅读完《*掌握 Kubernetes 第四版*》后，我们非常想听听你的想法！请 [点击这里直接前往 Amazon 评价页面](https://packt.link/r/1804611395)并分享你的反馈。

你的评论对我们和技术社区来说非常重要，它将帮助我们确保提供高质量的内容。

# 免费下载本书的 PDF 副本

感谢你购买本书！

你喜欢在路上阅读但又无法随身携带纸质书籍吗？你的电子书购买是否与你选择的设备不兼容？

别担心，现在每本 Packt 书籍都会免费提供该书的无 DRM PDF 版本。

随时随地，在任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制并粘贴代码到您的应用程序中。

福利不仅仅是这些，您还可以获得独家折扣、新闻简报，并每天在邮箱中收到精彩的免费内容

按照这些简单步骤获取福利：

1.  扫描二维码或访问以下链接

*![二维码 说明自动生成](img/B18998_QR_Free_PDF.png)*

[`packt.link/free-ebook/9781804611395`](https://packt.link/free-ebook/9781804611395)

1.  提交您的购买凭证

1.  就这样！我们会将您的免费 PDF 及其他福利直接发送到您的邮箱
